<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script src="/cdn-cgi/apps/head/3cOPSgo5Omz84ycX7CvigfX4cpw.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82213539-2"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-82213539-2');
        </script>
        <title>The Grails Framework 4.0.0</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <div class="navTitle">
                
                The Grails Framework
            </div>
            <div class="navLinks">
                <ul>
                    <li>
                        <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                            <a href="../guide/index.html" class="button">Table of contents</a>
                            <div id="nav-summary-childs" style="display:none;">
                                
                                <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>&#31616;&#20171;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>2</strong><span>&#20837;&#38376;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#upgrading"><strong>3</strong><span>&#20174; Grails 3.3.x &#21319;&#32423;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#conf"><strong>4</strong><span>&#37197;&#32622;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#commandLine"><strong>5</strong><span>&#21629;&#20196;&#34892;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#profiles"><strong>6</strong><span>&#24212;&#29992;&#31243;&#24207;&#37197;&#32622;&#25991;&#20214;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#GORM"><strong>7</strong><span>&#23545;&#35937;&#20851;&#31995;&#26144;&#23556; &#65288;GORM&#65289;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#theWebLayer"><strong>8</strong><span>Web &#23618;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#traits"><strong>9</strong><span>&#29305;&#24449;&#65288;Trait&#65289;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#REST"><strong>10</strong><span>REST</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#async"><strong>11</strong><span>&#24322;&#27493;&#32534;&#31243;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#validation"><strong>12</strong><span>&#39564;&#35777;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#services"><strong>13</strong><span>&#26381;&#21153;&#23618;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#staticTypeCheckingAndCompilation"><strong>14</strong><span>&#38745;&#24577;&#31867;&#22411;&#26816;&#26597;&#21644;&#32534;&#35793;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#testing"><strong>15</strong><span>&#27979;&#35797;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#i18n"><strong>16</strong><span>&#22269;&#38469;&#21270;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#security"><strong>17</strong><span>&#23433;&#20840;&#24615;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#plugins"><strong>18</strong><span>&#25554;&#20214;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#spring"><strong>19</strong><span>Grails &#19982; Spring</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#scaffolding"><strong>20</strong><span>&#33050;&#25163;&#26550;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#deployment"><strong>21</strong><span>&#37096;&#32626;</span></a></div>
                                
                                <div class="toc-item" style="margin-left:0"><a href="#contributing"><strong>22</strong><span>&#32473; Grails &#36129;&#29486;&#20195;&#30721;</span></a></div>
                                
                            </div>
                        </div>
                    </li>
                    <li class="separator selected">
                        <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                    </li>
                </ul>

            </div>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>The Grails Framework</h1>
                            <p><strong>Authors:</strong> The Grails Team</p>
                            <p><strong>Version:</strong> 4.0.0</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>&#31616;&#20171;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#whatsNew"><strong>1.1</strong><span>Grails 4 &#20013;&#30340;&#26032;&#22686;&#21151;&#33021;&#26159;&#20160;&#20040;&#65311;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dependencyUpgrades"><strong>1.1.1</strong><span>&#26356;&#26032;&#30340;&#20381;&#36182;&#39033;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#micronautSupport"><strong>1.1.2</strong><span>Micronaut &#29238;&#19978;&#19979;&#25991;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>&#20837;&#38376;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>&#23433;&#35013;&#35201;&#27714;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#downloadingAndInstalling"><strong>2.2</strong><span>&#19979;&#36733;&#21644;&#23433;&#35013;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingAnApplication"><strong>2.3</strong><span>&#21019;&#24314;&#24212;&#29992;&#31243;&#24207;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#aHelloWorldExample"><strong>2.4</strong><span>Hello World &#31034;&#20363;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#usingInteractiveMode"><strong>2.5</strong><span>&#20351;&#29992;&#20132;&#20114;&#27169;&#24335;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#ide"><strong>2.6</strong><span>&#22312; IDE &#20013;&#35774;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#conventionOverConfiguration"><strong>2.7</strong><span>&#37197;&#32622;&#30340;&#32422;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#runningAndDebuggingAnApplication"><strong>2.8</strong><span>&#36816;&#34892;&#21644;&#35843;&#35797;&#24212;&#29992;&#31243;&#24207;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#testingAnApplication"><strong>2.9</strong><span>&#27979;&#35797;&#24212;&#29992;&#31243;&#24207;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#deployingAnApplication"><strong>2.10</strong><span>&#37096;&#32626;&#24212;&#29992;&#31243;&#24207;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#supportedJavaEEContainers"><strong>2.11</strong><span>&#25903;&#25345;&#30340; Java EE &#23481;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingArtefacts"><strong>2.12</strong><span>&#21019;&#24314;&#20154;&#24037;&#21046;&#21697;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#generatingAnApplication"><strong>2.13</strong><span>&#29983;&#25104;&#24212;&#29992;&#31243;&#24207;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#upgrading"><strong>3</strong><span>&#20174; Grails 3.3.x &#21319;&#32423;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#conf"><strong>4</strong><span>&#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#config"><strong>4.1</strong><span>&#22522;&#26412;&#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#ymlOptions"><strong>4.1.1</strong><span>YML &#26684;&#24335;&#36873;&#39033;&#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#builtInOptions"><strong>4.1.2</strong><span>&#20869;&#32622;&#36873;&#39033;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#logging"><strong>4.1.3</strong><span>&#26085;&#24535;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#loggerName"><strong>4.1.3.1</strong><span>&#35760;&#24405;&#22120;&#21517;&#31216;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#maskingRequestParametersFromStacktraceLogs"><strong>4.1.3.2</strong><span>&#20174;&#22534;&#26632;&#36319;&#36394;&#26085;&#24535;&#23631;&#34109;&#35831;&#27714;&#21442;&#25968;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:30px"><a href="#externalLoggingConfiguration"><strong>4.1.3.3</strong><span>&#22806;&#37096;&#37197;&#32622;&#25991;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#configGORM"><strong>4.1.4</strong><span>GORM</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#proxyConfig"><strong>4.1.5</strong><span>&#37197;&#32622; HTTP &#20195;&#29702;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#applicationClass"><strong>4.2</strong><span>&#24212;&#29992;&#31243;&#24207;&#31867;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#executing"><strong>4.2.1</strong><span>&#25191;&#34892;&#24212;&#29992;&#31243;&#24207;&#31867;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#customizing"><strong>4.2.2</strong><span>&#33258;&#23450;&#20041;&#24212;&#29992;&#31243;&#24207;&#31867;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#applicationLifeCycle"><strong>4.2.3</strong><span>&#24212;&#29992;&#31243;&#24207;&#29983;&#21629;&#21608;&#26399;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#environments"><strong>4.3</strong><span>&#29615;&#22659;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#dataSource"><strong>4.4</strong><span>&#25968;&#25454;&#28304;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dataSourcesAndEnvironments"><strong>4.4.1</strong><span>&#25968;&#25454;&#28304;&#21644;&#29615;&#22659;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#automaticDatabaseMigration"><strong>4.4.2</strong><span>&#33258;&#21160;&#25968;&#25454;&#24211;&#36801;&#31227;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#transactionAwareDataSourceProxy"><strong>4.4.3</strong><span>&#20107;&#21153;&#24863;&#30693;&#25968;&#25454;&#28304;&#20195;&#29702;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#databaseConsole"><strong>4.4.4</strong><span>&#25968;&#25454;&#24211;&#25511;&#21046;&#21488;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#multipleDatasources"><strong>4.4.5</strong><span>&#22810;&#20010;&#25968;&#25454;&#28304;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#versioning"><strong>4.5</strong><span>&#29256;&#26412;&#25511;&#21046;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#dependencyResolution"><strong>4.6</strong><span>&#20381;&#36182;&#39033;&#35299;&#26512;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#commandLine"><strong>5</strong><span>&#21629;&#20196;&#34892;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#interactiveMode"><strong>5.1</strong><span>&#20132;&#20114;&#27169;&#24335;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingCustomScripts"><strong>5.2</strong><span>&#21019;&#24314;&#33258;&#23450;&#20041;&#33050;&#26412;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingCustomCommands"><strong>5.3</strong><span>&#21019;&#24314;&#33258;&#23450;&#20041;&#21629;&#20196;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#reusingGrailsScripts"><strong>5.4</strong><span>&#37325;&#29992; Grails &#33050;&#26412;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#gradleBuild"><strong>5.5</strong><span>&#29992; Gradle &#26500;&#24314;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#gradleDependencies"><strong>5.5.1</strong><span>&#20351;&#29992; Gradle &#23450;&#20041;&#20381;&#36182;&#20851;&#31995;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#gradleTasks"><strong>5.5.2</strong><span>&#20351;&#29992; Gradle &#20219;&#21153;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#gradlePlugins"><strong>5.5.3</strong><span>Gradle &#30340; Grails &#25554;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#profiles"><strong>6</strong><span>&#24212;&#29992;&#31243;&#24207;&#37197;&#32622;&#25991;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingProfiles"><strong>6.1</strong><span>&#21019;&#24314;&#37197;&#32622;&#25991;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#profileInheritance"><strong>6.2</strong><span>&#32487;&#25215;&#37197;&#32622;&#25991;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#publishingProfiles"><strong>6.3</strong><span>&#21457;&#24067;&#37197;&#32622;&#25991;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#profileStructure"><strong>6.4</strong><span>&#20102;&#35299;&#37197;&#32622;&#25991;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#profileCommands"><strong>6.5</strong><span>&#21019;&#24314;&#37197;&#32622;&#25991;&#20214;&#21629;&#20196;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#profileFeatures"><strong>6.6</strong><span>&#21019;&#24314;&#37197;&#32622;&#25991;&#20214;&#21151;&#33021;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#GORM"><strong>7</strong><span>&#23545;&#35937;&#20851;&#31995;&#26144;&#23556; &#65288;GORM&#65289;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#quickStartGuide"><strong>7.1</strong><span>&#24555;&#36895;&#20837;&#38376;&#25351;&#21335;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#basicCRUD"><strong>7.1.1</strong><span>&#22522;&#26412; CRUD</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#furtherReading"><strong>7.2</strong><span>&#20851;&#20110; GORM &#30340;&#36827;&#19968;&#27493;&#38405;&#35835;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#theWebLayer"><strong>8</strong><span>Web &#23618;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#controllers"><strong>8.1</strong><span>&#25511;&#21046;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#understandingControllersAndActions"><strong>8.1.1</strong><span>&#20102;&#35299;&#25511;&#21046;&#22120;&#21644;&#25805;&#20316;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#controllersAndScopes"><strong>8.1.2</strong><span>&#25511;&#21046;&#22120;&#21644;&#20316;&#29992;&#22495;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#modelsAndViews"><strong>8.1.3</strong><span>&#27169;&#22411;&#21644;&#35270;&#22270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#redirectsAndChaining"><strong>8.1.4</strong><span>&#37325;&#23450;&#21521;&#21644;&#38142;&#25509;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#dataBinding"><strong>8.1.5</strong><span>&#25968;&#25454;&#32465;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#jsonResponses"><strong>8.1.6</strong><span>&#20351;&#29992; JSON &#21709;&#24212;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#moreOnJSONBuilder"><strong>8.1.7</strong><span>&#20851;&#20110; JSONBuilder</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#xmlResponses"><strong>8.1.8</strong><span>&#20351;&#29992; XML &#21709;&#24212;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#uploadingFiles"><strong>8.1.9</strong><span>&#19978;&#20256;&#25991;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#commandObjects"><strong>8.1.10</strong><span>&#21629;&#20196;&#23545;&#35937;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#formtokens"><strong>8.1.11</strong><span>&#22788;&#29702;&#37325;&#22797;&#34920;&#21333;&#25552;&#20132;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#typeConverters"><strong>8.1.12</strong><span>&#22522;&#26412;&#31867;&#22411;&#36716;&#25442;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#controllerExceptionHandling"><strong>8.1.13</strong><span>&#22768;&#26126;&#24615;&#25511;&#21046;&#22120;&#24322;&#24120;&#22788;&#29702;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#gsp"><strong>8.2</strong><span>Grails &#26381;&#21153;&#22120;&#39029;&#38754;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#urlmappings"><strong>8.3</strong><span>URL &#26144;&#23556;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingToControllersAndActions"><strong>8.3.1</strong><span>&#26144;&#23556;&#21040;&#25511;&#21046;&#22120;&#21644;&#25805;&#20316;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#restfulMappings"><strong>8.3.2</strong><span>&#26144;&#23556;&#21040; REST &#36164;&#28304;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#redirectMappings"><strong>8.3.3</strong><span>&#22312; URL &#26144;&#23556;&#20013;&#37325;&#23450;&#21521;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#embeddedVariables"><strong>8.3.4</strong><span>&#23884;&#20837;&#24335;&#21464;&#37327;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingToViews"><strong>8.3.5</strong><span>&#26144;&#23556;&#21040;&#35270;&#22270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingToResponseCodes"><strong>8.3.6</strong><span>&#26144;&#23556;&#21040;&#21709;&#24212;&#20195;&#30721;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingHTTP"><strong>8.3.7</strong><span>&#26144;&#23556;&#21040; HTTP &#26041;&#27861;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#mappingWildcards"><strong>8.3.8</strong><span>&#26144;&#23556;&#36890;&#37197;&#31526;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#automaticLinkRewriting"><strong>8.3.9</strong><span>&#33258;&#21160;&#38142;&#25509;&#37325;&#20889;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#applyingConstraints"><strong>8.3.10</strong><span>&#24212;&#29992;&#32422;&#26463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#namedMappings"><strong>8.3.11</strong><span>&#21629;&#21517; URL &#26144;&#23556;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#customizingUrlFormat"><strong>8.3.12</strong><span>&#33258;&#23450;&#20041; URL &#26684;&#24335;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#namespacedControllers"><strong>8.3.13</strong><span>&#25511;&#21046;&#22120;&#30340;&#21629;&#21517;&#31354;&#38388;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#cors"><strong>8.4</strong><span>CORS</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#interceptors"><strong>8.5</strong><span>&#25318;&#25130;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#definingInterceptors"><strong>8.5.1</strong><span>&#23450;&#20041;&#25318;&#25130;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#interceptorMatching"><strong>8.5.2</strong><span>&#23558;&#35831;&#27714;&#19982;&#25318;&#25130;&#22120;&#21305;&#37197;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#interceptorOrdering"><strong>8.5.3</strong><span>&#23450;&#20041;&#25318;&#25130;&#22120;&#25191;&#34892;&#39034;&#24207;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#contentNegotiation"><strong>8.6</strong><span>&#20869;&#23481;&#21327;&#21830;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#traits"><strong>9</strong><span>&#29305;&#24449;&#65288;Trait&#65289;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#traitsprovided"><strong>9.1</strong><span>Grails &#25552;&#20379;&#30340;&#29305;&#24449;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#example"><strong>9.1.1</strong><span>Web &#23646;&#24615;&#29305;&#24615;&#31034;&#20363;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#REST"><strong>10</strong><span>REST</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#domainResources"><strong>10.1</strong><span>&#22495;&#31867;&#20316;&#20026; REST &#36164;&#28304;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#urlMappings"><strong>10.2</strong><span>&#26144;&#23556;&#21040; REST &#36164;&#28304;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#linkingToResources"><strong>10.3</strong><span>&#20174; GSP &#39029;&#38754;&#38142;&#25509;&#21040; REST &#36164;&#28304;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#versioningResources"><strong>10.4</strong><span>&#29256;&#26412;&#21270; REST &#36164;&#28304;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#restfulControllers"><strong>10.5</strong><span>&#23454;&#29616; REST &#25511;&#21046;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#extendingRestfulController"><strong>10.5.1</strong><span>&#25193;&#23637;Rest&#25511;&#21046;&#22120;&#36229;&#32423;&#31867;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#restControllersStepByStep"><strong>10.5.2</strong><span>&#36880;&#27493;&#23454;&#29616; REST &#25511;&#21046;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#generatingRestControllers"><strong>10.5.3</strong><span>&#20351;&#29992;&#22522;&#26550;&#29983;&#25104; REST &#25511;&#21046;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#callingRestServices"><strong>10.6</strong><span>&#20351;&#29992; HttpClient &#35843;&#29992; REST &#26381;&#21153;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#restProfile"><strong>10.7</strong><span>REST &#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#angularJsProfile"><strong>10.8</strong><span>AngularJS &#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#angularProfile"><strong>10.9</strong><span>Angular &#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#jsonViews"><strong>10.10</strong><span>JSON &#35270;&#22270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#jsonViewsSetup"><strong>10.10.1</strong><span>&#20837;&#38376;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#jsonViewsCreating"><strong>10.10.2</strong><span>&#21019;&#24314; JSON &#35270;&#22270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#jsonViewsAndTemplates"><strong>10.10.3</strong><span>JSON &#35270;&#22270;&#27169;&#26495;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#jsonViewsAndDomainClasses"><strong>10.10.4</strong><span>&#20351;&#29992; JSON &#35270;&#22270;&#21576;&#29616;&#22495;&#31867;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#jsonViewsTemplatesAndConventions"><strong>10.10.5</strong><span>&#25353;&#32422;&#23450;&#36827;&#34892;&#30340; JSON &#35270;&#22270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#renderers"><strong>10.11</strong><span>&#33258;&#23450;&#20041;&#21709;&#24212;&#21576;&#29616;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#defaultRenderers"><strong>10.11.1</strong><span>&#33258;&#23450;&#20041;&#40664;&#35748;&#28210;&#26579;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#customRenderers"><strong>10.11.2</strong><span>&#23454;&#29616;&#33258;&#23450;&#20041;&#28210;&#26579;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#gspRenderers"><strong>10.11.3</strong><span>&#20351;&#29992; GSP &#33258;&#23450;&#20041;&#28210;&#26579;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#hypermedia"><strong>10.12</strong><span>&#36229;&#23186;&#20307;&#20316;&#20026;&#24212;&#29992;&#31243;&#24207;&#29366;&#24577;&#30340;&#24341;&#25806;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#hal"><strong>10.12.1</strong><span>HAL &#25903;&#25345;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#atom"><strong>10.12.2</strong><span>Atom &#25903;&#25345;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#vndError"><strong>10.12.3</strong><span>Vnd.&#38169;&#35823;&#25903;&#25345;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#binding"><strong>10.13</strong><span>&#33258;&#23450;&#20041;&#36164;&#28304;&#32465;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#RSSAndAtom"><strong>10.14</strong><span>RSS &#21644; Atom</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#async"><strong>11</strong><span>&#24322;&#27493;&#32534;&#31243;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#validation"><strong>12</strong><span>&#39564;&#35777;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#constraints"><strong>12.1</strong><span>&#22768;&#26126;&#32422;&#26463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validatingConstraints"><strong>12.2</strong><span>&#39564;&#35777;&#32422;&#26463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#sharingConstraints"><strong>12.3</strong><span>&#31867;&#20043;&#38388;&#30340;&#20849;&#20139;&#32422;&#26463;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validationOnTheClient"><strong>12.4</strong><span>&#23545;&#23458;&#25143;&#31471;&#30340;&#39564;&#35777;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validationAndInternationalization"><strong>12.5</strong><span>&#39564;&#35777;&#21644;&#22269;&#38469;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#validationNonDomainAndCommandObjectClasses"><strong>12.6</strong><span>&#23558;&#39564;&#35777;&#24212;&#29992;&#20110;&#20854;&#20182;&#31867;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#services"><strong>13</strong><span>&#26381;&#21153;&#23618;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#declarativeTransactions"><strong>13.1</strong><span>&#22768;&#26126;&#24615;&#20107;&#29289;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#transactionsMultiDataSource"><strong>13.1.1</strong><span>&#22810;&#25968;&#25454;&#28304;&#20107;&#29289;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#transactionsRollbackAndTheSession"><strong>13.1.2</strong><span>&#20107;&#21153;&#22238;&#28378;&#21644;&#20250;&#35805;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#scopedServices"><strong>13.2</strong><span>Service &#30340;&#20316;&#29992;&#22495;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#dependencyInjectionServices"><strong>13.3</strong><span>&#20381;&#36182;&#39033;&#27880;&#20837;&#21644;&#26381;&#21153;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#staticTypeCheckingAndCompilation"><strong>14</strong><span>&#38745;&#24577;&#31867;&#22411;&#26816;&#26597;&#21644;&#32534;&#35793;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#grailsCompileStatic"><strong>14.1</strong><span>Grails &#32534;&#35793;&#38745;&#24577;&#27880;&#37322;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#grailsTypeChecked"><strong>14.2</strong><span>Grails &#31867;&#22411;&#26816;&#26597;&#27880;&#37322;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#testing"><strong>15</strong><span>&#27979;&#35797;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#unitTesting"><strong>15.1</strong><span>&#21333;&#20803;&#27979;&#35797;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#integrationTesting"><strong>15.2</strong><span>&#38598;&#25104;&#27979;&#35797;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#functionalTesting"><strong>15.3</strong><span>&#21151;&#33021;&#27979;&#35797;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#i18n"><strong>16</strong><span>&#22269;&#38469;&#21270;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#understandingMessageBundles"><strong>16.1</strong><span>&#20102;&#35299;&#28040;&#24687;&#21253;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#changingLocales"><strong>16.2</strong><span>&#26356;&#25913;&#21306;&#22495;&#35774;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#readingMessages"><strong>16.3</strong><span>&#38405;&#35835;&#28040;&#24687;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#scaffoldingAndI18n"><strong>16.4</strong><span>&#33050;&#25163;&#26550;&#21644; i18n</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#security"><strong>17</strong><span>&#23433;&#20840;&#24615;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#securingAgainstAttacks"><strong>17.1</strong><span>&#38450;&#33539;&#25915;&#20987;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#xssPrevention"><strong>17.2</strong><span>&#36328;&#31449;&#28857;&#33050;&#26412; &#65288;XSS&#65289; &#39044;&#38450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#codecs"><strong>17.3</strong><span>&#32534;&#30721;&#21644;&#35299;&#30721;&#23545;&#35937;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#authentication"><strong>17.4</strong><span>&#36523;&#20221;&#39564;&#35777;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#securityPlugins"><strong>17.5</strong><span>&#23433;&#20840;&#25554;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#springSecurity"><strong>17.5.1</strong><span>Spring &#23433;&#20840;&#26426;&#21046;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#plugins"><strong>18</strong><span>&#25554;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#creatingAndInstallingPlugins"><strong>18.1</strong><span>&#21019;&#24314;&#21644;&#23433;&#35013;&#25554;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#repositories"><strong>18.2</strong><span>&#25554;&#20214;&#24211;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#providingBasicArtefacts"><strong>18.3</strong><span>&#25552;&#20379;&#22522;&#26412;&#25991;&#29289;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#evaluatingConventions"><strong>18.4</strong><span>&#35780;&#20272;&#32422;&#23450;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#hookingIntoRuntimeConfiguration"><strong>18.5</strong><span>&#25346;&#38057;&#21040;&#36816;&#34892;&#26102;&#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#addingMethodsAtCompileTime"><strong>18.6</strong><span>&#22312;&#32534;&#35793;&#26102;&#28155;&#21152;&#26041;&#27861;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#addingDynamicMethodsAtRuntime"><strong>18.7</strong><span>&#22312;&#36816;&#34892;&#26102;&#28155;&#21152;&#21160;&#24577;&#26041;&#27861;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#participatingInAutoReloadEvents"><strong>18.8</strong><span>&#21442;&#19982;&#33258;&#21160;&#37325;&#26032;&#21152;&#36733;&#20107;&#20214;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#understandingPluginLoadOrder"><strong>18.9</strong><span>&#20102;&#35299;&#25554;&#20214;&#21152;&#36733;&#39034;&#24207;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#artefactApi"><strong>18.10</strong><span>&#33402;&#26415;&#21697; API</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#queryingArtefacts"><strong>18.10.1</strong><span>&#35810;&#38382;&#21487;&#29992;&#25991;&#29289;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#customArtefacts"><strong>18.10.2</strong><span>&#28155;&#21152;&#24744;&#33258;&#24049;&#30340;&#33402;&#26415;&#21697;&#31867;&#22411;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#spring"><strong>19</strong><span>Grails &#19982; Spring</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#springdslAdditional"><strong>19.1</strong><span>&#37197;&#32622;&#20854;&#20182; bean</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#springdsl"><strong>19.2</strong><span>&#20351;&#29992; Bean DSL &#36816;&#34892;&#26102;Spring</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#theBeanBuilderDSLExplained"><strong>19.3</strong><span>Bean&#26500;&#24314;&#22120;DSL&#35299;&#37322;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#propertyPlaceholderConfiguration"><strong>19.4</strong><span>&#23646;&#24615;&#21344;&#20301;&#31526;&#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#propertyOverrideConfiguration"><strong>19.5</strong><span>&#23646;&#24615;&#35206;&#30422;&#37197;&#32622;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#actuators"><strong>19.6</strong><span>Spring Boot &#25191;&#34892;&#22120;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#scaffolding"><strong>20</strong><span>&#33050;&#25163;&#26550;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#deployment"><strong>21</strong><span>&#37096;&#32626;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#deploymentStandalone"><strong>21.1</strong><span>&#29420;&#31435;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#deploymentContainer"><strong>21.2</strong><span>&#23481;&#22120;&#37096;&#32626;&#65288;&#20363;&#22914;&#65292;Tomcat&#65289;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#deploymentTasks"><strong>21.3</strong><span>&#37096;&#32626;&#37197;&#32622;&#20219;&#21153;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#contributing"><strong>22</strong><span>&#32473; Grails &#36129;&#29486;&#20195;&#30721;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#issues"><strong>22.1</strong><span>&#22312; Github &#20013;&#25253;&#21578;&#38382;&#39064;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#build"><strong>22.2</strong><span>&#20174;&#28304;&#20195;&#30721;&#32534;&#35793;&#24182;&#36816;&#34892;&#27979;&#35797;</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#patchesCore"><strong>22.3</strong><span>&#23558;&#34917;&#19969;&#25552;&#20132;&#21040; Grails</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#patchesDoc"><strong>22.4</strong><span>&#23558;&#20462;&#34917;&#31243;&#24207;&#25552;&#20132;&#21040; Grails &#25991;&#26723;</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        
<a name="1. &#31616;&#20171;"><!-- Legacy link --></a>
<h1 id="introduction">1 简介</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/introduction.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Java 领域中的许多现代 Web 框架都比需要的更为复杂，并且不包含「不重复造轮子（DRY）」原则。</p>
</div>
<div class="paragraph">
<p>诸如 Rails 和 Django 之类的动态框架帮助为更现代的 Web 应用程序思考方式铺平了道路。Grails 基于这些概念，并大大降低了在 Java 平台上构建 Web 应用程序的复杂性。然而，使它与众不同的是，它是通过在已经建立的 Java 技术（例如 Spring 和 Hibernate ）的基础上实现的。</p>
</div>
<div class="paragraph">
<p>Grails 是一个全栈框架，它试图通过核心技术及其关联的插件来解决许多 Web 开发难题。发行包中包括以下内容：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://gorm.grails.org">GORM</a> - 一个易于使用的对象映射库，支持 <a href="http://gorm.grails.org/latest/hibernate">SQL</a>, <a href="http://gorm.grails.org/latest/mongodb">MongoDB</a>, <a href="http://gorm.grails.org/latest/mongodb">Neo4j</a> 和 <a href="http://gorm.grails.org">more</a>.</p>
</li>
<li>
<p>查看 <a href="https://gsp.grails.org">呈现HTML</a> 以及 <a href="http://views.grails.org">JSON</a> 技术。</p>
</li>
<li>
<p>建立在控制器层上 <a href="http://www.spring.io">Spring Boot</a></p>
</li>
<li>
<p>一个具有特色的插件系统 <a href="http://plugins.grails.org">数百个插件</a>.</p>
</li>
<li>
<p>灵活的配置文件 <a href="http://start.grails.org/#/index">使用AngularJS，React等创建应用程序</a>.</p>
</li>
<li>
<p>一个基于命令行的交互式命令行环境和构建系统 <a href="http://gradle.org">Gradle</a></p>
</li>
<li>
<p>嵌入式 <a href="http://tomcat.apache.org">Tomcat</a> 容器，配置为即时重新加载</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过 <a href="http://groovy-lang.org">Groovy</a> 语言的强大功能和领域特定语言（DSL）的广泛使用，所有这些都变得易于使用</p>
</div>
<div class="paragraph">
<p>本文档将引导您入门 Grails，并使用 Grails 框架构建 Web 应用程序。</p>
</div>
<div class="paragraph">
<p>除了本文档外，还有 <a href="http://guides.grails.org">comprehensive guides</a> 指导您了解该技术的各个方面。</p>
</div>
<div class="paragraph">
<p>最后，Grails 不仅仅是一个 Web 框架，它还由各种子项目组成。下表总结了生态系统中的其他一些重要项目，并提供了文档链接。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Grails Ecosystem Projects</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">项目</th>
<th class="tableblock halign-left valign-top">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/hibernate">GORM for Hibernate</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SQL 数据库的对象映射实现</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/mongodb">GORM for MongoDB</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">MongoDB 文档数据库的对象映射实现</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gorm.grails.org/latest/neo4j">GORM for Neo4j</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Neo4j 图形数据库的对象映射实现</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://views.grails.org">JSON Views</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一种用于在服务器端呈现 JSON 的视图技术</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://gsp.grails.org">Groovy Server Pages</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">一种用于在服务器上呈现 HTML 和其他标记的视图技术</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://async.grails.org">Async Framework</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">异步编程抽象，支持 RxJava，GPars 等</p></td>
</tr>
</tbody>
</table>

<a name="1.1 Grails 2.0 &#20013;&#30340;&#26032;&#22686;&#21151;&#33021;&#26159;&#20160;&#20040;&#65311;"><!-- Legacy link --></a>
<h2 id="whatsNew">1.1 Grails 4 中的新增功能是什么？</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/introduction/whatsNew.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>本节介绍了 Grails 4 中引入的所有新功能。</p>
</div>


<h2 id="dependencyUpgrades">1.1.1 更新的依赖项</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/introduction/whatsNew/dependencyUpgrades.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 4 附带了以下依赖项升级：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Groovy 2.5.6</p>
</li>
<li>
<p>GORM 7 and Hibernate 5.4 (现在是新应用程序的默认 Hibernate 版本)</p>
</li>
<li>
<p>Spring Framework 5.1.5</p>
</li>
<li>
<p>Spring Boot 2.1.3</p>
</li>
<li>
<p>Gradle 5.1.1</p>
</li>
<li>
<p>Spock 1.2</p>
</li>
</ul>
</div>


<h2 id="micronautSupport">1.1.2 Micronaut 父上下文</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/introduction/whatsNew/micronautSupport.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://micronaut.io">Micronaut</a> 现在是 Grails 的父应用程序上下文，因此允许使用许多 Micronaut 功能，包括 Micronaut <a href="https://docs.micronaut.io/latest/guide/index.html#httpClient">HTTP Client</a> 和 <a href="https://micronaut-projects.github.io/micronaut-kafka/latest/guide/">Kafka Client</a> 。</p>
</div>
<div class="paragraph">
<p>Micronaut 还已用于改善 Grails 应用程序的启动并减少其总体内存消耗（以及 Spring Boot 2.1 中的相关改进）。</p>
</div>

<a name="2. &#20837;&#38376;"><!-- Legacy link --></a>
<h1 id="gettingStarted">2 入门</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>





<h2 id="requirements">2.1 安装要求</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>在安装 Grails 4.0.0 之前，您至少需要安装一个 1.8 或以上版本的 Java 开发工具包(JDK)。下载适合您的操作系统的 JDK，运行安装程序，然后设置一个名为 <code>JAVA_HOME</code> 的环境变量，指向安装的位置。</p>
</div>
<div class="paragraph">
<p>为了自动化 Grails 的安装，我们推荐 <a href="http://sdkman.io">SDKMAN</a> 大大简化了安装和管理多个 Grails 版本。</p>
</div>
<div class="paragraph">
<p>在某些平台上(例如OS X)，会自动检测到 Java 安装。但是，在许多情况下，您需要手动配置 Java 的位置。例如，如果您正在使用 bash 或 Bourne Shell 的另一种变体:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export JAVA_HOME=/Library/Java/Home
export PATH=&quot;$PATH:$JAVA_HOME/bin&quot;</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
在Windows上，你必须在 <code>My Computer/Advanced/Environment Variables</code> 中配置这些环境变量
</td>
</tr>
</table>
</div>

<a name="2.1 &#19979;&#36733;&#21644;&#23433;&#35013;"><!-- Legacy link --></a>
<h2 id="downloadingAndInstalling">2.2 下载和安装</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/downloadingAndInstalling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>启动和运行 Grails 的第一步是安装这个发行版。</p>
</div>
<div class="paragraph">
<p>在 *nix 系统上安装 Grails 的最佳方法是使用 <a href="http://sdkman.io">SDKMAN</a> ，SDKMAN 大大简化了安装和管理多个 Grails 版本。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_安装_sdkman">安装 SDKMAN</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要使用 SDKMAN 安装最新版本的 Grails，请在您的终端上运行它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sdk install grails</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以指定一个版本</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="shell">sdk install grails 4.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以在 <a href="http://sdkman.io/usage.html">SDKMAN Docs</a> 中找到关于 SDKMAN 使用的更多信息。</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_手动安装">手动安装</h2>
<div class="sectionbody">
<div class="paragraph">
<p>手动安装请遵循以下步骤:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails/grails-core/releases">Download</a> Grails 的二进制发行版，并将生成的 zip 文件解压缩到您选择的位置</p>
</li>
<li>
<p>将 GRAILS_HOME 环境变量设置为您提取 zip 的位置</p>
<div class="ulist">
<ul>
<li>
<p>在基于 Unix/Linux 的系统中，这通常是在您的配置文件中添加类似 <code>export GRAILS_HOME=/path/to/grails</code> 这样的内容</p>
</li>
<li>
<p>在Windows中，这通常是在 <code>My Computer/Advanced/Environment Variables</code> 下设置一个环境变量</p>
</li>
</ul>
</div>
</li>
<li>
<p>然后将 <code>bin</code> 目录添加到您的 <code>PATH</code> 变量中:</p>
<div class="ulist">
<ul>
<li>
<p>在基于Unix/Linux的系统中，这可以通过在您的配置文件中添加 <code>export PATH="$PATH:$GRAILS_HOME/bin"</code> 来实现</p>
</li>
<li>
<p>在Windows中，这是通过修改 <code>My Computer/Advanced/Environment Variables</code> 下的 <code>Path</code> 环境变量来实现的。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>如果 Grails 工作正常，您现在应该可以在终端窗口中输入 <code>grails -version</code> ，并看到类似如下的输出:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Grails <span class="key">version</span>: <span class="float">4.0</span><span class="float">.0</span></code></pre>
</div>
</div>
</div>
</div>

<a name="2.4 &#21019;&#24314;&#24212;&#29992;&#31243;&#24207;"><!-- Legacy link --></a>
<h2 id="creatingAnApplication">2.3 创建应用程序</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/creatingAnApplication.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>要创建 Grails 应用程序，首先需要熟悉 <code>Grails</code> 命令的用法，它的用法如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails &lt;&lt;command name&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行 <a href="../ref/Command%20Line/create-app.html">create-app</a> 创建应用:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails create-app helloworld</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在包含项目的当前目录中创建一个新目录。在你的控制台中导航到这个目录:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">cd helloworld</code></pre>
</div>
</div>

<a name="2.5 Hello World &#31034;&#20363;"><!-- Legacy link --></a>
<h2 id="aHelloWorldExample">2.4 Hello World 示例</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/aHelloWorldExample.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>现在让我们将这个新项目转换为经典的 “Hello world!” 示例。</p>
</div>
<div class="paragraph">
<p>首先，切换到刚刚创建的 “helloworld” 目录，启动 Grails 交互控制台:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd helloworld
$ grails</code></pre>
</div>
</div>
<div class="paragraph">
<p>你会看到这样的提示:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/interactive-helloworld.png" alt="interactive helloworld">
</div>
</div>
<div class="paragraph">
<p>我们需要的是一个简单的页面，它只向浏览器输出 “Hello World!”。</p>
</div>
<div class="paragraph">
<p>在 Grails 中，每当需要一个新页面时，只需为它创建一个新的 controller。由于我们还没有一个 controller，让我们现在创建一个控制器。</p>
</div>
<div class="paragraph">
<p><a href="../ref/Command%20Line/create-controller。html">create-controller</a> 命令:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails&gt; create-controller hello</code></pre>
</div>
</div>
<div class="paragraph">
<p>不要忘记，在交互控制台中，我们有命令名的自动补全功能。
因此，您可以键入“cre”，然后按 &lt;tab&gt; 得到所有 <code>create-*</code> 命令的列表。
再输入几个命令名字母，然后再次 &lt;tab&gt; 来完成。</p>
</div>
<div class="paragraph">
<p>上面的命令将创建一个新 <a href="theWebLayer.html#controllers">controller</a> 在 <code>grails-app/controllers/helloworld</code> 目录下，名为 <code>HelloController.groovy</code> 。
为什么多了一个额外的 <code>helloworld</code> 目录？因为在 Java 领域，强烈建议将所有类都放到包中，所以如果不提供应用程序名称，Grails 将默认使用应用程序名称。<a href="../ref/Command%20Line/create-controller.html">create-controller</a> 提供了更多的细节。</p>
</div>
<div class="paragraph">
<p>现在我们有了一个控制器，让我们添加一个动作来生成 “Hello World!” 页面。
在任何文本编辑器中，编辑新控制器&#8201;&#8212;&#8201;<code>HelloController.groovy</code> 文件&#8201;&#8212;&#8201;通过添加一个 render line。
文件里的代码应该是这样的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> helloworld

<span class="type">class</span> <span class="class">HelloController</span> {

    <span class="keyword">def</span> <span class="function">index</span>() {
        render <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个控制器只有一个简单的方法。在这个特殊的例子中，它调用了Grails提供的一个特殊方法来
<a href="../ref/Controllers/render.html页面">render</a>。</p>
</div>
<div class="paragraph">
<p>任务完成。想要看你的应用运行，你只需要启动一个服务器与另一个命令 <a href="../ref/Line/run-app.html">run-app</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails&gt; run-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在承载应用程序的端口8080上启动一个嵌入式服务器。现在，访问您的应用程序—请尝试一下! 您应该能够通过 URL <a href="http://localhost:8080/" class="bare">http://localhost:8080/</a></p>
</div>
<div class="paragraph">
<p>要为应用程序设置上下文路径，可以在 <code>grails-app/conf/application.yml</code> 中添加一个配置属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">server</span>:
    <span class="key">servlet</span>:
        <span class="key">context-path</span>: <span class="string"><span class="content">/helloworld</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>有了上面的配置，服务器将在URL <a href="http://localhost:8080/helloworld/" class="bare">http://localhost:8080/helloworld/</a> 处启动。</p>
</div>
<div class="paragraph">
<p>或者，你也可以通过命令行设置上下文路径:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails&gt; run-app -Dgrails.server.servlet.context-path=/helloworld</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果您看到错误" Server failed to start for port 8080: Address already in use"，那么这意味着另一个服务器正在该端口上运行。
您可以通过使用 <code>run-app -port=9090</code> 在不同的端口上运行服务器来轻松解决这个问题。
'9090&#8217;就是一个例子：你几乎可以选择 1024 到 49151 之间的任何东西。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>结果将是这样的:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/intropage.png" alt="intropage">
</div>
</div>
<div class="paragraph">
<p>这是由 <code>grails-app/view/index.gsp</code> 渲染的 Grails 项目首页。
它检测你的控制器的存在并提供链接。
您可以点击 "HelloController" 链接，查看包含文本"Hello World!"的自定义页面。
瞧!您有了第一个可以工作的Grails应用程序。</p>
</div>
<div class="paragraph">
<p>最后一件事:控制器可以包含许多操作，每个操作对应于不同的页面(此处忽略AJAX)。
每个页面都可以通过一个由控制器名和操作名组成的惟一URL进行访问 :/&lt;appname&gt;/&lt;controller&gt;/&lt;action&gt; 。
这意味着您可以通过 <a href="http://localhost:8080/helloworld/helloworld/hello/index">/helloworld/hello/index</a> 访问Hello World页面，其中 'Hello' 是控制器名称(从类名中去掉 'Controller' 后缀，第一个字母用小写字母表示)，'index' 是操作名称。
但是，您也可以通过相同的 URL 访问页面，而不需要 action 名称:这是因为&#8217;index&#8217;是 <em>default action</em> 。
用户指南的 <a href="theWebLayer.html#understandingControllersAndActions">controllers and actions</a> 部分，以了解更多的默认动作。</p>
</div>


<h2 id="usingInteractiveMode">2.5 使用交互模式</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/usingInteractiveMode.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>从 3.0 开始，Grails 就有了交互式模式，这使得命令执行更快，因为不必为每个命令重新启动 JVM。要使用交互模式，只需从任何项目的根目录中输入 'grail' ，并使用TAB补全来获得可用命令的列表。请看下面的截图：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/interactive-output.png" alt="interactive output">
</div>
</div>
<div class="paragraph">
<p>有关交互模式功能的更多信息，请在用户指南中参阅 <a href="commandLine.html#interactiveMode">Interactive Mode</a> 。</p>
</div>

<a name="2.6 &#22312; IDE &#20013;&#35774;&#32622;"><!-- Legacy link --></a>
<h2 id="ide">2.6 在 IDE 中设置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/ide.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_intellij_idea">IntelliJ IDEA</h4>
<div class="paragraph">
<p><a href="http://www.jetbrains.com/idea">IntelliJ IDEA</a> 是 Grails 3.0 开发的优秀 IDE。它有两个版本，免费社区版和付费终极版。</p>
</div>
<div class="paragraph">
<p>虽然 GSP 高亮语法只存在于付费版中，但社区版可以用于大多数情况</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
如果您想在社区版中高亮显示 GSP，那么可以在 HTML 编辑器中打开 GSP 文件。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要开始使用 Intellij IDEA 和 Grails 3.0，只需点击 <code>File / Open</code> ，将 IDEA 指向你用于导入和配置项目的 <code>build.gradle</code> 文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_textmate_sublime_vim_等">TextMate, Sublime, VIM 等.</h4>
<div class="paragraph">
<p>有几个优秀的文本编辑器可以很好地与Groovy和Grails配合使用。参考文献如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/textmate/groovy-grails.tmbundle">TextMate bundle</a> 存在 Groovy / Grails 支持在 <a href="http://macromates.com">Textmate</a></p>
</li>
<li>
<p><a href="https://github.com/osoco/sublimetext-grails">Sublime Text plugin</a> 可以通过Sublime包控件安装  <a href="http://www.sublimetext.com">Sublime Text Editor</a>。</p>
</li>
<li>
<p>参见 <a href="http://www.objectpartners.com/2012/02/21/using-vim-as-your-grails-ide-part-1-navigating-your-project/">this post</a> 了解一些关于如何设置VIM作为Grails编辑器的有用技巧。</p>
</li>
<li>
<p><a href="https://atom.io/packages/atom-grails">Atom Package</a> 和 <a href="https://atom.io">Atom editor</a>一起用。</p>
</li>
</ul>
</div>
</div>

<a name="2.7 &#32422;&#23450;&#22823;&#20110;&#37197;&#32622;"><!-- Legacy link --></a>
<h2 id="conventionOverConfiguration">2.7 配置的约定</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/conventionOverConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 使用“约定优于配置”来配置自己。这通常意味着使用的是文件的名称和位置，而不是显式的配置，因此您需要熟悉 Grails 提供的目录结构。</p>
</div>
<div class="paragraph">
<p>以下是各有关部分的分类及连结:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails-app</code> - Groovy 源代码的顶级目录</p>
<div class="ulist">
<ul>
<li>
<p><code>conf</code> - <a href="conf.html">Configuration sources</a></p>
</li>
<li>
<p><code>controllers</code> - <a href="theWebLayer.html#controllers">Web controllers</a> - MVC 的 C。</p>
</li>
<li>
<p><code>domain</code> - 域类 <a href="GORM.html">application domain</a>.</p>
</li>
<li>
<p><code>i18n</code> - 国际化支持 <a href="i18n.html">internationalization (i18n)</a>.</p>
</li>
<li>
<p><code>services</code> - The <a href="services.html">service layer</a>.</p>
</li>
<li>
<p><code>taglib</code> - <a href="theWebLayer.html#taglibs">Tag libraries</a>.</p>
</li>
<li>
<p><code>utils</code> - Grails 工具.</p>
</li>
<li>
<p><code>views</code> - <a href="theWebLayer.html#gsp">Groovy Server Pages</a> or <a href="http://views.grails.org/latest">JSON Views</a> - MVC 的 V.</p>
</li>
</ul>
</div>
</li>
<li>
<p><code>src/main/scripts</code> - <a href="commandLine.html">Code generation scripts</a>.</p>
</li>
<li>
<p><code>src/main/groovy</code> - 其他 groovy 源码</p>
</li>
<li>
<p><code>src/test/groovy</code>  - <a href="testing.html">Unit and integration tests</a>.</p>
</li>
</ul>
</div>

<a name="2.8 &#36816;&#34892;&#21644;&#35843;&#35797;&#24212;&#29992;&#31243;&#24207;"><!-- Legacy link --></a>
<h2 id="runningAndDebuggingAnApplication">2.8 运行和调试应用程序</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/runningAndDebuggingAnApplication.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 应用程序可以使用 Tomcat 服务器中内置的链接来 <a href="../ref/Command%20Line/run-app.html">run-app</a>，默认情况下在端口 8080 加载服务器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails run-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可以指定一个不同的端口使用 <code>-port</code> 参数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails run-app -port=8090</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，最好以交互模式启动应用程序，因为容器重新启动要快得多：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails
grails&gt; run-app
| Grails application running at http://localhost:8080 in environment: development
grails&gt; stop-app
| Shutting down application...
| Application shutdown.
grails&gt; run-app
| Grails application running at http://localhost:8080 in environment: development</code></pre>
</div>
</div>
<div class="paragraph">
<p>只需右键单击 <code>Application.groovy</code>，在 IDE 中分类并选择适当的操作(Grails 3 以上)。</p>
</div>
<div class="paragraph">
<p>或者，您可以使用以下命令运行应用程序，然后将远程调试器附加到应用程序上。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails run-app --debug-jvm</code></pre>
</div>
</div>
<div class="paragraph">
<p>更多信息可在 <a href="../ref/Command%20Line/run-app.html">run-app</a> 命令可以在参考指南中找到。</p>
</div>

<a name="2.9 &#27979;&#35797;&#24212;&#29992;&#31243;&#24207;"><!-- Legacy link --></a>
<h2 id="testingAnApplication">2.9 测试应用程序</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/testingAnApplication.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 中的 <code>create-*</code> 命令会在 <code>src/test/groovy</code> 目录中自动为您创建单元测试或集成测试。当然，您可以使用有效的测试逻辑来填充这些测试，有关这些逻辑的信息可以在 <a href="testing.html">Unit and integration tests</a> 中找到。</p>
</div>
<div class="paragraph">
<p>要执行测试，您可以运行以下 <a href="../ref/Command%20Line/test-app.html">test-app</a> 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app</code></pre>
</div>
</div>

<a name="2.10 &#37096;&#32626;&#24212;&#29992;&#31243;&#24207;"><!-- Legacy link --></a>
<h2 id="deployingAnApplication">2.10 部署应用程序</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/deployingAnApplication.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 应用程序可以以多种不同的方式部署。</p>
</div>
<div class="paragraph">
<p>如果部署到传统容器(Tomcat、Jetty等)，可以创建 Web 应用程序存档(WAR文件)，Grails 包含 <a href="../ref/Command%20Line/war.html">war</a>。执行此任务的命令:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails war</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在 <code>build/libs</code> 目录下生成一个WAR文件，然后可以根据容器的说明部署该文件。</p>
</div>
<div class="paragraph">
<p>注意，在默认情况下，Grails 将在 WAR 文件中包含一个可嵌入的 Tomcat 版本，如果将其部署到另一个 Tomcat 版本，则可能会导致问题。如果您不打算使用嵌入式容器，那么您应该在 <code>build.gradle</code> 中将Tomcat依赖项的范围更改为 <code>provided</code> ，然后再部署到您的生产容器中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">provided <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-tomcat</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您正在构建一个要在 Tomcat 7 上部署的 WAR 文件，那么您还需要在构建中更改目标 Tomcat 版本。默认情况下，Grails是针对 Tomcat 8 的 API 构建的。</p>
</div>
<div class="paragraph">
<p>要针对 Tomcat 7 容器，在 <code>dependencies { }</code> 上面插入一行 <code>build.gradle</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ext[<span class="string"><span class="delimiter">'</span><span class="content">tomcat.version</span><span class="delimiter">'</span></span>] = <span class="string"><span class="delimiter">'</span><span class="content">7.0.59</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>不像大多数脚本默认为 <code>development</code> 环境，除非被覆盖， <code>war</code> 命令默认在 <code>production</code> 环境中运行。您可以通过指定环境名称来像任何脚本一样覆盖它，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails dev war</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您不希望操作单独的 Servlet 容器，那么可以简单地将 Grails WAR 文件作为标准 Java 应用程序运行。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails war
java -Dgrails.env=prod -jar build/libs/mywar-0.1.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>在部署 Grails 时，应该始终使用 <code>-server</code> 选项和足够的内存分配来运行容器 JVM 。一组好的 VM 标志是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">-server -Xmx768M -XX:MaxPermSize=256m</code></pre>
</div>
</div>

<a name="2.11 &#25903;&#25345;&#30340; Java EE &#23481;&#22120;"><!-- Legacy link --></a>
<h2 id="supportedJavaEEContainers">2.11 支持的 Java EE 容器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/supportedJavaEEContainers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 可以在任何支持 Servlet 3.0 及以上的容器上运行，并且已知可以在以下特定容器产品上工作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Tomcat 7</p>
</li>
<li>
<p>GlassFish 3 or above</p>
</li>
<li>
<p>Resin 4 or above</p>
</li>
<li>
<p>JBoss 6 or above</p>
</li>
<li>
<p>Jetty 8 or above</p>
</li>
<li>
<p>Oracle Weblogic 12c or above</p>
</li>
<li>
<p>IBM WebSphere 8.0 or above</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
需要在 "Application servers &gt; server &gt; Process Definition &gt; Java Virtual Machine &gt; Generic JVM arguments" 中为较老版本的 WebSphere 设置 "-Xverify:none" 。对于 WebSphere version 8 或更新版本，不再需要这样做。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>但是，有些容器有 bug，在大多数情况下可以解决这些 bug。 一个 <a href="https://grails.org/wiki/version/Deployment/92">list of known deployment issues</a> 可以在 Grails wiki 上找到。</p>
</div>
<div class="paragraph">
<p>另外, 参考 <a href="http://guides.grails.org/">Grails Guides</a> 关于如何将 Grails 部署到各种流行的云服务的提示</p>
</div>

<a name="2.13 &#21019;&#24314;&#20154;&#24037;&#21046;&#21697;"><!-- Legacy link --></a>
<h2 id="creatingArtefacts">2.12 创建人工制品</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/creatingArtefacts.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 附带了一些方便的命令，比如 <a href="../ref/Command%20Line/create-controller.html">create-controller</a> , <a href="../ref/Command%20Line/create-domain-class.html">create-domain-class</a>
等将创建 <a href="theWebLayer.html#controllers">controllers</a> 为您创建不同的内容。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这些只是为了您的方便，您可以轻松地使用 IDE 或您最喜欢的文本编辑器。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>例如，要创建应用程序的基础，您通常需要一个 <a href="GORM.html">domain model</a>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails create-app helloworld
cd helloworld
grails create-domain-class book</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致在 <code>grails-app/domain/helloworld/Book.groovy</code> 创建一个域类，如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> helloworld

<span class="type">class</span> <span class="class">Book</span> {
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有许多这样的 <code>create-*</code> 命令可以在命令行参考指南中找到。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
为了减少运行 Grails 脚本所需的时间，可以使用交互式模式。
</td>
</tr>
</table>
</div>

<a name="2.12 &#29983;&#25104;&#24212;&#29992;&#31243;&#24207;"><!-- Legacy link --></a>
<h2 id="generatingAnApplication">2.13 生成应用程序</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/gettingStarted/generatingAnApplication.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>要快速开始使用 Grails，通常需要使用一个名为 <a href="scaffolding.html">scaffolding</a> 的特性，生成应用程序的框架。要做到这一点，可以使用 <code>generate-*</code> 命令，比如 <a href="../ref/Command%20Line/generate-all.html">generate-all</a> ，它将生成一个 <a href="theWebLayer.html#controllers">controller</a> (包含他的测试用例)和相关 <a href="theWebLayer.html#gsp">views</a> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails generate-all helloworld.Book</code></pre>
</div>
</div>


<h1 id="upgrading">3 从 Grails 3.3.x 升级</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/upgrading.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_grails版本冲突">Grails版本冲突</h3>
<div class="paragraph">
<p>您将需要升级在 <code>gradle.properties</code> 中定义的Grails版本。
Grails 3应用的 <code>gradle.properties</code></p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">...
grailsVersion=3.3.8
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails 4应用程序的 <code>gradle.properties</code></p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">...
grailsVersion=4.0.0
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_提升gorm版本">提升GORM版本</h3>
<div class="paragraph">
<p>如果您使用的是 <a href="http://gorm.grails.org">GORM</a>，则需要更新 <code>gradle.properties</code> 中定义的版本。
Grails 3应用的 <code>gradle.properties</code></p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">...
gormVersion=6.1.10.RELEASE
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails 4应用程序的 <code>gradle.properties</code></p>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">...
gormVersion=7.0.2
...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_5和spring_boot_2_1">Spring 5和Spring Boot 2.1</h3>
<div class="paragraph">
<p>Grails 4.0是基于Spring 5和Spring Boot 2.1构建的。如果您使用的是Spring特定功能请参阅 <a href="https://github.com/spring-projects/spring-boot/wiki/Spring-Boot-2.0-Migration-Guide">迁移指南</a> 和
<a href="https://github.com/spring-projects/spring-boot/Wiki/Spring-Boot-2.1-Release-Notes">发行版本</a> 。</p>
</div>
</div>
<div class="sect2">
<h3 id="_hibernate_5_4和gorm_7_x">Hibernate 5.4和GORM 7.x</h3>
<div class="paragraph">
<p>Grails 4.x支持最低版本的Hibernate 5.4和GORM7.x。 GORM进行了一些更改，以支持较新的Hibernate版本并简化GORM本身。
有关这些更改的详细信息，请参见 <a href="http://gorm.grails.org/7.0.x/hibernate/manual/index.html#upgradeNotes">GORM升级文档</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_spring_boot_2_1执行器">Spring Boot 2.1执行器</h3>
<div class="paragraph">
<p>请检查 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">Spring Boot Actuator</a>文档，因为它与Spring Boot 1.5的Grails版本相比有很大变化使用3.x。
如果您有以下配置:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml - Grails 3.3.x</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">endpoints</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">false</span></span>
    <span class="key">jmx</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">unique-names</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>替换为:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml - Grails 4.x</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">spring</span>:
    <span class="key">jmx</span>:
        <span class="key">unique-names</span>: <span class="string"><span class="content">true</span></span>
<span class="key">management</span>:
    <span class="key">endpoints</span>:
        <span class="key">enabled-by-default</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_boot开发人员工具和spring_loaded">Spring Boot开发人员工具和Spring Loaded</h3>
<div class="paragraph">
<p>Grails的早期版本使用了名为 <a href="https://github.com/spring-projects/spring-loaded">Spring Loaded</a>的重新加载代理。由于该库不再维护且不支持Java 11，因此已删除了对Spring Loaded的支持。</p>
</div>
<div class="paragraph">
<p>作为替代，Grails 4应用程序在build.gradle构建脚本中包括 <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/using-boot-devtools.html">Spring Boot Developer Tools</a> 依赖项。 如果要迁移Grails 3.x应用，请包括以下依赖项集：</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.
..
...
configurations {
    developmentOnly
    runtimeClasspath {
        extendsFrom developmentOnly
    }
}

dependencies {
        developmentOnly(<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-devtools</span><span class="delimiter">&quot;</span></span>)
        ...
        ..
}
...
..
.</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，您应该在 <code>application.yml</code> 中为Spring Developer Tools配置必要的排除项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">spring</span>:
    <span class="key">devtools</span>:
        <span class="key">restart</span>:
            <span class="key">exclude</span>:
                - <span class="string"><span class="content">grails-app/views/**</span></span>
                - <span class="string"><span class="content">grails-app/i18n/**</span></span>
                - <span class="string"><span class="content">grails-app/conf/**</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的配置可防止在视图或消息捆绑包更改时服务器重新启动。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
您可以将Spring Developer Tools与浏览器扩展程序（例如 <a href="https://chrome.google.com/webstore/detail/livereload/jnihajbhpnppcggbcgedagnkighmdlei">Chrome LiveReload扩展程序</a>）结合使用以获取自动浏览器
在Grails应用程序中进行任何更改时刷新。
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_spring_boot_gradle插件更改">Spring Boot Gradle插件更改</h3>
<div class="paragraph">
<p>Grails 4构建于Spring Boot 2.1之上。 Grails 3应用程序是在Spring Boot 1.x之上构建的。</p>
</div>
<div class="paragraph">
<p>您的Grails 3应用的 <code>build.gradle</code> 可能具有这样的配置:</p>
</div>
<div class="listingblock">
<div class="title">buid.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bootRun {
    addResources = <span class="predefined-constant">true</span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails 4应用程序基于Spring Boot 2.1构建。从Spring Boot 2.0开始， <code>addResources</code> 属性不再存在。相反，您需要将sourceResources属性设置为要使用的源集。通常是 <code>sourceSets.main</code> 。这在 <a href="https://docs.spring.io/spring-boot/docs/2.0.0.M3//gradle-plugin/reference/html/#running-your-application-reloading-resources">Spring Boot Gradle中进行了描述插件的文档</a>。
您可以配置Grails 4应用程序的 <code>build.gradle</code> :</p>
</div>
<div class="listingblock">
<div class="title">buid.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bootRun {
        sourceResources sourceSets.main
    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_为grails插件构建可执行jar">为Grails插件构建可执行jar</h3>
<div class="paragraph">
<p><a href="https://spring.io/blog/2017/04/05/spring-boot-s-new-gradle-plugin">Spring Boot的新Gradle插件</a>：</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>bootRepackage任务已替换为bootJar和bootWar任务，分别用于构建可执行的jar和wars。两项任务都扩展了其等效的标准Gradle jar或war任务，使您可以访问所有常规配置选项和行为。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>如果您有以下配置：</p>
</div>
<div class="listingblock">
<div class="title">buid.gradle | Grails 3</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// 如果您希望将此插件打包为独立应用程序，请启用</span>
bootRepackage.enabled = <span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>替换为:</p>
</div>
<div class="listingblock">
<div class="title">buid.gradle | Grails 4</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// 如果您希望将此插件打包为独立应用程序，请启用</span>
bootJar.enabled = <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_升级到gradle_5">升级到Gradle 5</h3>
<div class="paragraph">
<p>默认情况下，Grails 3应用程序使用的是 <a href="http://gradle.org">Gradle</a> 3.5。 Grails 4应用程序使用Gradle 5。</p>
</div>
<div class="paragraph">
<p>升级到Gradle 5执行:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew wrapper --gradle-version 5.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于Gradle 5的更改，插件的 <a href="https://docs.gradle.org/current/userguide/upgrading_version_4.html#rel5.0:pom_compile_runtime_separation">不再解决传递依赖项</a>。如果您的项目使用具有传递依赖项的插件，则需要将其显式添加到您的 <code>build.gradle</code> 文件中。</p>
</div>
<div class="paragraph">
<p>如果您自定义应用程序的构建，则可能需要进行其他迁移。请检查
<a href="https://docs.gradle.org/current/userguide/upgrading_version_4.html">Gradle升级构建</a> 文件资料.</p>
</div>
</div>
<div class="sect2">
<h3 id="_h2_web控制台">H2 Web控制台</h3>
<div class="paragraph">
<p>Spring Boot 2.1包括对H2数据库Web控制台的本地支持。由于此功能已包含在Spring Boot中，因此等效功能已从Grails中删除。因此，H2控制台现在可以在 <code>/h2-console</code> 中使用，而不是先前的 <code>/dbconsole</code> URI。有关更多信息，请参阅Spring Boot文档中的 <a href="https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#boot-features-sql-h2-console">使用H2的Web控制台</a>。</p>
</div>
</div>
<div class="sect2">
<h3 id="_升级休眠">升级休眠</h3>
<div class="paragraph">
<p>如果您在Grails 3应用程序中使用GORM进行Hibernate实施，则需要升级到Hibernate 5.4。</p>
</div>
<div class="paragraph">
<p>Grails 3 <code>build.gradle</code> ，例如:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
...
  compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate5</span><span class="delimiter">&quot;</span></span>
  compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate:hibernate-core:5.1.5.Final</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>将在Grails 4中:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
...
  compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:hibernate5</span><span class="delimiter">&quot;</span></span>
  compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.hibernate:hibernate-core:5.4.0.Final</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_迁移到geb_2_3">迁移到Geb 2.3</h3>
<div class="paragraph">
<p>Geb 1.1.x（与JDK 1.7兼容的版本）是Grails 3默认提供的版本。Grails4不再与Java 1.7兼容。您应该迁移到Geb 2.3。</p>
</div>
<div class="paragraph">
<p>在Grails 3中，如果您的build.gradle看起来像:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
 testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:geb:1.1.2</span><span class="delimiter">&quot;</span></span>
 testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-htmlunit-driver:2.47.1</span><span class="delimiter">&quot;</span></span>
 testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">net.sourceforge.htmlunit:htmlunit:2.18</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在Grails 4中，您应该将其替换为：</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    repositories {
       ...
    }
    dependencies {
        ...
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">gradle.plugin.com.energizedwork.webdriver-binaries:webdriver-binaries-gradle-plugin:</span><span class="inline"><span class="inline-delimiter">$</span>webdriverBinariesVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>
    }
}
...
..

repositories {
  ...
}

apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">idea</span><span class="delimiter">&quot;</span></span>
...
...
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">com.energizedwork.webdriver-binaries</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="1"></i><b>(1)</b>


dependencies {
...
    testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:geb</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
    testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-chrome-driver:</span><span class="inline"><span class="inline-delimiter">$</span>seleniumVersion</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="5"></i><b>(5)</b>
    testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-firefox-driver:</span><span class="inline"><span class="inline-delimiter">$</span>seleniumVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
    testRuntime <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-safari-driver:</span><span class="inline"><span class="inline-delimiter">$</span>seleniumSafariDriverVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>

    testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-remote-driver:</span><span class="inline"><span class="inline-delimiter">$</span>seleniumVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
    testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-api:</span><span class="inline"><span class="inline-delimiter">$</span>seleniumVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
    testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.seleniumhq.selenium:selenium-support:</span><span class="inline"><span class="inline-delimiter">$</span>seleniumVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="5"></i><b>(5)</b>
}

webdriverBinaries {
    chromedriver <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>chromeDriverVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="2"></i><b>(2)</b>
    geckodriver <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>geckodriverVersion</span><span class="delimiter">&quot;</span></span> <i class="conum" data-value="3"></i><b>(3)</b>
}

tasks.withType(Test) {
    systemProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">geb.env</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">geb.env</span><span class="delimiter">'</span></span>)
    systemProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">geb.build.reportsDir</span><span class="delimiter">&quot;</span></span>, reporting.file(<span class="string"><span class="delimiter">&quot;</span><span class="content">geb/integrationTest</span><span class="delimiter">&quot;</span></span>)
    systemProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">webdriver.chrome.driver</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">webdriver.chrome.driver</span><span class="delimiter">'</span></span>)
    systemProperty <span class="string"><span class="delimiter">&quot;</span><span class="content">webdriver.gecko.driver</span><span class="delimiter">&quot;</span></span>, <span class="predefined-type">System</span>.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">webdriver.gecko.driver</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="properties">gebVersion=2.3
seleniumVersion=3.12.0
webdriverBinariesVersion=1.4
hibernateCoreVersion=5.1.5.Final
chromeDriverVersion=2.44 <i class="conum" data-value="2"></i><b>(2)</b>
geckodriverVersion=0.23.0 <i class="conum" data-value="3"></i><b>(3)</b>
seleniumSafariDriverVersion=3.14.0</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>包括 <a href="https://plugins.gradle.org/plugin/com.energizedwork.webdriver-binaries">Webdriver Binaries Gradle插件</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>设定适当 <a href="http://chromedriver.chromium.org">适用于Chrome版本的Webdriver</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>设定适当 <a href="https://github.com/mozilla/geckodriver/releases">Firefox版本的Webdriver</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>包括 <a href="https://github.com/grails3-plugins/geb">Grails Geb插件依赖性</a> 对 <code>geb-spock</code> 具有传递依赖。这是使用 <a href="http://www.gebish.org">Geb</a>和Spock所必需的依赖项。</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Selenium和不同的驱动程序依赖性。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>还创建一个 <a href="http://www.gebish.org/manual/current/#configuration">Geb Configuration</a> 归档于 <code>src/integration-test/resources/GebConfig.groovy</code> .</p>
</div>
<div class="listingblock">
<div class="title">src/integration-test/resources/GebConfig.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.openqa.selenium.chrome.ChromeDriver</span>
<span class="keyword">import</span> <span class="include">org.openqa.selenium.chrome.ChromeOptions</span>
<span class="keyword">import</span> <span class="include">org.openqa.selenium.firefox.FirefoxDriver</span>
<span class="keyword">import</span> <span class="include">org.openqa.selenium.firefox.FirefoxOptions</span>
<span class="keyword">import</span> <span class="include">org.openqa.selenium.safari.SafariDriver</span>

environments {

    <span class="comment">// 您需要在Safari中配置-&gt;开发-&gt;允许远程自动化</span>
    safari {
        driver = { <span class="keyword">new</span> SafariDriver() }
    }

    <span class="comment">// 通过 ` ./gradlew -Dgeb.env = chrome iT `运行</span>
    chrome {
        driver = { <span class="keyword">new</span> ChromeDriver() }
    }

    <span class="comment">// 通过 ` ./gradlew -Dgeb.env = chromeHeadless iT `运行</span>
    chromeHeadless {
        driver = {
            ChromeOptions o = <span class="keyword">new</span> ChromeOptions()
            o.addArguments(<span class="string"><span class="delimiter">'</span><span class="content">headless</span><span class="delimiter">'</span></span>)
            <span class="keyword">new</span> ChromeDriver(o)
        }
    }

    <span class="comment">// 通过 ` ./gradlew -Dgeb.env = firefoxHeadless iT `运行</span>
    firefoxHeadless {
        driver = {
            FirefoxOptions o = <span class="keyword">new</span> FirefoxOptions()
            o.addArguments(<span class="string"><span class="delimiter">'</span><span class="content">-headless</span><span class="delimiter">'</span></span>)
            <span class="keyword">new</span> FirefoxDriver(o)
        }
    }

    <span class="comment">// 通过 ` ./gradlew -Dgeb.env = firefox iT `运行</span>
    firefox {
        driver = { <span class="keyword">new</span> FirefoxDriver() }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_不推荐使用的课程">不推荐使用的课程</h3>
<div class="paragraph">
<p>在Grails 3.x中不推荐使用的以下类在Grails 4中已被删除。请检查下面的列表以找到合适的替代品：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">去除类</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">替代</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.UniqueConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.builtin.UniqueConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.util.BuildScope</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.transaction.GrailsTransactionTemplate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.transactions.GrailsTransactionTemplate</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.transaction.transform.RollbackTransform</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.transactions.transform.RollbackTransform</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.transaction.NotTransactional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.transactions.NotTransactional</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.transaction.Rollback</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.transactions.Rollback</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.transaction.Transactional</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.transactions.Transactional</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.config.FlatConfig</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.core.metaclass.MetaClassEnhancer</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use traits instead.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.core.util.ClassPropertyFetcher</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.mapping.reflect.ClassPropertyFetcher</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.transaction.transform.TransactionalTransform</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.transactions.transform.TransactionalTransform</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.core.ComponentCapableDomainClass</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.core.GrailsDomainClassProperty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the <code>org.grails.datastore.mapping.model.MappingContext</code> API instead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.core.DefaultGrailsDomainClassProperty</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.core.MetaGrailsDomainClassProperty</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.core.support.GrailsDomainConfigurationUtil</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use the <code>org.grails.datastore.mapping.model.MappingContext</code> and <code>org.grails.datastore.mapping.model.MappingFactory</code> APIs instead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.plugins.domain.DomainClassPluginSupport</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.plugins.domain.support.GormApiSupport</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.plugins.domain.support.GrailsDomainClassCleaner</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Handled by <code>org.grails.datastore.mapping.model.MappingContext</code> now</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.AbstractConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use <code>org.grails.datastore.gorm.validation.constraints.AbstractConstraint</code> instead</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.AbstractVetoingConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"> <code>org.grails.datastore.gorm.validation.constraints.AbstractVetoingConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.CascadingValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.validation.CascadingValidator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.ConstrainedProperty</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.validation.ConstrainedProperty</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.Constraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.validation.Constraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.ConstraintFactory</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.factory.ConstraintFactory</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.VetoingConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.validation.VetoingConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.validation.ConstraintException</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.BlankConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.BlankConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.ConstrainedPropertyBuilder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.builder.ConstrainedPropertyBuilder</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.ConstraintDelegate</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.ConstraintsEvaluatorFactoryBean</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.eval.ConstraintsEvaluator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.CreditCardConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.CreditCardConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.DefaultConstraintEvaluator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.eval.DefaultConstraintEvaluator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.DomainClassPropertyComparator</code></p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.EmailConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.EmailConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.GrailsDomainClassValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.gorm.validation.PersistentEntityValidator</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.InListConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.InListConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.MatchesConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.MatchesConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.MaxConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.MaxConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.MaxSizeConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.MaxSizeConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.MinConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.MinConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.MinSizeConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.MinSizeConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.NotEqualConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.NotEqualConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.NullableConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.NullableConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.RangeConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.RangeConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.ScaleConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.ScaleConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.SizeConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.SizeConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.UrlConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.UrlConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.ValidatorConstraint</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.datastore.gorm.validation.constraints.ValidatorConstraint</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.routines.DomainValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by newer version of commons-validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.routines.InetAddressValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by newer version of commons-validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.routines.RegexValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by newer version of commons-validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.routines.ResultPair</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by newer version of commons-validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>org.grails.validation.routines.UrlValidator</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Replaced by newer version of commons-validation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.web.JSONBuilder</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>groovy.json.StreamingJsonBuilder</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_grails_java8">Grails-Java8</h3>
<div class="paragraph">
<p>对于那些在 <code>grails-java8</code> 插件上添加了依赖关系的人，您只需要做的就是删除依赖关系。 插件中的所有类均已移至各自的项目。</p>
</div>
</div>
<div class="sect2">
<h3 id="_配置文件弃用">配置文件弃用</h3>
<div class="paragraph">
<p>Grails 3.x支持的一些配置文件将不再维护，因此，当它们以简写形式出现时，将不再可能创建应用程序。 升级现有项目时，有必要为这些配置文件提供版本。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.grails.profiles:angularjs</code> &#8594; <code>org.grails.profiles:angularjs:1.1.2</code></p>
</li>
<li>
<p><code>org.grails.profiles:webpack</code> &#8594; <code>org.grails.profiles:webpack:1.1.6</code></p>
</li>
<li>
<p><code>org.grails.profiles:react-webpack</code> &#8594; <code>org.grails.profiles:react-webpack:1.0.8</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_预定方法">预定方法</h3>
<div class="paragraph">
<p>在Grails 3中，使用Spring <code>@Scheduled</code> 注释不需要配置或其他更改。 在Grails 4中，必须将 <code>@EnableScheduling</code> 批注应用到您的应用程序类中，以便安排工作。</p>
</div>
</div>

<a name="3. &#37197;&#32622;"><!-- Legacy link --></a>
<h1 id="conf">4 配置</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>在我们现在讨论这个主题的，包含“约定之上的约定”的框架中，这似乎很奇怪。
正如快速入门所示，使用Grails的默认设置，您实际上可以在不进行任何配置的情况下开发应用程序，但是重要的是要了解在需要时在何处以及如何覆盖约定。
用户指南的后面各节将提及您可以使用哪些配置设置，但没有介绍如何设置它们。假设您至少已经阅读了本章的第一部分！</p>
</div>

<a name="3.1 &#22522;&#26412;&#37197;&#32622;"><!-- Legacy link --></a>
<h2 id="config">4.1 基本配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 中的配置通常分为两个区域：构建配置和运行时配置。</p>
</div>
<div class="paragraph">
<p>通常通过 Gradle 和 <code>build.gradle</code> 文件来完成构建配置。默认情况下，运行时配置是在YAML中的 <code>grails-app/conf/application.yml</code> 文件中指定的。</p>
</div>
<div class="paragraph">
<p>如果您更喜欢使用 Grails 2.0 风格的 Groovy 配置，则可以使用 Groovy 的 <a href="http://docs.groovy-lang.org/latest/html/documentation/#_configslurper">ConfigSlurper</a> 语法指定配置。有两个 Groovy 配置文件：grails-app/conf/application.groovy 和 grails-app/conf/runtime.groovy：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>使用 <code>application.groovy</code> 进行不依赖于应用程序类的配置</p>
</li>
<li>
<p>使用 <code>runtime.groovy</code> 进行不依赖于应用程序类的配置</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>这种分离是必要的，因为 Grails CLI 可以使用 <code>application.groovy</code> 中定义的配置值，Grails CLI 必须能够在编译应用程序之前加载 <code>application.groovy</code> 。当以下命令由 CLI 执行时，对 <code>application.groovy</code> 中的应用程序类的引用将导致异常：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>运行 Grails CLI 时发生错误：
启动失败：script14738267015581837265078.groovy：13：无法解析 com.foo.Bar 类</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>对于 Groovy 配置，以下变量可用于配置脚本：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>变量</strong></th>
<th class="tableblock halign-left valign-top"><strong>说明</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">userHome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">运行 Grails 应用程序的帐户的主目录的位置。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">grailsHome</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">安装 Grails 的目录的位置。如果设置了 <code>GRAILS_HOME</code> 环境变量，则使用它。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">appName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 build.gradle 中显示的应用程序名称。</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">appVersion</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">在 build.gradle 中显示的应用程序版本。</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">my.tmp.dir = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>userHome<span class="inline-delimiter">}</span></span><span class="content">/.grails/tmp</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_使用_grailsapplication_访问配置">使用 GrailsApplication 访问配置</h3>
<div class="paragraph">
<p>如果您想读取运行时配置设置，即在 <code>application.yml</code> 中定义的设置，请使用 <a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsApplication.html">grailsApplication</a> 对象，该对象可以在控制器和标记库中作为变量使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyController</span> {
    <span class="keyword">def</span> <span class="function">hello</span>() {
        <span class="keyword">def</span> recipient = grailsApplication.config.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">foo.bar.hello</span><span class="delimiter">'</span></span>)

        render <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">${</span>recipient<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>grailsApplication 对象的 config 属性是 <a href="http://docs.grails.org/4.0.0/api/grails/config/Config.html">Config</a> 接口的一个实例，并提供了许多有用的方法来读取应用程序的配置。</p>
</div>
<div class="paragraph">
<p>特别是，<code>getProperty</code> 方法（如上所示）对于有效检索配置属性非常有用，同时可以指定属性类型（默认类型为 String）和/或提供默认的后备值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyController</span> {

    <span class="keyword">def</span> <span class="function">hello</span>(Recipient recipient) {
        <span class="comment">//Retrieve Integer property 'foo.bar.max.hellos', otherwise use value of 5</span>
        <span class="keyword">def</span> max = grailsApplication.config.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">foo.bar.max.hellos</span><span class="delimiter">'</span></span>, <span class="predefined-type">Integer</span>, <span class="integer">5</span>)

        <span class="comment">//Retrieve property 'foo.bar.greeting' without specifying type (default is String), otherwise use value &quot;Hello&quot;</span>
        <span class="keyword">def</span> greeting = grailsApplication.config.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">foo.bar.greeting</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello</span><span class="delimiter">&quot;</span></span>)

        <span class="keyword">def</span> message = (recipient.receivedHelloCount &gt;= max) ?
          <span class="string"><span class="delimiter">&quot;</span><span class="content">Sorry, you've been greeted the max number of times</span><span class="delimiter">&quot;</span></span> :  <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>greeting<span class="inline-delimiter">}</span></span><span class="content">, </span><span class="inline"><span class="inline-delimiter">${</span>recipient<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        }

        render message
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意， <code>Config</code> 实例是基于 Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/PropertySource.html">PropertySource</a> 概念的合并配置，并从环境，系统属性和本地应用程序配置中读取配置，并将它们合并为单个对象。</p>
</div>
<div class="paragraph">
<p><code>GrailsApplication</code> 可以很容易地注入服务和其他 Grails 工件中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.core.*</span>

<span class="type">class</span> <span class="class">MyService</span> {
    GrailsApplication grailsApplication

    <span class="predefined-type">String</span> greeting() {
        <span class="keyword">def</span> recipient = grailsApplication.config.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">foo.bar.hello</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">${</span>recipient<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_grailsconfigurationaware_接口">GrailsConfigurationAware 接口</h3>
<div class="paragraph">
<p>在运行时动态访问配置会对应用程序性能产生很小的影响。一种替代方法是实现 <a href="http://docs.grails.org/4.0.0/api/grails/core/support/GrailsConfigurationAware.html">GrailsConfigurationAware</a> 接口，该接口提供了一个 <code>setConfiguration</code> 方法，该方法在初始化类时将应用程序配置作为参数接受。然后，您可以将相关的配置属性分配给类上的实例属性，以供以后使用。</p>
</div>
<div class="paragraph">
<p><code>Config</code> 实例与注入的 <code>GrailsApplication</code> config 对象具有相同的属性和用法。这是上一个示例中的服务类，使用的是 GrailsConfigurationAware 而不是注入 <code>GrailsApplication</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.core.support.GrailsConfigurationAware</span>

<span class="type">class</span> <span class="class">MyService</span> <span class="directive">implements</span> GrailsConfigurationAware {

    <span class="predefined-type">String</span> recipient

    <span class="predefined-type">String</span> greeting() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">${</span>recipient<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }

    <span class="type">void</span> setConfiguration(Config config) {
        recipient = config.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">foo.bar.hello</span><span class="delimiter">'</span></span>)
    }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_spring_value_注解">Spring Value 注解</h3>
<div class="paragraph">
<p>您可以使用 Spring 的 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Value.html">Value</a> 批注注入配置值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.*</span>

<span class="type">class</span> <span class="class">MyController</span> {
    <span class="annotation">@Value</span>(<span class="string"><span class="delimiter">'</span><span class="content">${foo.bar.hello}</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">String</span> recipient

    <span class="keyword">def</span> <span class="function">hello</span>() {
        render <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello </span><span class="inline"><span class="inline-delimiter">${</span>recipient<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 Groovy 代码中，必须在字符串周围使用单引号作为 <code>value</code> 注释的值，否则它将被解释为 GString 而不是 Spring 表达式。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如您所见，访问配置设置时，使用与定义它们时相同的点符号。</p>
</div>
</div>


<h2 id="ymlOptions">4.1.1 YML 格式选项配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/ymlOptions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 3.0 中引入了 <code>application.yml</code> 文件，现在 YAML 是配置文件的首选格式。</p>
</div>
<div class="sect2">
<h3 id="_使用系统属性_命令行参数">使用系统属性/命令行参数</h3>
<div class="paragraph">
<p>假设您使用的是 <code>JDBC_CONNECTION_STRING</code> 命令行参数，并且希望在 yml 文件中访问该参数，则可以按以下方式执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">production</span>:
    <span class="key">dataSource</span>:
        <span class="key">url</span>: <span class="string"><span class="content">'${JDBC_CONNECTION_STRING}'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>同样，也可以访问系统参数。</p>
</div>
<div class="paragraph">
<p>如果使用 <code>grails run app</code> 启动应用程序，则需要在 <code>build.gradle</code> 中使用此命令来修改 <code>bootRun</code> 目标：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bootRun {
    systemProperties = <span class="predefined-type">System</span>.properties
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了进行测试，需要将 <code>test</code> 任务更改如下</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">test {
    systemProperties = <span class="predefined-type">System</span>.properties
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_外部配置">外部配置</h3>
<div class="paragraph">
<p>默认情况下，Grails将从 <code>./config</code> 或当前目录中读取 <code>application.(properties | yml)</code> 。</p>
</div>
<div class="paragraph">
<p>因为 Grails 也是一个 SpringBoot，所以也提供了配置选项方式，有关文档，请参阅： <a href="https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html#boot-features-external-config-application-property-files" class="bare">https://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-external-config.html#boot-features-external-config-application-property-files</a></p>
</div>
</div>

<a name="3.1.1 &#20869;&#32622;&#36873;&#39033;"><!-- Legacy link --></a>
<h2 id="builtInOptions">4.1.2 内置选项</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/builtInOptions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 有一组核心设置值得了解。它们的默认值适用于大多数项目，但了解它们的作用很重要，因为您可能需要这些设置中的一个或多个。</p>
</div>
<div class="sect2">
<h3 id="_运行时设置">运行时设置</h3>
<div class="paragraph">
<p>在运行时方面，即 <code>grails app/conf/application.yml</code> ，还有很多核心设置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails.enable.native2ascii</code> - 如果不需要 grails i18n 属性文件的 native2ascii 转换，则将其设置为 false（默认值：true）。</p>
</li>
<li>
<p><code>grails.views.default.codec</code> - 设置 GSPs 的默认编码机制——可以是 'none', 'html', 或者 'base64' 之一（默认值：'none'）。要降低 XSS 攻击的风险，请将其设置为 'html'。</p>
</li>
<li>
<p><code>grails.views.gsp.encoding</code> - 用于 GSP 源文件的文件编码（默认值：“utf-8”）。</p>
</li>
<li>
<p><code>grails.mime.file.extensions</code> - 是否使用文件扩展名指定链接中的 mime 类型 <a href="theWebLayer.html#contentNegotiation">Content Negotiation</a>（默认值：true）。</p>
</li>
<li>
<p><code>grails.mime.types</code> - 用于 <a href="theWebLayer.html#contentNegotiation">Content Negotiation</a> 的受支持 mime 类型的映射。</p>
</li>
<li>
<p><code>grails.server URL</code> - 指定绝对链接的服务器URL部分的字符串，包括服务器名，例如 grails.serverURL="http://my.yourportal.com"。查看 <a href="http://gsp.grails.org/latest/ref/Tags/createLink.html">createLink</a>。也被重定向使用。</p>
</li>
<li>
<p><code>grails.views.gsp.sitemesh.preprocess</code> - 决定是否进行 sitemesh 预处理。禁用此选项会减慢页面呈现速度，但如果需要 SiteMesh 从 GSP 视图解析生成的 HTML，则禁用它是正确的选项。如果您不了解此高级属性，请不要担心：将其设置为 true。</p>
</li>
<li>
<p><code>grails.reload.excludes</code> 和 <code>grails.reload.includes</code> - 配置这些指令将确定项目特定源文件的重新加载行为。每个指令都有一个字符串列表，这些字符串是项目源文件的类名，在使用 <code>run app</code> 命令运行开发中的应用程序时，这些字符串应排除在重新加载行为之外，或相应地包含在其中。如果配置了 <code>grails.reload.includes</code> 指令，则只会重新加载该列表中的类。</p>
</li>
</ul>
</div>
</div>

<a name="3.1.2 &#26085;&#24535;"><!-- Legacy link --></a>
<h2 id="logging">4.1.3 日志</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/logging.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>默认情况下，Grails 3.0 中的日志记录由 <a href="http://logback.qos.ch">Logback日志记录框架</a> 处理，并且可以使用 <code>grails-app/conf/logback.groovy</code> 文件进行配置。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果您更喜欢XML，则可以将 <code>logback.groovy `文件替换为 `logback.xml</code> 文件。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>有关配置日志记录的更多信息，请参阅关于该主题的 <a href="http://logback.qos.ch/manual/groovy.html">Logback文档</a>。</p>
</div>


<h2 id="loggerName">4.1.3.1 记录器名称</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/logging/loggerName.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails artifacts（Grails 工件：控制器、服务…）会自动注入一个 log 属性。</p>
</div>
<div class="paragraph">
<p>在 Grails 3.3.0 之前, Grails Artifact 的 logger 遵循惯例 <code>grails.app.&lt;type&gt;.&lt;className&gt;</code>，其中 type 是工件的类型，例如 <code>controllers</code> 或 <code>services</code>，<code>className</code> 是工件的完全限定名。</p>
</div>
<div class="paragraph">
<p>Grails 3.3.x 简化了 logger 名称。下面的示例说明了这些更改：</p>
</div>
<div class="paragraph">
<p><code>BookController.groovy</code> 位于 <code>grails app/controllers/com/company</code> ，没有使用 <code><a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/util/logging/Slf4j.html">@Slf4j</a></code> 注释：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.3.x or higher)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.2.x or lower)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookController</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.app.controllers.com.company.BookController</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>BookController.groovy</code> 位于 <code>grails app/controllers/com/company</code> ，注释为 <code><a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/util/logging/Slf4j.html">@Slf4j</a></code> ：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.3.x or higher)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.2.x or lower)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookController</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookController</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>BookService.groovy</code> 位于 <code>grails app/services/com/company</code> ，没有使用 <code><a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/util/logging/Slf4j.html">@Slf4j</a></code> 注释：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.3.x or higher)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.2.x or lower)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>grails.app.services.com.company.BookService</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>BookService.groovy</code> 位于 <code>grails app/services/com/company</code> ，注释为 <code><a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/util/logging/Slf4j.html">@Slf4j</a></code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.3.x or higher)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.2.x or lower)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookService</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookService</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>BookDetail.groovy</code> 位于 <code>src/main/groovy/com/company</code> ，注释为 <code><a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/util/logging/Slf4j.html">@Slf4j</a></code></p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.3.x or higher)</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Logger Name (Grails 3.2.x or lower)</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookDetail</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>com.company.BookDetail</code></p></td>
</tr>
</tbody>
</table>


<h2 id="maskingRequestParametersFromStacktraceLogs">4.1.3.2 从堆栈跟踪日志屏蔽请求参数</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/logging/maskingRequestParametersFromStacktraceLogs.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>当 Grails 记录堆栈跟踪（stacktrace）时，日志消息可能包含当前请求的所有请求参数的名称和值。</p>
</div>
<div class="paragraph">
<p>要屏蔽安全请求参数的值，请在 <code>grails.exceptionresolver.params.exclude</code> 配置属性中指定参数名称：</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">exceptionresolver</span>:
        <span class="key">params</span>:
            <span class="key">exclude</span>:
                - <span class="string"><span class="content">password</span></span>
                - <span class="string"><span class="content">creditCard</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>通过将 <code>grails.exceptionresolver.logRequestParameters</code> 配置属性设置为 false，可以完全关闭请求参数日志记录。</p>
</div>
<div class="paragraph">
<p>当应用程序在开发模式（DEVELOPMENT MODE）下运行时，默认值为 true，对于应用程序的其他所有环境，默认值为 false。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yaml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">exceptionresolver</span>:
        <span class="key">logRequestParameters</span>: <span class="string"><span class="content">false</span></span></code></pre>
</div>
</div>


<h2 id="externalLoggingConfiguration">4.1.3.3 外部配置文件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/logging/externalLoggingConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果设置配置属性 <code>logging.config</code>，则可以通知 Logback 使用外部配置文件。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">logging</span>:
    <span class="key">config</span>: <span class="string"><span class="content">/Users/me/config/logback.groovy</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，可以通过配置系统属性的方式提供配置文件位置：</p>
</div>
<div class="paragraph">
<p><code>$ ./gradlew -Dlogging.config=/Users/me/config/logback.groovy bootRun</code></p>
</div>
<div class="paragraph">
<p>或者，还可以使用环境变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ export LOGGING_CONFIG=/Users/me/config/logback.groovy
$ ./gradlew bootRun</code></pre>
</div>
</div>

<a name="3.1.3 GORM"><!-- Legacy link --></a>
<h2 id="configGORM">4.1.4 GORM</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/configGORM.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 提供了以下 GORM 配置选项:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails.gorm.failOnError</code> - 如果设置为 <code>true</code> ，则会导致域类上的 <code>save()</code> 方法在 <a href="validation.html">validation</a> 失败时抛出 <code>grails.validation.ValidationException</code> 。也可以为该选项分配表示包名称的字符串列表。如果值是字符串列表，则 failOnError 行为将仅应用于这些包（包括子包）中的域类。有关更多详细信息，请参阅 <a href="../ref/Domain%20Classes/save.html">save</a> 文档。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，要为所有域类启用 failOnError：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">gorm</span>:
        <span class="key">failOnError</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>以及要按包为域类启用 failOnError：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">gorm</span>:
        <span class="key">failOnError</span>:
            - <span class="string"><span class="content">com.companyname.somepackage</span></span>
            - <span class="string"><span class="content">com.companyname.someotherpackage</span></span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails.gorm.autoFlush</code> - 如果设置为 <code>true</code> ,将导致 <a href="../ref/Domain%20Classes/merge.html">merge</a> 、 <a href="../ref/Domain%20Classes/save.html">save</a> 和 <a href="../ref/Domain%20Classes/delete.html">delete</a> 方法刷新会话，替换使用 <code>save(flush:true)</code> 显式刷新的需要。</p>
</li>
</ul>
</div>


<h2 id="proxyConfig">4.1.5 配置 HTTP 代理</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/config/proxyConfig.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>要将 Grails 设置为使用 HTTP 代理，有两个步骤。首先，如果您想使用它来创建应用程序，则需要配置 <code>grails</code> CLI以了解代理。可以使用 <code>GRAILS_OPTS</code> 环境变量来完成，例如在 Unix 系统上：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">export GRAILS_OPTS=&quot;-Dhttps.proxyHost=127.0.0.1 -Dhttps.proxyPort=3128 -Dhttp.proxyUser=test -Dhttp.proxyPassword=test&quot;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认的配置文件存储库是通过HTTPS解析的，因此使用 <code>https.proxyPort</code> 和 <code>https.proxyUser</code> ，但是用户名和密码是通过 <code>http.proxyUser</code> 和 <code>http.proxyPassword</code> 指定的。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>对于 Windows 系统，可以在 "我的电脑/高级/环境变量" 下配置环境变量。</p>
</div>
<div class="paragraph">
<p>有了这种配置，<code>grails</code> 命令就可以通过代理进行连接和认证。</p>
</div>
<div class="paragraph">
<p>其次，由于 Grails 使用 Gradle 作为构建系统，因此您需要将 Gradle 配置为通过代理进行身份验证。有关如何执行此操作的说明，请参阅 <a href="https://docs.gradle.org/current/userguide/build_environment.html#sec:accessing_the_web_via_a_proxy">该主题的Gradle用户指南部分</a>。</p>
</div>


<h2 id="applicationClass">4.2 应用程序类</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/applicationClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>每个新的 Grails 应用程序都在 grails-app/init 目录中具有一个 Application 类。</p>
</div>
<div class="paragraph">
<p><code>Application</code> 类是 <a href="http://docs.grails.org/4.0.0/api/grails/boot/config/GrailsAutoConfiguration.html">GrailsAutoConfiguration</a> 类，并具有静态无返回值 main 方法，这意味着它可以作为常规应用程序运行。</p>
</div>


<h2 id="executing">4.2.1 执行应用程序类</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/applicationClass/executing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>有几种方法可以执行 <code>Application</code> 类，如果您使用的是 IDE，那么您只需右键单击该类并直接从 IDE 运行它，IDE 将启动 Grails 应用程序。</p>
</div>
<div class="paragraph">
<p>这对于调试也很有用，因为可以使用 <code>run-app --debug-jvm</code> 命令行中的命令。</p>
</div>
<div class="paragraph">
<p>您还可以将应用程序打包为可运行的WAR文件，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails package
$ java -jar build/libs/myapp-0.1.war</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您计划使用无容器（container-less）方法部署应用程序，这将非常有用。</p>
</div>


<h2 id="customizing">4.2.2 自定义应用程序类</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/applicationClass/customizing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>您可以通过多种方式自定义 <code>Application</code> 类。</p>
</div>
<div class="sect2">
<h3 id="_总定义扫描路径">总定义扫描路径</h3>
<div class="paragraph">
<p>默认情况下，Grails 会扫描所有已知的源目录中的控制器、域类等，但是，如果您希望扫描其他JAR文件中的软件包，则可以通过覆盖 <code>Application</code> 类的 <code>packageNames()</code> 方法来进行扫描：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Application</span> <span class="directive">extends</span> GrailsAutoConfiguration {
    <span class="annotation">@Override</span>
    <span class="predefined-type">Collection</span>&lt;<span class="predefined-type">String</span>&gt; packageNames() {
        <span class="local-variable">super</span>.packageNames() + [<span class="string"><span class="delimiter">'</span><span class="content">my.additional.package</span><span class="delimiter">'</span></span>]
    }

    ...
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_注册其他bean">注册其他Bean</h3>
<div class="paragraph">
<p><code>Application</code> 类也可以用作 Spring bean 定义的源代码，只需定义一个用 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/Bean.html">Bean</a> 注释的方法，返回的对象将成为 Spring bean 。 该方法的名称用作Bean名称：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Application</span> <span class="directive">extends</span> GrailsAutoConfiguration {
    <span class="annotation">@Bean</span>
    MyType myBean() {
        <span class="keyword">return</span> <span class="keyword">new</span> MyType()
    }

    ...
}</code></pre>
</div>
</div>
</div>


<h2 id="applicationLifeCycle">4.2.3 应用程序生命周期</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/applicationClass/applicationLifeCycle.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><code>Application</code> 类还实现了所有插件都实现的 <a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsApplicationLifeCycle.html">GrailsApplicationLifeCycle</a> 接口。</p>
</div>
<div class="paragraph">
<p>这意味着 <code>Application</code> 类可用于执行与插件相同的功能。您可以通过覆盖适当的方法来覆盖 <a href="plugins.html#hookingIntoRuntimeConfiguration">regular plugins hooks</a> ，例如 <code>doWithSpring</code> ，<code>doWithApplicationContext</code> 等。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Application</span> <span class="directive">extends</span> GrailsAutoConfiguration {
    <span class="annotation">@Override</span>
    Closure doWithSpring() {
        {-&gt;
            mySpringBean(MyType)
        }
    }

    ...
}</code></pre>
</div>
</div>

<a name="3.2 &#29615;&#22659;"><!-- Legacy link --></a>
<h2 id="environments">4.3 环境</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/environments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_每个环境独立配置">每个环境独立配置</h3>
<div class="paragraph">
<p>Grails 支持每个环境配置的概念。 <code>grails-app/conf</code> 目录中的 <code>application.yml</code> 和 <code>application.groovy</code> 文件可以使用每个环境的配置，使用 YAML 或 <a href="http://docs.groovy-lang.org/latest/html/documentation/＃_configslurper">ConfigSlurper</a> 提供的语法。作为示例，请考虑 Grails 提供的以下默认 <code>application.yml</code> 定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>environments:
    development:
        dataSource:
            dbCreate: create-drop
            url: jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE
    test:
        dataSource:
            dbCreate: update
            url: jdbc:h2:mem:testDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE
    production:
        dataSource:
            dbCreate: update
            url: jdbc:h2:prodDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE
        properties:
           jmxEnabled: true
           initialSize: 5
        ...</pre>
</div>
</div>
<div class="paragraph">
<p>以上内容可以在 <code>application.groovy</code> 中的 Groovy 语法中表示如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource {
    pooled = <span class="predefined-constant">false</span>
    driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>
    username = <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>
    password = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
}
environments {
    development {
        dataSource {
            dbCreate = <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:devDb</span><span class="delimiter">&quot;</span></span>
        }
    }
    test {
        dataSource {
            dbCreate = <span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:testDb</span><span class="delimiter">&quot;</span></span>
        }
    }
    production {
        dataSource {
            dbCreate = <span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>
            url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:prodDb</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意如何在顶层提供通用配置，然后一个 <code>environments</code> 块为每个环境设置指定 <code>DataSource</code> 的 <code>dbCreate</code> 和 <code>url</code> 属性。</p>
</div>
</div>
<div class="sect2">
<h3 id="_不同环境下的打包和运行">不同环境下的打包和运行</h3>
<div class="paragraph">
<p>Grails 的 <a href="commandLine.html">command line</a> 具有内置功能，可以在特定环境的上下文中执行任何命令。格式为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails &lt;&lt;environment&gt;&gt; &lt;&lt;command name&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，Grails 已知 3 种预设环境：<code>dev</code>、<code>prod</code> 和 <code>test</code> 用于 <code>开发环境</code>、<code>生产环境</code> 和 <code>测试环境</code> 。例如，要为 <code>test</code> 环境创建 WAR，您将运行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails test war</code></pre>
</div>
</div>
<div class="paragraph">
<p>要定位其他环境，可以将 <code>grails.env</code> 变量传递给任何命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails -Dgrails.env=UAT run-app</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_程序环境检测">程序环境检测</h3>
<div class="paragraph">
<p>在代码中，例如在 Gant 脚本或引导程序类中，您可以使用 <a href="http://docs.grails.org/4.0.0/api/grails/util/Environment.html">Environment</a> 类来检测环境：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.util.Environment</span>

...

switch (Environment.current) {
    <span class="keyword">case</span> Environment.DEVELOPMENT:
        configureForDevelopment()
        <span class="keyword">break</span>
    <span class="keyword">case</span> Environment.PRODUCTION:
        configureForProduction()
        <span class="keyword">break</span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_每个环境引导">每个环境引导</h3>
<div class="paragraph">
<p>当您的应用程序基于每个环境启动时，通常希望运行代码。为此，您可以使用 <code>grails-app/init/BootStrap.groovy</code> 文件对每个环境的执行的支持：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> init = { ServletContext ctx -&gt;
    environments {
        production {
            ctx.setAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">prod</span><span class="delimiter">&quot;</span></span>)
        }
        development {
            ctx.setAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">env</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">dev</span><span class="delimiter">&quot;</span></span>)
        }
    }
    ctx.setAttribute(<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_每个环境通用的执行">每个环境通用的执行</h3>
<div class="paragraph">
<p>前面的 <code>BootStrap</code> 示例内部使用了 <code>grails.util.Environment</code> 类来执行。您还可以自己使用此类来执行自己的环境特定逻辑：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Environment.executeForCurrentEnvironment {
    production {
        <span class="comment">// do something in production</span>
    }
    development {
        <span class="comment">// do something only in development</span>
    }
}</code></pre>
</div>
</div>
</div>

<a name="3.3 &#25968;&#25454;&#28304;"><!-- Legacy link --></a>
<h2 id="dataSource">4.4 数据源</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/dataSource.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>由于 Grails 是基于 Java 技术建立的，因此设置数据源需要 JDBC 的一些知识（JDBC 是 Java Database Connectivity 的缩写）。</p>
</div>
<div class="paragraph">
<p>如果使用 H2 以外的数据库，则需要 JDBC 驱动程序。 例如对于 MySQL，您将需要 <a href="http://www.mysql.com/downloads/connector/j/">Connector/J</a> 。</p>
</div>
<div class="paragraph">
<p>驱动程序通常以 JAR 存档的形式出现。最好使用依赖项解析来解析 jar（如果它在 Maven 存储库中可用），例如，您可以为 MySQL 驱动程序添加依赖项，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtime <span class="string"><span class="delimiter">'</span><span class="content">mysql:mysql-connector-java:5.1.29</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>解决 JAR 问题后，您需要熟悉 Grails 如何管理其数据库配置。可以在 <code>grails-app/conf/application.groovy</code> 或 <code>grails-app/conf/application.yml</code> 中维护配置。这些文件包含 dataSource 定义，其中包括以下设置：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>driverClassName</code> - JDBC 驱动程序的类名</p>
</li>
<li>
<p><code>username</code> - 用于建立 JDBC 连接的用户名</p>
</li>
<li>
<p><code>password</code> - 用于建立 JDBC 连接的密码</p>
</li>
<li>
<p><code>url</code> - 数据库的 JDBC URL</p>
</li>
<li>
<p><code>dbCreate</code> - 是否从域模型自动生成数据库 - 'create-drop'，'create'，'update' 或 'validate' 之一</p>
</li>
<li>
<p><code>pooled</code> - 是否使用连接池（默认为 true）</p>
</li>
<li>
<p><code>logSql</code> - 启用 SQL 记录到标准输出</p>
</li>
<li>
<p><code>formatSql</code> - 格式化记录的 SQL</p>
</li>
<li>
<p><code>dialect</code> - 一个字符串或类，表示用于与数据库进行通信的 Hibernate 语言。有关可用的语言，请参见 <a href="http://docs.jboss.org/hibernate/core/3.6/javadocs/org/hibernate/dialect/package-summary.html">org.hibernate.dialect</a> 程序包。</p>
</li>
<li>
<p><code>readOnly</code> - 如果 <code>true</code> 使数据源为只读，则导致连接池在每个 <code>Connection</code> 上调用 <code>setReadOnly（true）</code> 。</p>
</li>
<li>
<p><code>transactional</code> - 如果 <code>false</code> 将 DataSource 的 transactionManager bean 留在链式 BE1PC 事务管理器实现之外。这仅适用于其他数据源。</p>
</li>
<li>
<p><code>persistenceInterceptor</code> - 默认数据源自动连接到持久性拦截器，其他数据源不自动连接，除非将其设置为 <code>true</code></p>
</li>
<li>
<p><code>properties</code> - 在 DataSource bean 上设置的额外属性。请参阅 <a href="http://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html#Common_Attributes">Tomcat Pool</a> 文档。还有Javadoc格式的 <a href="https://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/tomcat/jdbc/pool/PoolConfiguration.html">documentation of the properties</a> 。</p>
</li>
<li>
<p><code>jmxExport</code> - 如果为 <code>false</code> ，将禁用所有数据源的 JMX MBean 注册。默认情况下，为属性中的 <code>jmxEnabled = true</code> 的数据源添加 JMX MBean。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在 application.groovy 中，MySQL 的典型配置可能类似于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource {
    pooled = <span class="predefined-constant">true</span>
    dbCreate = <span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>
    url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/my_database</span><span class="delimiter">&quot;</span></span>
    driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span>
    dialect = org.hibernate.dialect.MySQL5InnoDBDialect
    username = <span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>
    password = <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
    properties {
       jmxEnabled = <span class="predefined-constant">true</span>
       initialSize = <span class="integer">5</span>
       maxActive = <span class="integer">50</span>
       minIdle = <span class="integer">5</span>
       maxIdle = <span class="integer">25</span>
       maxWait = <span class="integer">10000</span>
       maxAge = <span class="integer">10</span> * <span class="integer">60000</span>
       timeBetweenEvictionRunsMillis = <span class="integer">5000</span>
       minEvictableIdleTimeMillis = <span class="integer">60000</span>
       validationQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1</span><span class="delimiter">&quot;</span></span>
       validationQueryTimeout = <span class="integer">3</span>
       validationInterval = <span class="integer">15000</span>
       testOnBorrow = <span class="predefined-constant">true</span>
       testWhileIdle = <span class="predefined-constant">true</span>
       testOnReturn = <span class="predefined-constant">false</span>
       jdbcInterceptors = <span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectionState;StatementCache(max=200)</span><span class="delimiter">&quot;</span></span>
       defaultTransactionIsolation = java.sql.Connection.TRANSACTION_READ_COMMITTED
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
在配置数据源时，请不要在任何配置设置之前包含 type 或 def 关键字，因为 Groovy 会将其视为本地变量定义，并且将不对其进行处理。例如，以下内容无效：
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource {
    <span class="type">boolean</span> pooled = <span class="predefined-constant">true</span> <span class="comment">// type declaration results in ignored local variable</span>
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用额外属性的高级配置示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource {
    pooled = <span class="predefined-constant">true</span>
    dbCreate = <span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>
    url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://localhost:3306/my_database</span><span class="delimiter">&quot;</span></span>
    driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span>
    dialect = org.hibernate.dialect.MySQL5InnoDBDialect
    username = <span class="string"><span class="delimiter">&quot;</span><span class="content">username</span><span class="delimiter">&quot;</span></span>
    password = <span class="string"><span class="delimiter">&quot;</span><span class="content">password</span><span class="delimiter">&quot;</span></span>
    properties {
       <span class="comment">// Documentation for Tomcat JDBC Pool</span>
       <span class="comment">// http://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html#Common_Attributes</span>
       <span class="comment">// https://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/tomcat/jdbc/pool/PoolConfiguration.html</span>
       jmxEnabled = <span class="predefined-constant">true</span>
       initialSize = <span class="integer">5</span>
       maxActive = <span class="integer">50</span>
       minIdle = <span class="integer">5</span>
       maxIdle = <span class="integer">25</span>
       maxWait = <span class="integer">10000</span>
       maxAge = <span class="integer">10</span> * <span class="integer">60000</span>
       timeBetweenEvictionRunsMillis = <span class="integer">5000</span>
       minEvictableIdleTimeMillis = <span class="integer">60000</span>
       validationQuery = <span class="string"><span class="delimiter">&quot;</span><span class="content">SELECT 1</span><span class="delimiter">&quot;</span></span>
       validationQueryTimeout = <span class="integer">3</span>
       validationInterval = <span class="integer">15000</span>
       testOnBorrow = <span class="predefined-constant">true</span>
       testWhileIdle = <span class="predefined-constant">true</span>
       testOnReturn = <span class="predefined-constant">false</span>
       ignoreExceptionOnPreLoad = <span class="predefined-constant">true</span>
       <span class="comment">// http://tomcat.apache.org/tomcat-7.0-doc/jdbc-pool.html#JDBC_interceptors</span>
       jdbcInterceptors = <span class="string"><span class="delimiter">&quot;</span><span class="content">ConnectionState;StatementCache(max=200)</span><span class="delimiter">&quot;</span></span>
       defaultTransactionIsolation = java.sql.Connection.TRANSACTION_READ_COMMITTED <span class="comment">// safe default</span>
       <span class="comment">// controls for leaked connections</span>
       abandonWhenPercentageFull = <span class="integer">100</span> <span class="comment">// settings are active only when pool is full</span>
       removeAbandonedTimeout = <span class="integer">120</span>
       removeAbandoned = <span class="predefined-constant">true</span>
       <span class="comment">// use JMX console to change this setting at runtime</span>
       logAbandoned = <span class="predefined-constant">false</span> <span class="comment">// causes stacktrace recording overhead, use only for debugging</span>
       <span class="comment">// JDBC driver properties</span>
       <span class="comment">// Mysql as example</span>
       dbProperties {
           <span class="comment">// Mysql specific driver properties</span>
           <span class="comment">// http://dev.mysql.com/doc/connector-j/en/connector-j-reference-configuration-properties.html</span>
           <span class="comment">// let Tomcat JDBC Pool handle reconnecting</span>
           autoReconnect=<span class="predefined-constant">false</span>
           <span class="comment">// truncation behaviour</span>
           jdbcCompliantTruncation=<span class="predefined-constant">false</span>
           <span class="comment">// mysql 0-date conversion</span>
           zeroDateTimeBehavior=<span class="string"><span class="delimiter">'</span><span class="content">convertToNull</span><span class="delimiter">'</span></span>
           <span class="comment">// Tomcat JDBC Pool's StatementCache is used instead, so disable mysql driver's cache</span>
           cachePrepStmts=<span class="predefined-constant">false</span>
           cacheCallableStmts=<span class="predefined-constant">false</span>
           <span class="comment">// Tomcat JDBC Pool's StatementFinalizer keeps track</span>
           dontTrackOpenResources=<span class="predefined-constant">true</span>
           <span class="comment">// performance optimization: reduce number of SQLExceptions thrown in mysql driver code</span>
           holdResultsOpenOverStatementClose=<span class="predefined-constant">true</span>
           <span class="comment">// enable MySQL query cache - using server prep stmts will disable query caching</span>
           useServerPrepStmts=<span class="predefined-constant">false</span>
           <span class="comment">// metadata caching</span>
           cacheServerConfiguration=<span class="predefined-constant">true</span>
           cacheResultSetMetadata=<span class="predefined-constant">true</span>
           metadataCacheSize=<span class="integer">100</span>
           <span class="comment">// timeouts for TCP/IP</span>
           connectTimeout=<span class="integer">15000</span>
           socketTimeout=<span class="integer">120000</span>
           <span class="comment">// timer tuning (disable)</span>
           maintainTimeStats=<span class="predefined-constant">false</span>
           enableQueryTimeouts=<span class="predefined-constant">false</span>
           <span class="comment">// misc tuning</span>
           noDatetimeStringSync=<span class="predefined-constant">true</span>
       }
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_有关_dbcreate_的更多信息">有关 dbCreate 的更多信息</h4>
<div class="paragraph">
<p>Hibernate 可以自动创建您的域模型所需的数据库表。您可以通过 dbCreate 属性控制何时以及如何执行此操作，该属性可以采用以下值：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>create</strong> - 删除现有架构并在启动时创建架构，首先删除现有表，索引等。</p>
</li>
<li>
<p><strong>create-drop</strong> - 与 create 相同，但是在应用程序完全关闭时也会删除表。</p>
</li>
<li>
<p><strong>update</strong> - 创建丢失的表和索引，并在不删除任何表或数据的情况下更新当前架构。请注意，这无法正确处理许多架构更改，例如列重命名（剩下的旧列包含现有数据）。</p>
</li>
<li>
<p><strong>validate</strong> - 不更改数据库。将配置与现有数据库架构进行比较，并报告警告。</p>
</li>
<li>
<p>any other value - 不执行任何操作</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一旦您的模式相对稳定，并且建议将应用程序和数据库部署在生产环境中时，建议将 <code>dbCreate</code> 设置为 "none" 。 然后，使用SQL脚本或诸如 <a href="https://flywaydb.org/">Flyway</a> 或 <a href="http://www.liquibase.org/">Liquibase</a> 之类的迁移工具，通过适当的迁移来管理数据库更改。 <a href="http://plugins.grails.org/plugin/grails/database-migration">DatabaseMigration</a> 插件使用 Liquibase 。</p>
</div>
</div>

<a name="3.3.1 &#25968;&#25454;&#28304;&#21644;&#29615;&#22659;"><!-- Legacy link --></a>
<h2 id="dataSourcesAndEnvironments">4.4.1 数据源和环境</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/dataSource/dataSourcesAndEnvironments.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>前面的示例配置假定您在所有环境（生产、测试、开发等）下都需要相同的配置。</p>
</div>
<div class="paragraph">
<p>但是，Grails的DataSource 定义是 "环境感知的(environment aware)"，因此您可以执行以下操作:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource {
    pooled = <span class="predefined-constant">true</span>
    driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span>
    dialect = org.hibernate.dialect.MySQL5InnoDBDialect
    <span class="comment">// other common settings here</span>
}

environments {
    production {
        dataSource {
            url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:mysql://liveip.com/liveDb</span><span class="delimiter">&quot;</span></span>
            <span class="comment">// other environment-specific settings here</span>
        }
    }
}</code></pre>
</div>
</div>

<a name="3.3.3 &#33258;&#21160;&#25968;&#25454;&#24211;&#36801;&#31227;"><!-- Legacy link --></a>
<h2 id="automaticDatabaseMigration">4.4.2 自动数据库迁移</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/dataSource/automaticDatabaseMigration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><code>DataSource</code> 定义的 <code>dbCreate</code> 属性很重要，因为它指示 Grails 在运行时应该如何从 <a href="GORM.html">GORM</a> 类自动生成数据库表。这些选项在 <a href="#dataSource">DataSource</a> 部分中进行了描述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>create</code></p>
</li>
<li>
<p><code>create-drop</code></p>
</li>
<li>
<p><code>update</code></p>
</li>
<li>
<p><code>validate</code></p>
</li>
<li>
<p>no value</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>在 <a href="#environments">development</a> 模式下，默认将 <code>dbCreate</code> 设置为 “create-drop”，但是在开发的某个时刻（比如一旦进入生产阶段）您需要停止每次启动服务器时都删除并重新创建数据库。</p>
</div>
<div class="paragraph">
<p>尝试变更为 <code>update</code> 看起来很美好，因为您保留了现有数据并且仅在代码更改时才更新架构，但是 Hibernate 的更新支持非常保守。它不会进行任何可能导致数据丢失的更改，并且不会检测到重命名的列或表，因此您将继续拥有旧的列或表，并且还将同时拥有新的列或表。</p>
</div>
<div class="paragraph">
<p>Grails 支持通过使用 Liquibase 插件或 Flyway 插件进行迁移。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://plugins.grails.org/plugin/grails/database-migration">Database Migration</a></p>
</li>
<li>
<p><a href="http://plugins.grails.org/plugin/saw303/org.grails.plugins%3Agrails-flyway">Flyway</a></p>
</li>
</ul>
</div>

<a name="3.3.4 &#20107;&#21153;&#24863;&#30693;&#25968;&#25454;&#28304;&#20195;&#29702;"><!-- Legacy link --></a>
<h2 id="transactionAwareDataSourceProxy">4.4.3 事务感知数据源代理</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/dataSource/transactionAwareDataSourceProxy.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>实际的 <code>dataSource</code> bean 被包装在一个可识别事务的代理中，因此将为您提供当前事务或 Hibernate <code>Session</code> （如果一个处于活动状态）正在使用的连接。</p>
</div>
<div class="paragraph">
<p>如果不是这种情况，那么从 <code>dataSource</code> 中检索连接将是一个新的连接，并且您将无法看到尚未提交的更改（假设您具有合理的事务隔离设置，例如 <code>READ_COMMITTED</code> 或更高）。</p>
</div>
<div class="paragraph">
<p>如果需要访问，仍然可以使用 "真实的" 未代理的 <code>dataSource</code> 。它的bean名称是 <code>dataSourceUnproxied</code> 。</p>
</div>
<div class="paragraph">
<p>您可以像使用其他任何 Spring bean 一样访问此 bean，即使用依赖注入：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyService</span> {

   <span class="keyword">def</span> dataSourceUnproxied
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或从 <code>ApplicationContext</code> 中将其拉出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dataSourceUnproxied = ctx.dataSourceUnproxied</code></pre>
</div>
</div>

<a name="3.3.5 &#25968;&#25454;&#24211;&#25511;&#21046;&#21488;"><!-- Legacy link --></a>
<h2 id="databaseConsole">4.4.4 数据库控制台</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/dataSource/databaseConsole.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://h2database.com/html/quickstart.html#h2_console">H2数据库控制台</a> 是 H2 的一项便利功能，它为您拥有 JDBC 驱动程序的任何数据库提供了基于 Web 的界面，对于查看您要开发的数据库。当针对内存数据库运行时，它特别有用。</p>
</div>
<div class="paragraph">
<p>您可以通过在浏览器中导航到 <a href="http://localhost:8080/dbconsole" class="bare">http://localhost:8080/dbconsole</a> 来访问控制台。可以使用 <code>application.groovy</code> 中的 <code>grails.dbconsole.urlRoot</code> 属性来配置URI，默认为 <code>/dbconsole</code>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
目前已经变更为 <code>/h2-console</code>。by <a href="http://www.micrograils.com">MicroGrails</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>默认情况下，控制台在开发模式下处于启用状态，可以通过使用 <code>application.groovy</code> 中的 <code>grails.dbconsole.enabled</code> 属性来禁用或启用该控制台。例如，您可以这样在生产环境中启用控制台：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">environments {
    production {
        grails.serverURL = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.changeme.com</span><span class="delimiter">&quot;</span></span>
        grails.dbconsole.enabled = <span class="predefined-constant">true</span>
        grails.dbconsole.urlRoot = <span class="string"><span class="delimiter">'</span><span class="content">/admin/dbconsole</span><span class="delimiter">'</span></span>
    }
    development {
        grails.serverURL = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="inline"><span class="inline-delimiter">${</span>appName<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
    test {
        grails.serverURL = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/</span><span class="inline"><span class="inline-delimiter">${</span>appName<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
如果在生产环境中启用了控制台，请确保使用受信任的安全框架来保护对控制台的访问。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_配置">配置</h4>
<div class="paragraph">
<p>默认情况下，控制台配置为H2数据库，如果您尚未配置外部数据库，则该控制台将使用默认设置工作-您只需要将 JDBC URL 更改为 <code>jdbc:h2:mem:devDb</code>。如果您已经配置了外部数据库（例如 MySQL，Oracle 等），则可以使用"保存的设置"下拉列表选择设置模板，然后从 <code>application.groovy</code> 中填写url和用户名/密码信息。</p>
</div>
</div>

<a name="3.3.6 &#22810;&#20010;&#25968;&#25454;&#28304;"><!-- Legacy link --></a>
<h2 id="multipleDatasources">4.4.5 多个数据源</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/dataSource/multipleDatasources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>默认情况下，所有域类共享一个 <code>DataSource</code> 和一个数据库，但是您可以选择将域类划分为两个或多个数据源。</p>
</div>
<div class="sect3">
<h4 id="_配置其他数据源">配置其他数据源</h4>
<div class="paragraph">
<p><code>grails-app/conf/application.yml</code> 中的默认 <code>DataSource</code> 配置如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dataSource</span>:
    <span class="key">pooled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">jmxExport</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">driverClassName</span>: <span class="string"><span class="content">org.h2.Driver</span></span>
    <span class="key">username</span>: <span class="string"><span class="content">sa</span></span>
    <span class="key">password</span>:

<span class="key">environments</span>:
    <span class="key">development</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</span></span>
    <span class="key">test</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:mem:testDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</span></span>
    <span class="key">production</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:prodDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</span></span>
            <span class="key">properties</span>:
               <span class="key">jmxEnabled</span>: <span class="string"><span class="content">true</span></span>
               <span class="key">initialSize</span>: <span class="string"><span class="content">5</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将使用名为 <code>dataSource</code> 的 Spring bean 配置单个 <code>DataSource</code> 。要配置额外的数据源，请添加一个带有自定义名称的 <code>dataSources</code> 块（放在顶层，或在一个环境块中，或两者都在，就像标准的 <code>DataSource</code> 定义一样）。例如，下面配置添加了第二个 <code>DataSource</code> ，在开发环境中使用 MySQL，在生产环境中使用 Oracle：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dataSource</span>:
    <span class="key">pooled</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">jmxExport</span>: <span class="string"><span class="content">true</span></span>
    <span class="key">driverClassName</span>: <span class="string"><span class="content">org.h2.Driver</span></span>
    <span class="key">username</span>: <span class="string"><span class="content">sa</span></span>
    <span class="key">password</span>:

<span class="key">dataSources</span>:
    <span class="key">lookup</span>:
        <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.MySQLInnoDBDialect</span></span>
        <span class="key">driverClassName</span>: <span class="string"><span class="content">com.mysql.jdbc.Driver</span></span>
        <span class="key">username</span>: <span class="string"><span class="content">lookup</span></span>
        <span class="key">password</span>: <span class="string"><span class="content">secret</span></span>
        <span class="key">url</span>: <span class="string"><span class="content">jdbc:mysql://localhost/lookup</span></span>
        <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>

<span class="key">environments</span>:
    <span class="key">development</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">create-drop</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:mem:devDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</span></span>
    <span class="key">test</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:mem:testDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</span></span>
    <span class="key">production</span>:
        <span class="key">dataSource</span>:
            <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span>
            <span class="key">url</span>: <span class="string"><span class="content">jdbc:h2:prodDb;MVCC=TRUE;LOCK_TIMEOUT=10000;DB_CLOSE_ON_EXIT=FALSE</span></span>
            <span class="key">properties</span>:
                <span class="key">jmxEnabled</span>: <span class="string"><span class="content">true</span></span>
                <span class="key">initialSize</span>: <span class="string"><span class="content">5</span></span>
                <span class="error">...</span>
        <span class="key">dataSources</span>:
            <span class="key">lookup</span>:
                <span class="key">dialect</span>: <span class="string"><span class="content">org.hibernate.dialect.Oracle10gDialect</span></span>
                <span class="key">driverClassName</span>: <span class="string"><span class="content">oracle.jdbc.driver.OracleDriver</span></span>
                <span class="key">username</span>: <span class="string"><span class="content">lookup</span></span>
                <span class="key">password</span>: <span class="string"><span class="content">secret</span></span>
                <span class="key">url</span>: <span class="string"><span class="content">jdbc:oracle:thin:@localhost:1521:lookup</span></span>
                <span class="key">dbCreate</span>: <span class="string"><span class="content">update</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用相同或不同的数据库，只要 Hibernate 支持即可。</p>
</div>
<div class="paragraph">
<p>如果您需要在 Grails 工件中注入 <code>lookup</code> 数据源，则可以这样进行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">DataSource</span> dataSource_lookup</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在定义多个数据源时，<strong>必须</strong> 有一个被命名为 "dataSource"。这是必需的，因为 Grails 通过确定哪个数据源被命名为 "dataSource" 来确定哪个数据源是默认的。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_配置_domain_类">配置 Domain 类</h4>
<div class="paragraph">
<p>如果域类没有 <code>DataSource</code> 配置，则默认为标准的 <code>'dataSource'</code> 。在 <code>mapping</code> 块中设置 <code>datasource</code> 属性，以配置非默认的 <code>DataSource</code> 。例如，如果您想使用 <code>ZipCode</code> 域来使用 <code>'lookup'</code> <code>DataSource</code> ，请按以下方式进行配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      datasource <span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>域类也可以使用两个或多个数据源。将 <code>datasources</code> 属性与名称列表一起使用可以配置多个名称，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      datasources([<span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">auditing</span><span class="delimiter">'</span></span>])
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果域类使用默认的 <code>DataSource</code> 和一个或多个其他类，请使用特殊名称 <code>DEFAULT</code> 来指示默认的 <code>DataSource</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      datasources([<span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">DEFAULT</span><span class="delimiter">'</span></span>])
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果域类使用所有已配置的数据源，请使用特殊值 <code>'ALL'</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      datasource <span class="string"><span class="delimiter">'</span><span class="content">ALL</span><span class="delimiter">'</span></span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_命名空间和_gorm_方法">命名空间和 GORM 方法</h4>
<div class="paragraph">
<p>如果域类使用多个 <code>DataSource</code> ，则可以使用每个 <code>DataSource</code> 名称隐含的命名空间对特定的 <code>DataSource</code> 进行GORM调用。例如，考虑使用两个数据源的此类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ZipCode</span> {

   <span class="predefined-type">String</span> code

   <span class="directive">static</span> mapping = {
      datasources([<span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">auditing</span><span class="delimiter">'</span></span>])
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当不使用显式命名空间时，指定的第一个 <code>DataSource</code> 是默认值，因此在这种情况下，我们默认为 <code>'lookup'</code> 。但是您可以使用 <code>DataSource</code> 名称在 'auditing' <code>DataSource</code> 上调用 GORM 方法，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> zipCode = ZipCode.auditing.get(<span class="integer">42</span>)
...
zipCode.auditing.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p>如您所见，在静态情况和实例情况下，都将 <code>DataSource</code> 添加到方法调用中。</p>
</div>
</div>
<div class="sect3">
<h4 id="_hibernate_映射_domain_类">Hibernate 映射 Domain 类</h4>
<div class="paragraph">
<p>您还可以将带注释的 Java 类划分为单独的数据源。使用默认数据源的类在 <code>grails-app/conf/hibernate.cfg.xml</code> 中注册。要指定带注释的类使用非默认数据源，请为该数据源创建一个 <code>hibernate.cfg.xml</code> 文件，文件名以该数据源名称为前缀。</p>
</div>
<div class="paragraph">
<p>例如，如果 <code>Book</code> 类位于默认数据源中，则可以在 <code>grails-app/conf/hibernate.cfg.xml</code> 中进行注册：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span>
<span class="doctype">&lt;!DOCTYPE hibernate-configuration PUBLIC
          '-//Hibernate/Hibernate Configuration DTD 3.0//EN'
          'http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd'&gt;</span>
<span class="tag">&lt;hibernate-configuration&gt;</span>
   <span class="tag">&lt;session-factory&gt;</span>
      <span class="tag">&lt;mapping</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">org.example.Book</span><span class="delimiter">'</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/session-factory&gt;</span>
<span class="tag">&lt;/hibernate-configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果 <code>Library</code> 类位于 "ds2" 数据源中，则可以在 <code>grails-app/conf/ds2_hibernate.cfg.xml</code> 中进行注册：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version='1.0' encoding='UTF-8'?&gt;</span>
<span class="doctype">&lt;!DOCTYPE hibernate-configuration PUBLIC
          '-//Hibernate/Hibernate Configuration DTD 3.0//EN'
          'http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd'&gt;</span>
<span class="tag">&lt;hibernate-configuration&gt;</span>
   <span class="tag">&lt;session-factory&gt;</span>
      <span class="tag">&lt;mapping</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">org.example.Library</span><span class="delimiter">'</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;/session-factory&gt;</span>
<span class="tag">&lt;/hibernate-configuration&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>对于使用 hbm.xml 文件映射的类，该过程相同-只需在相应的 hibernate.cfg.xml 文件中列出它们即可。</p>
</div>
</div>
<div class="sect3">
<h4 id="_services">Services</h4>
<div class="paragraph">
<p>与 Domain 类一样，默认情况下，Services 使用默认的 <code>DataSource</code> 和 <code>PlatformTransactionManager</code> 。要将服务配置为使用其他 <code>DataSource</code> ，请使用静态 <code>datasource</code> 属性，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DataService</span> {

   <span class="directive">static</span> datasource = <span class="string"><span class="delimiter">'</span><span class="content">lookup</span><span class="delimiter">'</span></span>

   <span class="type">void</span> someMethod(...) {
      ...
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>事务性服务只能使用单个 <code>DataSource</code> ，因此请确保仅对 <code>DataSource</code> 与 "Service" 相同的域类进行更改。</p>
</div>
<div class="paragraph">
<p>请注意，服务中指定的数据源与用于域类的数据源无关。这取决于它们在域类本身中声明的数据源。用于声明要使用的事务管理器。</p>
</div>
<div class="paragraph">
<p>如果您在 <code>dataSource1</code> 中有一个 <code>Foo</code> 域类，而在 <code>dataSource2</code> 中有一个 <code>Bar</code> 域类，如果 <code>WahooService</code> 使用 <code>dataSource1</code> ，这是一种保存新 <code>Foo</code> 和新 <code>Bar</code> 的服务方法。由于它们共享相同的数据源，因此只会对 <code>Foo</code> 进行交易。交易不会影响 <code>Bar</code> 实例。如果您希望两者都是事务性的，则需要使用两个服务和XA数据源进行两阶段提交，例如使用 Atomikos 插件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_跨多个数据源的事务">跨多个数据源的事务</h4>
<div class="paragraph">
<p>默认情况下，Grails 不会尝试处理跨越多个数据源的事务。</p>
</div>
<div class="paragraph">
<p>您可以启用 Grails 使用 "尽力而为1PC模式（Best Effort 1PC）" 处理跨多个数据源的事务。为此，您必须在 <code>application.yml</code> 中将 <code>grails.transaction.chainedTransactionManagerPostProcessor.enabled</code> 设置设置为 <code>true</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
  <span class="key">transaction</span>:
    <span class="key">chainedTransactionManagerPostProcessor</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="https://www.javaworld.com/article/2077963/open-source-tools/distributed-transactions-in-spring-with-and-without-xa.html">尽力而为1PC模式</a> 相当普遍，但可能会失败在某些情况下，开发人员必须了解。</p>
</div>
<div class="paragraph">
<p>这是一种非 XA 模式，涉及多个资源的同步单阶段提交。因为没有使用 <a href="#ref-orgwiki-twophasecommit-2PC">2PC</a>，所以它永远不能像 <a href="#ref-orgwiki-x-open-xa-XA">XA</a> 事务一样安全，但是通常是好的如果参与者知道这些折衷，就足够了。</p>
</div>
<div class="paragraph">
<p>基本思想是在事务中尽可能延迟所有资源的提交，以便唯一可能出错的是基础结构故障（而不是业务处理错误）。依靠 BE1PC 的系统认为，基础结构故障非常罕见，以至于他们可以承担风险以换取更高的吞吐量。如果业务处理服务也被设计为幂等的，那么实践中几乎不会出错。</p>
</div>
<div class="paragraph">
<p>BE1PC 实现已在 Grails 2.3.6 中添加 。在此更改之前，其他数据源未参与 Grails 中启动的事务。其他数据源中的事务基本上处于自动提交模式。在某些情况下，这可能是所需的行为。原因可能是性能：在每个新事务开始时，BE1PC 事务管理器都会为每个数据源创建一个新事务。通过在附加数据源的相应配置块中设置 <code>transactional = false</code> ，可以将附加数据源留在 BE1PC 事务管理器之外。<code>readOnly = true</code> 的数据源也将从链式事务管理器中删除（自2.3.7开始）。</p>
</div>
<div class="paragraph">
<p>默认情况下，BE1PC 实现会将所有实现 Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api//org/springframework/transaction/PlatformTransactionManager.html">PlatformTransactionManager</a> 接口的 bean 添加到链接的 BE1PC 事务管理器中。例如，可能会将 Grails 应用程序上下文中的一个可能的 <a href="https://docs.spring.io/spring/docs/current/javadoc-api//org/springframework/jms/connection/JmsTransactionManager.html">JMSTransactionManager</a> bean 添加到 Grails BE1PC 事务管理器的事务管理器链中。</p>
</div>
<div class="paragraph">
<p>您可以使用以下配置选项从BE1PC实现中排除事务管理器bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
  <span class="key">transaction</span>:
    <span class="key">chainedTransactionManagerPostProcessor</span>:
      <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
      <span class="key">blacklistPattern</span>: <span class="string"><span class="content">'.*'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>排除匹配是在事务管理器 bean 的名称上完成的。带有 <code>transactional = false</code> 或 <code>readOnly = true</code> 的数据源的事务管理器将被跳过，在这种情况下不需要使用此配置选项。</p>
</div>
</div>
<div class="sect3">
<h4 id="_xa和两阶段提交">XA和两阶段提交</h4>
<div class="paragraph">
<p>当"尽力而为"1PC模式不适合跨多个事务资源（不仅是数据源）处理事务时，可以使用多种选项将 XA/2PC 支持添加到 Grails应用程序。</p>
</div>
<div class="paragraph">
<p><a href="{springdocs}/transaction.html#transaction-application-server-integration">Spring交易文档</a> 包含有关集成不同应用程序服务器的 JTA/XA 交易管理器的信息。在这种情况下，您可以在 <code>resources.groovy</code> 或 <code>resources.xml</code> 文件中手动配置名为 <code>transactionManager</code> 的 bean。</p>
</div>
</div>

<a name="3.5 &#29256;&#26412;"><!-- Legacy link --></a>
<h2 id="versioning">4.5 版本控制</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/versioning.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_运行时检测版本">运行时检测版本</h4>
<div class="paragraph">
<p>您可以使用 <a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsApplication.html">GrailsApplication</a> 类使用 Grails 对应用程序元数据的支持来检测应用程序版本。例如，在 <a href="theWebLayer.html＃controllers">controllers</a> 中，有一个隐式链接 <a href="../ref/Controllers/grailsApplication.html">grailsApplication</a> 变量可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> version = grailsApplication.metadata.getApplicationVersion()</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以获取运行的 Grails 版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> grailsVersion = grailsApplication.metadata.getGrailsVersion()</code></pre>
</div>
</div>
<div class="paragraph">
<p>或通过 <code>GrailsUtil</code> 类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.util.GrailsUtil</span>
...
def grailsVersion = GrailsUtil.grailsVersion</code></pre>
</div>
</div>
</div>

<a name="3.7 &#20381;&#36182;&#35299;&#26512;"><!-- Legacy link --></a>
<h2 id="dependencyResolution">4.6 依赖项解析</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/conf/dependencyResolution.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>依赖关系解析是由 <a href="http://gradle.org">Gradle build tool</a> 处理的，所有依赖关系都在 <code>build.gradle</code> 文件中定义。 有关更多信息，请参考 <a href="commandLine.html＃gradleBuild">Gradle 用户指南</a> 。</p>
</div>

<a name="4. &#21629;&#20196;&#34892;"><!-- Legacy link --></a>
<h1 id="commandLine">5 命令行</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 3.0的命令行系统与Grails的早期版本有很大不同，并且具有用于调用Gradle进行构建相关任务以及执行代码生成的API。</p>
</div>
<div class="paragraph">
<p>当您输入时:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails &lt;&lt;command name&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails根据当前应用程序的配置文件搜索 <a href="http://bintray.com/grails/profiles">配置文件存储库</a>。
如果概要文件是针对Web应用程序的，则从Web概要文件及其继承的基本概要文件中读取命令。</p>
</div>
<div class="paragraph">
<p>由于命令行为是特定于配置文件的，因此Web配置文件可以为 <code>run-app</code> 命令提供不同的行为，然后说一个用于运行批处理应用程序的配置文件。</p>
</div>
<div class="paragraph">
<p>当您键入以下命令时：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails run-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>它将首先搜索应用程序，然后在配置文件中搜索命令：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>PROJECT_HOME/src/main/scripts/run-app.groovy</code></p>
</li>
<li>
<p><code><a href="#profile">[profile]</a>/commands/run-app.groovy</code></p>
</li>
<li>
<p><code><a href="#profile">[profile]</a>/commands/run-app.yml</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要获取所有命令的列表以及有关可用命令的一些帮助，请输入：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails help</code></pre>
</div>
</div>
<div class="paragraph">
<p>它输出使用说明和Grails知道的命令列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails &lt;&lt;environment&gt;&gt;* &lt;&lt;target&gt;&gt; &lt;&lt;arguments&gt;&gt;*'

| 例如:
$ grails dev run-app
$ grails create-app books

| Available Commands (type grails help 'command-name' for more info):
| Command Name                          Command Description
----------------------------------------------------------------------------------------------------
clean                                   Cleans a Grails application's compiled sources
compile                                 Compiles a Grails application
...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
有关单个命令的更多信息，请参考参考指南的“快速参考”菜单中的“命令行参考”。
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_争论">争论</h3>
<div class="paragraph">
<p><code>grails</code> 命令是对 <code>gradle</code> 调用的前提，因此可能会有意想不到的副作用。
例如，当执行 <code>grails -Dapp.foo = bar run-app</code> 时, <code>app.foo</code> 系统属性将对您的应用程序不可用。
这是因为在 <code>build.gradle</code> 中的 <code>bootRun</code> 配置了系统属性。
为了使这项工作有效，您可以将所有 <code>System.properties</code> 附加到 <code>build.gradle</code> 中的 <code>bootRun</code> 中,如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bootRun{
    systemProperties <span class="predefined-type">System</span>.properties <span class="comment">// Please note not to use '=', because this will override all configured systemProperties. This will append them.</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者,如果您只想传递有限的集合,则可以使用任意前缀为系统属性添加前缀,并配置 <code>bootRun</code> ,例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bootRun{
    bootRun {
        systemProperties <span class="predefined-type">System</span>.properties.inject([:]){acc,item-&gt; item.key.startsWith(<span class="string"><span class="delimiter">'</span><span class="content">boot.</span><span class="delimiter">'</span></span>)?acc &lt;&lt; [(item.key.substring(<span class="string"><span class="delimiter">'</span><span class="content">boot.</span><span class="delimiter">'</span></span>.length())):item.value]:acc }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，仅传递以 <code>boot.</code> 开头的系统属性。</p>
</div>
<div class="paragraph">
<p>应用程序和JVM参数也应该在 <code>bootRun</code> 中指定。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bootRun{
    bootRun {
        jvmArgs(<span class="string"><span class="delimiter">'</span><span class="content">-Dspring.output.ansi.enabled=always</span><span class="delimiter">'</span></span>)
        args(<span class="string"><span class="delimiter">'</span><span class="content">--app.foo=bar</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">--app.bar=foo</span><span class="delimiter">'</span></span>) <span class="comment">// Override the `app.foo` and `app.bar` config options (`grailsApplication.config`)</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_非互动模式">非互动模式</h3>
<div class="paragraph">
<p>当您手动运行脚本并提示您输入信息时，您可以回答问题并继续运行脚本。
但是，当您将脚本作为自动化过程的一部分（例如，持续集成构建服务器）运行时，则无法"answer"问题。
因此，您可以将 <code>\--non-interactive</code> 开关传递给script命令，以告诉Grails对任何问题（例如是否安装缺少的插件）接受默认答案。</p>
</div>
<div class="paragraph">
<p>例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails war --non-interactive</code></pre>
</div>
</div>
</div>


<h2 id="interactiveMode">5.1 交互模式</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/interactiveMode.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>交互模式是 Grails 命令行的一项功能，该功能可使 JVM 保持运行并允许更快地执行命令。要激活交互模式，请在命令行中键入 <code>grails</code> ，然后使用 TAB 补全获取命令列表：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/interactive-output.png" alt="interactive output">
</div>
</div>
<div class="paragraph">
<p>如果您需要在交互模式下打开文件，则可以使用 <code>open</code> 命令，它将制表完整的文件路径：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/interactive-open-cmd.png" alt="interactive open cmd">
</div>
</div>
<div class="paragraph">
<p>更帅气的是，<code>open</code> 命令了解逻辑别名 <code>test-report</code> 和 <code>dep-report</code>，这将分别打开最新的测试报告和依赖项报告。换句话说，要在浏览器中打开测试报告，只需执行 <code>open test-report</code>。 您甚至可以一次打开多个文件：<code>open test-report test/unit/MyTests.groovy</code> 将在浏览器中打开HTML测试报告，并在文本编辑器中打开 <code>MyTests.groovy</code> 源文件。</p>
</div>
<div class="paragraph">
<p>在 <code>create- *</code> 命令之后，TAB补全也适用于类名：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/interactive-complete-class.png" alt="interactive complete class">
</div>
</div>
<div class="paragraph">
<p>如果您需要在交互模式下运行时运行外部进程，可以通过使用！来启动命令：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/interactive-run-external.png" alt="interactive run external">
</div>
</div>
<div class="paragraph">
<p>注意用!（感叹号）命令，您将获得文件路径自动完成功能——非常适合在文件系统上运行的外部命令，例如 'ls' ，'cat'，'git' 等。</p>
</div>
<div class="paragraph">
<p>要退出交互模式，请输入 <code>exit</code> 命令。请注意，如果 Grails 应用程序通常是通过 run-app 运行的，则它将在交互式模式控制台退出时终止，因为 JVM 将被终止。如果应用程序以分叉模式（forked mode）运行，则这是一个例外，这意味着该应用程序在其他 JVM中 运行。在这种情况下，交互式模式控制台终止后，应用程序将保持运行状态。如果要退出交互模式并停止以分叉模式运行的应用程序，请使用 <code>quit</code> 命令。退出命令将停止正在运行的应用程序，然后关闭交互模式。</p>
</div>


<h2 id="creatingCustomScripts">5.2 创建自定义脚本</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/creatingCustomScripts.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>您可以通过从项目根目录运行 <a href="../ref/Command%20Line/create-script.html">create-script</a> 命令来创建自己的 Command 脚本。 例如，以下命令将创建一个名为 <code>src/main/scripts/hello-world.groovy</code> 的脚本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-script hello-world</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
通常，应使用 Grails 脚本来编写基于 Gradle 的构建系统和代码生成的脚本。 脚本无法加载应用程序类，而实际上不应加载脚本，因为需要Gradle构造应用程序类路径。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>例如下面输出 "Hello World" 的示例脚本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">description <span class="string"><span class="delimiter">&quot;</span><span class="content">Example description</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">grails hello-world</span><span class="delimiter">&quot;</span></span>

println <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>description</code> 方法用于定义 <code>grails help</code> 看到的输出并帮助脚本用户。 以下是提供来自 <code>generate-all</code> 命令的描述的更完整示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">description( <span class="string"><span class="delimiter">&quot;</span><span class="content">Generates a controller that performs CRUD operations and the associated views</span><span class="delimiter">&quot;</span></span> ) {
  usage <span class="string"><span class="delimiter">&quot;</span><span class="content">grails generate-all &lt;&lt;DOMAIN CLASS&gt;&gt;</span><span class="delimiter">&quot;</span></span>
  flag <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">force</span><span class="delimiter">'</span></span>, <span class="key">description</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Whether to overwrite existing files</span><span class="delimiter">&quot;</span></span>
  argument <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">Domain Class</span><span class="delimiter">'</span></span>, <span class="key">description</span>:<span class="string"><span class="delimiter">'</span><span class="content">The name of the domain class</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如您所见，该描述描述了用法说明、标志和参数。 这允许该命令按如下方式使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails generate-all MyClass --force</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_模板_template_生成">模板（Template）生成</h4>
<div class="paragraph">
<p>需要定义模板生成任务的插件和应用程序可以使用脚本来完成。 一个示例是 Scaffolding 插件，它定义了 <code>generate-all</code> 和 <code>generate-controllers</code> 命令。</p>
</div>
<div class="paragraph">
<p>每个 Grails 脚本都实现 <a href="http://docs.grails.org/4.0.0/api/org/grails/cli/profile/commands/templates/TemplateRenderer.html">TemplateRenderer</a> 接口，这使得将模板呈现给用户项目工作区很简单。</p>
</div>
<div class="paragraph">
<p>以下是用 Groovy 编写的 <a href="../ref/Command%20Line/create-script.html">create-script</a> 命令的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">description( <span class="string"><span class="delimiter">&quot;</span><span class="content">Creates a Grails script</span><span class="delimiter">&quot;</span></span> ) {
  usage <span class="string"><span class="delimiter">&quot;</span><span class="content">grails create-script &lt;&lt;SCRIPT NAME&gt;&gt;</span><span class="delimiter">&quot;</span></span>
  argument <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">Script Name</span><span class="delimiter">'</span></span>, <span class="key">description</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The name of the script to create</span><span class="delimiter">&quot;</span></span>
  flag <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">force</span><span class="delimiter">'</span></span>, <span class="key">description</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Whether to overwrite existing files</span><span class="delimiter">&quot;</span></span>
}

<span class="keyword">def</span> scriptName = args[<span class="integer">0</span>]
<span class="keyword">def</span> model = model(scriptName)
<span class="keyword">def</span> overwrite = flag(<span class="string"><span class="delimiter">'</span><span class="content">force</span><span class="delimiter">'</span></span>) ? <span class="predefined-constant">true</span> : <span class="predefined-constant">false</span>

render  <span class="key">template</span>: template(<span class="string"><span class="delimiter">'</span><span class="content">artifacts/Script.groovy</span><span class="delimiter">'</span></span>),
        <span class="key">destination</span>: file(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/scripts/</span><span class="inline"><span class="inline-delimiter">${</span>model.lowerCaseName<span class="inline-delimiter">}</span></span><span class="content">.groovy</span><span class="delimiter">&quot;</span></span>),
        <span class="key">model</span>: model,
        <span class="key">overwrite</span>: overwrite</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果在插件或配置文件中定义了脚本，则 <code>template(String)</code> 方法将在使用插件或配置文件提供的模板之前在应用程序中搜索模板。这使您的插件或配置文件的用户可以自定义生成的内容。</p>
</div>
<div class="paragraph">
<p>通常，提供一种允许用户从您的插件或配置文件复制模板的简便方法。这是关于角度脚手架如何复制模板的一个示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">templates(<span class="string"><span class="delimiter">&quot;</span><span class="content">angular/**/*</span><span class="delimiter">&quot;</span></span>).each { Resource r -&gt;
    <span class="predefined-type">String</span> path = r.URL.toString().replaceAll(<span class="regexp"><span class="delimiter">/</span><span class="content">^.*?META-INF</span><span class="delimiter">/</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">src/main</span><span class="delimiter">&quot;</span></span>)
    <span class="keyword">if</span> (path.endsWith(<span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>)) {
        mkdir(path)
    } <span class="keyword">else</span> {
        <span class="predefined-type">File</span> to = <span class="keyword">new</span> <span class="predefined-type">File</span>(path)
        SpringIOUtils.copy(r, to)
        println(<span class="string"><span class="delimiter">&quot;</span><span class="content">Copied </span><span class="inline"><span class="inline-delimiter">${</span>r.filename<span class="inline-delimiter">}</span></span><span class="content"> to location </span><span class="inline"><span class="inline-delimiter">${</span>to.canonicalPath<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="__模型_model">"模型（model）"</h4>
<div class="paragraph">
<p>用 <code>Class</code>/<code>String</code>/<code>File</code>/<code>Resource</code> 执行 <code>model</code> 方法将返回 <a href="http://docs.grails.org/4.0.0/api/grails/codegen/model/Model.html">Model</a> 的实例。该模型包含几个可以帮助您生成代码的属性。</p>
</div>
<div class="paragraph">
<p>例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> domain = model(com.foo.Bar)

domain.className == <span class="string"><span class="delimiter">&quot;</span><span class="content">FooBar</span><span class="delimiter">&quot;</span></span>
domain.fullName == <span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo.FooBar</span><span class="delimiter">&quot;</span></span>
domain.packageName == <span class="string"><span class="delimiter">&quot;</span><span class="content">com.foo</span><span class="delimiter">&quot;</span></span>
domain.packagePath == <span class="string"><span class="delimiter">&quot;</span><span class="content">com/foo</span><span class="delimiter">&quot;</span></span>
domain.propertyName == <span class="string"><span class="delimiter">&quot;</span><span class="content">fooBar</span><span class="delimiter">&quot;</span></span>
domain.lowerCaseName == <span class="string"><span class="delimiter">&quot;</span><span class="content">foo-bar</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此外，还可以使用 <code>asMap</code> 方法将所有属性转换为映射以传递给 <code>render</code> 方法。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用文件">使用文件</h4>
<div class="paragraph">
<p>所有脚本都可以访问 <a href="http://docs.grails.org/4.0.0/api/org/grails/cli/profile/commands/io/FileSystemInteraction.html">FileSystemInteraction</a> 类上的方法。它包含复制，删除和创建文件的有用方法。</p>
</div>
</div>


<h2 id="creatingCustomCommands">5.3 创建自定义命令</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/creatingCustomCommands.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>您可以通过从项目的根目录运行 <a href="#ref-command- create-command">create-command</a> 命令来创建自己的命令。例如，下面的命令将创建一个名为 <code>grails-app/commands/HelloWorldCommand</code> 的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-command HelloWorld</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
与脚本不同，命令会导致 Grails 环境启动，您可以在应用程序运行时完全访问上下文。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>自 Grails 3.2.0 以来，命令在检索参数、模板生成、文件访问和模型构建方面具有与脚本类似的功能。</p>
</div>
<div class="paragraph">
<p>如果您在以前的 grails 版本中创建了一个命令，那么您可以通过更改正在实现的特性来更新命令以获得这些能力。</p>
</div>
<div class="paragraph">
<p>在 Grails 3.1.x 或更低版本中创建的命令默认情况下实现 <a href="http://docs.grails.org/latest/api/grails/dev/commands/ApplicationCommand.html">ApplicationCommand</a> 特性，这需要您的命令实现以下方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">boolean</span> handle(ExecutionContext executionContext)</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 Grails 3.2.0 或更高版本中创建的命令默认情况下实现 <a href="http://docs.grails.org/latest/api/grails/dev/commands/GrailsApplicationCommand.html">GrailsApplicationCommand</a> 特性，这需要您的命令实现以下方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">boolean</span> handle()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
以这种方式定义的命令仍然可以通过名为 "executionContext" 的变量访问执行上下文。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>可以使用 <strong>grails run-command</strong> 执行自定义命令 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>grails run-command my-example</code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用 <strong>runCommand</strong> gradle任务执行命令。 请注意，gradle 任务使用驼峰命名法（camelCase）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>gradle runCommand -Pargs="my-example"</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果 grails 服务器是一个子项目（例如，在使用 <strong>angular</strong> 概要文件创建的项目中），则仍可以从父项目的 gradle 包装器中调用 subproject 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./gradlew server:runCommand -Pargs="my-example"</code></pre>
</div>
</div>

<a name="4.2 &#37325;&#22797;&#20351;&#29992; Grails &#33050;&#26412;"><!-- Legacy link --></a>
<h2 id="reusingGrailsScripts">5.4 重用 Grails 脚本</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/reusingGrailsScripts.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 原生提供了许多命令行功能，您可能会在自己的脚本中发现它们有用（有关所有命令的信息，请参阅参考指南中的命令行参考）。</p>
</div>
<div class="paragraph">
<p>您创建的任何脚本都可以通过调用方法来调用另一个Grails脚本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testApp()</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面将调用 <code>test-app</code> 命令。您还可以使用方法参数传递参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testApp(<span class="string"><span class="delimiter">'</span><span class="content">--debug-jvm</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_调用_gradle">调用 Gradle</h4>
<div class="paragraph">
<p>不用调用另一个 Grails CLI 命令，您可以使用 <code>gradle</code> 属性调用 Gradle 目录。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">gradle.compileGroovy()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_调用_ant">调用 Ant</h4>
<div class="paragraph">
<p>您还可以从脚本中调用 Ant 任务，如果您需要编写代码生成和自动化任务，则可以提供帮助：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ant.mkdir(<span class="key">dir</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
</div>


<h2 id="gradleBuild">5.5 用 Gradle 构建</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/gradleBuild.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 3.1 使用 <a href="http://gradle.org">Gradle Build System</a> 来执行与构建相关的任务，例如编译、运行测试以及生成项目的二进制发行版。建议将 Gradle 2.2 或更高版本与 Grails 3.1 一起使用。</p>
</div>
<div class="paragraph">
<p>构建由 <code>build.gradle</code> 文件定义，该文件指定项目的版本，项目的依赖项以及用于查找这些依赖项的存储库（以及其他内容）。</p>
</div>
<div class="paragraph">
<p>当您调用 grails 命令时，grails 进程会通过 <a href="http://www.gradle.org/docs/current/userguide/embedding.html">Gradle Tooling API</a> 调用 Grails 3.1（当前为2.9）附带的 Gradle 版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># Equivalent to 'gradle classes'
$ grails compile</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用 <code>gradle</code> 命令直接调用 Gradle 并使用自己的 Gradle 本地版本，但是您需要 Gradle 2.2 或更高版本才能与 Grails 3.0 一起使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gradle assemble</code></pre>
</div>
</div>


<h2 id="gradleDependencies">5.5.1 使用 Gradle 定义依赖关系</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/gradleBuild/gradleDependencies.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>项目的依赖项在 <code>dependencies</code> 块中定义。一般来说，您可以按照  <a href="http://www.gradle.org/docs/current/userguide/artifact_dependencies_tutorial.html">Gradle documentation on dependency management</a> 来了解如何配置其他依赖项。</p>
</div>
<div class="paragraph">
<p>"web" 配置文件的默认依赖项如下所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
  compile <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-starter-logging</span><span class="delimiter">'</span></span>
  compile(<span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-starter-actuator</span><span class="delimiter">'</span></span>)
  compile <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-autoconfigure</span><span class="delimiter">'</span></span>
  compile <span class="string"><span class="delimiter">'</span><span class="content">org.springframework.boot:spring-boot-starter-tomcat</span><span class="delimiter">'</span></span>
  compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails:grails-dependencies</span><span class="delimiter">'</span></span>
  compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails:grails-web-boot</span><span class="delimiter">'</span></span>

  compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:hibernate</span><span class="delimiter">'</span></span>
  compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:cache</span><span class="delimiter">'</span></span>
  compile <span class="string"><span class="delimiter">'</span><span class="content">org.hibernate:hibernate-ehcache</span><span class="delimiter">'</span></span>

  runtime <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:asset-pipeline</span><span class="delimiter">'</span></span>
  runtime <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:scaffolding</span><span class="delimiter">'</span></span>

  testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.grails:grails-plugin-testing</span><span class="delimiter">'</span></span>
  testCompile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:geb</span><span class="delimiter">'</span></span>

  <span class="comment">// Note: It is recommended to update to a more robust driver (Chrome, Firefox etc.)</span>
  testRuntime <span class="string"><span class="delimiter">'</span><span class="content">org.seleniumhq.selenium:selenium-htmlunit-driver:2.44.0</span><span class="delimiter">'</span></span>

  console <span class="string"><span class="delimiter">'</span><span class="content">org.grails:grails-console</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，版本号并没有出现在大多数依赖项中。
这要感谢依赖项管理插件，它配置了Maven BOM，定义了某些常用依赖项和插件的默认依赖项版本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencyManagement {
    imports {
        mavenBom <span class="string"><span class="delimiter">'</span><span class="content">org.grails:grails-bom:</span><span class="delimiter">'</span></span> + grailsVersion
    }
    applyMavenExclusions <span class="predefined-constant">false</span>
}</code></pre>
</div>
</div>


<h2 id="gradleTasks">5.5.2 使用 Gradle 任务</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/gradleBuild/gradleTasks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如前所述，<code>grails</code> 命令使用内置的 Gradle 版本和以前版本的非结构化映射中存在的某些非终结符命令。下表显示了哪个 Grails 命令调用哪个 Gradle 任务：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Grails 命令</strong></th>
<th class="tableblock halign-left valign-top"><strong>Gradle 任务</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">clean</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">compile</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">classes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assemble</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">run-app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bootRun</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test-app</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">test</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">test-app --integration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">integrationTest</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">war</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">assemble</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果您愿意，可以使用与它们等效的 Gradle 任务调用这些 Grails 命令中的任何一个：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gradle test</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是请注意，您将需要使用与 Grails 3.1（2.2或更高版本）兼容的 Gradle 版本。 如果您希望使用 Grails 使用的 Gradle 版本来调用 Gradle 任务，可以使用 <code>grails</code> 命令来执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails gradle compileGroovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，建议您通过交互方式执行此操作，因为它可以大大加快执行速度，并为可用的 Gradle 任务提供 TAB 完成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails
| Enter a command name to run. Use TAB for completion:
 grails&gt; gradle compileGroovy
 ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>要找出什么 Gradle 任务是可用的，而不使用交互式模式标签完成，你可以使用 Gradle <code>tasks</code> 任务:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">gradle tasks</code></pre>
</div>
</div>


<h2 id="gradlePlugins">5.5.3 Gradle 的 Grails 插件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/commandLine/gradleBuild/gradlePlugins.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>当你使用 <a href="../ref/Command%20Line/create-app.html">create-app</a> 命令创建一个新项目时，会创建一个默认的 <code>build.gradle</code> 。 默认的 <code>build.gradle</code> 配置了一组 Gradle 插件，允许 Gradle 构建 Grails 项目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">war</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-web</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-gsp</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">asset-pipeline</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认插件如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>war</code> -  <a href="http://www.gradle.org/docs/current/userguide/war_plugin.html">WAR 插件</a> 改变了打包方式，这让 Gradle 可以从您的应用程序中创建 WAR 文件。如果您只想为独立部署创建一个可运行的 JAR 文件，您可以注释掉这个插件。</p>
</li>
<li>
<p><code>asset-pipeline</code> - <a href="https://grails.org/plugins.html#plugin/asset-pipeline">asset pipeline</a> 插件允许编译静态资源(JavaScript、CSS等)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>许多插件是由 Gradle 或第三方插件提供的。Grails 提供的 Gradle 插件如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>org.grails.grails-core</code> - 用于 Gradle 的主要的 Grails 插件，包含在所有其他插件中，设计用于所有配置文件。</p>
</li>
<li>
<p><code>org.grails.grails-gsp</code> - Grails GSP 插件为生产部署添加了 GSP 文件的预编译。</p>
</li>
<li>
<p><code>org.grails.grails-doc</code> - 用于使用 Grails 2.0 文档引擎的 Gradle 插件。</p>
</li>
<li>
<p><code>org.grails.grails-plugin</code> - 用于构建 Grails 插件的 Gradle 插件。</p>
</li>
<li>
<p><code>org.grails.grails-plugin-publish</code> - 用于将 Grails 插件发布到中央存储库的插件。</p>
</li>
<li>
<p><code>org.grails.grails-profile</code> - 创建 Grails 时使用的插件 <a href="#profiles">Profiles</a> 。</p>
</li>
<li>
<p><code>org.grails.grails-profile-publish</code> - 一个将 Grails 配置文件发布到中央存储库的插件。</p>
</li>
<li>
<p><code>org.grails.grails-web</code> - Grails Web gradle 插件配置 gradle 来理解 Grails 的约定和目录结构。</p>
</li>
</ul>
</div>


<h1 id="profiles">6 应用程序配置文件</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/profiles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>当你使用 <a href="../ref/Command%20Line/create-app.html">create-app</a>命令创建Grails应用程序时，将使用"web"配置文件:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails create-app myapp</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用profile参数指定其他配置文件:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails create-app myapp --profile=rest-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>概要文件封装了旨在用于给定概要文件的项目命令，模板和插件。概要文件的来源可以在 <a href="https://github.com/grails-profiles">Github上找到</a>，而概要文件本身以JAR文件的形式发布到Grails中央存储库。
要找出可用的配置文件，请使用 <a href="../ref/Command%20Line/list-profiles.html">list-profiles</a>命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails list-profiles</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关特定配置文件的更多信息，请使用 <a href="../ref/Command%20Line/profile-info.html">profile-info</a>命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails profile-info rest-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意: 当您在grails项目中调用Grails CLI时，诸如`profile-info`或`list-profiles`之类的命令不可用。</p>
</div>
<div class="sect3">
<h4 id="_配置文件存储库">配置文件存储库</h4>
<div class="paragraph">
<p>默认情况下，Grails将从 <a href="https://repo.grails.org/grails/core/org/grails/profiles/">Grails中央存储库</a> 解析配置文件。 但是，可以通过在 <code>USER_HOME/.grails/settings.groovy</code> 文件中指定存储库来覆盖要搜索的存储库。
如果希望除Grails中央存储库外还使用自定义存储库解析配置文件，则还必须在文件中指定Grails中央存储库：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
  profiles {
    repositories {
      myRepo {
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://foo.com/repo</span><span class="delimiter">&quot;</span></span>
        snapshotsEnabled = <span class="predefined-constant">true</span>
      }
      grailsCentral {
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.grails.org/grails/core</span><span class="delimiter">&quot;</span></span>
        snapshotsEnabled = <span class="predefined-constant">true</span>
      }
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：Grails使用Aether来解析配置文件，因为在执行 <code>create-app</code> 命令时Gradle实例尚不可用。 这意味着您还可以根据需要在 <code>USER_HOME /.m2 / settings.xml</code> 文件中定义存储库和更高级的配置（代理，身份验证等）。
也可以直接在 <code>USER_HOME /.grails / settings.groovy</code> 文件中存储配置文件存储库的简单凭证。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
  profiles {
    repositories {
      myRepo {
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://foo.com/repo</span><span class="delimiter">&quot;</span></span>
        snapshotsEnabled = <span class="predefined-constant">true</span>
        username = <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>
        password = <span class="string"><span class="delimiter">&quot;</span><span class="content">pass</span><span class="delimiter">&quot;</span></span>
      }
      ...
    }
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置文件默认值">配置文件默认值</h4>
<div class="paragraph">
<p>要创建使用定制概要文件的应用程序，必须指定完整的工件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app myapp --profile=com.mycompany.grails.profiles:myprofile:1.0.0</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了简化此过程，可以在 <code>USER_HOME/.grails / settings.groovy</code> 文件中为给定的配置文件定义默认值。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
  profiles {
    myprofile {
      groupId = <span class="string"><span class="delimiter">&quot;</span><span class="content">com.mycompany.grails.profiles</span><span class="delimiter">&quot;</span></span>
      version = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>
    }
    repositories {
      ...
    }
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用指定的默认值，使用该概要文件创建应用程序的命令将变为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app myapp --profile=myprofile</code></pre>
</div>
</div>
</div>


<h2 id="creatingProfiles">6.1 创建配置文件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/profiles/creatingProfiles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>创建新配置文件背后的想法是，您可以设置针对特定技术或组织的默认命令和插件集。</p>
</div>
<div class="paragraph">
<p>要创建新的配置文件，您可以使用链接：<a href="../ref/Command%20Line/create-profile.html">创建个人资料</a>命令，该命令将创建一个扩展基础配置文件的新的空配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-profile mycompany</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的命令将在执行该命令的 "mycompany" 目录中创建一个新的配置文件。如果在目录中启动交互模式，将获得一组用于创建配置文件的命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ cd mycompany
$ grails
| Enter a command name to run. Use TAB for completion:
grails&gt;

create-command      create-creator-command      create-feature      create-generator-command    create-gradle-command   create-template</code></pre>
</div>
</div>
<div class="paragraph">
<p>命令如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>create-command</code>- 创建一个新命令，使用配置文件时可从Grails CLI使用</p>
</li>
<li>
<p><code>create-creator-command</code>- 创建可用于 CLI 的命令，以渲染模板（示例：create-controller）</p>
</li>
<li>
<p><code>create-generator-command</code>- 创建可用于 CLI 的命令，该命令基于域类呈现模板（示例：generate-controller）</p>
</li>
<li>
<p><code>create-feature</code>- 创建可与此配置文件一起使用的功能</p>
</li>
<li>
<p><code>create-gradle-command</code>- 创建一个可以调用 gradle 的 CLI 命令</p>
</li>
<li>
<p><code>create-template</code>- 创建可以由命令呈现的模板</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要为您的配置文件自定义依赖性，您可以在 <code>profile.yml</code> 中指定其他依赖性。</p>
</div>
<div class="paragraph">
<p>下面是一个示例 <code>profile.yml</code> 文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">features</span>:
    <span class="key">defaults</span>:
        - <span class="string"><span class="content">hibernate</span></span>
        - <span class="string"><span class="content">asset-pipeline</span></span>
<span class="key">build</span>:
    <span class="key">plugins</span>:
        - <span class="string"><span class="content">org.grails.grails-web</span></span>
    <span class="key">excludes</span>:
        - <span class="string"><span class="content">org.grails.grails-core</span></span>
<span class="key">dependencies</span>:
    <span class="key">compile</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">org.mycompany:myplugin:1.0.1</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>完成上述配置后，您可以使用 <code>gradle install</code> 将配置文件发布到本地存储库中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gradle install</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，您的个人资料可通过 <code>create-app</code> 命令使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app myapp --profile mycompany</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用上述命令，将使用 "mycompany" 配置文件创建该应用程序，该配置文件包括对 "myplugin" 插件的附加依赖关系，还包括"休眠"和"资产管道"功能（稍后将详细介绍功能）。</p>
</div>
<div class="paragraph">
<p>请注意，如果您自定义配置文件的依赖性坐标（组，版本等），则可能需要使用完全限定的坐标来创建应用程序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app myapp --profile com.mycompany:mycompany:1.0.1</code></pre>
</div>
</div>


<h2 id="profileInheritance">6.2 继承配置文件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/profiles/profileInheritance.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>一个配置文件可以扩展一个或多个不同的父配置文件。要定义配置文件继承，您可以修改配置文件的 <code>build.gradle</code> 并定义配置文件依赖性。例如，通常您想扩展 <code>base</code> 配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtime project(<span class="string"><span class="delimiter">'</span><span class="content">:base</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过从父配置文件继承，您可以获得以下好处：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>执行<a href="../ref/Command%20Line/create-app.html">创建应用</a>命令时，将首先复制父配置文件的框架</p>
</li>
<li>
<p>依赖关系和build.gradle从父级合并</p>
</li>
<li>
<p><code>application.yml</code> 文件是从父目录合并的</p>
</li>
<li>
<p>父配置文件的CLI命令被继承</p>
</li>
<li>
<p>父配置文件中的特征被继承</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要定义继承的顺序，请确保以正确的顺序声明依赖项。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
    runtime project(<span class="string"><span class="delimiter">'</span><span class="content">:plugin</span><span class="delimiter">'</span></span>)
    runtime project(<span class="string"><span class="delimiter">'</span><span class="content">:web</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在以上代码段中，首先复制了"插件"配置文件中的框架，然后是"web"配置文件。此外，"Web"配置文件会覆盖"插件"配置文件中的命令，而如果颠倒了依存顺序，则"插件"配置文件将覆盖"Web"配置文件。</p>
</div>


<h2 id="publishingProfiles">6.3 发布配置文件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/profiles/publishingProfiles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_将配置文件发布到grails中央存储库">将配置文件发布到Grails中央存储库</h4>
<div class="paragraph">
<p>使用 <a href="../ref/Command%20Line/create-profile.html">创建个人资料</a> 命令创建的任何配置文件都已经配置了在build.gradle中定义的grails-profile-publish插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-profile-publish</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要将使用此插件的配置文件发布到Grails中央存储库，请先将源代码上传到 <a href="https://github.com">Github</a>（不接受封闭的源代码配置文件）。然后在 <a href="http://bintray.com">Bintray</a>上注册一个帐户，并在配置文件的 <code>build.gradle</code> 文件中进行如下配置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grailsPublish {
  user = <span class="string"><span class="delimiter">'</span><span class="content">YOUR USERNAME</span><span class="delimiter">'</span></span>
  key = <span class="string"><span class="delimiter">'</span><span class="content">YOUR KEY</span><span class="delimiter">'</span></span>
  githubSlug = <span class="string"><span class="delimiter">'</span><span class="content">your-repo/your-profile</span><span class="delimiter">'</span></span>
  license = <span class="string"><span class="delimiter">'</span><span class="content">Apache-2.0</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>githubSlug</code> 参数应该指向您的Github存储库的路径。例如，如果您的存储库位于 <a href="https://github.com/foo/bar" class="bare">https://github.com/foo/bar</a> ，则您的githubSlug是foo/ bar。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>有了这个，您可以运行 <code>gradle publishProfile</code> 来发布您的个人资料：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gradle publishProfile</code></pre>
</div>
</div>
<div class="paragraph">
<p>个人资料将被上传到Bintray。然后，您可以转到 <a href="https://github.com/grails-profiles">Grails个人资料存储库</a>，并通过单击Bintray界面上的 <code>包含我的软件包</code> 按钮来请求包含您的个人资料（您必须登录才能看到此信息）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_将配置文件发布到内部存储库">将配置文件发布到内部存储库</h4>
<div class="paragraph">
<p>前面提到的 <code>grails-profile-publish</code> 插件配置 <a href="https://docs.gradle.org/current/userguide/publishing_maven.html">Gradle的Maven Publish插件</a>。为了发布到内部存储库，您所需要做的就是在build.gradle中定义存储库。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">publishing {
    repositories {
        maven {
            credentials {
                username <span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>
                password <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span>
            }

            url <span class="string"><span class="delimiter">&quot;</span><span class="content">http://foo.com/repo</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>配置完成后，您可以使用 <code>gradle publish</code> 来发布插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gradle publish</code></pre>
</div>
</div>
</div>


<h2 id="profileStructure">6.4 了解配置文件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/profiles/profileStructure.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>概要文件是一个简单的目录，其中包含 <code>profile.yml</code> 文件和包含该概要文件定义的"命令"，"骨架" 和 "模板" 的目录。例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/web
    commands/
        create-controller.yml
        run-app.groovy
        ...
    features/
        asset-pipeline/
            skeleton
            feature.yml
    skeleton/
        grails-app/
            controllers/
            ...
        build.gradle
    templates/
        artifacts/
            Controller.groovy
    profile.yml</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例是&#8217;网络&#8217;配置文件的结构的摘要。 <code>profile.yml</code> 文件用于描述配置文件并控制构建的配置方式。</p>
</div>
<div class="sect3">
<h4 id="_了解profile_yml描述符">了解profile.yml描述符</h4>
<div class="paragraph">
<p><code>profile.yml</code> 可以包含以下子元素。</p>
</div>
</div>
<div class="sect3">
<h4 id="_1_仓库">1) 仓库</h4>
<div class="paragraph">
<p>包含在生成的版本中的Maven存储库列表。例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">repositories</span>:
    - <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.grails.org/grails/core</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_2_建立仓库">2) 建立仓库</h4>
<div class="paragraph">
<p>包含在生成的构建的buildscript部分中的Maven存储库列表。例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">build</span>:
    <span class="key">repositories</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">https://repo.grails.org/grails/core</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_3_配置插件">3) 配置插件</h4>
<div class="paragraph">
<p>要在生成的版本中配置的Gradle插件列表。例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">build</span>:
    <span class="key">plugins</span>:
        - <span class="string"><span class="content">eclipse</span></span>
        - <span class="string"><span class="content">idea</span></span>
        - <span class="string"><span class="content">org.grails.grails-core</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_4_build_excludes">4) build.excludes</h4>
<div class="paragraph">
<p>从父配置文件中继承的Gradle插件列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">build</span>:
    <span class="key">excludes</span>:
        - <span class="string"><span class="content">org.grails.grails-core</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_5_依赖">5) 依赖</h4>
<div class="paragraph">
<p>要配置的作用域和依赖项的映射。  <code>排除</code> 范围可用于从父配置文件中排除。例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">dependencies</span>:
    <span class="key">excludes</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:hibernate:*</span><span class="delimiter">&quot;</span></span>
    <span class="key">build</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-gradle-plugin:$grailsVersion</span><span class="delimiter">&quot;</span></span>
    <span class="key">compile</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-logging</span><span class="delimiter">&quot;</span></span>
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-autoconfigure</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_6_features_defaults">6) features.defaults</h4>
<div class="paragraph">
<p>如果未指定显式功能，则使用的默认功能列表。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">features</span>:
    <span class="key">defaults</span>:
        - <span class="string"><span class="content">hibernate</span></span>
        - <span class="string"><span class="content">asset-pipeline</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_7_skeleton_excludes">7) skeleton.excludes</h4>
<div class="paragraph">
<p>从父配置文件的骨架中排除的文件列表（支持通配符）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">skeleton</span>:
    <span class="key">excludes</span>:
        - gradlew
        - gradlew.bat
        - gradle/</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_8_skeleton_parent_target">8) skeleton.parent.target</h4>
<div class="paragraph">
<p>父配置文件的骨架应复制到的目标文件夹。这可用于创建多项目构建。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">skeleton</span>:
    <span class="key">parent</span>:
        <span class="key">target</span>: app</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_9_skeleton_binaryextensions">9) skeleton.binaryExtensions</h4>
<div class="paragraph">
<p>哪些文件扩展名应作为二进制文件从配置文件复制。从父级配置文件继承并合并。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">skeleton</span>:
    <span class="key">binaryExtensions</span>: [exe, zip]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_10_skeleton_executable">10) skeleton.executable</h4>
<div class="paragraph">
<p>在结果应用程序中应标记为可执行文件的文件模式。从父级配置文件继承并合并。用 <a href="https://ant.apache.org/manual/dirtasks.html#patterns">Ant</a>解析模式。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">skeleton</span>:
    <span class="key">executable</span>:
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">**/gradlew*</span><span class="delimiter">&quot;</span></span>
      - <span class="string"><span class="delimiter">&quot;</span><span class="content">**/grailsw*</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_11_指示">11) 指示</h4>
<div class="paragraph">
<p>创建应用程序后向用户显示的文本</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">instructions</span>: Here are some instructions</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用配置文件时会发生什么">使用配置文件时会发生什么？</h4>
<div class="paragraph">
<p>当运行 <code>create-app</code> 命令时，它将获取父概要文件的框架并将这些框架复制到新的项目结构中。</p>
</div>
<div class="paragraph">
<p>生成build.gradle文件是获得在profile.yml文件中定义的所有依赖关系信息的结果，并生成所需的依赖关系。</p>
</div>
<div class="paragraph">
<p>该命令还将合并配置文件及其父配置文件中定义的所有 <code>build.gradle</code> 文件。</p>
</div>
<div class="paragraph">
<p>考虑到配置文件和所有父配置文件， <code>grails-app / conf / application.yml</code> 文件也合并为一个YAML文件。</p>
</div>
</div>


<h2 id="profileCommands">6.5 创建配置文件命令</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/profiles/profileCommands.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>概要文件可以使用YAML或Groovy脚本定义仅适用于该概要文件的新命令。以下是在YAML中定义的链接示例：<a href="../ref/Command%20Line/create-controller.html">创建控制器</a>命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">description</span>:
    - <span class="string"><span class="content">Creates a controller</span></span>
    - <span class="string"><span class="content">usage: 'create-controller &lt;&lt;controller name&gt;&gt;'</span></span>
    - <span class="string"><span class="content">completer: org.grails.cli.interactive.completers.DomainClassCompleter</span></span>
    - <span class="string"><span class="content">argument: &quot;Controller Name&quot;</span></span>
      <span class="key">description</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The name of the controller</span><span class="delimiter">&quot;</span></span>
<span class="key">steps</span>:
 - <span class="string"><span class="content">command: render</span></span>
   <span class="key">template</span>: <span class="string"><span class="content">templates/artifacts/Controller.groovy</span></span>
   <span class="key">destination</span>: <span class="string"><span class="content">grails-app/controllers/`artifact.package.path`/`artifact.name`Controller.groovy</span></span>
 - <span class="string"><span class="content">command: render</span></span>
   <span class="key">template</span>: <span class="string"><span class="content">templates/testing/Controller.groovy</span></span>
   <span class="key">destination</span>: <span class="string"><span class="content">src/test/groovy/`artifact.package.path`/`artifact.name`ControllerSpec.groovy</span></span>
 - <span class="string"><span class="content">command: mkdir</span></span>
   <span class="key">location</span>: <span class="string"><span class="content">grails-app/views/`artifact.propertyName`</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>YAML中定义的命令必须定义一个或多个步骤。每个步骤本身就是一个命令。可用的步骤类型为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>render</code> - 将模板渲染到给定的目标（如上例所示）</p>
</li>
<li>
<p><code>mkdir</code> - 建立一个由 <code>location</code> 参数指定的目录</p>
</li>
<li>
<p><code>execute</code> - 执行由 <code>class</code> 参数指定的命令。必须是实现<a href="http://docs.grails.org/4.0.0/api/org/grails/cli/profile/Command.html">Command</a>接口的类。</p>
</li>
<li>
<p><code>gradle</code> - 执行由tasks参数指定的一个或多个Gradle任务。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，要调用Gradle任务，可以定义以下YAML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">description</span>: <span class="string"><span class="content">Creates a WAR file for deployment to a container (like Tomcat)</span></span>
<span class="key">minArguments</span>: <span class="string"><span class="content">0</span></span>
<span class="key">usage</span>: <span class="string"><span class="delimiter">|</span><span class="content">
 war</span></span>
<span class="key">steps</span>:
 - <span class="string"><span class="content">command: gradle</span></span>
   <span class="key">tasks</span>:
     - <span class="string"><span class="content">war</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您需要比声明性YAML方法提供的灵活性更多的灵活性，则可以创建Groovy脚本命令。每个Command脚本都来自<a href="http://docs.grails.org/4.0.0/api/org/grails/cli/profile/commands/script/GroovyScriptCommand.html">GroovyScriptCommmand</a>类，因此可以使用该类的所有方法。</p>
</div>
<div class="paragraph">
<p>以下是一个示例 用Groovy编写的 <a href="../ref/Command%20Line/create-script.html">创建脚本</a> 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">description( <span class="string"><span class="delimiter">&quot;</span><span class="content">Creates a Grails script</span><span class="delimiter">&quot;</span></span> ) {
  usage <span class="string"><span class="delimiter">&quot;</span><span class="content">grails create-script &lt;&lt;SCRIPT NAME&gt;&gt;</span><span class="delimiter">&quot;</span></span>
  argument <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">Script Name</span><span class="delimiter">'</span></span>, <span class="key">description</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The name of the script to create</span><span class="delimiter">&quot;</span></span>
  flag <span class="key">name</span>:<span class="string"><span class="delimiter">'</span><span class="content">force</span><span class="delimiter">'</span></span>, <span class="key">description</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Whether to overwrite existing files</span><span class="delimiter">&quot;</span></span>
}

<span class="keyword">def</span> scriptName = args[<span class="integer">0</span>]
<span class="keyword">def</span> model = model(scriptName)
<span class="keyword">def</span> overwrite = flag(<span class="string"><span class="delimiter">'</span><span class="content">force</span><span class="delimiter">'</span></span>) ? <span class="predefined-constant">true</span> : <span class="predefined-constant">false</span>

render  <span class="key">template</span>: template(<span class="string"><span class="delimiter">'</span><span class="content">artifacts/Script.groovy</span><span class="delimiter">'</span></span>),
        <span class="key">destination</span>: file(<span class="string"><span class="delimiter">&quot;</span><span class="content">src/main/scripts/</span><span class="inline"><span class="inline-delimiter">${</span>model.lowerCaseName<span class="inline-delimiter">}</span></span><span class="content">.groovy</span><span class="delimiter">&quot;</span></span>),
        <span class="key">model</span>: model,
        <span class="key">overwrite</span>: overwrite</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关创建CLI命令的更多信息，请参见用户指南的 <code>命令行</code> 部分中有关<a href="commandLine.html#creatingCustomScripts">创建自定义脚本</a> 的部分。</p>
</div>


<h2 id="profileFeatures">6.6 创建配置文件功能</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/profiles/profileFeatures.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>配置文件功能是一组可共享的模板和依赖项，它们可以跨越多个配置文件。通常，您创建一个具有多个功能和从父级继承的子级配置文件的基本配置文件，因此可以使用父级可用的功能。</p>
</div>
<div class="paragraph">
<p>要创建功能，请使用个人资料根目录中的 <code>create-feature</code> 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-feature myfeature</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将创建一个 <code>myfeature/feature.yml</code> 文件，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">description</span>: <span class="string"><span class="content">Description of the feature</span></span>
<span class="comment"># customize versions here</span>
<span class="comment"># dependencies:</span>
<span class="comment">#   compile:</span>
<span class="comment">#     - &quot;org.grails.plugins:myplugin2:1.0&quot;</span>
<span class="comment">#</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>作为更具体的例子。以下是"资产管道"功能中的 <code>feature.yml</code> 文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">description</span>: <span class="string"><span class="content">Adds Asset Pipeline to a Grails project</span></span>
<span class="key">build</span>:
    <span class="key">plugins</span>:
        - <span class="string"><span class="content">asset-pipeline</span></span>
<span class="key">dependencies</span>:
    <span class="key">build</span>:
        - <span class="string"><span class="content">'com.bertramlabs.plugins:asset-pipeline-gradle:2.5.0'</span></span>
    <span class="key">runtime</span>:
        - <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:asset-pipeline</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>功能的结构如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>FEATURE_DIR
    feature.yml
    skeleton/
        grails-app/
            conf/
                application.yml
        build.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>框架的内容被复制到应用程序树中，而 <code>application.yml</code> 和 <code>build.gradle</code> 则通过使用分别与配置文件中的对应部分合并。</p>
</div>
<div class="paragraph">
<p>使用 <code>feature.yml</code> ，您可以定义其他依赖项。这使用户可以创建具有可选功能的应用程序。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app myapp --profile myprofile --features myfeature,hibernate</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例将使用您的新功能和"休眠"功能创建一个新的应用程序。</p>
</div>

<a name="5. &#23545;&#35937;&#20851;&#31995;&#26144;&#23556; &#65288;GORM&#65289;"><!-- Legacy link --></a>
<h1 id="GORM">7 对象关系映射 （GORM）</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/GORM.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>域类是任何业务应用程序的核心。他们保持有关业务流程的状态，并希望也能实现行为。
它们通过关系联系在一起；一对一，一对多或多对多。</p>
</div>
<div class="paragraph">
<p>GORM是Grails的对象关系映射（ORM）实现。在后台，它使用Hibernate（一种非常流行且灵活的开源ORM解决方案），并且由于具有静态和动态类型的Groovy的动态特性以及Grails的约定，因此创建Grails域类所涉及的配置要少得多。</p>
</div>
<div class="paragraph">
<p>您也可以用Java编写Grails域类。有关如何在Java中编写域类，但仍使用动态持久方法的信息，请参见Hibernate Integration一节。以下是GORM运行中的预览：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> book = <span class="predefined-type">Book</span>.findByTitle(<span class="string"><span class="delimiter">&quot;</span><span class="content">Groovy in Action</span><span class="delimiter">&quot;</span></span>)

book
  .addToAuthors(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Dierk Koenig</span><span class="delimiter">&quot;</span></span>)
  .addToAuthors(<span class="key">name</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Guillaume LaForge</span><span class="delimiter">&quot;</span></span>)
  .save()</code></pre>
</div>
</div>

<a name="5.1 &#24555;&#36895;&#20837;&#38376;&#25351;&#21335;"><!-- Legacy link --></a>
<h2 id="quickStartGuide">7.1 快速入门指南</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/GORM/quickStartGuide.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>可以使用 <a href="#ref-command-line-create-domain-class">create-domain-class</a> 命令创建域类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-domain-<span class="type">class</span> <span class="class">helloworld</span>.Person</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
注意：如果没有使用 create-domain-class 脚本指定软件包，Grails 会自动使用应用程序名称作为软件包名称。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这将在 <code>grails-app/domain/helloworld/Person.groovy</code> 位置创建一个类，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> helloworld

<span class="type">class</span> <span class="class">Person</span> {
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果您在链接： <a href="conf.html#dataSource">DataSource</a> 上将 <code>dbCreate</code> 属性设置为 "update"、"create" 或 "create-drop"，则 Grails 将自动为您生成/修改数据库表。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>您可以通过添加属性来自定义类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> age
    <span class="predefined-type">Date</span> lastVisit
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>拥有域类后，尝试使用 <a href="#ref-command-line-shell">shell</a> 或 <a href="#ref-command-line-console">console</a> 通过输入以下内容进行操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails console</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将加载一个交互式 GUI，您可以在其中运行 Groovy 命令并访问 Spring ApplicationContext，GORM 等。</p>
</div>

<a name="5.1.1 &#22522;&#26412; CRUD"><!-- Legacy link --></a>
<h2 id="basicCRUD">7.1.1 基本 CRUD</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/GORM/quickStartGuide/basicCRUD.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>尝试执行一些基本的 CRUD（创建/读取/更新/删除）操作。</p>
</div>
<div class="sect2">
<h3 id="_创建_create">创建（Create）</h3>
<div class="paragraph">
<p>要创建域类，请使用 Map 构造函数设置其属性并调用 <a href="#ref-domain-classes-save">save</a> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>, <span class="key">age</span>: <span class="integer">40</span>, <span class="key">lastVisit</span>: <span class="keyword">new</span> <span class="predefined-type">Date</span>())
p.save()</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="#ref-domain-classes-save">save</a> 方法将使用基础的 Hibernate ORM 层将您的类持久保存到数据库中。</p>
</div>
</div>
<div class="sect2">
<h3 id="_读取_read">读取（Read）</h3>
<div class="paragraph">
<p>Grails 透明地为您的域类添加了一个隐式的 <code>id</code> 属性，您可以将其用于检索：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
<span class="keyword">assert</span> <span class="integer">1</span> == p.id</code></pre>
</div>
</div>
<div class="paragraph">
<p>这使用 <a href="#ref-domain-classes-get">get</a> 方法，该方法期望数据库标识符从数据库中读取 <code>Person</code> 对象。
您还可以使用 <a href="#ref-domain-classes-read">read</a> 方法以只读状态加载对象：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.read(<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，基础的 Hibernate 引擎将不执行任何脏检查，并且该对象将不会持久化。注意
如果您显式调用 <a href="#ref-domain-classes-save">save</a> 方法，则该对象将被放回读写状态。</p>
</div>
<div class="paragraph">
<p>此外，您还可以使用 <a href="#ref-domain-classes-load">load</a> 方法为实例加载代理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.load(<span class="integer">1</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>除非调用 getId() 以外的方法，否则不会导致数据库访问。然后，Hibernate 初始化代理实例，或者
如果找不到指定 ID 的记录，则引发异常。</p>
</div>
</div>
<div class="sect2">
<h3 id="_修改_update">修改（Update）</h3>
<div class="paragraph">
<p>要更新实例，请更改一些属性，然后再次调用 <a href="#ref-domain-classes-save">save</a> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span>
p.save()</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_删除_delete">删除（Delete）</h3>
<div class="paragraph">
<p>要删除实例，请使用 <a href="#ref-domain-classes-delete">delete</a> 方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)
p.delete()</code></pre>
</div>
</div>
</div>


<h2 id="furtherReading">7.2 关于 GORM 的进一步阅读</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/GORM/furtherReading.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>有关使用 GORM 的更多信息，请参见GORM项目的 <a href="http://gorm.grails.org/6.0.x/hibernate">dedicated documentation</a> 。</p>
</div>

<a name="7. &#32593;&#32476;&#23618;"><!-- Legacy link --></a>
<h1 id="theWebLayer">8 Web 层</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<a name="7.1 &#25511;&#21046;&#22120;"><!-- Legacy link --></a>
<h2 id="controllers">8.1 控制器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>控制器处理请求并创建或准备响应。 控制器可以直接生成响应或委托给视图。 要创建控制器，只需在 <code>grails-app/controllers</code> 目录（如果在软件包中，则在子目录中）中创建一个名称以 <code>Controller</code> 结尾的类。</p>
</div>
<div class="paragraph">
<p>默认的 <a href="#urlmappings">URL Mapping</a> 配置可确保将控制器名称的第一部分映射到URI，并且在控制器中定义的每个操作都将映射到控制器名称URI中的URI。</p>
</div>

<a name="7.1.1 &#20102;&#35299;&#25511;&#21046;&#22120;&#21644;&#25805;&#20316;"><!-- Legacy link --></a>
<h2 id="understandingControllersAndActions">8.1.1 了解控制器和操作</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/understandingControllersAndActions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_creating_a_controller">Creating a controller</h4>
<div class="paragraph">
<p>可以 <a href="../ref/Command％20Line/create-controller.html">create-controller</a> 或 <a href="../ref/Command％20Lin/generate-controller.html">generate-controller</a> 命令创建控制器 。 例如，尝试从Grails项目的根目录运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails create-controller book</code></pre>
</div>
</div>
<div class="paragraph">
<p>该命令将在 <code>grails-app/controllers/myapp/BookController.groovy</code> 位置创建一个控制器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myapp

<span class="type">class</span> <span class="class">BookController</span> {

    <span class="keyword">def</span> <span class="function">index</span>() { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>其中 <code>myapp</code> 将是你的应用程序的名称，如果未指定，则为默认软件包名称。
默认情况下，<code>BookController</code> 映射到/book URI（相对于你的应用程序根目录）。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>create-controller</code> 和 <code>generate-controller</code> 命令只是为了方便起见，也可以使用自己喜欢的文本编辑器或IDE轻松创建控制器。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_创建动作">创建动作</h4>
<div class="paragraph">
<p>一个控制者可以有多种公共行动方法。 每个映射到一个URI：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {

    <span class="keyword">def</span> <span class="function">list</span>() {

        <span class="comment">// do controller logic</span>
        <span class="comment">// create model</span>

        <span class="keyword">return</span> model
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于该属性被命名为 <code>list</code> ，因此该示例默认情况下映射到 <code>/book/list</code> URI</p>
</div>
</div>
<div class="sect3">
<h4 id="_默认动作">默认动作</h4>
<div class="paragraph">
<p>控制器具有默认URI的概念，该默认URI映射到控制器的根URI，例如，<code>/book</code> 代表 <code>BookController</code> ，请求默认URI时调用的操作由以下规则决定：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果只有一个action，则为默认</p>
</li>
<li>
<p>如果有一个名为 <code>index</code> 的动作，则为默认</p>
</li>
<li>
<p>或者，可以使用 <code>defaultAction</code> 属性显式设置</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> defaultAction = <span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>

<a name="7.1.2 &#25511;&#21046;&#22120;&#21644;&#20316;&#29992;&#22495;"><!-- Legacy link --></a>
<h2 id="controllersAndScopes">8.1.2 控制器和作用域</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/controllersAndScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_可用范围">可用范围</h4>
<div class="paragraph">
<p>范围是类似于哈希的对象，您可以在其中存储变量。以下作用域可用于控制器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../ref/Controllers/servletContext.html">servletContext</a> - 也称为应用程序范围，此范围使您可以在整个Web应用程序之间共享状态。servletContext是 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContext.html">ServletContext</a> 的实例</p>
</li>
<li>
<p><a href="../ref/Controllers/session.html">session</a> - 会话允许将状态与给定用户相关联，并且通常使用Cookie将会话与客户端相关联。会话对象是 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html">HttpSession</a> 的实例</p>
</li>
<li>
<p><a href="../ref/Controllers/request.html">request</a> - 请求对象仅允许存储当前请求的对象。请求对象是 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html">HttpServletRequest</a> 的实例</p>
</li>
<li>
<p><a href="../ref/Controllers/params.html">params</a> - 传入请求查询字符串或POST参数的可变映射</p>
</li>
<li>
<p><a href="../ref/Controllers/flash.html">flash</a> - 参见下文</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_访问范围">访问范围</h4>
<div class="paragraph">
<p>可以使用上面的变量名结合Groovy的数组索引运算符来访问作用域，即使在Servlet API提供的类上，例如 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html">HttpServletRequest</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">find</span>() {
        <span class="keyword">def</span> findBy = params[<span class="string"><span class="delimiter">&quot;</span><span class="content">findBy</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">def</span> appContext = request[<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">def</span> loggedUser = session[<span class="string"><span class="delimiter">&quot;</span><span class="content">logged_user</span><span class="delimiter">&quot;</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以使用取消引用运算符访问范围内的值，从而使语法更加清晰：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">find</span>() {
        <span class="keyword">def</span> findBy = params.findBy
        <span class="keyword">def</span> appContext = request.foo
        <span class="keyword">def</span> loggedUser = session.logged_user
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是Grails统一访问不同范围的方式之一。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用flash范围">使用Flash范围</h4>
<div class="paragraph">
<p>Grails支持将 <a href="../ref/Controllers/flash.html">flash</a> 作用域作为临时存储区的概念，以使该属性仅可用于此请求和下一个请求。然后清除属性。这对于直接在重定向之前设置消息很有用，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>def delete() {
    def b = Book.get(params.id)
    if (!b) {
        flash.message = "User not found for id ${params.id}"
        redirect(action:list)
    }
    ... // remaining code
}</pre>
</div>
</div>
<div class="paragraph">
<p>当请求 <code>delete</code> 动作时，<code>message</code> 值将在范围内，可用于显示信息消息。在第二次请求后，它将被从 <code>flash</code> 作用域中删除。</p>
</div>
<div class="paragraph">
<p>请注意，属性名称可以是任何您想要的名称，并且值通常是用于显示消息的字符串，但可以是任何对象类型。</p>
</div>
</div>
<div class="sect3">
<h4 id="_作用域控制器">作用域控制器</h4>
<div class="paragraph">
<p>新创建的应用程序在 <code>application.yml</code> 中将 <code>grails.controllers.defaultScope</code> 属性设置为"singleton"。您可以将此值更改为任何
下面列出的受支持范围。如果根本没有为属性分配任何值，则控制器将默认为"prototype"范围。</p>
</div>
<div class="paragraph">
<p>支持的控制器范围是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>prototype</code> （默认）-将为每个请求创建一个新的控制器（建议将其作为“闭合”属性使用）</p>
</li>
<li>
<p><code>session</code> - 为用户会话的范围创建一个控制器</p>
</li>
<li>
<p><code>singleton</code> - 控制器仅存在一个实例（建议将操作作为方法使用）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要启用其中一个作用域，请使用上面列出的有效作用域值之一向您的类添加静态 <code>scope</code> 属性，例如</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> scope = <span class="string"><span class="delimiter">&quot;</span><span class="content">singleton</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用 <code>grails.controllers.defaultScope</code> 键在 <code>application.yml</code> 中定义默认策略，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">controllers</span>:
        <span class="key">defaultScope</span>: singleton</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
明智地使用作用域控制器。例如，我们不建议在单例作用域的控制器中包含任何属性，因为它们将为_all_请求共享。
</td>
</tr>
</table>
</div>
</div>

<a name="7.1.3 &#27169;&#22411;&#21644;&#35270;&#22270;"><!-- Legacy link --></a>
<h2 id="modelsAndViews">8.1.3 模型和视图</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/modelsAndViews.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_退回模型">退回模型</h4>
<div class="paragraph">
<p>模型是视图在渲染时使用的Map。 该Map中的键对应于视图可访问的变量名。 有两种返回模型的方法。 首先，您可以显式返回Map实例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
上面的内容不会_not_反映您应该在脚手架视图中使用的内容-有关更多详细信息，请参见 <a href="scaffolding.html">scaffolding section</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>一种更高级的方法是返回Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/ModelAndView.html">ModelAndView</a> 类的实例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.web.servlet.ModelAndView</span>

<span class="keyword">def</span> <span class="function">index</span>() {
    <span class="comment">// get some books just for the index page, perhaps your favorites</span>
    <span class="keyword">def</span> favoriteBooks = ...

    <span class="comment">// forward to the list view to show them</span>
    <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string"><span class="delimiter">&quot;</span><span class="content">/book/list</span><span class="delimiter">&quot;</span></span>, [ bookList : favoriteBooks ])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要记住的一件事是某些变量名称不能在模型中使用:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>attributes</code></p>
</li>
<li>
<p><code>application</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>目前，如果您使用它们，将不会报告任何错误，但是希望在将来的Grails版本中会有所改变.</p>
</div>
</div>
<div class="sect3">
<h4 id="_选择视图">选择视图</h4>
<div class="paragraph">
<p>在前两个示例中，没有代码指定要呈现的 <a href="#gsp">view</a> . 那么Grails如何知道该选哪个呢？ 答案在于约定。 Grails将在此 <code>show</code> 操作中在 <code>grails-app/views/book/show.gsp</code> 位置查找视图:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">show</span>() {
         [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要渲染其他视图，请使用 <a href="../ref/Controllers/render.html">render</a> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    <span class="keyword">def</span> map = [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
    render(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">display</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: map)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，Grails将尝试在该位置
渲染视图 <code>grails-app/views/book/display.gsp</code>. 请注意，Grails会自动通过 <code>grails-app/views</code> 目录的 <code>book</code> 目录限定视图位置。 这很方便，但是要访问共享视图，请使用绝对路径而不是相对路径:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    <span class="keyword">def</span> map = [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
    render(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/shared/display</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: map)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，Grails将尝试在该位置渲染视图 <code>grails-app/views/shared/display.gsp</code>.</p>
</div>
<div class="paragraph">
<p>Grails还支持将JSP用作视图，因此，如果在预期的位置找不到GSP，但是在JSP所在的位置，则会使用它.</p>
</div>
</div>
<div class="sect3">
<h4 id="_为命名空间的控制器选择视图">为命名空间的控制器选择视图</h4>
<div class="paragraph">
<p>如果控制器使用 <a href="#namespacedControllers">namespace</a> 属性为其自身定义了名称空间，这将影响Grails在根目录中查找用相对路径指定的视图的根目录.  由命名空间控制器呈现的视图的默认根目录为 <code>grails-app/views/&lt;namespace name&gt;/&lt;controller name&gt;/</code>.  如果在命名空间目录中找不到该视图，则Grails将回退以在非命名空间目录中查找该视图.</p>
</div>
<div class="paragraph">
<p>参见下面的例子.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ReportingController</span> {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">business</span><span class="delimiter">'</span></span>

    <span class="keyword">def</span> <span class="function">humanResources</span>() {
        <span class="comment">// This will render grails-app/views/business/reporting/humanResources.gsp</span>
        <span class="comment">// if it exists.</span>

        <span class="comment">// If grails-app/views/business/reporting/humanResources.gsp does not</span>
        <span class="comment">// exist the fallback will be grails-app/views/reporting/humanResources.gsp.</span>

        <span class="comment">// The namespaced GSP will take precedence over the non-namespaced GSP.</span>

        [<span class="key">numberOfEmployees</span>: <span class="integer">9</span>]
    }


    <span class="keyword">def</span> <span class="function">accountsReceivable</span>() {
        <span class="comment">// This will render grails-app/views/business/reporting/numberCrunch.gsp</span>
        <span class="comment">// if it exists.</span>

        <span class="comment">// If grails-app/views/business/reporting/numberCrunch.gsp does not</span>
        <span class="comment">// exist the fallback will be grails-app/views/reporting/numberCrunch.gsp.</span>

        <span class="comment">// The namespaced GSP will take precedence over the non-namespaced GSP.</span>

        render <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">numberCrunch</span><span class="delimiter">'</span></span>, <span class="key">model</span>: [<span class="key">numberOfEmployees</span>: <span class="integer">13</span>]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_呈现回应">呈现回应</h4>
<div class="paragraph">
<p>有时，直接从控制器将文本或代码片段呈现给响应会更容易（例如，对于Ajax应用程序）。 为此，可以使用高度灵活的 <code>render</code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">render <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的代码写了文本"Hello World！"。 回应。 其他例子包括:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// write some markup</span>
render {
   <span class="keyword">for</span> (b <span class="keyword">in</span> books) {
      div(<span class="key">id</span>: b.id, b.title)
   }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// render a specific view</span>
render(<span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">show</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// render a template for each item in a collection</span>
render(<span class="key">template</span>: <span class="string"><span class="delimiter">'</span><span class="content">book_template</span><span class="delimiter">'</span></span>, <span class="key">collection</span>: <span class="predefined-type">Book</span>.list())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// render some text with encoding and content type</span>
render(<span class="key">text</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xml&gt;some xml&lt;/xml&gt;</span><span class="delimiter">&quot;</span></span>, <span class="key">contentType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>, <span class="key">encoding</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果计划使用Groovy的 <code>MarkupBuilder</code> 来生成与 <code>render</code> 方法一起使用的HTML，请小心命名HTML元素和Grails标签之间的冲突。例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.xml.MarkupBuilder</span>
...
def login() {
    <span class="keyword">def</span> writer = <span class="keyword">new</span> <span class="predefined-type">StringWriter</span>()
    <span class="keyword">def</span> builder = <span class="keyword">new</span> MarkupBuilder(writer)
    builder.html {
        head {
            title <span class="string"><span class="delimiter">'</span><span class="content">Log in</span><span class="delimiter">'</span></span>
        }
        body {
            h1 <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
            form {
            }
        }
    }

    <span class="keyword">def</span> html = writer.toString()
    render html
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>实际上，这将 <a href="#tagsAsMethodCalls">call the form tag</a> 它将返回一些文本，这些文本将被 <code>MarkupBuilder</code> 忽略）。 要正确输出 <code>&lt;form&gt;</code> 元素，请使用以下命令:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">login</span>() {
    <span class="comment">// ...</span>
    body {
        h1 <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
        builder.form {
        }
    }
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>

<a name="7.1.4 &#37325;&#23450;&#21521;&#21644;&#38142;&#25509;"><!-- Legacy link --></a>
<h2 id="redirectsAndChaining">8.1.4 重定向和链接</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/redirectsAndChaining.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_重新导向">重新导向</h4>
<div class="paragraph">
<p>可以使用 <a href="../ref/Controllers/redirect.html">redirect</a> 控制器方式:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">OverviewController</span> {

    <span class="keyword">def</span> <span class="function">login</span>() {}

    <span class="keyword">def</span> <span class="function">find</span>() {
        <span class="keyword">if</span> (!session.user)
            redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>内部 <a href="../ref/Controllers/redirect.html">redirect</a> 方法使用 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html">HttpServletResponse</a> 对象的 <code>sendRedirect</code> 方法.</p>
</div>
<div class="paragraph">
<p><code>redirect</code> 方法期望以下之一:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>动作名称（如果不是当前控制器中的重定向，则为控制器名称）:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Also redirects to the index action in the home controller</span>
redirect(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">home</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>相对于应用程序上下文路径的资源的URI:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Redirect to an explicit URI</span>
redirect(<span class="key">uri</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/login.html</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>或完整网址:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Redirect to a URL</span>
redirect(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://grails.org</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="GORM.html">domain class</a> 实例:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Redirect to the domain instance</span>
<span class="predefined-type">Book</span> book = ... <span class="comment">// obtain a domain instance</span>
redirect book</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，Grails将使用域类 <code>id</code> 来构造链接(如果存在).</p>
</div>
<div class="paragraph">
<p>可以选择使用方法的参数 <code>params</code> 从一个动作传递到下一个动作:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">myaction</span><span class="delimiter">'</span></span>, <span class="key">params</span>: [<span class="key">myparam</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myvalue</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些参数可通过链接 <a href="../ref/Controllers/params.html">params</a> 动态属性访问请求参数。 如果使用与请求参数相同的名称指定了参数，则将覆盖请求参数并使用控制器参数.</p>
</div>
<div class="paragraph">
<p>由于 <code>params</code> 对象是Map，因此您可以使用它将当前请求参数从一个操作传递到下一个操作:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">next</span><span class="delimiter">&quot;</span></span>, <span class="key">params</span>: params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，您还可以在目标URI中包含一个片段:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">redirect(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>, <span class="key">fragment</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">profile</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>它将（取决于URL映射）重定向到类似"/myapp/test/show#profile"的内容.</p>
</div>
</div>
<div class="sect3">
<h4 id="_chaining">Chaining</h4>
<div class="paragraph">
<p>动作也可以被链接。 链接允许将模型从一个动作保留到另一个动作。 例如，在此操作中调用 <code>first</code> 操作:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ExampleChainController</span> {

    <span class="keyword">def</span> <span class="function">first</span>() {
        chain(<span class="key">action</span>: second, <span class="key">model</span>: [<span class="key">one</span>: <span class="integer">1</span>])
    }

    <span class="keyword">def</span> <span class="function">second</span> () {
        chain(<span class="key">action</span>: third, <span class="key">model</span>: [<span class="key">two</span>: <span class="integer">2</span>])
    }

    <span class="keyword">def</span> <span class="function">third</span>() {
        [<span class="key">three</span>: <span class="integer">3</span>])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果在模型中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[<span class="key">one</span>: <span class="integer">1</span>, <span class="key">two</span>: <span class="integer">2</span>, <span class="key">three</span>: <span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用 <code>chainModel</code> 映射在链中的后续控制器操作中访问模型。 该动态属性仅存在于调用 <code>chain</code> 方法之后的动作中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ChainController</span> {

    <span class="keyword">def</span> <span class="function">nextInChain</span>() {
        <span class="keyword">def</span> model = chainModel.myModel
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>像 <code>redirect</code> 方法一样，您也可以将参数传递给 <code>chain</code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">chain(<span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">action1</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: [<span class="key">one</span>: <span class="integer">1</span>], <span class="key">params</span>: [<span class="key">myparam</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">param1</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
chain方法使用HTTP会话，因此仅在您的应用程序是有状态的时才应使用.
</td>
</tr>
</table>
</div>
</div>

<a name="7.1.6 &#25968;&#25454;&#32465;&#23450;"><!-- Legacy link --></a>
<h2 id="dataBinding">8.1.5 数据绑定</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/dataBinding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>数据绑定是将传入请求参数"binding"到对象或对象的整个图上的行为。 数据绑定应处理所有必要的类型转换，因为通常由表单提交提供的请求参数始终是字符串，而Groovy或Java对象的属性可能不是.</p>
</div>
<div class="sect3">
<h4 id="_基于地图的绑定">基于地图的绑定</h4>
<div class="paragraph">
<p>数据绑定器能够将Map中的值转换并分配给对象的属性。 绑定器将使用Map中的键将Map中的条目与对象的属性相关联，这些键的值与对象上的属性名称相对应。 以下代码演示了基础知识:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/Person.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">Integer</span> age
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">63</span>]

<span class="keyword">def</span> person = <span class="keyword">new</span> Person(bindingMap)

<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.lastName == <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.age == <span class="integer">63</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要更新域对象的属性，您可以将Map分配给域类的 <code>properties</code> 属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">63</span>]

<span class="keyword">def</span> person = Person.get(someId)
person.properties = bindingMap

<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.lastName == <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.age == <span class="integer">63</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>活页夹可以使用Maps of Maps填充对象的完整图.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">Integer</span> age
    Address homeAddress
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> county
    <span class="predefined-type">String</span> country
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">63</span>, <span class="key">homeAddress</span>: [<span class="key">county</span>: <span class="string"><span class="delimiter">'</span><span class="content">Surrey</span><span class="delimiter">'</span></span>, <span class="key">country</span>: <span class="string"><span class="delimiter">'</span><span class="content">England</span><span class="delimiter">'</span></span>] ]

<span class="keyword">def</span> person = <span class="keyword">new</span> Person(bindingMap)

<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.lastName == <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.age == <span class="integer">63</span>
<span class="keyword">assert</span> person.homeAddress.county == <span class="string"><span class="delimiter">'</span><span class="content">Surrey</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.homeAddress.country == <span class="string"><span class="delimiter">'</span><span class="content">England</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_绑定到收藏夹和地图">绑定到收藏夹和地图</h4>
<div class="paragraph">
<p>数据绑定器可以填充和更新Collections 和 Maps。 以下代码显示了在域类中填充对象的 <code>List</code> 的简单示例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Band</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">albums</span>: Album]
    <span class="predefined-type">List</span> albums
}

<span class="type">class</span> <span class="class">Album</span> {
    <span class="predefined-type">String</span> title
    <span class="predefined-type">Integer</span> numberOfTracks
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Genesis</span><span class="delimiter">'</span></span>,
                  <span class="string"><span class="delimiter">'</span><span class="content">albums[0]</span><span class="delimiter">'</span></span>: [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Foxtrot</span><span class="delimiter">'</span></span>, <span class="key">numberOfTracks</span>: <span class="integer">6</span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">albums[1]</span><span class="delimiter">'</span></span>: [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Nursery Cryme</span><span class="delimiter">'</span></span>, <span class="key">numberOfTracks</span>: <span class="integer">7</span>]]

<span class="keyword">def</span> band = <span class="keyword">new</span> Band(bindingMap)

<span class="keyword">assert</span> band.name == <span class="string"><span class="delimiter">'</span><span class="content">Genesis</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> band.albums.size() == <span class="integer">2</span>
<span class="keyword">assert</span> band.albums[<span class="integer">0</span>].title == <span class="string"><span class="delimiter">'</span><span class="content">Foxtrot</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> band.albums[<span class="integer">0</span>].numberOfTracks == <span class="integer">6</span>
<span class="keyword">assert</span> band.albums[<span class="integer">1</span>].title == <span class="string"><span class="delimiter">'</span><span class="content">Nursery Cryme</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> band.albums[<span class="integer">1</span>].numberOfTracks == <span class="integer">7</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果 <code>albums</code> 是数组而不是 <code>List</code>，则该代码将以相同的方式工作.</p>
</div>
<div class="paragraph">
<p>请注意，当绑定到 <code>Set</code> 时，将Map绑定到Set的结构与将 <code>Map</code> 绑定到 <code>List</code> 的结构相同，但是由于 <code>Set</code>  是无序的，因此 索引不一定与 <code>Set</code> 中元素的顺序相对应。 在上面的代码示例中，如果 <code>albums</code> 是 <code>Set</code> 而不是 <code>List</code>，则 <code>bindingMap</code> 可能看起来完全相同，但 <code>bindingMap</code>  可能是 <code>Set</code> 中的第一张专辑，也可能是第二。 当更新 <code>Set</code> 中的现有元素时，分配给 <code>Set</code> 的 <code>Map</code> 必须包含其中的id元素，这些id代表要更新 <code>Set</code> 中的元素，如以下示例所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/*
 * The value of the indexes 0 and 1 in albums[0] and albums[1] are arbitrary
 * values that can be anything as long as they are unique within the Map.
 * They do not correspond to the order of elements in albums because albums
 * is a Set.
 */</span>
<span class="keyword">def</span> bindingMap = [<span class="string"><span class="delimiter">'</span><span class="content">albums[0]</span><span class="delimiter">'</span></span>: [<span class="key">id</span>: <span class="integer">9</span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>]
                  <span class="string"><span class="delimiter">'</span><span class="content">albums[1]</span><span class="delimiter">'</span></span>: [<span class="key">id</span>: <span class="integer">4</span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Selling England By The Pound</span><span class="delimiter">'</span></span>]]

<span class="keyword">def</span> band = Band.get(someBandId)

<span class="comment">/*
 * This will find the Album in albums that has an id of 9 and will set its title
 * to 'The Lamb Lies Down On Broadway' and will find the Album in albums that has
 * an id of 4 and set its title to 'Selling England By The Pound'.  In both
 * cases if the Album cannot be found in albums then the album will be retrieved
 * from the database by id, the Album will be added to albums and will be updated
 * with the values described above.  If a Album with the specified id cannot be
 * found in the database, then a binding error will be created and associated
 * with the band object.  More on binding errors later.
 */</span>
band.properties = bindingMap</code></pre>
</div>
</div>
<div class="paragraph">
<p>当绑定到 <code>Map</code> 时，绑定 <code>Map</code> 的结构与用于绑定到 <code>List</code>  或 <code>Set</code> 的 <code>Map</code> 的结构相同，方括号内的索引对应于键 在绑定到的 <code>Map</code> 中。 看下面的代码:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Album</span> {
    <span class="predefined-type">String</span> title
    <span class="directive">static</span> hasMany = [<span class="key">players</span>: Player]
    <span class="predefined-type">Map</span> players
}

<span class="type">class</span> <span class="class">Player</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>,
                  <span class="string"><span class="delimiter">'</span><span class="content">players[guitar]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[vocals]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[keyboards]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span>]]

<span class="keyword">def</span> album = <span class="keyword">new</span> Album(bindingMap)

<span class="keyword">assert</span> album.title == <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.size() == <span class="integer">3</span>
<span class="keyword">assert</span> album.players.guitar.name == <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.vocals.name == <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.keyboards.name == <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>当更新现有的 <code>Map</code> 时，如果绑定的 <code>Map</code> 中指定的键在绑定的 <code>Map</code> 中不存在，则将创建一个新值，并使用指定的键将其添加到 <code>Map</code> 中，如 下面的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>,
                  <span class="string"><span class="delimiter">'</span><span class="content">players[guitar]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[vocals]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[keyboards]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span>]]

<span class="keyword">def</span> album = <span class="keyword">new</span> Album(bindingMap)

<span class="keyword">assert</span> album.title == <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.size() == <span class="integer">3</span>
<span class="keyword">assert</span> album.players.guitar.name == <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.vocals.name  == <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.keyboards.name  == <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span>

<span class="keyword">def</span> updatedBindingMap = [<span class="string"><span class="delimiter">'</span><span class="content">players[drums]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Phil Collins</span><span class="delimiter">'</span></span>],
                         <span class="string"><span class="delimiter">'</span><span class="content">players[keyboards]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Anthony George Banks</span><span class="delimiter">'</span></span>]]

album.properties = updatedBindingMap

<span class="keyword">assert</span> album.title == <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.size() == <span class="integer">4</span>
<span class="keyword">assert</span> album.players.guitar.name == <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.vocals.name == <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.keyboards.name == <span class="string"><span class="delimiter">'</span><span class="content">Anthony George Banks</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.drums.name == <span class="string"><span class="delimiter">'</span><span class="content">Phil Collins</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_将请求数据绑定到模型">将请求数据绑定到模型</h4>
<div class="paragraph">
<p><a href="../ref/Controllers/params.html">params</a>控制器中可用的对象具有特殊的行为，有助于将点的请求参数名称转换为数据绑定程序可以使用的嵌套Maps。 例如，如果请求包含名为 <code>person.homeAddress.country</code> 和 <code>person.homeAddress.city</code> 的请求参数，其值分别为 <code>USA</code> 和 <code>St</code> . 分别是路易斯，<code>params</code> 将包括这些条目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[<span class="key">person</span>: [<span class="key">homeAddress</span>: [<span class="key">country</span>: <span class="string"><span class="delimiter">'</span><span class="content">USA</span><span class="delimiter">'</span></span>, <span class="key">city</span>: <span class="string"><span class="delimiter">'</span><span class="content">St. Louis</span><span class="delimiter">'</span></span>]]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>有两种方法可以将请求参数绑定到域类的属性上。 第一个涉及使用域类的Map构造函数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">save</span>() {
    <span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)
    b.save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>数据绑定发生在代码 <code>new Book(params)</code> 中 . 通过传递 <a href="../ref/Controllers/params.html">params</a> 域类构造函数的对象Grails自动识别出您正在尝试从请求参数进行绑定。 因此，如果我们有一个传入请求，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/book/save?title=The%20Stand&amp;author=Stephen%20King</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，将在域类上自动设置 <code>title</code> 和 <code>author</code> 请求参数。 您可以使用<a href="../ref/Domain%20Classes/properties.html">properties</a> 属性将数据绑定到现有实例上:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">save</span>() {
    <span class="keyword">def</span> b = <span class="predefined-type">Book</span>.get(params.id)
    b.properties = params
    b.save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用隐式构造函数的效果相同.</p>
</div>
<div class="paragraph">
<p>绑定空字符串（其中没有字符，甚至没有空格的字符串）时，数据绑定器会将空字符串转换为null。 这简化了最常见的情况，其目的是将空表单字段视为具有值null，因为没有一种方法可以实际提交null作为请求参数。 当这种行为不是所希望的时，应用程序可以直接分配值.</p>
</div>
<div class="paragraph">
<p>质量属性绑定机制默认情况下将在绑定时自动修剪所有字符串。 要禁用此行为，请将 <code>grails-app/conf/application.groovy</code> 的 <code>grails.databinding.trimStrings</code> 属性设置为false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// the default value is true</span>
grails.databinding.trimStrings = <span class="predefined-constant">false</span>

<span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>质量属性绑定机制将默认在绑定时自动将所有空字符串转换为null。 要禁用此行为，请将  <code>grails-app/conf/application.groovy</code> 中的 <code>grails.databinding.convertEmptyStringsToNull</code> 属性设置为false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// the default value is true</span>
grails.databinding.convertEmptyStringsToNull = <span class="predefined-constant">false</span>

<span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>事件发生的顺序是发生字符串修整，然后发生空转换，因此，如果 <code>trimStrings</code>  为 <code>true</code> 和 <code>convertEmptyStringsToNull</code> 为 <code>true</code> ，不仅空字符串将转换为null，空字符串也将转换为空。 空字符串是任何字符串，这样 <code>trim（）</code> 方法将返回一个空字符串.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Grails中的这些形式的数据绑定非常方便，但也是不加区别的。 换句话说，它们将绑定目标对象的_all_非临时性，类型化实例属性，包括您可能不想绑定的属性。 仅仅因为UI中的表单没有提交所有属性，攻击者仍然可以通过原始HTTP请求发送恶意数据。 幸运的是，Grails还可轻松防止此类攻击-有关更多信息，请参见标题为 "Data Binding and Security concerns" 的部分.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和单端关联">数据绑定和单端关联</h4>
<div class="paragraph">
<p>如果您具有 <code>one-to-one</code> 或 <code>many-to-one</code> 关联，则也可以使用Grails的数据绑定功能来更新这些关系。 例如，如果您有一个传入请求，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/book/save?author.id=20</code></pre>
</div>
</div>
<div class="paragraph">
<p>在进行数据绑定（例如）时，Grails会自动检测request参数上的 <code>.id</code> 后缀，并在给定id的 <code>Author</code> 实例中查找:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过传递文字 <code>String</code>  "null"，可以将关联属性设置为 <code>null</code> 。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/book/save?author.id=null</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和多端关联">数据绑定和多端关联</h4>
<div class="paragraph">
<p>如果您具有一对多或多对多关联，则根据关联类型，可以使用不同的数据绑定技术.</p>
</div>
<div class="paragraph">
<p>如果您有一个基于 <code>Set</code> 的关联（<code>hasMany</code> 的默认设置），那么填充关联的最简单方法是发送一个标识符列表。 例如，考虑下面的 <code>&lt;g:select&gt;</code> 的用法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${Book.list()}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">multiple</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">optionKey</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将产生一个选择框，使您可以选择多个值。 在这种情况下，如果您提交表单，Grails将自动使用选择框中的标识符来填充 <code>books</code> 关联.</p>
</div>
<div class="paragraph">
<p>但是，如果您想更新关联对象的属性，则此技术将不起作用。 而是使用下标运算符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Stand</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Shining</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，对于基于 <code>Set</code> 的关联，至关重要的是，以与计划进行更新时相同的顺序来呈现标记。这是因为 <code>Set</code> 没有顺序的概念，因此尽管我们指的是 对于 <code>books [0]</code> 和 <code>books [1]</code>，除非您自己进行一些明确的排序，否则不能保证关联的顺序在服务器端是正确的.</p>
</div>
<div class="paragraph">
<p>如果您使用基于 <code>List</code> 的关联，这不是问题，因为 <code>List</code> 具有定义的顺序和可以引用的索引。 基于 <code>Map</code> 的关联也是如此.</p>
</div>
<div class="paragraph">
<p>还要注意，如果要绑定的关联的大小为2，并且引用的元素超出了关联的大小:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Stand</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Shining</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[2].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Red Madder</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后Grails将在定义的位置自动为您创建一个新实例.</p>
</div>
<div class="paragraph">
<p>您可以使用与单端关联相同的 <code>.id</code> 语法将关联类型的现有实例绑定到 <code>List</code> 。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${bookList}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[0]?.id}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${bookList}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[1]?.id}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[2].id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${bookList}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[2]?.id}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>允许单独选择 <code>books List</code> 中的各个条目.</p>
</div>
<div class="paragraph">
<p>特定索引的条目也可以用相同的方法删除。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].id</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${Book.list()}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[0]?.id}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">noSelection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">['null': '']</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果选择了空选项，将呈现一个选择框，该选择框将删除 <code>books[0]</code> 处的关联.</p>
</div>
<div class="paragraph">
<p>绑定到 <code>Map</code> 属性的工作方式相同，只是参数名中的列表索引被map键替换。:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">images[cover].id</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${Image.list()}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${book?.images[cover]?.id}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">noSelection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">['null': '']</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这会将选定的图像绑定到 <code>"cover"</code> 键下的 <code>Map</code> 属性 <code>images</code> 中.</p>
</div>
<div class="paragraph">
<p>绑定到Maps，Arrays和Collections时，数据绑定器将根据需要自动增大collections的大小.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
绑定程序将集合增长到多大的默认限制是256。如果数据绑定器遇到一个要求将集合增长到该限制之外的条目，则该条目将被忽略。 可以通过为 <code>application.groovy</code> 中的 <code>grails.databinding.autoGrowCollectionLimit</code> 属性分配一个值来配置限制。.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// the default value is 256</span>
grails.databinding.autoGrowCollectionLimit = <span class="integer">128</span>

<span class="comment">// ...</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_具有多个域类的数据绑定">具有多个域类的数据绑定</h4>
<div class="paragraph">
<p>可以通过以下链接将数据绑定到多个域对象 <a href="../ref/Controllers/params.html">params</a> .</p>
</div>
<div class="paragraph">
<p>例如，您有一个传入请求:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/book/save?book.title=The%20Stand&amp;author.name=Stephen%20King</code></pre>
</div>
</div>
<div class="paragraph">
<p>您会注意到与上述请求的不同之处在于，每个参数都有一个前缀，例如 <code>author.</code> 或 <code>book.</code>，用于区分哪些参数属于哪种类型。 Grails的 <code>params</code> 对象就像一个多维哈希，您可以对其进行索引以仅隔离要绑定的参数的子集.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params.book)</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，我们如何在 <code>book.title</code> 参数的第一个点之前使用前缀，以仅隔离此级别以下的参数进行绑定。 我们可以对 <code>Author</code> 域类做同样的事情:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> a = <span class="keyword">new</span> Author(params.author)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和动作参数">数据绑定和动作参数</h4>
<div class="paragraph">
<p>控制器操作参数受请求参数数据绑定的约束。 控制器动作参数有2类。 第一类是命令对象。 复杂类型被视为命令对象。 有关详细信息，请参见用户指南中的<a href="theWebLayer.html#commandObjects">Command Objects</a> 部分。 另一类是基本对象类型。 支持的类型是8个原语，它们对应的类型包装器和 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html">java.lang.String</a>. 默认行为是按名称将请求参数映射到操作参数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AccountingController</span> {

   <span class="comment">// accountNumber will be initialized with the value of params.accountNumber</span>
   <span class="comment">// accountType will be initialized with params.accountType</span>
   <span class="keyword">def</span> <span class="function">displayInvoice</span>(<span class="predefined-type">String</span> accountNumber, <span class="type">int</span> accountType) {
       <span class="comment">// ...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于原始参数和作为任何原始类型包装器类实例的参数，必须在将请求参数值绑定到动作参数之前执行类型转换。 类型转换自动发生。 在上面显示的示例中， <code>params.accountType</code> 请求参数必须转换为 <code>int</code>. 如果由于某种原因类型转换失败，则该参数将具有每个常规Java行为的默认值（类型包装器引用为null，布尔值为false，数字为零），并且相应的错误将添加到定义的 <code>errors</code> 属性中 控制者.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/accounting/displayInvoice?accountNumber=B59786&amp;accountType=bogusValue</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于无法将"bogusValue"转换为int类型，accountType的值将为零，控制器的 <code>errors.hasErrors()</code> 为true，控制器的 <code>errors.errorCount</code> 将等于1，控制器的 <code>errors.getFieldError('accountType')</code> 将包含相应的错误.</p>
</div>
<div class="paragraph">
<p>如果参数名称与请求参数的名称不匹配，则可以将  <code>@grails.web.RequestParameter</code> 批注应用于参数，以表达应绑定到该参数的请求参数的名称:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.web.RequestParameter</span>

<span class="type">class</span> <span class="class">AccountingController</span> {

   <span class="comment">// mainAccountNumber will be initialized with the value of params.accountNumber</span>
   <span class="comment">// accountType will be initialized with params.accountType</span>
   <span class="keyword">def</span> <span class="function">displayInvoice</span>(<span class="annotation">@RequestParameter</span>(<span class="string"><span class="delimiter">'</span><span class="content">accountNumber</span><span class="delimiter">'</span></span>) <span class="predefined-type">String</span> mainAccountNumber, <span class="type">int</span> accountType) {
       <span class="comment">// ...</span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和类型转换错误">数据绑定和类型转换错误</h4>
<div class="paragraph">
<p>有时在执行数据绑定时，无法将特定的String转换为特定的目标类型。 这导致类型转换错误。 Grails将在Grails域类的<a href="../ref/Domain%20Classes/errors.html">errors</a>属性内保留类型转换错误。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    ...
    URL publisherURL
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这里我们有一个域类 <code>Book</code> ，它使用 <code>java.net.URL</code> 类来表示URL。 给定一个传入请求，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/book/save?publisherURL=a-bad-url</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于发生类型不匹配错误，因此无法将字符串 <code>a-bad-url</code> 绑定到 <code>publisherURL</code> 属性。 您可以像这样检查这些:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)

<span class="keyword">if</span> (b.hasErrors()) {
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">The value </span><span class="inline"><span class="inline-delimiter">${</span>b.errors.getFieldError(<span class="string"><span class="delimiter">'</span><span class="content">publisherURL</span><span class="delimiter">'</span></span>).rejectedValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content"> is not a valid URL!</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>尽管我们尚未涵盖错误代码（有关更多信息，请参见<a href="validation.html">validation</a>上的部分），但对于类型转换错误，您希望将消息从 <code>grails-app/i18n/messages.properties</code> 文件发送到 用于错误。 您可以使用通用错误消息处理程序，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">typeMismatch.java.net.URL=The field {<span class="integer">0</span>} is not a valid <span class="predefined-type">URL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>或更具体的一个:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">typeMismatch.Book.publisherURL=The publisher <span class="predefined-type">URL</span> you specified is not a valid <span class="predefined-type">URL</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bindusing注释">BindUsing注释</h4>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindUsing.html">BindUsing</a> 注释可以用于为类中的特定字段定义自定义绑定机制。 每当将数据绑定应用于字段时，便会使用2个参数来调用注释的闭包值. 第一个参数是要应用数据绑定的对象，第二个参数是 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/DataBindingSource.html">DataBindingSource</a> 它是数据绑定的数据源. 从闭包返回的值将绑定到该属性。 以下示例将导致在数据绑定期间将源中的 <code>name</code> 值的大写版本应用于 <code>name</code> 字段.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindUsing</span>

<span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="annotation">@BindUsing</span>({obj, source -&gt;

        <span class="comment">//source is DataSourceBinding which is similar to a Map</span>
        <span class="comment">//and defines getAt operation but source.name cannot be used here.</span>
        <span class="comment">//In order to get name from source use getAt instead as shown below.</span>

        source[<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>]?.toUpperCase()
    })
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
请注意，仅当请求参数的名称与类中的字段名称匹配时，才可以进行数据绑定.
在这里，请求参数中的 <code>name</code> 与 <code>SomeClass</code> 中的 <code>name</code> 相匹配.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindUsing.html">BindUsing</a> 注释可用于为特定类上的所有字段定义自定义绑定机制. 当将注释应用于一个类时，分配给该注释的值应该是一个实现 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindingHelper.html">BindingHelper</a> 接口.  每当将值绑定到该注释已应用于的类中的属性时，都将使用该类的实例.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@BindUsing</span>(SomeClassWhichImplementsBindingHelper)
<span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="predefined-type">String</span> someProperty
    <span class="predefined-type">Integer</span> someOtherProperty
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bindinitializer批注">BindInitializer批注</h4>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindInitializer.html">BindInitializer</a> 如果未定义，则注释可用于初始化类中的关联字段.
不像 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindUsing.html">BindUsing</a> 注释，数据绑定将继续绑定此关联上的所有嵌套属性.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindInitializer</span>

<span class="type">class</span> <span class="class">Account</span>{}

<span class="type">class</span> <span class="class">User</span> {
  Account account

  <span class="comment">// BindInitializer expects you to return a instance of the type</span>
  <span class="comment">// where it's declared on. You can use source as a parameter, in this case user.</span>
  <span class="annotation">@BindInitializer</span>({user-&gt; <span class="keyword">new</span> Contact(<span class="key">account</span>:user.account) })
  Contact contact
}
<span class="type">class</span> <span class="class">Contact</span>{
  Account account
  <span class="predefined-type">String</span> firstName
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
根据此用例，@BindInitializer 仅对关联的实体有意义.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_定制数据转换器">定制数据转换器</h4>
<div class="paragraph">
<p>活页夹将自动执行很多类型转换。 一些应用程序可能想要定义自己的用于转换值的机制，而执行此操作的一种简单方法是编写一个实现 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/converters/ValueConverter.html">ValueConverter</a> 并在Spring应用程序上下文中将该类的实例注册为Bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.myapp.converters

<span class="keyword">import</span> <span class="include">grails.databinding.converters.ValueConverter</span>

<span class="comment">/**
 * A custom converter which will convert String of the
 * form 'city:state' into an Address object.
 */</span>
<span class="type">class</span> <span class="class">AddressValueConverter</span> <span class="directive">implements</span> ValueConverter {

    <span class="type">boolean</span> canConvert(value) {
        value <span class="keyword">instanceof</span> <span class="predefined-type">String</span>
    }

    <span class="keyword">def</span> <span class="function">convert</span>(value) {
        <span class="keyword">def</span> pieces = value.split(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>)
        <span class="keyword">new</span> com.myapp.Address(<span class="key">city</span>: pieces[<span class="integer">0</span>], <span class="key">state</span>: pieces[<span class="integer">1</span>])
    }

    <span class="predefined-type">Class</span>&lt;?&gt; getTargetType() {
        com.myapp.Address
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该类的实例需要在Spring应用程序上下文中注册为Bean。 Bean名称并不重要。 所有实现ValueConverter的bean将自动插入到数据绑定过程中.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    addressConverter com.myapp.converters.AddressValueConverter
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    Address homeAddress
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
    <span class="predefined-type">String</span> state
}

<span class="keyword">def</span> person = <span class="keyword">new</span> Person()
person.properties = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Jeff</span><span class="delimiter">'</span></span>, <span class="key">homeAddress</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">O'Fallon:Missouri</span><span class="delimiter">&quot;</span></span>]
<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Jeff</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.homeAddress.city = <span class="string"><span class="delimiter">&quot;</span><span class="content">O'Fallon</span><span class="delimiter">&quot;</span></span>
<span class="keyword">assert</span> person.homeAddress.state = <span class="string"><span class="delimiter">'</span><span class="content">Missouri</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定的日期格式">数据绑定的日期格式</h4>
<div class="paragraph">
<p>通过将字符串绑定到Date值时，可以指定要使用的自定义日期格式 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindingFormat.html">BindingFormat</a> 日期字段的注释.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindingFormat</span>

<span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@BindingFormat</span>(<span class="string"><span class="delimiter">'</span><span class="content">MMddyyyy</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">Date</span> birthDate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在 <code>application.groovy</code> 中配置一个全局设置来定义日期格式，当绑定到Date时将在整个应用程序中使用.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.databinding.dateFormats = [<span class="string"><span class="delimiter">'</span><span class="content">MMddyyyy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">yyyy-MM-dd HH:mm:ss.S</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd'T'hh:mm:ss'Z'</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>将尝试按照在列表中包含的顺序尝试 <code>grails.databinding.dateFormats</code> 中指定的格式。如果一个属性标有 <code>@BindingFormat</code> ，则 <code>@BindingFormat</code> 将优先于 <code>grails.databinding.dateFormats</code> 中指定的值。</p>
</div>
<div class="paragraph">
<p>默认配置的格式为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yyyy-MM-dd HH:mm:ss.S</code></p>
</li>
<li>
<p><code>yyyy-MM-dd&#8217;T&#8217;hh:mm:ss&#8217;Z'</code></p>
</li>
<li>
<p><code>yyyy-MM-dd HH:mm:ss.S z</code></p>
</li>
<li>
<p><code>yyyy-MM-dd&#8217;T&#8217;HH:mm:ss.SSSX</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_定制格式转换器">定制格式转换器</h4>
<div class="paragraph">
<p>您可以通过编写实现<a href="http://docs.grails.org/4.0.0/api/grails/databinding/converters/FormattedValueConverter.html">FormattedValueConverter</a> 接口的类并注册一个实例来为 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindingFormat.html">BindingFormat</a> 注释提供自己的处理程序。 该类在Spring应用程序上下文中作为bean。 下面是一个简单的自定义String格式化程序的示例，该格式化程序可以根据分配给BindingFormat批注的值来转换String的大小写.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.myapp.converters

<span class="keyword">import</span> <span class="include">grails.databinding.converters.FormattedValueConverter</span>

<span class="type">class</span> <span class="class">FormattedStringValueConverter</span> <span class="directive">implements</span> FormattedValueConverter {
    <span class="keyword">def</span> <span class="function">convert</span>(value, <span class="predefined-type">String</span> format) {
        <span class="keyword">if</span>(<span class="string"><span class="delimiter">'</span><span class="content">UPPERCASE</span><span class="delimiter">'</span></span> == format) {
            value = value.toUpperCase()
        } <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string"><span class="delimiter">'</span><span class="content">LOWERCASE</span><span class="delimiter">'</span></span> == format) {
            value = value.toLowerCase()
        }
        value
    }

    <span class="predefined-type">Class</span> getTargetType() {
        <span class="comment">// specifies the type to which this converter may be applied</span>
        <span class="predefined-type">String</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该类的实例需要在Spring应用程序上下文中注册为Bean。 Bean名称并不重要。 所有实现FormattedValueConverter的bean将自动插入到数据绑定过程中.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    formattedStringConverter com.myapp.converters.FormattedStringValueConverter
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了适当的绑定之后，就可以将 <code>BindingFormat</code> 注释应用于 <code>String</code> 字段，以通知数据绑定器利用自定义转换器.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindingFormat</span>

<span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@BindingFormat</span>(<span class="string"><span class="delimiter">'</span><span class="content">UPPERCASE</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">String</span> someUpperCaseString

    <span class="annotation">@BindingFormat</span>(<span class="string"><span class="delimiter">'</span><span class="content">LOWERCASE</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">String</span> someLowerCaseString

    <span class="predefined-type">String</span> someOtherString
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本地绑定格式">本地绑定格式</h4>
<div class="paragraph">
<p><code>BindingFormat</code> 批注通过使用可选的 <code>code</code> 属性来支持本地化的格式字符串。 如果将值分配给了code属性，则该值将用作消息代码，以在Spring应用程序上下文中从 <code>messageSource</code> bean中检索绑定格式字符串，并且该查找将被本地化.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindingFormat</span>

<span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@BindingFormat</span>(code=<span class="string"><span class="delimiter">'</span><span class="content">date.formats.birthdays</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">Date</span> birthDate
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">#</span> grails-app/conf/i18n/messages.properties
date.formats.birthdays=MMddyyyy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">#</span> grails-app/conf/i18n/messages_es.properties
date.formats.birthdays=ddMMyyyy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_结构化数据绑定编辑器">结构化数据绑定编辑器</h4>
<div class="paragraph">
<p>结构化数据绑定编辑器是一个帮助程序类，可以将结构化请求参数绑定到属性。 结构化绑定的常见用例是绑定到一个 <code>日期</code> 对象，该对象可能是由几个请求参数中包含的一些较小的信息片段构成的，它们的名称分别为 <code>birthday_month</code> , <code>birthday_date</code> 和 <code>birthday_year</code> 。 结构化的编辑器将检索所有这些单独的信息，并使用它们来构建一个 <code>Date</code>.</p>
</div>
<div class="paragraph">
<p>该框架提供了用于绑定到 <code>Date</code> 对象的结构化编辑器。 应用程序可以注册适合任何类型的自己的结构化编辑器。 考虑以下课程:</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/databinding/Gadget.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> databinding

<span class="type">class</span> <span class="class">Gadget</span> {
    <span class="predefined-type">Shape</span> expandedShape
    <span class="predefined-type">Shape</span> compressedShape
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/databinding/Shape.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> databinding

<span class="type">class</span> <span class="class">Shape</span> {
    <span class="type">int</span> area
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>一个 <code>Gadget</code> 具有2个 <code>Shape</code> 字段。 <code>Shape</code> 具有 <code>area</code> 属性。 可能是应用程序想要接受诸如 <code>width</code> 和 <code>height</code> 的请求参数，并在绑定时使用这些参数来计算 <code>Shape</code> 的 <code>area</code>。 结构化绑定编辑器非常适合.</p>
</div>
<div class="paragraph">
<p>在数据绑定过程中注册结构化编辑器的方法是将 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/TypedStructuredBindingEditor.html">grails.databinding.TypedStructuredBindingEditor</a> 接口的实例添加到Spring应用程序上下文。 实现 <code>TypedStructuredBindingEditor</code> 接口的最简单方法是继承 <a href="http://docs.grails.org/4.0.0/api/org/grails/databinding/converters/AbstractStructuredDateBindingEditor.html">org.grails.databinding.converters.AbstractStructuredBindingEditor</a> 抽象类并覆盖 <code>getPropertyValue</code> 方法，如图所示 下面:</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/databinding/converters/StructuredShapeEditor.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> databinding.converters

<span class="keyword">import</span> <span class="include">databinding.Shape</span>

<span class="keyword">import</span> <span class="include">org.grails.databinding.converters.AbstractStructuredBindingEditor</span>

<span class="type">class</span> <span class="class">StructuredShapeEditor</span> <span class="directive">extends</span> AbstractStructuredBindingEditor&lt;<span class="predefined-type">Shape</span>&gt; {

    <span class="directive">public</span> <span class="predefined-type">Shape</span> getPropertyValue(<span class="predefined-type">Map</span> values) {
        <span class="comment">// retrieve the individual values from the Map</span>
        <span class="keyword">def</span> width = values.width <span class="keyword">as</span> <span class="type">int</span>
        <span class="keyword">def</span> height = values.height <span class="keyword">as</span> <span class="type">int</span>

        <span class="comment">// use the values to calculate the area of the Shape</span>
        <span class="keyword">def</span> area = width * height

        <span class="comment">// create and return a Shape with the appropriate area</span>
        <span class="keyword">new</span> <span class="predefined-type">Shape</span>(<span class="key">area</span>: area)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该类的实例需要在Spring应用程序上下文中注册:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    shapeEditor databinding.converters.StructuredShapeEditor
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当数据绑定器绑定到 <code>Gadget</code> 类的实例时，它将检查是否存在名称为 <code>compressedShape</code> 和 <code>expandedShape</code> 的请求参数，其值均为"struct"，如果确实存在，则会触发 使用 <code>StructuredShapeEditor</code> 。 结构的各个组件必须具有格式为propertyName_structuredElementName的参数名称。 在上述 <code>Gadget</code> 类的情况下，这意味着 <code>compressedShape</code> 请求参数应具有"struct"值，而 <code>compressedShape_width</code> 和 <code>compressedShape_height</code> 参数应具有代表宽度和高度的值。 压缩的 <code>Shape</code> 。 同样，expandedShape请求参数应具有"struct"值，expandedShape_width和expandedShape_height参数应具有表示扩展 <code>Shape</code> 宽度和高度的值.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createGadget</span>(Gadget gadget) {
        <span class="comment">/*
        /demo/createGadget?expandedShape=struct&amp;expandedShape_width=80&amp;expandedShape_height=30
                          &amp;compressedShape=struct&amp;compressedShape_width=10&amp;compressedShape_height=3

        */</span>

        <span class="comment">// with the request parameters shown above gadget.expandedShape.area would be 2400</span>
        <span class="comment">// and gadget.compressedShape.area would be 30</span>
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常，以"struct"作为其值的请求参数将由隐藏的表单字段表示.</p>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定事件侦听器">数据绑定事件侦听器</h4>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/events/DataBindingListener.html">DataBindingListener</a> 接口提供了一种机制，可将数据绑定事件通知给侦听器。 界面看起来像这样:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> grails.databinding.events;

<span class="keyword">import</span> <span class="include">grails.databinding.errors.BindingError</span>;

<span class="comment">/**
 * A listener which will be notified of events generated during data binding.
 *
 * @author Jeff Brown
 * @since 3.0
 * @see DataBindingListenerAdapter
 */</span>
<span class="directive">public</span> <span class="type">interface</span> DataBindingListener {

    <span class="comment">/**
     * @return true if the listener is interested in events for the specified type.
     */</span>
    <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; clazz);

    <span class="comment">/**
     * Called when data binding is about to start.
     *
     * @param target The object data binding is being imposed upon
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     * @return true if data binding should continue
     */</span>
    <span class="predefined-type">Boolean</span> beforeBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called when data binding is about to imposed on a property
     *
     * @param target The object data binding is being imposed upon
     * @param propertyName The name of the property being bound to
     * @param value The value of the property being bound
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     * @return true if data binding should continue, otherwise return false
     */</span>
    <span class="predefined-type">Boolean</span> beforeBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">String</span> propertyName, <span class="predefined-type">Object</span> value, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called after data binding has been imposed on a property
     *
     * @param target The object data binding is being imposed upon
     * @param propertyName The name of the property that was bound to
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     */</span>
    <span class="type">void</span> afterBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">String</span> propertyName, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called after data binding has finished.
     *
     * @param target The object data binding is being imposed upon
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     */</span>
    <span class="type">void</span> afterBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called when an error occurs binding to a property
     * @param error encapsulates information about the binding error
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     * @see BindingError
     */</span>
    <span class="type">void</span> bindingError(BindingError error, <span class="predefined-type">Object</span> errors);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring应用程序上下文中实现该接口的任何bean都会自动向数据绑定器注册.  <a href="http://docs.grails.org/4.0.0/api/grails/databinding/events/DataBindingListenerAdapter.html">DataBindingListenerAdapter</a> 类实现了 <code>DataBindingListener</code> 接口，并为接口中的所有方法提供了默认实现，因此此类非常适合于子类化，因此您的侦听器类仅需要为您的侦听器感兴趣的方法提供实现.</p>
</div>
</div>
<div class="sect3">
<h4 id="_直接使用数据绑定器">直接使用数据绑定器</h4>
<div class="paragraph">
<p>在某些情况下，应用程序可能希望直接使用数据绑定器。 例如，在服务上对不是域类的任意对象进行绑定。 以下内容将不起作用，因为 <code>properties</code> 属性是只读的.</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/bindingdemo/Widget.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">Widget</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> size
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/services/bindingdemo/WidgetService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">WidgetService</span> {

    <span class="keyword">def</span> <span class="function">updateWidget</span>(Widget widget, <span class="predefined-type">Map</span> data) {
        <span class="comment">// this will throw an exception because</span>
        <span class="comment">// properties is read-only</span>
        widget.properties = data
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>数据绑定器的一个实例在Spring应用程序上下文中，其bean名称为 <code>grailsWebDataBinder</code> .  该bean实现 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/DataBinder.html">DataBinder</a>接口.  以下代码演示了如何直接使用数据绑定器.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/bindingdmeo/WidgetService</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="keyword">import</span> <span class="include">grails.databinding.SimpleMapDataBindingSource</span>

<span class="type">class</span> <span class="class">WidgetService</span> {

    <span class="comment">// this bean will be autowired into the service</span>
    <span class="keyword">def</span> grailsWebDataBinder

    <span class="keyword">def</span> <span class="function">updateWidget</span>(Widget widget, <span class="predefined-type">Map</span> data) {
        grailsWebDataBinder.bind widget, data <span class="keyword">as</span> SimpleMapDataBindingSource
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关重载版本的更多信息，请参见 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/DataBinder.html">DataBinder</a> 文档。
 <code>bind</code> 方法.</p>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和安全问题">数据绑定和安全问题</h4>
<div class="paragraph">
<p>从请求参数批量更新属性时，需要注意不要允许客户端将恶意数据绑定到域类并保留在数据库中。 您可以使用下标运算符限制将哪些属性绑定到给定的域类:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)

p.properties[<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>] = params</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，只会绑定 <code>firstName</code> 和 <code>lastName</code> 属性.</p>
</div>
<div class="paragraph">
<p>另一种方法是使用 <a href="theWebLayer.html#commandObjects">Command Objects</a> 作为数据绑定的目标而不是域类. 另外，也有灵活的 <a href="../ref/Controllers/bindData.html">bindData</a> 方法.</p>
</div>
<div class="paragraph">
<p><code>bindData</code> 方法允许相同的数据绑定功能，但可以绑定到任意对象:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person()
bindData(p, params)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>bindData</code> 方法还允许您排除某些不想更新的参数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person()
bindData(p, params, [<span class="key">exclude</span>: <span class="string"><span class="delimiter">'</span><span class="content">dateOfBirth</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>或仅包含某些属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person()
bindData(p, params, [<span class="key">include</span>: [<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>]])</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果提供了一个空的List作为 <code>include</code> 参数的值，那么如果未明确排除所有字段，则将对其进行绑定.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="../ref/Constraints/bindable.html">bindable</a> 约束可用于全局阻止某些属性的数据绑定.</p>
</div>
</div>


<h2 id="jsonResponses">8.1.6 使用 JSON 响应</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/jsonResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_使用response方法输出json">使用response方法输出JSON</h4>
<div class="paragraph">
<p><code>响应</code> 方法是返回JSON的首选方法，并与 <a href="theWebLayer.html#contentNegotiation">Content Negotiation</a> 和 <a href="http://views.grails.org">JSON Views</a> 集成.</p>
</div>
<div class="paragraph">
<p><code>响应</code> 方法提供了内容协商策略，以智能地为给定客户端生成适当的响应.</p>
</div>
<div class="paragraph">
<p>例如给出以下控制器和动作:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/BookController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example

<span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">index</span>() {
        respond <span class="predefined-type">Book</span>.list()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>respond</code> 方法将采取以下步骤:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>如果客户端的 <code>Accept</code> 标头指定了媒体类型（例如 <code>application/json</code>），请使用</p>
</li>
<li>
<p>如果URI的文件扩展名（例如 <code>/books.json</code>）包含在 <code>grails-app/conf/application.yml</code> 的 <code>grails.mime.types</code> 属性中定义的格式，请使用在组态</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>然后，<code>respond</code> 方法将查找适当 <a href="http://docs.grails.org/4.0.0/api/grails/rest/render/Renderer.html">Renderer</a> 用于对象，并从链接中计算出媒体类型 <a href="http://docs.grails.org/4.0.0/api/grails/rest/render/RendererRegistry.html">RendererRegistry</a>.</p>
</div>
<div class="paragraph">
<p>Grails包含许多预配置的 <code>Renderer</code> 实现，这些实现将为传递给 <code>respond</code> 的参数生成JSON响应的默认表示。 例如，转到 <code>/book.json</code> URI将产生JSON，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
    {<span class="error">i</span><span class="error">d</span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>},
    {<span class="error">i</span><span class="error">d</span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Shining</span><span class="delimiter">&quot;</span></span>}
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_控制媒体类型的优先级">控制媒体类型的优先级</h4>
<div class="paragraph">
<p>默认情况下，如果您定义一个控制器，则在发送回客户端的格式方面没有优先级，Grails假定您希望将HTML作为响应类型提供.</p>
</div>
<div class="paragraph">
<p>但是，如果您的应用程序主要是API，则可以使用 <code>response Formats</code> 属性指定优先级:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/BookController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example

<span class="type">class</span> <span class="class">BookController</span> {
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span>]
    <span class="keyword">def</span> <span class="function">index</span>() {
        respond <span class="predefined-type">Book</span>.list()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，如果无法通过`Accept`标头或文件扩展名计算出要响应的媒体类型，则Grails默认情况下将以 <code>json</code> 响应.</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用视图输出json响应">使用视图输出JSON响应</h4>
<div class="paragraph">
<p>如果您定义视图（GSP或一个 <a href="http://views.grails.org">JSON View</a>)，则在使用 <code>respond</code> 方法时，Grails将根据传递给 <code>respond</code> 的参数计算模型来渲染视图.</p>
</div>
<div class="paragraph">
<p>例如，在上一个清单中，如果要定义 <code>grails-app/views/index.gson</code> 和 <code>grails-app/views/index.gsp</code> 视图，则在客户端请求 <code>application/json</code> 时将使用这些视图或 <code>text/html</code> 媒体类型。 因此，您可以定义一个后端，该后端能够提供对Web浏览器的响应或代表您的应用程序的API.</p>
</div>
<div class="paragraph">
<p>渲染视图时，Grails将根据传递给 <code>respond</code> 方法的值的类型来计算要传递给视图的模型.</p>
</div>
<div class="paragraph">
<p>下表总结了此约定:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Argument Type</th>
<th class="tableblock halign-left valign-top">Calculated Model Variable</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond Book.list()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bookList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [] )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>emptyList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond Book.get(1)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>example.Book</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>book</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [1,2] )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integerList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [1,2] as Set )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integerSet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [1,2] as Integer[] )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integerArray</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>使用此约定，您可以在视图中引用传递给 <code>respond</code> 的参数。:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/index.gson</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Field</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; bookList = <span class="type">[]</span>

json bookList, { <span class="predefined-type">Book</span> book -&gt;
    title book.title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您将注意到，如果 <code>Book.list（）</code> 返回一个空列表，则模型变量名称将转换为 <code>emptyList</code> 。 这是设计使然，如果未指定模型变量，则应在视图中提供默认值，例如上例中的 <code>List</code> :</p>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/index.gson</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// defaults to an empty list</span>
<span class="annotation">@Field</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; bookList = <span class="type">[]</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>在某些情况下，您可能希望更明确一些并控制模型变量的名称。 例如，如果您有一个域继承层次结构，那么对 <code>list（）</code> 的调用可能会导致依赖于自动计算的其他子类返回不可靠.</p>
</div>
<div class="paragraph">
<p>在这种情况下，您应该使用 <code>respond</code> 和map参数直接传递模型:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">respond <span class="key">bookList</span>: <span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
在集合中使用任何类型的混合参数类型进行响应时，请始终使用显式模型名称.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如果您只是想扩充计算的模型，则可以通过传递一个 <code>model</code> 参数来实现:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">respond <span class="predefined-type">Book</span>.list(), [<span class="key">model</span>: [<span class="key">bookCount</span>: <span class="predefined-type">Book</span>.count()]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例将生成一个模型，如 <code>[bookList:books, bookCount:totalBooks]</code>,其中将计算出的模型与在 <code>model</code> 参数中传递的模型组合在一起.</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用render方法输出json">使用render方法输出JSON</h4>
<div class="paragraph">
<p><code>Render</code> 方法也可以用于输出JSON，但仅应用于不保证创建JSON视图的简单情况下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">list</span>() {

    <span class="keyword">def</span> results = <span class="predefined-type">Book</span>.list()

    render(<span class="key">contentType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>) {
        books(results) { <span class="predefined-type">Book</span> b -&gt;
            title b.title
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，结果将类似于:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Shining</span><span class="delimiter">&quot;</span></span>}
]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
对于非常简单的响应，这种呈现JSON的技术可能是可以的，但是通常，您应该支持使用 <a href="webServices.html#jsonViews">JSON Views</a> 并使用视图层，而不是在应用程序中嵌入逻辑.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>与上述XML命名冲突相同的危险也适用于JSON构建.</p>
</div>
</div>

<a name="7.1.8 &#20851;&#20110; JSONBuilder &#30340;&#25193;&#23637;"><!-- Legacy link --></a>
<h2 id="moreOnJSONBuilder">8.1.7 关于 JSONBuilder</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/moreOnJSONBuilder.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>上一节有关XML和JSON响应的部分介绍了呈现XML和JSON响应的简单示例。 尽管Grails使用的XML构建器是Groovy中的标准 <a href="http://groovy-lang.org/processing-xml.html#_xmlparser_and_xmlslurper">XmlSlurper</a> .</p>
</div>
<div class="paragraph">
<p>对于JSON，自Grails 3.1起，Grails默认使用Groovy的 <a href="http://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#_streamingjsonbuilder">StreamingJsonBuilder</a> 您可以参考 link: <a href="http://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#_streamingjsonbuilder">Groovy documentation</a> 和 <a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/json/StreamingJsonBuilder.html">StreamingJsonBuilder</a> API文档 如何使用它.</p>
</div>


<h2 id="xmlResponses">8.1.8 使用 XML 响应</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/xmlResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<a name="7.1.9 &#19978;&#20256;&#25991;&#20214;"><!-- Legacy link --></a>
<h2 id="uploadingFiles">8.1.9 上传文件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/uploadingFiles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_程序化文件上传">程序化文件上传</h4>
<div class="paragraph">
<p>Grails支持使用Spring的 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/multipart/MultipartHttpServletRequest.html">MultipartHttpServletRequest</a> 接口上传文件。 上传文件的第一步是创建一个多部分表单，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Upload Form: <span class="tag">&lt;br</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;g:uploadForm</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">upload</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFile</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/g:uploadForm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>uploadForm</code> 标签将 <code>enctype ="multipart/form-data"</code> 属性添加到标准 <code>&lt;g:form&gt;</code> 标签中。
有多种方法可以处理文件上传。 一种是直接使用Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/multipart/MultipartFile.html">MultipartFile</a> 实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">upload</span>() {
    <span class="keyword">def</span> f = request.getFile(<span class="string"><span class="delimiter">'</span><span class="content">myFile</span><span class="delimiter">'</span></span>)
    <span class="keyword">if</span> (f.empty) {
        flash.message = <span class="string"><span class="delimiter">'</span><span class="content">file cannot be empty</span><span class="delimiter">'</span></span>
        render(<span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">uploadForm</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    f.transferTo(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">/some/local/dir/myfile.txt</span><span class="delimiter">'</span></span>))
    response.sendError(<span class="integer">200</span>, <span class="string"><span class="delimiter">'</span><span class="content">Done</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/multipart/MultipartFile.html">MultipartFile</a> 界面可以获得 <code>InputStream</code> 等信息，方便对其他目的地的传输和直接处理文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_通过数据绑定上传文件">通过数据绑定上传文件</h4>
<div class="paragraph">
<p>文件上传也可以使用数据绑定来执行。 考虑这个 <code>Image</code> 域类:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Image</span> {
    <span class="type">byte</span><span class="type">[]</span> myFile

    <span class="directive">static</span> constraints = {
        <span class="comment">// Limit upload file size to 2MB</span>
        myFile <span class="key">maxSize</span>: <span class="integer">1024</span> * <span class="integer">1024</span> * <span class="integer">2</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用构造函数中的 <code>params</code> 对象创建图像，如下例所示，Grails会将文件的内容作为 <code>byte[]</code> 自动绑定到 <code>myFile</code> 属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> img = <span class="keyword">new</span> <span class="predefined-type">Image</span>(params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置 <a href="../ref/Constraints/size.html">size</a> 或<a href="../ref/Constraints/maxSize.html">maxSize</a> 约束很重要，否则数据库可能会以较小的列大小创建无法处理大小合理的文件。 例如，对于 <code>byte[]</code> 属性，H2和MySQL的默认Blob大小均为255个字节。
通过将图像上的 <code>myFile</code> 属性的类型更改为String类型，也可以将文件的内容设置为字符串：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Image</span> {
   <span class="predefined-type">String</span> myFile
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_增加上传最大文件大小">增加上传最大文件大小</h4>
<div class="paragraph">
<p>Grails上载文件的默认大小为128000（〜128KB).当超出此限制时，将看到以下异常：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.springframework.web.multipart.MultipartException: Could not parse multipart servlet request; nested exception is java.lang.IllegalStateException: org.apache.tomcat.util.http.fileupload.FileUploadBase<span class="error">$</span><span class="exception">SizeLimitExceededException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在 <code>application.yml</code> 中配置限制，如下所示：</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">grails</span>:
    <span class="key">controllers</span>:
        <span class="key">upload</span>:
            <span class="key">maxFileSize</span>: <span class="string"><span class="content">2000000</span></span>
            <span class="key">maxRequestSize</span>: <span class="string"><span class="content">2000000</span></span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`maxFileSize` = 允许上传文件的最大大小。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`maxRequestSize` =  多部分/表单数据请求所允许的最大大小。</pre>
</div>
</div>
<div class="paragraph">
<p>您应牢记 <a href="https://www.owasp.org/index.php/Unrestricted_File_Upload">OWASP recommendations - Unrestricted File Upload</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
将文件大小限制为最大值，以防止拒绝服务攻击。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>存在这些限制是为了防止DoS攻击并增强应用程序整体性能</p>
</div>
</div>

<a name="7.1.10 &#21629;&#20196;&#23545;&#35937;"><!-- Legacy link --></a>
<h2 id="commandObjects">8.1.10 命令对象</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/commandObjects.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails控制器支持命令对象的概念。命令对象是与 <a href="theWebLayer.html#dataBinding">data binding</a> 结合使用的类，通常用于验证可能不适合现有域类的数据。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
仅当类用作操作的参数时，才将其视为命令对象。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_声明命令对象">声明命令对象</h4>
<div class="paragraph">
<p>命令对象类的定义与其他任何类一样。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LoginCommand</span> <span class="directive">implements</span> grails.validation.Validateable {
    <span class="predefined-type">String</span> username
    <span class="predefined-type">String</span> password

    <span class="directive">static</span> constraints = {
        username(<span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">minSize</span>: <span class="integer">6</span>)
        password(<span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">minSize</span>: <span class="integer">6</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，命令对象类实现了 <code>Validateable</code> 特征。<code>Validateable</code> 特征允许对 <a href="validation.html#constraints">Constraints</a> 的定义，就像在 <a href="GORM.html">domain classes</a> 中一样。如果命令对象与使用它的控制器在同一源文件中定义，则Grails会自动将其设为 <code>Validateable</code> 。不需要命令对象类是可验证的。</p>
</div>
<div class="paragraph">
<p>默认情况下，不是 <code>java.util.Collection</code> 或 <code>java.util.Map</code> 实例的所有 <code>Validateable</code> 对象属性都是 <code>nullable: false</code>。<code>java.util.Collection</code> 和 <code>java.util.Map</code> 的实例默认为 <code>nullable: true</code> 。如果您希望默认情况下具有 <code>nullable: true</code> 属性的 <code>Validateable</code>，则可以通过在类中定义 <code>defaultNullable</code> 方法来指定此值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorSearchCommand</span> <span class="directive">implements</span> grails.validation.Validateable {
    <span class="predefined-type">String</span>  name
    <span class="predefined-type">Integer</span> age

    <span class="directive">static</span> <span class="type">boolean</span> defaultNullable() {
        <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，<code>name</code> 和 <code>age</code> 在验证期间都将允许空值。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用命令对象">使用命令对象</h4>
<div class="paragraph">
<p>要使用命令对象，控制器动作可以选择指定任意数量的命令对象参数。必须提供参数类型，以便Grails知道要创建和初始化的对象。</p>
</div>
<div class="paragraph">
<p>在执行控制器动作之前，Grails将自动创建命令对象类的实例，并通过绑定请求参数来填充其属性。如果命令对象类标记有 <code>Validateable</code>，则将验证命令对象。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LoginController</span> {

    <span class="keyword">def</span> <span class="function">login</span>(LoginCommand cmd) {
        <span class="keyword">if</span> (cmd.hasErrors()) {
            redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">loginForm</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        <span class="comment">// work with the command object data</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果命令对象的类型是域类的类型，并且有一个 <code>id</code> 请求参数，则将调用域类的静态 <code>get</code> 方法，而不是调用域类的构造函数来创建新实例。 <code>id</code> 参数的值将作为参数传递。</p>
</div>
<div class="paragraph">
<p>调用 <code>get</code> 返回的结果将传递到控制器动作中。这意味着，如果有一个 <code>id</code> 请求参数，而在数据库中找不到相应的记录，那么命令对象的值将为 <code>null</code>。如果在从数据库中检索实例时发生错误，则将 <code>null</code> 作为控制器操作的参数传递给错误，并且将添加错误的controllers <code>errors</code> 属性。</p>
</div>
<div class="paragraph">
<p>如果命令对象的类型是域类，并且没有 <code>id</code> 请求参数，或者没有 <code>id</code> 请求参数，并且其值为空，那么除非HTTP request方法为 <code>null</code> ，否则它将被传递给控制器操作"POST"，在这种情况下，将通过调用域类构造函数来创建域类的新实例。对于域类实例为非空的所有情况，仅当HTTP请求方法为"POST"，"PUT"或"PATCH"时才执行数据绑定。</p>
</div>
</div>
<div class="sect3">
<h4 id="_命令对象和请求参数名称">命令对象和请求参数名称</h4>
<div class="paragraph">
<p>通常，请求参数名称将直接映射到命令对象中的属性名称。嵌套参数名称可用于以直观方式绑定对象图。</p>
</div>
<div class="paragraph">
<p>在下面的示例中，名为 <code>name</code> 的请求参数将绑定到 <code>Person</code> 实例的 <code>name</code> 属性，而名为 <code>address.city</code> 的请求参数将绑定到 <code>address</code> 实例的 <code>city</code> 属性。  <code>Person</code> 中的属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StoreController</span> {
    <span class="keyword">def</span> <span class="function">buy</span>(Person buyer) {
        <span class="comment">// ...</span>
    }
}

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Address address
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果控制器动作接受恰好包含相同属性名称的多个命令对象，则可能会出现问题。考虑以下示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StoreController</span> {
    <span class="keyword">def</span> <span class="function">buy</span>(Person buyer, Product product) {
        <span class="comment">// ...</span>
    }
}

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Address address
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
}

<span class="type">class</span> <span class="class">Product</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果有一个名为 <code>name</code> 的请求参数，则不清楚该参数是否应代表 <code>Product</code> 的名称或 <code>Person</code> 的名称。如果控制器动作接受2个相同类型的命令对象，则可能会出现该问题的另一个版本，如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StoreController</span> {
    <span class="keyword">def</span> <span class="function">buy</span>(Person buyer, Person seller, Product product) {
        <span class="comment">// ...</span>
    }
}

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Address address
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
}

<span class="type">class</span> <span class="class">Product</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了帮助解决此问题，框架强加了一些特殊的规则，用于将参数名称映射到命令对象类型。命令对象数据绑定将把以控制器操作参数名称开头的所有参数视为属于相应命令对象。</p>
</div>
<div class="paragraph">
<p>例如，<code>product.name</code> 请求参数将绑定到 <code>product</code> 参数中的 <code>name</code> 属性，<code>buyer.name</code> 请求参数将绑定到 <code>buyer</code> 参数中的 <code>name</code> 属性。 <code>seller.address.city</code> 请求参数将绑定到 <code>seller</code> 参数的 <code>address</code> 属性的 <code>city</code> 属性等。</p>
</div>
</div>
<div class="sect3">
<h4 id="_命令对象和依赖注入">命令对象和依赖注入</h4>
<div class="paragraph">
<p>命令对象可以参与依赖项注入。如果您的命令对象具有一些使用Grails链接的自定义验证逻辑，这将非常有用<a href="services.html">service</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LoginCommand</span> <span class="directive">implements</span> grails.validation.Validateable {

    <span class="keyword">def</span> loginService

    <span class="predefined-type">String</span> username
    <span class="predefined-type">String</span> password

    <span class="directive">static</span> constraints = {
        username <span class="key">validator</span>: { val, obj -&gt;
            obj.loginService.canLogin(obj.username, obj.password)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，命令对象与 <code>loginService</code> bean交互，该bean是通过名字从Spring <code>ApplicationContext</code> 中注入的。</p>
</div>
</div>
<div class="sect3">
<h4 id="_将请求主体绑定到命令对象">将请求主体绑定到命令对象</h4>
<div class="paragraph">
<p>当发出对接受命令对象的控制器操作的请求，并且该请求包含主体时，Grails将尝试根据请求内容类型解析请求的主体，并使用该主体对命令对象进行数据绑定。请参见以下示例。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/bindingdemo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createWidget</span>(Widget w) {
        render <span class="string"><span class="delimiter">&quot;</span><span class="content">Name: </span><span class="inline"><span class="inline-delimiter">${</span>w?.name<span class="inline-delimiter">}</span></span><span class="content">, Size: </span><span class="inline"><span class="inline-delimiter">${</span>w?.size<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}

<span class="type">class</span> <span class="class">Widget</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> size
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -H &quot;Content-Type: application/json&quot; -d '{&quot;name&quot;:&quot;Some Widget&quot;,&quot;42&quot;}'[size] localhost:8080/demo/createWidget
 Name: Some Widget, Size: 42

$ curl -H &quot;Content-Type: application/xml&quot; -d '&lt;widget&gt;&lt;name&gt;Some Other Widget&lt;/name&gt;&lt;size&gt;2112&lt;/size&gt;&lt;/widget&gt;' localhost:8080/bodybind/demo/createWidget
 Name: Some Other Widget, Size: 2112</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在以下情况下，将不会解析请求正文：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>请求方法为GET</p>
</li>
<li>
<p>请求方法为DELETE</p>
</li>
<li>
<p>内容长度为0</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>请注意，正在解析请求的主体以使其正常工作。此后任何尝试读取请求正文的尝试都将失败，因为相应的输入流将为空。控制器动作可以使用命令对象，也可以自行解析请求的主体（直接解析或通过引用诸如request.JSON之类的东西），但不能同时执行。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/bindingdemo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createWidget</span>(Widget w) {
        <span class="comment">// this will fail because it requires reading the body,</span>
        <span class="comment">// which has already been read.</span>
        <span class="keyword">def</span> json = request.JSON

        <span class="comment">// ...</span>

    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用命令对象列表">使用命令对象列表</h4>
<div class="paragraph">
<p>命令对象的常见用例是一个包含另一个对象的集合的命令对象：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createAuthor</span>(AuthorCommand command) {
        <span class="comment">// ...</span>

    }

    <span class="type">class</span> <span class="class">AuthorCommand</span> {
        <span class="predefined-type">String</span> fullName
        <span class="predefined-type">List</span>&lt;BookCommand&gt; books
    }

    <span class="type">class</span> <span class="class">BookCommand</span> {
        <span class="predefined-type">String</span> title
        <span class="predefined-type">String</span> isbn
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，我们要创建一个包含多本Books的Author。</p>
</div>
<div class="paragraph">
<p>为了从UI层进行这项工作，您可以在GSP中执行以下操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:form</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit-author-books</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">demo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createAuthor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fullName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;ul&gt;</span>
        <span class="tag">&lt;li&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].isbn</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/li&gt;</span>

        <span class="tag">&lt;li&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].isbn</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/li&gt;</span>
    <span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;/g:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>还支持JSON，因此您可以使用正确的数据绑定提交以下内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">fullName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Graeme Rocher</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>: [{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Definitive Guide to Grails</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1111-343455-1111</span><span class="delimiter">&quot;</span></span>
    }, {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Definitive Guide to Grails 2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1111-343455-1112</span><span class="delimiter">&quot;</span></span>
    }],
}</code></pre>
</div>
</div>
</div>

<a name="7.1.11 &#22788;&#29702;&#37325;&#22797;&#34920;&#21333;&#25552;&#20132;"><!-- Legacy link --></a>
<h2 id="formtokens">8.1.11 处理重复表单提交</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/formtokens.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails具有使用“同步器令牌模式”处理重复表单提交的内置支持。 首先，请在链接上定义令牌： <a href="http://gsp.grails.org/latest/ref/Tags/form.html">form</a> 标记:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:form</span> <span class="attribute-name">useToken</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，在您的控制器代码中，可以使用 <a href="../ref/Controllers/withForm.html">withForm</a> 方法来处理有效和无效的请求:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withForm {
   <span class="comment">// good request</span>
}.invalidToken {
   <span class="comment">// bad request</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您仅提供 <a href="../ref/Controllers/withForm.html">withForm</a> 方法而不是链式的 <code>invalidToken</code> 方法，则Grails默认会将无效令牌存储在 <code>flash.invalidToken</code> 变量中并重定向请求 回到原始页面。 然后可以在视图中检查:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:if</span> <span class="attribute-name">test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${flash.invalidToken}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  Don't click the button twice!
<span class="tag">&lt;/g:if&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<a href="../ref/Controllers/withForm.html">withForm</a> 标记使用 <a href="../ref/Controllers/session.html">session</a> 因此如果在集群中使用，则需要会话关联性或集群会话.
</td>
</tr>
</table>
</div>

<a name="7.1.12 &#22522;&#26412;&#31867;&#22411;&#36716;&#25442;"><!-- Legacy link --></a>
<h2 id="typeConverters">8.1.12 基本类型转换器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/typeConverters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_类型转换方法">类型转换方法</h3>
<div class="paragraph">
<p>如果想避免 <a href="theWebLayer.html#dataBinding">data binding</a> 的开销，只是想将传入参数（通常是字符串）转换为另一个更合适的类型，请<a href="../ref/Controllers/params.html">params</a> 对象为每种类型提供许多方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> total = params.int(<span class="string"><span class="delimiter">'</span><span class="content">total</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例使用 <code>int</code> 方法，还有 <code>boolean</code>, <code>long</code>, <code>char</code>, <code>short</code> 等方法。 这些方法中的每一个都是null安全的，并且不会出现任何解析错误，因此不必对参数进行任何其他检查。
每个转换方法都允许将默认值作为可选的第二个参数传递。 如果在映射中找不到对应的条目，或者在转换过程中发生错误，则将返回默认值。 例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> total = params.int(<span class="string"><span class="delimiter">'</span><span class="content">total</span><span class="delimiter">'</span></span>, <span class="integer">42</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些相同的类型转换方法也可以在GSP标签的 <code>attrs</code> 参数上使用。</p>
</div>
</div>
<div class="sect2">
<h3 id="_处理多个参数">处理多个参数</h3>
<div class="paragraph">
<p>常见的一个用例是处理多个相同名称的请求参数。 例如，可以获得一个查询字符串，例如 <code>？name = Bob＆name = Judy</code></p>
</div>
<div class="paragraph">
<p>在这种情况下，处理一个参数和处理多个参数具有不同的语义，因为Groovy的 <code>String</code> 迭代机制在每个字符上进行迭代。 为了避免这个问题，可以<a href="../ref/Controllers/params.html">params</a> 对象提供了一个总是返回列表的 <code>list</code> 方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span> (name <span class="keyword">in</span> params.list(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) {
    println name
}</code></pre>
</div>
</div>
</div>


<h2 id="controllerExceptionHandling">8.1.13 声明性控制器异常处理</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/controllerExceptionHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails控制器支持声明式异常处理的简单机制。如果控制器声明了一个接受单个参数的方法，且参数类型为 <code>java.lang.Exception</code> 或 <code>java.lang.Exception</code> 的子类，则该控制器中的任何操作引发异常时都会调用该方法。这种类型的。请参见以下示例。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo


<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">someAction</span>() {
        <span class="comment">// do some work</span>
    }

    <span class="keyword">def</span> <span class="function">handleSQLException</span>(<span class="exception">SQLException</span> e) {
        render <span class="string"><span class="delimiter">'</span><span class="content">A SQLException Was Handled</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleBatchUpdateException</span>(<span class="exception">BatchUpdateException</span> e) {
        redirect <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">logging</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">batchProblem</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleNumberFormatException</span>(<span class="exception">NumberFormatException</span> nfe) {
        [<span class="key">problemDescription</span>: <span class="string"><span class="delimiter">'</span><span class="content">A Number Was Invalid</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该控制器的行为就像写了这样的东西&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">someAction</span>() {
        <span class="keyword">try</span> {
            <span class="comment">// do some work</span>
        } <span class="keyword">catch</span> (<span class="exception">BatchUpdateException</span> e) {
            <span class="keyword">return</span> handleBatchUpdateException(e)
        } <span class="keyword">catch</span> (<span class="exception">SQLException</span> e) {
            <span class="keyword">return</span> handleSQLException(e)
        } <span class="keyword">catch</span> (<span class="exception">NumberFormatException</span> e) {
            <span class="keyword">return</span> handleNumberFormatException(e)
        }
    }

    <span class="keyword">def</span> <span class="function">handleSQLException</span>(<span class="exception">SQLException</span> e) {
        render <span class="string"><span class="delimiter">'</span><span class="content">A SQLException Was Handled</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleBatchUpdateException</span>(<span class="exception">BatchUpdateException</span> e) {
        redirect <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">logging</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">batchProblem</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleNumberFormatException</span>(<span class="exception">NumberFormatException</span> nfe) {
        [<span class="key">problemDescription</span>: <span class="string"><span class="delimiter">'</span><span class="content">A Number Was Invalid</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>异常处理程序的方法名称可以是任何有效的方法名称。名称不是使方法成为异常处理程序的原因，<code>Exception</code> 参数类型是重要的部分。</p>
</div>
<div class="paragraph">
<p>异常处理程序方法可以执行控制器动作可以执行的任何操作，包括调用 <code>render</code>，<code>redirect</code>，返回模型等。</p>
</div>
<div class="paragraph">
<p>在多个控制器之间共享异常处理程序方法的一种方法是使用继承。异常处理程序方法被继承到子类中，因此应用程序可以在多个控制器从其扩展的抽象类中定义异常处理程序。在多个控制器之间共享异常处理程序方法的另一种方法是使用特征，如下所示&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/com/demo/DatabaseExceptionHandler.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.demo

trait DatabaseExceptionHandler {
    <span class="keyword">def</span> <span class="function">handleSQLException</span>(<span class="exception">SQLException</span> e) {
        <span class="comment">// handle SQLException</span>
    }

    <span class="keyword">def</span> <span class="function">handleBatchUpdateException</span>(<span class="exception">BatchUpdateException</span> e) {
        <span class="comment">// handle BatchUpdateException</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/com/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.demo

<span class="type">class</span> <span class="class">DemoController</span> <span class="directive">implements</span> DatabaseExceptionHandler {

    <span class="comment">// all of the exception handler methods defined</span>
    <span class="comment">// in DatabaseExceptionHandler will be added to</span>
    <span class="comment">// this class at compile time</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>异常处理程序方法必须在编译时出现。具体来说，不支持将运行时元编程到控制器类上的异常处理程序方法。</p>
</div>

<a name="7.2 Groovy &#26381;&#21153;&#39029;&#38754;&#65288;GSP&#65289;"><!-- Legacy link --></a>
<h2 id="gsp">8.2 Grails 服务器页面</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/gsp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://gsp.grails.org">Groovy Servers Pages</a>（简称GSP）是Grails的视图技术。 它旨在让ASP和JSP等技术的用户熟悉，但要更加灵活和直观。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
尽管GSP可以呈现任何格式，而不仅仅是HTML，但它是围绕呈现标记而设计的。 如果您正在寻找一种简化JSON响应的方法，请查看 <a href="webServices.html#jsonViews">JSON Views</a>。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>GSP位于 <code>grails-app/views</code> 目录中，通常自动（按惯例）或通过 <a href="../ref/Controllers/render.html">render</a> 方法呈现，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">render(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>GSP通常是标记和GSP标签的组合，有助于视图渲染。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
尽管可以在您的GSP中嵌入Groovy逻辑，并且在本文档中将对此进行介绍，但强烈建议不要这样做。 混合标记和代码是一件 <strong>bad</strong> 的事情，大多数GSP页面不包含代码，也不需要这样做。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>GSP通常具有一个"model"，该模型是用于视图渲染的一组变量。 该模型从控制器传递到GSP视图。 例如，考虑以下控制器操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个动作将查找一个 <code>Book</code> 实例，并创建一个包含名为 <code>book</code> 的键的模型。 然后可以使用名称 <code>book</code> 在GSP视图中引用此密钥：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span>{book.title}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
嵌入从用户输入中接收到的数据有使您的应用程序容易受到跨站点脚本（XSS）攻击的风险。 请阅读 <a href="security.html#xssPrevention">XSS预防</a>上的文档，以获取有关如何预防XSS攻击的信息。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>有关使用GSP的更多信息，请参阅 <a href="http://gsp.grails.org">dedicated GSP documentation</a>。</p>
</div>

<a name="7.4 URL &#26144;&#23556;"><!-- Legacy link --></a>
<h2 id="urlmappings">8.3 URL 映射</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>到目前为止，在整个文档中，用于URL的约定一直是默认的 <code>/controller/action/id</code> 。 然而，这个约定并不是硬性地嵌入到Grails中，实际上是由位于 <code>grails-app/controllers/mypackage/UrlMappings.groovy</code> 中的URL映射类控制的。</p>
</div>
<div class="paragraph">
<p><code>UrlMappings</code> 类包含一个名为 <code>mappings</code> 的属性，该属性已分配了代码块：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> mypackage

<span class="type">class</span> <span class="class">UrlMappings</span> {
    <span class="directive">static</span> mappings = {
    }
}</code></pre>
</div>
</div>

<a name="7.4.1 &#26144;&#23556;&#21040;&#25511;&#21046;&#22120;&#21644;&#25805;&#20316;"><!-- Legacy link --></a>
<h2 id="mappingToControllersAndActions">8.3.1 映射到控制器和操作</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/mappingToControllersAndActions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>要创建简单的映射，只需使用相对URL作为方法名，并为要映射到的控制器和操作指定命名参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>在本例中，我们将URL <code>/product</code> 映射到了 <code>ProductController</code> 的 <code>list</code> 操作。忽略要映射到控制器的默认操作的操作定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>另一种语法是指定要在传递给方法的块中使用的控制器和操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span> {
    controller = <span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>
    action = <span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>你使用哪种语法很大程度上取决于个人喜好。
如果所有映射都属于特定路径，则可以使用 <code>group</code> 方法对映射进行分组：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">group <span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span>, {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/apple</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>, <span class="key">id</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">apple</span><span class="delimiter">&quot;</span></span>)
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/htc</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>, <span class="key">id</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">htc</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>还可以创建嵌套的 <code>group</code> url映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">group <span class="string"><span class="delimiter">&quot;</span><span class="content">/store</span><span class="delimiter">&quot;</span></span>, {
    group <span class="string"><span class="delimiter">&quot;</span><span class="content">/product</span><span class="delimiter">&quot;</span></span>, {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要将一个URI重写为另一个显式URI（而不是控制器/操作对），请执行以下操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/hello</span><span class="delimiter">&quot;</span></span>(<span class="key">uri</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/hello.dispatch</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>在与其他框架集成时，重写特定的uri通常很有用。</p>
</div>

<a name="7.4.3 &#26144;&#23556;&#21040; REST &#36164;&#28304;"><!-- Legacy link --></a>
<h2 id="restfulMappings">8.3.2 映射到 REST 资源</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/restfulMappings.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>从Grails 2.3开始，可以创建RESTful URL映射，该映射按约定映射到控制器。 这样做的语法如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用 <code>resources</code> 参数定义基本URI和要映射到的控制器的名称。 上面的映射将产生以下URL：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Grails Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}/edit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果不确定为您的案例生成哪种映射，只需在grails控制台中运行命令 <code>url-mappings-report</code> 。 它将为您提供所有URL映射的简洁报告。</p>
</div>
<div class="paragraph">
<p>如果您希望包括或排除任何生成的URL映射，则可以使用 <code>includes</code> 或 <code>excludes</code> 参数来实现，该参数接受Grails操作的名称来包括或排除：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>, <span class="key">excludes</span>:[<span class="string"><span class="delimiter">'</span><span class="content">delete</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">update</span><span class="delimiter">'</span></span>])

or

<span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>, <span class="key">includes</span>:[<span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">show</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_显式rest映射">显式REST映射</h4>
<div class="paragraph">
<p>从Grails 3.1开始，如果您不希望依赖于 <code>resources</code> 映射来定义映射，则可以在任何URL映射之前加上HTTP方法名称（小写）以指示其适用的HTTP方法。 以下URL映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>相当于:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">get <span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>)
get <span class="string"><span class="delimiter">&quot;</span><span class="content">/books/create</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">create</span><span class="delimiter">&quot;</span></span>)
post <span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">save</span><span class="delimiter">&quot;</span></span>)
get <span class="string"><span class="delimiter">&quot;</span><span class="content">/books/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>)
get <span class="string"><span class="delimiter">&quot;</span><span class="content">/books/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">/edit</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span>)
put <span class="string"><span class="delimiter">&quot;</span><span class="content">/books/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>)
delete <span class="string"><span class="delimiter">&quot;</span><span class="content">/books/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">delete</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，HTTP方法名称是如何在每个URL映射定义之前添加前缀的。</p>
</div>
</div>
<div class="sect3">
<h4 id="_单一资源">单一资源</h4>
<div class="paragraph">
<p>单个资源是系统中只有一个资源（可能每个用户）的资源。 您可以使用 <code>single</code> 参数（而不是 <code>resources</code> ）创建单个资源：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/book</span><span class="delimiter">&quot;</span></span>(<span class="key">single</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致以下URL映射：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Grails Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/book/create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/book</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/book</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/book/edit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/book</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/book</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>主要区别在于该ID不包含在URL映射中。</p>
</div>
</div>
<div class="sect3">
<h4 id="_嵌套资源">嵌套资源</h4>
<div class="paragraph">
<p>您可以嵌套资源映射以生成子资源。 例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>) {
  <span class="string"><span class="delimiter">&quot;</span><span class="content">/authors</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>以上将导致以下URL映射:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">Grails Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/authors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/authors/create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/authors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/authors/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/authors/edit/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/authors/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/authors/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>您还可以在资源映射中嵌套常规URL映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>) {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/publisher</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致以下URL可用：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">Grails Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${bookId}/publisher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>要在资源下方直接映射URI，请使用收集块：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>) {
    collection {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">/publisher</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致以下URL可用（不带ID）：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">URL</th>
<th class="tableblock halign-left valign-top">Grails Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/publisher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_链接到restful映射">链接到RESTful映射</h4>
<div class="paragraph">
<p>您可以链接到Grails提供的 <code>g:link</code> 标签创建的任何URL映射，只需引用要链接到的控制器和操作即可：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link controller=<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>&gt;My Link&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>为了方便起见，您还可以将域实例传递给 <code>link</code> 标签的 <code>resource</code> 属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link resource=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>book<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;My Link&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将自动产生正确的链接(在本例中，ID为"1"的是"/books/1")。</p>
</div>
<div class="paragraph">
<p>嵌套资源的情况略有不同，因为它们通常需要两个标识符（资源的ID和嵌套在其中的ID）。 例如，给定嵌套资源：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>) {
  <span class="string"><span class="delimiter">&quot;</span><span class="content">/authors</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果希望链接到 <code>author</code> 控制器的 <code>show</code> 动作，则可以这样写：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Results in /books/1/authors/2</span>
&lt;<span class="key">g</span>:link controller=<span class="string"><span class="delimiter">&quot;</span><span class="content">author</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span> method=<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span> params=<span class="string"><span class="delimiter">&quot;</span><span class="content">[bookId:1]</span><span class="delimiter">&quot;</span></span> id=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>&gt;The Author&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，为了更加简洁，链接标记有一个 <code>resource</code> 属性，可以代替使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Results in /books/1/authors/2</span>
&lt;<span class="key">g</span>:link resource=<span class="string"><span class="delimiter">&quot;</span><span class="content">book/author</span><span class="delimiter">&quot;</span></span> action=<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span> bookId=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> id=<span class="string"><span class="delimiter">&quot;</span><span class="content">2</span><span class="delimiter">&quot;</span></span>&gt;My Link&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>resource属性接受以斜杠(在本例中为"book/author")分隔的资源路径。 标签的属性可用于指定必要的 <code>bookId</code> 参数。</p>
</div>
</div>

<a name="7.4.2 URL &#26144;&#23556;&#20013;&#30340;&#37325;&#23450;&#21521;"><!-- Legacy link --></a>
<h2 id="redirectMappings">8.3.3 在 URL 映射中重定向</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/redirectMappings.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>从Grails 2.3开始，可以定义用于指定重定向的URL映射。当URL映射指定重定向时，只要映射与传入请求匹配，就会使用该映射提供的信息启动重定向。</p>
</div>
<div class="paragraph">
<p>当URL映射指定重定向时，该映射必须提供表示要重定向到的URI的字符串，或者必须提供表示重定向目标的Map。 该Map的结构就像该Map可以作为参数传递给控制器中的 <code>redirect</code> 方法一样。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/viewBooks</span><span class="delimiter">&quot;</span></span>(<span class="key">redirect</span>: <span class="string"><span class="delimiter">'</span><span class="content">/books/list</span><span class="delimiter">'</span></span>)
<span class="string"><span class="delimiter">&quot;</span><span class="content">/viewAuthors</span><span class="delimiter">&quot;</span></span>(<span class="key">redirect</span>: [<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">author</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>])
<span class="string"><span class="delimiter">&quot;</span><span class="content">/viewPublishers</span><span class="delimiter">&quot;</span></span>(<span class="key">redirect</span>: [<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">publisher</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>, <span class="key">permanent</span>: <span class="predefined-constant">true</span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>原始请求中包含的请求参数将包含在重定向中。</p>
</div>

<a name="7.4.4 &#23884;&#20837;&#24335;&#21464;&#37327;"><!-- Legacy link --></a>
<h2 id="embeddedVariables">8.3.4 嵌入式变量</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/embeddedVariables.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_简单变量">简单变量</h4>
<div class="paragraph">
<p>上一节演示了如何使用具体的"令牌"映射简单的URL。在URL映射中，令牌是每个斜杠'/'之间的字符序列。具体的令牌是定义良好的令牌，例如 <code>/product</code>。但是，在许多情况下，直到运行时您都不知道特定令牌的值。 在这种情况下，您可以在URL中使用变量占位符，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
  <span class="string"><span class="delimiter">&quot;</span><span class="content">/product/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，通过将$id变量作为第二个令牌嵌入，Grails会自动将第二个令牌映射到名为 <code>id</code> 的参数（可通过链接： <a href="../ref/Controllers/params.html">params</a> 对象获得）。例如，在给定URL <code>/product/MacBook</code> 的情况下，以下代码会将"MacBook"呈现给响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ProductController</span> {
     <span class="keyword">def</span> <span class="function">index</span>() { render params.id }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您当然可以构造更复杂的映射示例。例如，传统的博客URL格式可以按以下方式映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>blog</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>year</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>month</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>day</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的映射使您可以执行以下操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/graemerocher/2007/01/10/my_funky_blog_entry</code></pre>
</div>
</div>
<div class="paragraph">
<p>URL中的各个标记将再次映射到链接:<a href="../ref/Controllers/params.html">params</a>对象，其值可用于 <code>year</code>,<code>month</code>,<code>day</code>,<code>id</code> 等等。</p>
</div>
</div>
<div class="sect3">
<h4 id="_动态控制器和动作名称">动态控制器和动作名称</h4>
<div class="paragraph">
<p>变量也可以用于动态构造控制器和动作名称。实际上，默认的Grails URL映射使用此技术：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>action</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?</span><span class="delimiter">&quot;</span></span>()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里，控制器的名称，动作和ID是从嵌入在URL中的变量 <code>controller</code>,<code>action</code> 和 <code>id</code> 隐式获得的。</p>
</div>
<div class="paragraph">
<p>您还可以使用闭包来解析控制器名称和操作名称以动态执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="delimiter">&quot;</span></span> {
        action = { params.goHere }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_可选变量">可选变量</h4>
<div class="paragraph">
<p>默认映射的另一个特征是附加？的能力。在变量的末尾使其成为可选标记。 在另一个示例中，可以将该技术应用于博客URL映射以具有更灵活的链接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>blog</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>year</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>month</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>day</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过此映射，所有这些URL仅与链接中所填充的相关参数相匹配：<a href="../ref/Controllers/params.html">params</a>对象：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>/graemerocher/2007/01/10/my_funky_blog_entry
/graemerocher/2007/01/10
/graemerocher/2007/01
/graemerocher/2007
/graemerocher</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_可选文件扩展名">可选文件扩展名</h4>
<div class="paragraph">
<p>如果您希望捕获特定路径的扩展名，则存在一种特殊情况的映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>action</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?(.</span><span class="inline"><span class="inline-delimiter">$</span>format</span><span class="content">)?</span><span class="delimiter">&quot;</span></span>()</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过添加 <code>(.$format)?</code> 映射，您可以使用控制器中的 <code>response.format</code> 属性来访问文件扩展名：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">index</span>() {
    render <span class="string"><span class="delimiter">&quot;</span><span class="content">extension is </span><span class="inline"><span class="inline-delimiter">${</span>response.format<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_任意变量">任意变量</h4>
<div class="paragraph">
<p>您还可以通过在传递给映射的块中设置任意参数，将URL映射中的任意参数传递给控制器​​</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/holiday/win</span><span class="delimiter">&quot;</span></span> {
     id = <span class="string"><span class="delimiter">&quot;</span><span class="content">Marrakech</span><span class="delimiter">&quot;</span></span>
     year = <span class="integer">2007</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该变量将在传递给控制器的<a href="../ref/Controllers/params.html">params</a>对象中可用。</p>
</div>
</div>
<div class="sect3">
<h4 id="_动态解析变量">动态解析变量</h4>
<div class="paragraph">
<p>硬编码的任意变量很有用，但是有时您需要根据运行时因素来计算变量的名称。通过将块分配给变量名称，这也是可行的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/holiday/win</span><span class="delimiter">&quot;</span></span> {
     id = { params.id }
     isEligible = { session.user != <span class="predefined-constant">null</span> } <span class="comment">// must be logged in</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上述情况下，当URL实际匹配时，将解析块中的代码，因此可以与各种逻辑结合使用。</p>
</div>
</div>

<a name="7.4.5 &#26144;&#23556;&#21040;&#35270;&#22270;"><!-- Legacy link --></a>
<h2 id="mappingToViews">8.3.5 映射到视图</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/mappingToViews.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>您可以将URL解析为不涉及控制器或操作的视图。例如，要将根URL <code>/</code> 映射到位于 <code>grails-app/views/index.GSP</code> 位置的GSP，可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/index</span><span class="delimiter">&quot;</span></span>)  <span class="comment">// map the root URL</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，如果需要特定于给定控制器的视图，可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">/help</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">site</span><span class="delimiter">&quot;</span></span>, <span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">help</span><span class="delimiter">&quot;</span></span>) <span class="comment">// to a view for a controller</span>
}</code></pre>
</div>
</div>

<a name="7.4.6 &#26144;&#23556;&#21040;&#21709;&#24212;&#20195;&#30721;"><!-- Legacy link --></a>
<h2 id="mappingToResponseCodes">8.3.6 映射到响应代码</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/mappingToResponseCodes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails还允许您将HTTP响应代码映射到控制器、操作或视图。只需使用与您感兴趣的响应代码匹配的方法名：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">403</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">forbidden</span><span class="delimiter">&quot;</span></span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">404</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">notFound</span><span class="delimiter">&quot;</span></span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">serverError</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者可以指定自定义错误页：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">403</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/errors/forbidden</span><span class="delimiter">&quot;</span></span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">404</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/errors/notFound</span><span class="delimiter">&quot;</span></span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/errors/serverError</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_声明式错误处理">声明式错误处理</h4>
<div class="paragraph">
<p>此外，还可以为个别异常配置处理程序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">403</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/errors/forbidden</span><span class="delimiter">&quot;</span></span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">404</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/errors/notFound</span><span class="delimiter">&quot;</span></span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">illegalArgument</span><span class="delimiter">&quot;</span></span>,
         <span class="key">exception</span>: <span class="exception">IllegalArgumentException</span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">nullPointer</span><span class="delimiter">&quot;</span></span>,
         <span class="key">exception</span>: <span class="exception">NullPointerException</span>)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">customException</span><span class="delimiter">&quot;</span></span>,
         <span class="key">exception</span>: MyException)
   <span class="string"><span class="delimiter">&quot;</span><span class="content">500</span><span class="delimiter">&quot;</span></span>(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/errors/serverError</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用此配置，<code>ErrorsController</code> 中的 <code>illegalArgument</code> 操作将处理 <code>illegalArgument</code> 异常，<code>NullPointerException</code> 操作将处理 <code>nullPointer</code> 异常，<code>MyException</code> 操作将处理 <code>customException</code> 。其他异常将由catch all规则处理，并使用 <code>/errors/serverError</code> 视图。</p>
</div>
<div class="paragraph">
<p>您可以使用请求的 <code>exception</code> 属性从自定义错误处理视图或控制器操作访问异常，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ErrorController</span> {
    <span class="keyword">def</span> <span class="function">handleError</span>() {
        <span class="keyword">def</span> exception = request.exception
        <span class="comment">// perform desired processing to handle the exception</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
如果您的错误处理控制器操作也引发了异常，则最终将导致 <code>StackOverflowException</code> 。
</td>
</tr>
</table>
</div>
</div>

<a name="7.4.7 &#26144;&#23556;&#21040; HTTP &#26041;&#27861;"><!-- Legacy link --></a>
<h2 id="mappingHTTP">8.3.7 映射到 HTTP 方法</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/mappingHTTP.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>URL映射也可以配置为基于HTTP方法（GET、POST、PUT或DELETE）进行映射。这对于restfulapi和基于HTTP方法的限制映射非常有用。
例如，以下映射为 <code>ProductController</code> 提供了RESTful API URL映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">/product/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">product</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">update</span><span class="delimiter">&quot;</span></span>, <span class="key">method</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">PUT</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，如果在URL映射中指定了GET以外的HTTP方法，则在创建相应链接时还必须指定该方法，方法是将 <code>method</code> 参数传递给 <code>g:link</code> 或 <code>g:createLink</code> ，以获取所需格式的链接。</p>
</div>

<a name="7.4.8 &#36890;&#37197;&#31526;&#26144;&#23556;"><!-- Legacy link --></a>
<h2 id="mappingWildcards">8.3.8 映射通配符</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/mappingWildcards.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails的URL映射机制也支持通配符映射。例如，考虑以下映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/images/*.jpg</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>此映射将匹配到诸如 <code>/image/logo.jpg</code> 等图像的所有路径。当然，使用变量也可以达到同样的效果：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/images/</span><span class="inline"><span class="inline-delimiter">$</span>name</span><span class="content">.jpg</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，也可以使用双通配符来匹配以下多个级别：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/images/**.jpg</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，映射将匹配 <code>/image/logo.jpg</code> 和 <code>/image/other/logo.jpg</code> 。最好使用双通配符变量：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="comment">// will match /image/logo.jpg and /image/other/logo.jpg</span>
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/images/</span><span class="inline"><span class="inline-delimiter">$</span>name</span><span class="content">**.jpg</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">image</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，它会将通配符匹配的路径存储在从<a href="../ref/Controllers/params.html">params</a>对象获取的 <code>name</code> 参数中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> name = params.name
println name <span class="comment">// prints &quot;logo&quot; or &quot;other/logo&quot;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用通配符URL映射，则可能需要从Grails的URL映射过程中排除某些uri。为此，可以在 <code>UrlMappings.groovy</code> 类中提供 <code>excludes</code> 设置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UrlMappings</span> {
    <span class="directive">static</span> excludes = [<span class="string"><span class="delimiter">&quot;</span><span class="content">/images/*</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">/css/*</span><span class="delimiter">&quot;</span></span>]
    <span class="directive">static</span> mappings = {
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，Grails不会尝试匹配以 <code>/images</code> 或 <code>/css</code> 开头的任何uri</p>
</div>

<a name="7.4.9 &#33258;&#21160;&#38142;&#25509;&#37325;&#20889;"><!-- Legacy link --></a>
<h2 id="automaticLinkRewriting">8.3.9 自动链接重写</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/automaticLinkRewriting.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>URL映射的另一个重要功能是它们会自动自定义链接的行为 <a href="http://gsp.grails.org/latest/ref/Tags/link.html">link</a>标记，以便更改映射不需要您去更改所有链接。</p>
</div>
<div class="paragraph">
<p>这是通过URL重写技术完成的，该技术对URL映射中的链接进行了反向工程。 因此，在前面的部分中给出了一个类似博客的映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>blog</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>year</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>month</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>day</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果按如下方式使用链接标记：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:link</span> <span class="attribute-name">controller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">params</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[blog:'fred', year:2007]</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    My Blog
<span class="tag">&lt;/g:link&gt;</span>

<span class="tag">&lt;g:link</span> <span class="attribute-name">controller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>
        <span class="attribute-name">params</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[blog:'fred', year:2007, month:10]</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    My Blog - October 2007 Posts
<span class="tag">&lt;/g:link&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails将自动以正确的格式重写URL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/fred/2007</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>My Blog<span class="tag">&lt;/a&gt;</span>
<span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/fred/2007/10</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>My Blog - October 2007 Posts<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>

<a name="7.4.10 &#24212;&#29992;&#32422;&#26463;"><!-- Legacy link --></a>
<h2 id="applyingConstraints">8.3.10 应用约束</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/applyingConstraints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>网址映射还支持Grails的统一 <a href="validation.html#constraints">validation constraints</a> 机制，这样可以进一步"constrain"URL的匹配方式。例如，如果我们重新访问之前的博客示例代码， 当前的映射如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>blog</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>year</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>month</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>day</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这允许以下URL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/graemerocher/2007/01/10/my_funky_blog_entry</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，它还允许</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/graemerocher/not_a_year/not_a_month/not_a_day/my_funky_blog_entry</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是有问题的,因为它迫使您在控制器代码中进行一些巧妙的解析。幸运的是，可以限制URL映射以进一步验证URL令牌：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>blog</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>year</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>month</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>day</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?</span><span class="delimiter">&quot;</span></span> {
     controller = <span class="string"><span class="delimiter">&quot;</span><span class="content">blog</span><span class="delimiter">&quot;</span></span>
     action = <span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>
     constraints {
          year(<span class="key">matches</span>:<span class="regexp"><span class="delimiter">/</span><span class="char">\\</span><span class="char">\d</span><span class="content">{4}</span><span class="delimiter">/</span></span>)
          month(<span class="key">matches</span>:<span class="regexp"><span class="delimiter">/</span><span class="char">\\</span><span class="char">\d</span><span class="content">{2}</span><span class="delimiter">/</span></span>)
          day(<span class="key">matches</span>:<span class="regexp"><span class="delimiter">/</span><span class="char">\\</span><span class="char">\d</span><span class="content">{2}</span><span class="delimiter">/</span></span>)
     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，约束条件可确保 <code>year</code> , <code>month</code> 和 <code>day</code> 参数匹配特定的有效模式,从而减轻了您以后的负担。</p>
</div>

<a name="7.4.11 &#21629;&#21517; URL &#26144;&#23556;"><!-- Legacy link --></a>
<h2 id="namedMappings">8.3.11 命名 URL 映射</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/namedMappings.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>URL映射还支持命名映射，即具有与其关联名称的映射。该名称可用于在生成链接时引用特定映射。
定义命名映射的语法如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
   name &lt;mapping name&gt;: &lt;url pattern&gt; {
      <span class="comment">// ...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    name <span class="key">personList</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/showPeople</span><span class="delimiter">&quot;</span></span> {
        controller = <span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>
        action = <span class="string"><span class="delimiter">'</span><span class="content">list</span><span class="delimiter">'</span></span>
    }
    name <span class="key">accountDetails</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/details/</span><span class="inline"><span class="inline-delimiter">$</span>acctNumber</span><span class="delimiter">&quot;</span></span> {
        controller = <span class="string"><span class="delimiter">'</span><span class="content">product</span><span class="delimiter">'</span></span>
        action = <span class="string"><span class="delimiter">'</span><span class="content">accountDetails</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>映射可以在GSP中的链接标记中引用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:link</span> <span class="attribute-name">mapping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">personList</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>List People<span class="tag">&lt;/g:link&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/showPeople</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>List People<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用params属性指定参数。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:link</span> <span class="attribute-name">mapping</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">accountDetails</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">params</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[acctNumber:'8675309']</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    Show Account
<span class="tag">&lt;/g:link&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/details/8675309</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Show Account<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，可以使用链接命名空间引用命名映射。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;link:personList&gt;</span>List People<span class="tag">&lt;/link:personList&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/showPeople</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>List People<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>链接命名空间方法允许将参数指定为属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;link:accountDetails</span> <span class="attribute-name">acctNumber</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8675309</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Show Account<span class="tag">&lt;/link:accountDetails&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/details/8675309</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Show Account<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>若要指定应应用于生成的 <code>href</code> 的属性，请指定 <code>attrs</code> 属性的 <code>Map</code> 值。这些属性将直接应用于href，而不是作为请求参数传递</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;link:accountDetails</span> <span class="attribute-name">attrs</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">[class: 'fancy']</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">acctNumber</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">8675309</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    Show Account
<span class="tag">&lt;/link:accountDetails&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;a</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/details/8675309</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fancy</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>Show Account<span class="tag">&lt;/a&gt;</span></code></pre>
</div>
</div>


<h2 id="customizingUrlFormat">8.3.12 自定义 URL 格式</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/customizingUrlFormat.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>默认的URL映射机制在URL中支持驼峰式案例名称。在名为 <code>MathHelperController</code> 的控制器中访问名为 <code>addNumbers</code> 的操作的默认URL将类似于 <code>/mathHelper/addNumbers</code> 。 Grails允许对此模式进行自定义，并提供了一种实现，该实现使用支持 <code>/math-helper/add-numbers</code> 之类的URL的连字符约定代替了驼峰大小写约定。要启用带连字符的URL，请为 <code>grails-app/conf/application.groovy</code> 中的 <code>grails.web.url.converter</code> 属性分配"hyphenated"值。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.web.url.converter = <span class="string"><span class="delimiter">'</span><span class="content">hyphenated</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以通过提供一个实现<a href="http://docs.grails.org/4.0.0/api/grails/web/UrlConverter.html">UrlConverter</a>接口的类，然后将该类的实例添加到具有bean名称为 <code>grails.web.UrlConverter</code> 的Spring应用程序上下文中，来插入任意策略。如果Grails在上下文中找到具有该名称的bean，它将用作默认转换器，无需为 <code>grails.web.url.converter</code> config属性分配值。</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/com/myapplication/MyUrlConverterImpl.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.myapplication

<span class="type">class</span> <span class="class">MyUrlConverterImpl</span> <span class="directive">implements</span> grails.web.UrlConverter {

    <span class="predefined-type">String</span> toUrlElement(<span class="predefined-type">String</span> propertyOrClassName) {
        <span class="comment">// return some representation of a property or class name that should be used in URLs...</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>grails.web.UrlConverter.BEAN_NAME<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>(com.myapplication.MyUrlConverterImpl)
}</code></pre>
</div>
</div>


<h2 id="namespacedControllers">8.3.13 控制器的命名空间</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/urlmappings/namespacedControllers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果应用程序定义多个具有相同名称的控制器 在不同的包中，控制器必须在名称空间。为控制器定义命名空间的方法是
在控制器中定义一个名为 <code>namespace</code> 的静态属性，并将字符串分配给表示名称空间的属性。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/com/app/reporting/AdminController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.app.reporting

<span class="type">class</span> <span class="class">AdminController</span> {

    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">reports</span><span class="delimiter">'</span></span>

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/com/app/security/AdminController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.app.security

<span class="type">class</span> <span class="class">AdminController</span> {

    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">users</span><span class="delimiter">'</span></span>

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在定义应该与命名空间控制器关联的URL映射时，<code>namespace</code> 变量必须是URL映射的一部分。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UrlMappings</span> {

    <span class="directive">static</span> mappings = {
        <span class="string"><span class="delimiter">'</span><span class="content">/userAdmin</span><span class="delimiter">'</span></span> {
            controller = <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>
            namespace = <span class="string"><span class="delimiter">'</span><span class="content">users</span><span class="delimiter">'</span></span>
        }

        <span class="string"><span class="delimiter">'</span><span class="content">/reportAdmin</span><span class="delimiter">'</span></span> {
            controller = <span class="string"><span class="delimiter">'</span><span class="content">admin</span><span class="delimiter">'</span></span>
            namespace = <span class="string"><span class="delimiter">'</span><span class="content">reports</span><span class="delimiter">'</span></span>
        }

        <span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>namespace</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>action</span><span class="content">?</span><span class="delimiter">&quot;</span></span>()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>反向URL映射还要求指定 <code>namespace</code> 。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:link controller=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> namespace=<span class="string"><span class="delimiter">&quot;</span><span class="content">reports</span><span class="delimiter">&quot;</span></span>&gt;Click For Report Admin&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span><span class="error">
</span>&lt;<span class="key">g</span>:link controller=<span class="string"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span> namespace=<span class="string"><span class="delimiter">&quot;</span><span class="content">users</span><span class="delimiter">&quot;</span></span>&gt;Click For User Admin&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:link&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在解析到命名空间控制器的URL映射（正向或反向）时，仅当提供了 <code>namespace</code> 时，映射才会匹配。 如果应用程序在不同的程序包中提供了多个具有相同名称的控制器，则最多可以定义其中1个而没有 <code>namespace</code> 属性。 如果存在多个没有定义 <code>namespace</code> 属性的同名控制器，则框架将不知道如何区分它们以进行正向或反向映射。</p>
</div>
<div class="paragraph">
<p>允许应用程序使用为控制器提供与应用程序提供的控制器同名的插件，并且只要控制器位于单独的程序包中，两个控制器都不能定义 <code>namespace</code> 属性。 例如，应用程序可以包括名为 <code>com.accounting.ReportingController</code> 的控制器，并且该应用程序可以使用提供名为 <code>com.humanresources.ReportingController</code> 的控制器的插件。 唯一的问题是插件所提供的控制器的URL映射在指定映射适用于插件所提供的 <code>ReportingController</code> 时需要明确。</p>
</div>
<div class="paragraph">
<p>请参见以下示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/accountingReports</span><span class="delimiter">&quot;</span></span> {
        controller = <span class="string"><span class="delimiter">&quot;</span><span class="content">reporting</span><span class="delimiter">&quot;</span></span>
    }
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/humanResourceReports</span><span class="delimiter">&quot;</span></span> {
        controller = <span class="string"><span class="delimiter">&quot;</span><span class="content">reporting</span><span class="delimiter">&quot;</span></span>
        plugin = <span class="string"><span class="delimiter">&quot;</span><span class="content">humanResources</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了该映射后，对 <code>/accountingReports</code> 的请求将
由 <code>ReportingController</code> 定义应用。对 <code>/humanResourceReports</code> 的请求将被处理，
由 <code>humanResources</code> 插件提供的 <code>ReportingController</code> 插入。</p>
</div>
<div class="paragraph">
<p>任意数量的插件可以提供任意数量的 <code>ReportingController</code> 控制器，但是即使在单独的程序包中定义了插件，也不能提供一个以上的 <code>ReportingController</code> 控制器。</p>
</div>
<div class="paragraph">
<p>仅当应用程序和/或插件提供的运行时有多个具有相同名称的控制器可用时，才需要为映射中的 <code>plugin</code> 变量分配一个值。如果 <code>humanResources</code> 插件提供了 <code>ReportingController</code> 并且存在在运行时没有其他 <code>ReportingController</code> 可用，以下映射将起作用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> mappings = {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/humanResourceReports</span><span class="delimiter">&quot;</span></span> {
        controller = <span class="string"><span class="delimiter">&quot;</span><span class="content">reporting</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>最好的做法是明确说明控制器由插件提供。</p>
</div>


<h2 id="cors">8.4 CORS</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/cors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Spring Boot提供了开箱即用的CORS支持，但是由于使用UrlMappings而不是用于定义URL的注释的方式，因此在Grails应用程序中进行配置很困难。 从Grails 3.2.1开始，我们添加了一种在Grails应用程序中有意义的配置CORS的方法。</p>
</div>
<div class="paragraph">
<p>启用后，默认设置为“全开”。</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">cors</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将产生到所有URL <code>/ **</code> 的映射，其中：</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedOrigins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['*']</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedMethods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['*']</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['*']</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exposedHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1800</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowCredentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>其中一些设置直接来自Spring Boot，并且可以在将来的版本中进行更改。 请参阅link:https://docs.spring.io/spring/docs/current/javadoc-api//org/springframework/web/cors/CorsConfiguration.html#applyPermitDefaultValues [Spring CORS配置文档]</p>
</div>
<div class="paragraph">
<p>所有这些设置都可以轻松覆盖。</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">cors</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">allowedOrigins</span>:
            - <span class="string"><span class="content">http://localhost:5000</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，<code>allowedOrigins</code> 设置将替换 <code>[*]</code>。</p>
</div>
<div class="paragraph">
<p>您还可以配置其他URL。</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">cors</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">allowedHeaders</span>:
            - <span class="string"><span class="content">Content-Type</span></span>
        <span class="key">mappings</span>:
            <span class="error">/api/**</span>:
                <span class="key">allowedOrigins</span>:
                    - <span class="string"><span class="content">http://localhost:5000</span></span>
                <span class="comment"># Other configurations not specified default to the global config</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
指定至少一个映射将禁用全局映射（<code>/**</code>）的创建。 如果希望保留该设置，则应将其与其他映射一起指定。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>上面的设置将产生具有以下设置的 <code>/api/**</code> 的单个映射：</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 40%;">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedOrigins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['http://localhost:5000']</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedMethods</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['*']</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowedHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>['Content-Type']</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">exposedHeaders</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>null</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxAge</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>1800</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">allowCredentials</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>如果您不想覆盖任何默认设置，而只想指定URL，则可以像下面的示例所示：</p>
</div>
<div class="listingblock">
<div class="title">application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">cors</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span>
        <span class="key">mappings</span>:
            <span class="error">/api/**</span>: <span class="error">inherit</span></code></pre>
</div>
</div>

<a name="7.1.5 &#25511;&#21046;&#22120;&#25318;&#25130;&#22120;"><!-- Legacy link --></a>
<h2 id="interceptors">8.5 拦截器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/interceptors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails使用以下链接提供独立的拦截器 <a href="../ref/Command％20Line/create-interceptor.html">create-interceptor</a> 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-interceptor MyInterceptor</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的命令将在 <code>grails-app/controllers</code> 目录中创建一个拦截器，其默认内容如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyInterceptor</span> {

  <span class="type">boolean</span> before() { <span class="predefined-constant">true</span> }

  <span class="type">boolean</span> after() { <span class="predefined-constant">true</span> }

  <span class="type">void</span> afterView() {
    <span class="comment">// no-op</span>
  }

}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_拦截器与过滤器">拦截器与过滤器</h4>
<div class="paragraph">
<p>在Grails 3.0之前的Grails版本中，Grails支持过滤器的概念。 为了向后兼容，仍支持这些功能，但认为已弃用。</p>
</div>
<div class="paragraph">
<p>Grails 3.0中的新拦截器概念在许多方面都具有优越性，最重要的是，拦截器可以使用Groovy的 <code>CompileStatic</code> 批注来优化性能（这很关键，因为对于每个请求都可以执行拦截器。）</p>
</div>
</div>


<h2 id="definingInterceptors">8.5.1 定义拦截器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/interceptors/definingInterceptors.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>默认情况下，拦截器将匹配具有相同名称的控制器。 例如,如果有一个名为 <code>BookInterceptor</code> 的拦截器，那么所有对 <code>BookInterceptor</code> 动作的请求都将触发该拦截器。
<code>Interceptor</code> 实现了 <a href="http://docs.grails.org/4.0.0/api/grails/artefact/Interceptor.html">Interceptor</a> 特征，并提供了3种可用于拦截请求的方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/**
 * Executed before a matched action
 *
 * @return Whether the action should continue and execute
 */</span>
<span class="type">boolean</span> before() { <span class="predefined-constant">true</span> }

<span class="comment">/**
 * Executed after the action executes but prior to view rendering
 *
 * @return True if view rendering should continue, false otherwise
 */</span>
<span class="type">boolean</span> after() { <span class="predefined-constant">true</span> }

<span class="comment">/**
 * Executed after view rendering completes
 */</span>
<span class="type">void</span> afterView() {}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如上所述, <code>before</code> 方法在动作之前执行，并且可以通过返回 <code>false</code> 来取消动作的执行。</p>
</div>
<div class="paragraph">
<p>在操作执行后执行 <code>after</code> 方法，如果返回false，则可以暂停视图渲染。<code>after</code> 方法也可以分别使用 <code>view</code> 属性和 <code>model</code> 属性来修改视图或模型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">boolean</span> after() {
  model.foo = <span class="string"><span class="delimiter">&quot;</span><span class="content">bar</span><span class="delimiter">&quot;</span></span> <span class="comment">// add a new model attribute called 'foo'</span>
  view = <span class="string"><span class="delimiter">'</span><span class="content">alternate</span><span class="delimiter">'</span></span> <span class="comment">// render a different view called 'alternate'</span>
  <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>视图渲染完成后,将执行 <code>afterView</code> 方法。 如果发生异常，则可以使用 <a href="http://docs.grails.org/4.0.0/api/grails/artefact/Interceptor.html">Interceptor</a> 特性的 <code>throwable</code> 属性来使用该异常。</p>
</div>


<h2 id="interceptorMatching">8.5.2 将请求与拦截器匹配</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/interceptors/interceptorMatching.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如上一节所述，默认情况下，拦截器将按照约定仅将请求匹配到关联的控制器。 但是，可以使用 <a href="http://docs.grails.org/4.0.0/api/grails/artefact/Interceptor.html">Interceptor API</a> 中定义的 <code>match</code> 方法或 <code>matchAll</code> 方法将拦截器配置为匹配任何请求.</p>
</div>
<div class="paragraph">
<p>匹配方法返回 <a href="http://docs.grails.org/4.0.0/api/grails/interceptors/Matcher.html">Matcher</a> 实例，该实例可用于配置拦截器如何匹配请求。</p>
</div>
<div class="paragraph">
<p>例如，以下拦截器将匹配除 <code>login</code> 请求外的所有请求：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthInterceptor</span> {
  AuthInterceptor() {
    matchAll()
    .excludes(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>)
  }

  <span class="type">boolean</span> before() {
    <span class="comment">// perform authentication</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>还可以使用命名参数执行匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LoggingInterceptor</span> {
  LoggingInterceptor() {
    match(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>) <span class="comment">// using strings</span>
    match(<span class="key">controller</span>: ~<span class="regexp"><span class="delimiter">/</span><span class="content">(author|publisher)</span><span class="delimiter">/</span></span>) <span class="comment">// using regex</span>
  }

  <span class="type">boolean</span> before() {
    ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用拦截器中定义的任意数量的匹配器。 它们将按照定义的顺序执行。 例如，上述拦截器将与以下所有匹配：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当调用 <code>BookController</code> 的 <code>show</code> 动作时</p>
</li>
<li>
<p>调用 <code>AuthorController</code> 或 <code>PublisherController</code> 时</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>除 <code>uri</code> 外，所有命名参数均接受String或Regex表达式。 <code>uri</code> 参数支持与Spring的<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/AntPathMatcher.html">AntPathMatcher</a> 兼容的String路径。  可能的命名参数为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>namespace</code> -控制器的名称空间</p>
</li>
<li>
<p><code>controller</code> -控制器的名称</p>
</li>
<li>
<p><code>action</code> -操作的名称</p>
</li>
<li>
<p><code>method</code> -HTTP方法</p>
</li>
<li>
<p><code>uri</code> -请求的URI。 如果使用此参数，则所有其他参数将被忽略，仅使用此参数。</p>
</li>
</ul>
</div>


<h2 id="interceptorOrdering">8.5.3 定义拦截器执行顺序</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/interceptors/interceptorOrdering.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>可以通过定义定义优先级的 <code>order</code> 属性来对拦截器进行排序。</p>
</div>
<div class="paragraph">
<p>例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthInterceptor</span> {

  <span class="type">int</span> order = HIGHEST_PRECEDENCE

  ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>order</code> 属性的默认值为0。拦截器的执行顺序是通过按升序对 <code>order</code> 属性进行排序并首先执行编号最低的拦截器来确定的。</p>
</div>
<div class="paragraph">
<p>值 <code>HIGHEST_PRECEDENCE</code> 和 <code>LOWEST_PRECEDENCE</code> 可用于定义应分别首先运行或最后运行的过滤器。</p>
</div>
<div class="paragraph">
<p>请注意，如果编写供他人使用的拦截器，最好增加或减少 <code>HIGHEST_PRECEDENCE</code> 和 <code>LOWEST_PRECEDENCE</code>，以允许在您编写的拦截器之前或之后插入其他拦截器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">int</span> order = HIGHEST_PRECEDENCE + <span class="integer">50</span>

<span class="comment">// or</span>

<span class="type">int</span> order = LOWEST_PRECEDENCE - <span class="integer">50</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要找出拦截器的计算顺序，可以将调试记录器添加到 <code>logback.groovy</code> 中，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">logger <span class="string"><span class="delimiter">'</span><span class="content">grails.artefact.Interceptor</span><span class="delimiter">'</span></span>, DEBUG, [<span class="string"><span class="delimiter">'</span><span class="content">STDOUT</span><span class="delimiter">'</span></span>], <span class="predefined-constant">false</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用 <code>grails-app/conf/application.yml</code> 中的bean覆盖配置覆盖所有拦截器的默认顺序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">beans</span>:
  <span class="key">authInterceptor</span>:
    <span class="key">order</span>: <span class="integer">50</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>或者使用 <code>grails-app/conf/application.groovy</code> :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans {
  authInterceptor {
    order = <span class="integer">50</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>因此，您可以完全控制拦截器的执行顺序。</p>
</div>

<a name="7.8 &#20869;&#23481;&#21327;&#21830;"><!-- Legacy link --></a>
<h2 id="contentNegotiation">8.6 内容协商</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/contentNegotiation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails使用HTTP <code>Accept</code> 标头，显式格式请求参数或映射URI的扩展名内置了对 <a href="http://en.wikipedia.org/wiki/Content_negotiation">Content negotiation</a>的支持。</p>
</div>
<div class="sect3">
<h4 id="_配置mime类型">配置Mime类型</h4>
<div class="paragraph">
<p>在开始进行内容协商之前，您需要告诉Grails您希望支持哪些内容类型。 默认情况下，Grails使用 <code>grails.mime.types</code> 设置在 <code>grails-app/conf/application.yml</code> 中配置了多种不同的内容类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">mime</span>:
        <span class="key">types</span>:
            <span class="key">all</span>: <span class="string"><span class="content">'*/*'</span></span>
            <span class="key">atom</span>: <span class="string"><span class="content">application/atom+xml</span></span>
            <span class="key">css</span>: <span class="string"><span class="content">text/css</span></span>
            <span class="key">csv</span>: <span class="string"><span class="content">text/csv</span></span>
            <span class="key">form</span>: <span class="string"><span class="content">application/x-www-form-urlencoded</span></span>
            <span class="key">html</span>:
              - <span class="string"><span class="content">text/html</span></span>
              - <span class="string"><span class="content">application/xhtml+xml</span></span>
            <span class="key">js</span>: <span class="string"><span class="content">text/javascript</span></span>
            <span class="key">json</span>:
              - <span class="string"><span class="content">application/json</span></span>
              - <span class="string"><span class="content">text/json</span></span>
            <span class="key">multipartForm</span>: <span class="string"><span class="content">multipart/form-data</span></span>
            <span class="key">rss</span>: <span class="string"><span class="content">application/rss+xml</span></span>
            <span class="key">text</span>: <span class="string"><span class="content">text/plain</span></span>
            <span class="key">hal</span>:
              - <span class="string"><span class="content">application/hal+json</span></span>
              - <span class="string"><span class="content">application/hal+xml</span></span>
            <span class="key">xml</span>:
              - <span class="string"><span class="content">text/xml</span></span>
              - <span class="string"><span class="content">application/xml</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以在 <code>grails-app/conf/application.groovy</code> 中进行设置，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.mime.types = [ <span class="comment">// the first one is the default format</span>
    <span class="key">all</span>:           <span class="string"><span class="delimiter">'</span><span class="content">*/*</span><span class="delimiter">'</span></span>, <span class="comment">// 'all' maps to '*' or the first available format in withFormat</span>
    <span class="key">atom</span>:          <span class="string"><span class="delimiter">'</span><span class="content">application/atom+xml</span><span class="delimiter">'</span></span>,
    <span class="key">css</span>:           <span class="string"><span class="delimiter">'</span><span class="content">text/css</span><span class="delimiter">'</span></span>,
    <span class="key">csv</span>:           <span class="string"><span class="delimiter">'</span><span class="content">text/csv</span><span class="delimiter">'</span></span>,
    <span class="key">form</span>:          <span class="string"><span class="delimiter">'</span><span class="content">application/x-www-form-urlencoded</span><span class="delimiter">'</span></span>,
    <span class="key">html</span>:          [<span class="string"><span class="delimiter">'</span><span class="content">text/html</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">application/xhtml+xml</span><span class="delimiter">'</span></span>],
    <span class="key">js</span>:            <span class="string"><span class="delimiter">'</span><span class="content">text/javascript</span><span class="delimiter">'</span></span>,
    <span class="key">json</span>:          [<span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">text/json</span><span class="delimiter">'</span></span>],
    <span class="key">multipartForm</span>: <span class="string"><span class="delimiter">'</span><span class="content">multipart/form-data</span><span class="delimiter">'</span></span>,
    <span class="key">rss</span>:           <span class="string"><span class="delimiter">'</span><span class="content">application/rss+xml</span><span class="delimiter">'</span></span>,
    <span class="key">text</span>:          <span class="string"><span class="delimiter">'</span><span class="content">text/plain</span><span class="delimiter">'</span></span>,
    <span class="key">hal</span>:           [<span class="string"><span class="delimiter">'</span><span class="content">application/hal+json</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">application/hal+xml</span><span class="delimiter">'</span></span>],
    <span class="key">xml</span>:           [<span class="string"><span class="delimiter">'</span><span class="content">text/xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">application/xml</span><span class="delimiter">'</span></span>]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的配置位使Grails能够检测到包含&#8217;text/xml&#8217;或&#8217;application/xml&#8217;媒体类型的请求的格式，仅是&#8217;xml'。 您可以通过在地图中添加新条目来添加自己的类型。
第一个是默认格式。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用请求参数格式的内容协商">使用请求参数格式的内容协商</h4>
<div class="paragraph">
<p>假设控制器动作可以返回多种格式的资源：HTML，XML和JSON。 客户将获得哪种格式？ 客户端控制它的最简单，最可靠的方法是通过一个 <code>format</code> URL参数。</p>
</div>
<div class="paragraph">
<p>因此，如果您作为浏览器或其他客户端，希望使用XML格式的资源，则可以使用如下所示的URL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>http://my.domain.org/books?format=xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>在服务器端的结果是在 <code>response</code> 对象上具有 <code>xml</code> 值的 <code>format</code> 属性。</p>
</div>
<div class="paragraph">
<p>您还可以在以下链接中定义此参数：<a href="theWebLayer.html#urlmappings">URL Mappings</a> 定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/book/list</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span>) {
    format = <span class="string"><span class="delimiter">&quot;</span><span class="content">xml</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以基于此属性编写控制器操作以返回XML，但也可以使用特定于控制器的 <code>withFormat()</code> 方法：</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这个例子需要添加 <code>org.grails.plugins:grails-plugin-converters</code> 插件
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.converters.JSON</span>
<span class="keyword">import</span> <span class="include">grails.converters.XML</span>

<span class="type">class</span> <span class="class">BookController</span> {

    <span class="keyword">def</span> <span class="function">list</span>() {
        <span class="keyword">def</span> books = <span class="predefined-type">Book</span>.list()

        withFormat {
            html <span class="key">bookList</span>: books
            json { render books <span class="keyword">as</span> JSON }
            xml { render books <span class="keyword">as</span> XML }
            <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { render books <span class="keyword">as</span> JSON }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，Grails将仅在 <code>withFormat()</code> 内部执行与请求的内容类型匹配的块。 因此，如果首选格式为 <code>html</code>，则Grails将仅执行 <code>html()</code> 调用。 每个“块”可以是对应视图的映射模型（如上例中对“ html”所做的操作）或闭包。 闭包可以包含任何标准动作代码，例如，它可以返回模型或直接呈现内容。</p>
</div>
<div class="paragraph">
<p>如果没有格式明确匹配，则可以使用 <code>*</code>（通配符）块来处理所有其他格式。</p>
</div>
<div class="paragraph">
<p>有一种特殊格式"all"，其处理方式与显式格式不同。 如果指定了"all"（通常是通过Accept头发生的-见下文），那么当没有 <code>*</code>（通配符）块可用时，将执行 <code>withFormat()</code> 的第一个块。</p>
</div>
<div class="paragraph">
<p>您不应添加显式的"all"块。 在此示例中，格式为"all"将触发 <code>html</code> 处理程序（ <code>html</code> 是第一个块，而没有 <code>*</code> 块）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withFormat {
    html <span class="key">bookList</span>: books
    json { render books <span class="keyword">as</span> JSON }
    xml { render books <span class="keyword">as</span> XML }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
当使用 <a href="../ref/Controllers/withFormat.html">withFormat</a>时，请确保它是控制器操作中的最后一次调用，因为操作将使用 <code>withFormat</code> 方法的返回值来指示下一步将发生什么。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_使用accept标头">使用Accept标头</h4>
<div class="paragraph">
<p>每个传入的HTTP请求都有一个特殊的 <a href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html">Accept</a> 标头，该标头定义了客户端可以“接受”哪些媒体类型（或mime类型）。 在较旧的浏览器中，这通常是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>*/*</code></pre>
</div>
</div>
<div class="paragraph">
<p>这简直意味着任何。 但是，较新的浏览器会发送更多有趣的值，例如Firefox发送的值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>text/xml, application/xml, application/xhtml+xml, text/html;q=0.9, \
    text/plain;q=0.8, image/png, */*;q=0.5</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个特定的accept标头无济于事，因为它表明XML是首选的响应格式，而用户确实期望HTML。 这就是为什么Grails默认会忽略浏览器的accept标头。 但是，非浏览器客户端通常会更具体地满足其要求，并且可以发送接受标头，例如</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">application/json</code></pre>
</div>
</div>
<div class="paragraph">
<p>如前所述，Grails中的默认配置是忽略浏览器的accept标头。 这是通过配置设置 <code>grails.mime.disable.accept.header.userAgents</code> 完成的，该配置设置用于检测主要的渲染引擎并忽略其ACCEPT标头。 这允许Grails的内容协商继续适用于非浏览器客户端：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.mime.disable.accept.header.userAgents = [<span class="string"><span class="delimiter">'</span><span class="content">Gecko</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">WebKit</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Presto</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Trident</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如，如果看到上面的accept标头("application/json")，它将按照您的期望将 <code>format</code> 设置为 <code>json</code>。 当然，这与 <code>withFormat（）</code> 方法配合使用，其方式与设置 <code>format</code> URL参数的方式相同（尽管URL参数优先）。</p>
</div>
<div class="paragraph">
<p>'*/\*'的接受标头会为 <code>format</code> 属性产生一个 <code>all</code> 值。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果使用了接受标头，但不包含已注册的内容类型，则Grails将假定浏览器正在发出错误的请求，并将设置HTML格式-请注意，这与其他内容协商模式的工作方式不同，因为它们会激活"all"格式！
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_请求格式与响应格式">请求格式与响应格式</h4>
<div class="paragraph">
<p>从Grails 2.0开始，有_request_格式和_response_格式的单独概念。 请求格式由 <code>CONTENT_TYPE</code> 标头决定，通常用于检测传入的请求是否可以解析为XML或JSON，而响应格式则使用文件扩展名，格式参数或ACCEPT标头来尝试传递适当的响应 到客户端。</p>
</div>
<div class="paragraph">
<p>控制器上可用的链接：<a href="../ref/Controllers/withFormat.html">withFormat</a> 特别处理响应格式。 如果您希望添加处理请求格式的逻辑，则可以使用请求上可用的单独的 <code>withFormat</code> 方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">request.withFormat {
    xml {
        <span class="comment">// read XML</span>
    }
    json {
        <span class="comment">// read JSON</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用uri扩展进行内容协商">使用URI扩展进行内容协商</h4>
<div class="paragraph">
<p>Grails还支持使用URI扩展的内容协商。 例如，给出以下URI：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/book/list.xml</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是默认URL映射定义的结果，它是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>action</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?(.</span><span class="inline"><span class="inline-delimiter">$</span>format</span><span class="content">)?</span><span class="delimiter">&quot;</span></span>{</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意路径中包含 <code>format</code> 变量。 如果您不希望通过文件扩展名使用内容协商，则只需删除URL映射的这一部分：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>controller</span><span class="content">/</span><span class="inline"><span class="inline-delimiter">$</span>action</span><span class="content">?/</span><span class="inline"><span class="inline-delimiter">$</span>id</span><span class="content">?</span><span class="delimiter">&quot;</span></span>{</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_测试内容协商">测试内容协商</h4>
<div class="paragraph">
<p>要在单元测试或集成测试中测试内容协商（请参阅<a href="testing.html">Testing</a>) 上的部分），您可以操纵传入的请求标头：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> testJavascriptOutput() {
    <span class="keyword">def</span> controller = <span class="keyword">new</span> TestController()
    controller.request.addHeader <span class="string"><span class="delimiter">&quot;</span><span class="content">Accept</span><span class="delimiter">&quot;</span></span>,
              <span class="string"><span class="delimiter">&quot;</span><span class="content">text/javascript, text/html, application/xml, text/xml, */*</span><span class="delimiter">&quot;</span></span>

    controller.testAction()
    assertEquals <span class="string"><span class="delimiter">&quot;</span><span class="content">alert('hello')</span><span class="delimiter">&quot;</span></span>, controller.response.contentAsString
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，您可以设置format参数来实现类似的效果：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">void</span> testJavascriptOutput() {
    <span class="keyword">def</span> controller = <span class="keyword">new</span> TestController()
    controller.params.format = <span class="string"><span class="delimiter">'</span><span class="content">js</span><span class="delimiter">'</span></span>

    controller.testAction()
    assertEquals <span class="string"><span class="delimiter">&quot;</span><span class="content">alert('hello')</span><span class="delimiter">&quot;</span></span>, controller.response.contentAsString
}</code></pre>
</div>
</div>
</div>


<h1 id="traits">9 特征（Trait）</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/traits.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_概貌">概貌</h3>
<div class="paragraph">
<p>Grails提供了许多特征，这些特征提供了对属性和行为的访问，这些属性和行为可以从各种Grails工件以及作为Grails项目一部分的任意Groovy类访问。其中许多特征会自动添加到Grails工件类中（例如，控制器和标签库），并且很容易添加到其他类中。</p>
</div>
</div>


<h2 id="traitsprovided">9.1 Grails 提供的特征</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/traits/traitsprovided.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>在编译时，Grails伪像会自动增加某些特征。</p>
</div>
<div class="sect3">
<h4 id="_域类特征">域类特征</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.grails.org/4.0.0/api/grails/artefact/DomainClass.html">grails.artefact.DomainClass</a></p>
</li>
<li>
<p><a href="http://docs.grails.org/4.0.0/api/grails/web/databinding/WebDataBinding.html">grails.web.databinding.WebDataBinding</a></p>
</li>
<li>
<p><a href="http://gorm.grails.org/latest/api//org/grails/datastore/gorm/GormEntity.html">org.grails.datastore.gorm.GormEntity</a></p>
</li>
<li>
<p><a href="http://gorm.grails.org/latest/api//org/grails/datastore/gorm/GormValidateable.html">org.grails.datastore.gorm.GormValidateable</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_控制器特征">控制器特征</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://gsp.grails.org/latest/api/grails/artefact/gsp/TagLibraryInvoker.html">grails.artefact.gsp.TagLibraryInvoker</a></p>
</li>
<li>
<p><a href="http://async.grails.org/latest/api/grails/artefact/AsyncController.html">grails.artefact.AsyncController</a></p>
</li>
<li>
<p><a href="http://docs.grails.org/4.0.0/api/grails/artefact/controller/RestResponder.html">grails.artefact.controller.RestResponder</a></p>
</li>
<li>
<p><a href="http://docs.grails.org/4.0.0/api/grails/artefact/Controller.html">grails.artefact.Controller</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_拦截者特质">拦截者特质</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://docs.grails.org/4.0.0/api/grails/artefact/Interceptor.html">grails.artefact.Interceptor</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_标签库特性">标签库特性</h4>
<div class="ulist">
<ul>
<li>
<p><a href="http://gsp.grails.org/latest/api/grails/artefact/TagLibrary.html">grails.artefact.TagLibrary</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>以下是框架提供的其他特征的列表。 javadocs提供了有关与每个特征相关的方法和属性的更多详细信息。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>Trait</strong></th>
<th class="tableblock halign-left valign-top"><strong>Brief Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.grails.org/4.0.0/api/grails/web/api/WebAttributes.html">grails.web.api.WebAttributes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Web Attributes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.grails.org/4.0.0/api/grails/web/api/ServletAttributes.html">grails.web.api.ServletAttributes</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Servlet API Attributes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.grails.org/4.0.0/api/grails/web/databinding/DataBinder.html">grails.web.databinding.DataBinder</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Binding API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.grails.org/4.0.0/api/grails/artefact/controller/support/RequestForwarder.html">grails.artefact.controller.support.RequestForwarder</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request Forwarding API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.grails.org/4.0.0/api/grails/artefact/controller/support/ResponseRedirector.html">grails.artefact.controller.support.ResponseRedirector</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response Redirecting API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.grails.org/4.0.0/api/grails/artefact/controller/support/ResponseRenderer.html">grails.artefact.controller.support.ResponseRenderer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Response Rendering API</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://docs.grails.org/4.0.0/api/grails/validation/Validateable.html">grails.validation.Validateable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Validation API</p></td>
</tr>
</tbody>
</table>
</div>


<h2 id="example">9.1.1 Web 属性特性示例</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/traits/traitsprovided/example.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/web/api/WebAttributes.html">WebAttributes</a>是框架提供的特征之一。 任何Groovy类都可以实现此特征，以继承该特征提供的所有属性和行为。</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/Helper.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.web.api.WebAttributes</span>

<span class="type">class</span> <span class="class">Helper</span> <span class="directive">implements</span> WebAttributes {

    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getControllerNames() {
        <span class="comment">// There is no need to pass grailsApplication as an argument</span>
        <span class="comment">// or otherwise inject the grailsApplication property.  The</span>
        <span class="comment">// WebAttributes trait provides access to grailsApplication.</span>
        grailsApplication.getArtefacts(<span class="string"><span class="delimiter">'</span><span class="content">Controller</span><span class="delimiter">'</span></span>)*.name
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些特征与静态编译兼容&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/demo/Helper.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">grails.web.api.WebAttributes</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Helper</span> <span class="directive">implements</span> WebAttributes {

    <span class="predefined-type">List</span>&lt;<span class="predefined-type">String</span>&gt; getControllerNames() {
        <span class="comment">// There is no need to pass grailsApplication as an argument</span>
        <span class="comment">// or otherwise inject the grailsApplication property.  The</span>
        <span class="comment">// WebAttributes trait provides access to grailsApplication.</span>
        grailsApplication.getArtefacts(<span class="string"><span class="delimiter">'</span><span class="content">Controller</span><span class="delimiter">'</span></span>)*.name
    }
}</code></pre>
</div>
</div>

<a name="8.1 REST"><!-- Legacy link --></a>
<h1 id="REST">10 REST</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>REST本身并不是一种真正的技术，而是一种架构模式。 REST非常简单，仅涉及使用纯XML或JSON作为通信介质，并结合了作为基础系统“代表”的URL模式以及HTTP方法（例如GET，PUT，POST和DELETE）。
每个HTTP方法都映射到一个类型。 例如，GET用于检索数据，POST用于创建数据，PUT用于更新等等。
Grails包含灵活的功能，可轻松创建RESTful API。 创建RESTful资源只需一行代码即可，如下一节所述。</p>
</div>


<h2 id="domainResources">10.1 域类作为 REST 资源</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/domainResources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>在Grails中创建RESTful API的最简单方法是将域类公开为REST资源。这可以通过在任何域类中添加 <code>grails.rest.Resource</code> 转换来完成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(uri=<span class="string"><span class="delimiter">'</span><span class="content">/books</span><span class="delimiter">'</span></span>)
<span class="type">class</span> <span class="class">Book</span> {

    <span class="predefined-type">String</span> title

    <span class="directive">static</span> constraints = {
        title <span class="key">blank</span>:<span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>简单地通过添加 <code>Resource</code> 转换并指定URI，您的域类将自动以XML或JSON格式用作REST资源。转换将自动注册必要的<a href="theWebLayer.html＃restfulMappings">RESTful URL mapping</a>并创建一个名为 <code>BookController</code> 的控制器。</p>
</div>
<div class="paragraph">
<p>您可以通过向BootStrap.groovy添加一些测试数据来进行尝试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> init = { servletContext -&gt;
    <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>).save()
    <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Shining</span><span class="delimiter">&quot;</span></span>).save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后点击URL <a href="http://localhost8080/books/1" class="bare">http://localhost8080/books/1</a>, 它将显示如下响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="tag">&lt;book</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;title&gt;</span>The Stand<span class="tag">&lt;/title&gt;</span>
<span class="tag">&lt;/book&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果将URL更改为 <a href="http://localhost:8080/books/1.json" class="bare">http://localhost:8080/books/1.json</a>, 您将获得JSON响应，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您希望更改默认值以返回JSON而不是XML，则可以通过设置 <code>Resource</code> 转换的 <code>formats</code> 属性来实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(uri=<span class="string"><span class="delimiter">'</span><span class="content">/books</span><span class="delimiter">'</span></span>, formats=[<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">Book</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，JSON将具有优先级。传递的列表应包含资源应公开的格式的名称。格式的名称在application.groovy的grails.mime.types设置中定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.mime.types = [
    ...
    json:          [<span class="string"><span class="delimiter">'</span><span class="content">application/json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">text/json</span><span class="delimiter">'</span></span>],
    ...
    xml:           [<span class="string"><span class="delimiter">'</span><span class="content">text/xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">application/xml</span><span class="delimiter">'</span></span>]
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关更多信息，请参见用户指南中的<a href="theWebLayer.html＃contentNegotiation">配置Mime类型</a>部分。</p>
</div>
<div class="paragraph">
<p>除了使用URI中的文件扩展名，您还可以使用ACCEPT标头获得JSON响应。这是使用Unix <code>curl</code> 工具的示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -H &quot;Accept: application/json&quot; localhost:8080/books/1
{&quot;id&quot;:1,&quot;title&quot;:&quot;The Stand&quot;}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这要归功于Grails的<a href="theWebLayer.html＃contentNegotiation">Content Negotiation</a>功能。</p>
</div>
<div class="paragraph">
<p>您可以通过发出POST请求来创建新资源：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;title&quot;:&quot;Along Came A Spider&quot;}' localhost:8080/books
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>更新可以通过 <code>PUT</code> 请求来完成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -X PUT -H &quot;Content-Type: application/json&quot; -d '{&quot;title&quot;:&quot;Along Came A Spider&quot;}' localhost:8080/books/1
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，可以通过 <code>DELETE</code> 请求删除资源：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -X DELETE localhost:8080/books/1
HTTP/1.1 204 No Content
Server: Apache-Coyote/1.1
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>如您所见，<code>Resource</code> 转换启用了资源上的所有HTTP方法动词。您可以通过将 <code>readOnly</code> 属性设置为true来仅启用只读功能：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(uri=<span class="string"><span class="delimiter">'</span><span class="content">/books</span><span class="delimiter">'</span></span>, readOnly=<span class="predefined-constant">true</span>)
<span class="type">class</span> <span class="class">Book</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，<code>POST</code>，<code>PUT</code> 和 <code>DELETE</code> 请求将被禁止。</p>
</div>


<h2 id="urlMappings">10.2 映射到 REST 资源</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/urlMappings.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果您希望将URL映射的声明保留在 <code>UrlMappings.groovy</code> 文件中，则只需删除 <code>Resource</code> 转换的 <code>uri</code> 属性，并将以下行添加到 <code>UrlMappings.groovy</code> 中就足够了：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>扩展您的API以包括更多端点将变得微不足道：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>) {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/publisher</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>, <span class="key">method</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例将公开URI <code>/books/1/publisher</code>。</p>
</div>
<div class="paragraph">
<p>更详细的解释 <a href="theWebLayer.html#restfulMappings">creating RESTful URL mappings</a> 可以在 <a href="theWebLayer.html#urlmappings">URL Mappings section</a> 用户指南。</p>
</div>


<h2 id="linkingToResources">10.3 从 GSP 页面链接到 REST 资源</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/linkingToResources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>链接标签提供了一种链接到任何域类资源的简便方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:link</span> <span class="attribute-name">resource</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${book}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>My Link<span class="tag">&lt;/g:link&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，当前您不能使用g:link链接到DELETE操作，并且大多数浏览器不支持直接发送DELETE方法。</p>
</div>
<div class="paragraph">
<p>最好的方法是使用表单提交：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;form</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">/book/2</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">method</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">post</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
         <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">hidden</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">_method</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">DELETE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails支持通过隐藏的_method参数覆盖请求方法。这是出于浏览器兼容性的目的。当使用静态资源映射创建功能强大的Web界面时，这很有用。
为了使链接触发此类事件，也许捕获具有data-method属性的链接的所有click事件，然后通过JavaScript提交表单提交。</p>
</div>


<h2 id="versioningResources">10.4 版本化 REST 资源</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/versioningResources.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>REST API的一个常见要求是同时公开不同的版本。 Grails中有几种​​方法可以实现。</p>
</div>
<div class="sect3">
<h4 id="_使用uri进行版本控制">使用URI进行版本控制</h4>
<div class="paragraph">
<p>一种常见的方法是使用URI来对API进行版本控制（尽管不建议使用此方法，而建议使用Hypermedia）。例如，您可以定义以下URL映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books/v1</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">namespace</span>:<span class="string"><span class="delimiter">'</span><span class="content">v1</span><span class="delimiter">'</span></span>)
<span class="string"><span class="delimiter">&quot;</span><span class="content">/books/v2</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">namespace</span>:<span class="string"><span class="delimiter">'</span><span class="content">v2</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将与以下控制器匹配：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myapp.v1

<span class="type">class</span> <span class="class">BookController</span> {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">v1</span><span class="delimiter">'</span></span>
}

<span class="keyword">package</span> myapp.v2

<span class="type">class</span> <span class="class">BookController</span> {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">v2</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这种方法的缺点是您的API需要两个不同的URI名称空间。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用accept_version标头进行版本控制">使用Accept-Version标头进行版本控制</h4>
<div class="paragraph">
<p>作为替代方案，Grails支持从客户端传递 <code>Accept-Version</code> 标头。例如，您可以定义以下URL映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">version</span>:<span class="string"><span class="delimiter">'</span><span class="content">1.0</span><span class="delimiter">'</span></span>, <span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">namespace</span>:<span class="string"><span class="delimiter">'</span><span class="content">v1</span><span class="delimiter">'</span></span>)
<span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">version</span>:<span class="string"><span class="delimiter">'</span><span class="content">2.0</span><span class="delimiter">'</span></span>, <span class="key">resources</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>, <span class="key">namespace</span>:<span class="string"><span class="delimiter">'</span><span class="content">v2</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后在客户端使用 <code>Accept-Version</code> 标头简单地传递您需要的版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -H &quot;Accept-Version: 1.0&quot; -X GET http://localhost:8080/books</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用hypermedia_mime类型进行版本控制">使用Hypermedia / Mime类型进行版本控制</h4>
<div class="paragraph">
<p>版本控制的另一种方法是使用Mime Type定义来声明自定义媒体类型的版本（有关Hypermedia概念的更多信息，请参见 <code>作为应用程序状态引擎的超媒体</code> 一节）。例如，在 <code>application.groovy</code> 中，您可以为您的资源声明一个自定义的Mime类型，其中包括版本参数（ <code>v</code> 参数）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.mime.types = [
    <span class="key">all</span>: <span class="string"><span class="delimiter">'</span><span class="content">*/*</span><span class="delimiter">'</span></span>,
    <span class="key">book</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.book+json;v=1.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key">bookv2</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.book+json;v=2.0</span><span class="delimiter">&quot;</span></span>,
    ...
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
将新的MIME类型放在 <code>所有</code> MIME类型之后非常重要，因为如果无法建立请求的内容类型，则映射中的第一个条目将用作响应。如果您的新Mime类型位于顶部，那么在无法建立请求的Mime类型时，Grails将始终尝试发送新的Mime类型。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>然后覆盖渲染器（有关自定义渲染器的更多信息，请参见 <code>自定义响应渲染</code> 部分），以在grails-app/conf/spring/resourses.groovy中发送自定义Mime类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.json.*</span>
<span class="keyword">import</span> <span class="include">grails.web.mime.*</span>

beans = {
    bookRendererV1(JsonRenderer, myapp.v1.Book, <span class="keyword">new</span> MimeType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.book+json</span><span class="delimiter">&quot;</span></span>, [<span class="key">v</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>]))
    bookRendererV2(JsonRenderer, myapp.v2.Book, <span class="keyword">new</span> MimeType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.book+json</span><span class="delimiter">&quot;</span></span>, [<span class="key">v</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">2.0</span><span class="delimiter">&quot;</span></span>]))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后更新控制器中可接受的响应格式列表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> <span class="directive">extends</span> RestfulController {
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">bookv2</span><span class="delimiter">'</span></span>]

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后使用 <code>Accept</code> 标头可以使用Mime Type指定所需的版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Accept: application/vnd.books.org.book+json;v=1.0</span><span class="delimiter">&quot;</span></span> -X GET <span class="key">http</span>:<span class="comment">//localhost:8080/books</span></code></pre>
</div>
</div>
</div>


<h2 id="restfulControllers">10.5 实现 REST 控制器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/restfulControllers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><code>资源</code> 转换是一种快速的入门方法，但是通常您需要自定义控制器逻辑，响应的呈现或扩展API以包括其他操作。</p>
</div>


<h2 id="extendingRestfulController">10.5.1 扩展Rest控制器超级类</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/restfulControllers/extendingRestfulController.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>开始这样做的最简单方法是为您的资源创建一个扩展 <code>grails.rest.RestfulController</code> 超级类的新控制器。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> <span class="directive">extends</span> RestfulController&lt;<span class="predefined-type">Book</span>&gt; {
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>]
    BookController() {
        <span class="local-variable">super</span>(<span class="predefined-type">Book</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要自定义任何逻辑，只需重写相应的操作。下表提供了操作名的名称及其映射到的uri：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Controller Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}/edit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
只有当控制器公开HTML接口时，才需要 <code>create</code> 和 <code>edit</code> 操作。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>例如，如果您有一个<a href="weblayer.html#restfulMappings">嵌套资源</a>，那么您通常希望同时查询父标识符和子标识符。例如，给定以下URL映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/authors</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">author</span><span class="delimiter">'</span></span>) {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>(<span class="key">resources</span>:<span class="string"><span class="delimiter">'</span><span class="content">book</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以按如下方式实现嵌套控制器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> <span class="directive">extends</span> RestfulController {
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>]
    BookController() {
        <span class="local-variable">super</span>(<span class="predefined-type">Book</span>)
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="predefined-type">Book</span> queryForResource(<span class="predefined-type">Serializable</span> id) {
        <span class="predefined-type">Book</span>.where {
            id == id &amp;&amp; author.id == params.authorId
        }.find()
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例将 <code>RestfulController</code> 子类化，并重写受保护的 <code>query for resource</code> 方法，以自定义资源的查询以将父资源考虑在内。</p>
</div>
<div class="sect3">
<h4 id="_在restfulcontroller子类中自定义数据绑定">在RestfulController子类中自定义数据绑定</h4>
<div class="paragraph">
<p>RestfulController类包含对 <code>save</code> 和 <code>update</code> 等操作进行数据绑定的代码。该类定义了一个 <code>getObjectToBind（）</code> 方法，该方法返回一个将用作数据绑定源的值。例如，update操作执行如下操作&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">RestfulController</span>&lt;T&gt; {

    <span class="keyword">def</span> <span class="function">update</span>() {
        T instance = <span class="comment">// retrieve instance from the database...</span>

        instance.properties = getObjectToBind()

        <span class="comment">// ...</span>
    }

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下， <code>getObjectToBind（）</code> 方法返回<a href="../ref/Controllers/request.html">request</a>对象。当 <code>request</code> 对象用作绑定源时，如果请求有一个body，那么将解析body并使用其内容进行数据绑定，否则将使用请求参数进行数据绑定。RestfulController的子类可以重写 <code>getObjectToBind（）</code> 方法并返回任何有效的绑定源，包括 <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html">Map</a>或<a href="http://docs.grails.org/4.0.0/api/grails/databinding/databindingsource.html">DataBindingSource</a>。对于大多数绑定请求的用例来说是合适的，但是getObjectToBind（）方法允许在需要时更改该行为。</p>
</div>
</div>
<div class="sect3">
<h4 id="_在资源注释中使用restfulcontroller的自定义子类">在资源注释中使用RestfulController的自定义子类</h4>
<div class="paragraph">
<p>您还可以自定义支持资源注释的控制器的行为。</p>
</div>
<div class="paragraph">
<p>类必须提供以域类作为参数的构造函数。第二个构造函数用于支持readOnly=true的资源注释。</p>
</div>
<div class="paragraph">
<p>这是一个模板，可用于资源批注中使用的子类RestfulController类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">SubclassRestfulController</span>&lt;T&gt; <span class="directive">extends</span> RestfulController&lt;T&gt; {
    SubclassRestfulController(<span class="predefined-type">Class</span>&lt;T&gt; domainClass) {
        <span class="local-variable">this</span>(domainClass, <span class="predefined-constant">false</span>)
    }

    SubclassRestfulController(<span class="predefined-type">Class</span>&lt;T&gt; domainClass, <span class="type">boolean</span> readOnly) {
        <span class="local-variable">super</span>(domainClass, readOnly)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用 <code>super class</code> 属性指定支持资源批注的控制器的超级类。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(uri=<span class="string"><span class="delimiter">'</span><span class="content">/books</span><span class="delimiter">'</span></span>, superClass=SubclassRestfulController)
<span class="type">class</span> <span class="class">Book</span> {

    <span class="predefined-type">String</span> title

    <span class="directive">static</span> constraints = {
        title <span class="key">blank</span>:<span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
</div>


<h2 id="restControllersStepByStep">10.5.2 逐步实现 REST 控制器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/restfulControllers/restControllersStepByStep.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果您不想利用 <code>RestfulController</code> 超级类提供的功能，则可以自己手动实现每个HTTP动词。第一步是创建一个控制器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> grails create-controller book</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后添加一些有用的导入，并默认启用readOnly：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.transactions.*</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpStatus.*</span>
<span class="keyword">import</span> <span class="include">static</span> <span class="include">org.springframework.http.HttpMethod.*</span>

<span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
<span class="type">class</span> <span class="class">BookController</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>回想一下，每个HTTP动词都根据以下约定与特定的Grails动作匹配：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">URI</th>
<th class="tableblock halign-left valign-top">Controller Action</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">show</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/create</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">create</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}/edit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">edit</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">update</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/books/${id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果您计划为REST资源实现HTML接口，则已经需要执行create和edit操作。它们在那里是为了呈现适当的HTML表单以创建和编辑资源。如果这不是必需的，则可以将其丢弃。
实施REST操作的关键是在Grails 2.3中引入的<a href="../ref/Controllers/respond.html">respond</a>方法。 <code>respond</code> 方法尝试为所请求的内容类型（JSON，XML，HTML等）产生最适当的响应。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_实施_code_索引_code_行动">实施 <code>索引</code> 行动</h4>
<div class="paragraph">
<p>例如，要实现 <code>index</code> 动作，只需调用 <code>respond</code> 方法来传递对象列表以进行响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">index</span>(<span class="predefined-type">Integer</span> max) {
    params.max = <span class="predefined-type">Math</span>.min(max ?: <span class="integer">10</span>, <span class="integer">100</span>)
    respond <span class="predefined-type">Book</span>.list(params), <span class="key">model</span>:[<span class="key">bookCount</span>: <span class="predefined-type">Book</span>.count()]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，在上面的示例中，我们还使用了 <code>respond</code> 方法的 <code>model</code> 参数来提供总数。仅当您计划通过某些用户界面支持分页时才需要。响应方法将使用<a href="theWebLayer.html＃contentNegotiation">Content Negotiation</a>，尝试根据客户端请求的内容类型（通过ACCEPT标头或文件扩展名）以最适当的响应进行回复。如果将内容类型确定为HTML，则将生成一个模型，使得上述操作等同于编写：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">index</span>(<span class="predefined-type">Integer</span> max) {
    params.max = <span class="predefined-type">Math</span>.min(max ?: <span class="integer">10</span>, <span class="integer">100</span>)
    [<span class="key">bookList</span>: <span class="predefined-type">Book</span>.list(params), <span class="key">bookCount</span>: <span class="predefined-type">Book</span>.count()]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过提供一个 <code>index.gsp</code> 文件，您可以为给定的模型渲染一个合适的视图。如果内容类型不是HTML，则 <code>respond</code> 方法将尝试查找适当的 <code>grails.rest.render.Renderer</code> 实例，该实例能够呈现传递的对象。这是通过检查 <code>grails.rest.render.RendererRegistry</code> 完成的。默认情况下，已经为JSON和XML配置了渲染器，要了解如何注册自定义渲染器，请参阅 <code>自定义响应渲染</code> 一节。</p>
</div>
</div>
<div class="sect3">
<h4 id="_实施_code_表演_code_行动">实施 <code>表演</code> 行动</h4>
<div class="paragraph">
<p>可以通过一行Groovy代码（不包括方法签名）来实现 <code>show</code> 操作，该操作用于按ID显示和单独显示资源：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>(<span class="predefined-type">Book</span> book) {
    respond book
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过将域实例指定为操作的参数，Grails将自动尝试使用请求的id参数查找域实例。如果域实例不存在，则将把 <code>null</code> 传递给操作。如果传递了null，则 <code>respond</code> 方法将返回404错误，否则它将再次尝试呈现适当的响应。如果格式为HTML，则将生成适当的模型。以下操作在功能上等同于上述操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>(<span class="predefined-type">Book</span> book) {
    <span class="keyword">if</span>(book == <span class="predefined-constant">null</span>) {
        render <span class="key">status</span>:<span class="integer">404</span>
    }
    <span class="keyword">else</span> {
        <span class="keyword">return</span> [<span class="key">book</span>: book]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_实施_code_保存_code_动作">实施 <code>保存</code> 动作</h4>
<div class="paragraph">
<p>保存操作创建新的资源表示。首先，只需定义一个将资源作为第一个参数的动作，并使用 <code>grails.gorm.transactions.Transactional</code> 转换将其标记为 <code>Transactional</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Transactional</span>
<span class="keyword">def</span> <span class="function">save</span>(<span class="predefined-type">Book</span> book) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后要做的第一件事是检查资源是否具有任何<a href="validation.html">validation errors</a>，如果有，则返回错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span>(book.hasErrors()) {
    respond book.errors, <span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">create</span><span class="delimiter">'</span></span>
}
<span class="keyword">else</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于HTML，将再次呈现 <code>创建</code> 视图，以便用户可以更正无效的输入。对于其他格式（JSON，XML等），错误对象本身将以适当的格式呈现，并返回状态码422（UNPROCESSABLE_ENTITY）。如果没有错误，则可以保存资源并发送适当的响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">book.save <span class="key">flush</span>:<span class="predefined-constant">true</span>
    withFormat {
        html {
            flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.created.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
            redirect book
        }
        <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { render <span class="key">status</span>: CREATED }
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>在HTML的情况下，将重定向发送到原始资源，对于其他格式，将返回状态码201（已创建）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_实施_code_更新_code_操作">实施 <code>更新</code> 操作</h4>
<div class="literalblock">
<div class="content">
<pre>`更新` 动作会更新现有的资源表示形式，并且与 `保存` 动作非常相似。首先定义方法签名：</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Transactional</span>
<span class="keyword">def</span> <span class="function">update</span>(<span class="predefined-type">Book</span> book) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果资源存在，则Grails将加载资源，否则将传递null。如果为null，则应返回404：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span>(book == <span class="predefined-constant">null</span>) {
        render <span class="key">status</span>: NOT_FOUND
    }
    <span class="keyword">else</span> {
        ...
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后再次检查错误<a href="validation.html">validation errors</a>，如果是，请回答以下错误：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span>(book.hasErrors()) {
    respond book.errors, <span class="key">view</span>:<span class="string"><span class="delimiter">'</span><span class="content">edit</span><span class="delimiter">'</span></span>
}
<span class="keyword">else</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于HTML，将再次呈现 <code>编辑</code> 视图，以便用户可以更正无效的输入。对于其他格式（JSON，XML等），错误对象本身将以适当的格式呈现，并返回状态码422（UNPROCESSABLE_ENTITY）。如果没有错误，则可以保存资源并发送适当的响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">book.save <span class="key">flush</span>:<span class="predefined-constant">true</span>
withFormat {
    html {
        flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.updated.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
        redirect book
    }
    <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span> { render <span class="key">status</span>: OK }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在HTML的情况下，将重定向发送到原始资源，对于其他格式，将返回状态码200（OK）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_实施_code_删除_code_操作">实施 <code>删除</code> 操作</h4>
<div class="paragraph">
<p><code>delete</code> 操作将删除现有资源。除了调用 <code>delete（）</code> 方法外，该实现与 <code>update</code> 操作非常相似：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">book.delete <span class="key">flush</span>:<span class="predefined-constant">true</span>
withFormat {
    html {
        flash.message = message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">default.deleted.message</span><span class="delimiter">'</span></span>, <span class="key">args</span>: [message(<span class="key">code</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book.label</span><span class="delimiter">'</span></span>, <span class="keyword">default</span>: <span class="string"><span class="delimiter">'</span><span class="content">Book</span><span class="delimiter">'</span></span>), book.id])
        redirect <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">index</span><span class="delimiter">&quot;</span></span>, <span class="key">method</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">GET</span><span class="delimiter">&quot;</span></span>
    }
    <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>{ render <span class="key">status</span>: NO_CONTENT }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，对于HTML响应，将重定向发送回 <code>index</code> 操作，而对于其他内容类型，将返回响应代码204（NO_CONTENT）。</p>
</div>
</div>


<h2 id="generatingRestControllers">10.5.3 使用基架生成 REST 控制器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/restfulControllers/generatingRestControllers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>要查看这些概念中的一些并帮助您继续使用， <a href="http://grails.org/plugins.html#plugin/scaffolding">scaffolding plugin</a>2.0版及更高版本可以为您生成一个REST-ready控制器，只需运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails generate-controller &lt;&lt;Domain Class Name&gt;&gt;</code></pre>
</div>
</div>


<h2 id="callingRestServices">10.6 使用 HttpClient 调用 REST 服务</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/callingRestServices.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>使用 <a href="https://docs.micronaut.io/latest/guide/index.html#httpClient">Micronaut HTTP客户端</a>，调用Grails REST服务以及第三方服务非常简单。该HTTP客户端同时具有低级API和高级AOP驱动的API，从而使其既可用于简单请求，也可用于构建声明性的类型安全的API层。</p>
</div>
<div class="paragraph">
<p>要使用Micronaut HTTP客户端，您必须在类路径上具有 <code>micronaut-http-client</code> 依赖项。将以下依赖项添加到您的build.gradle文件中。</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">io.micronaut:micronaut-http-client</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_低级_api">低级 API</h4>
<div class="paragraph">
<p><a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClient.html">HttpClient</a>接口构成了低级API的基础。该接口声明了一些方法，以帮助简化执行HTTP请求和接收响应的过程。
HttpClient接口中的大多数方法都返回Reactive Streams Publisher实例，并且包含一个称为RxHttpClient的子接口，该子接口提供了HttpClient接口的变体，该接口返回RxJava Flowable类型。在阻塞流中使用HttpClient时，您可能希望调用toBlocking（）以返回 <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/BlockingHttpClient.html的实例">BlockingHttpClient</a>。</p>
</div>
<div class="paragraph">
<p>您可以通过几种方式获取对 <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClient.html">HttpClient</a>的引用。最简单的方法是使用 <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/HttpClient.html#create-java.net.URL-">create</a>方法</p>
</div>
<div class="listingblock">
<div class="title">创建一个HTTP客户端</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    <span class="predefined-type">List</span>&lt;Album&gt; searchWithApi(<span class="predefined-type">String</span> searchTerm) {
        <span class="predefined-type">String</span> baseUrl = <span class="string"><span class="delimiter">&quot;</span><span class="content">https://itunes.apple.com/</span><span class="delimiter">&quot;</span></span>

        HttpClient client = HttpClient.create(baseUrl.toURL()).toBlocking() <i class="conum" data-value="1"></i><b>(1)</b>

        HttpRequest request = HttpRequest.GET(<span class="string"><span class="delimiter">&quot;</span><span class="content">/search?limit=25&amp;media=music&amp;entity=album&amp;term=</span><span class="inline"><span class="inline-delimiter">${</span>searchTerm<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
        HttpResponse&lt;<span class="predefined-type">String</span>&gt; resp = client.exchange(request, <span class="predefined-type">String</span>)
        client.close() <i class="conum" data-value="2"></i><b>(2)</b>

        <span class="predefined-type">String</span> json = resp.body()
        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper() <i class="conum" data-value="3"></i><b>(3)</b>
        objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, <span class="predefined-constant">false</span>)
        <span class="predefined-type">SearchResult</span> searchResult = objectMapper.readValue(json, <span class="predefined-type">SearchResult</span>)
        searchResult.results
    }</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>使用create方法创建一个新的HttpClient实例，并使用toBlocking（）将其转换为一个BlockingHttpClient实例</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>应该使用 <code>close</code> 方法关闭客户端，以防止线程泄漏。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>杰克逊的 <a href="https://fasterxml.github.io/jackson-databind/javadoc/2.9/com/fasterxml/jackson/databind/ObjectMapper.html">ObjectMapper</a> API可用于将原始JSON映射到POGO。案例 <code>SearchResult</code>。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>请参阅 <a href="https://docs.micronaut.io/latest/guide/index.html">Micronaut用户指南</a>的 <a href="https://docs.micronaut.io/latest/guide/index.html#lowLevelHttpClient">Http客户端部分</a>有关使用 <code>HttpClient</code> 低级API的更多信息。</p>
</div>
</div>
<div class="sect3">
<h4 id="_陈述式_api">陈述式 API</h4>
<div class="paragraph">
<p>可以通过将 <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/client/annotation/Client.html"><code>@ Client</code></a>批注添加到任何接口或抽象类来编写声明性HTTP客户端。使用Micronaut的AOP支持（请参阅 <a href="https://docs.micronaut.io/latest/guide/index.html#introductionAdvice">Introduction Advice</a>上的Micronaut用户指南部分），抽象或接口方法将在编译时为您实现作为HTTP调用。声明性客户端可以返回数据绑定的POGO（或POJO），而无需调用代码进行特殊处理。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.annotation.Client</span>

<span class="annotation">@Client</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">https://itunes.apple.com/</span><span class="delimiter">&quot;</span></span>)
<span class="type">interface</span> ItunesClient {

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/search?limit=25&amp;media=music&amp;entity=album&amp;term={term}</span><span class="delimiter">&quot;</span></span>)
    <span class="predefined-type">SearchResult</span> search(<span class="predefined-type">String</span> term)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，HTTP客户端方法使用适当的HTTP方法进行注释，例如 <code>@Get</code> 或 <code>@Post</code>。</p>
</div>
<div class="paragraph">
<p>要使用上面示例中的客户端，只需使用@Autowired批注将客户端的实例注入到任何bean中即可。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">  <span class="annotation">@Autowired</span>
    ItunesClient itunesClient

    <span class="predefined-type">List</span>&lt;Album&gt; searchAlbums(<span class="predefined-type">String</span> searchTerm) {
        <span class="predefined-type">SearchResult</span> searchResult = itunesClient.search(searchTerm)
        searchResult.results
    }</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="/index.html">Micronaut用户指南</a>。 有关编写和使用声明性客户端的更多详细信息，请参阅https的 <a href="https://docs.micronaut.io/latest/guide/index.html#clientAnnotation">Http客户端部分</a>://docs.micronaut.io/latest/guide</p>
</div>
</div>


<h2 id="restProfile">10.7 REST 配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/restProfile.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>从Grails 3.1开始，Grails支持用于创建REST应用程序的量身定制的配置文件，该应用程序提供了更加集中的依赖性和命令集。</p>
</div>
<div class="paragraph">
<p>要开始使用REST概要文件，请创建一个应用程序，指定 <code>rest-api</code> 作为概要文件的名称：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app my-api --profile rest-api</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将创建一个新的REST应用程序，该应用程序提供以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>用于创建和生成REST端点的默认命令集</p>
</li>
<li>
<p>默认为使用JSON视图来呈现响应（请参阅下一节）</p>
</li>
<li>
<p>少于默认Grails插件的插件（无GSP，无资产管道，无HTML相关）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，您会在grails-app / views目录中注意到有* .gson文件可用于呈现默认索引页以及任何404和500错误。</p>
</div>
<div class="paragraph">
<p>如果发出以下命令集：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-domain-class my.api.Book
$ grails generate-all my.api.Book</code></pre>
</div>
</div>
<div class="paragraph">
<p>代替CRUD HTML接口的是，生成了一个生成JSON响应的REST端点。另外，默认情况下，生成的功能和单元测试会测试REST端点。</p>
</div>


<h2 id="angularJsProfile">10.8 AngularJS 配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/angularJsProfile.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>从Grails 3.1开始，Grails支持使用AngularJS创建应用程序的配置文件，该配置文件提供了更加集中的依赖性和命令集。角度轮廓继承自REST轮廓，因此具有REST轮廓具有的所有命令和属性。
要开始使用AngularJS配置文件，请创建一个应用程序，将 <code>angularjs</code> 指定为配置文件的名称
**</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app my-api --profile angularjs</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将创建一个新的Grails应用程序，该应用程序提供以下功能：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>用于创建AngularJS工件的默认命令集</p>
</li>
<li>
<p>Gradle插件来管理客户端依赖性</p>
</li>
<li>
<p>Gradle插件来执行客户端单元测试</p>
</li>
<li>
<p>Asset Pipeline插件可简化开发</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认情况下，AngularJS配置文件包含GSP支持以呈现索引页面。这是必需的，因为配置文件是围绕资产管道设计的。
新命令是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>create-ng-component</code></p>
</li>
<li>
<p><code>create-ng-controller</code></p>
</li>
<li>
<p><code>create-ng-directive</code></p>
</li>
<li>
<p><code>create-ng-domain</code></p>
</li>
<li>
<p><code>create-ng-module</code></p>
</li>
<li>
<p><code>create-ng-service</code></p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_项目结构">项目结构</h4>
<div class="paragraph">
<p>AngularJS配置文件是围绕特定项目结构设计的。 <code>create-ng</code> 命令将自动创建不存在的模块。
例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-ng-controller foo</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在grails-app/assets/javascripts/${默认包名称} / controllers中生成一个fooController.js文件。
注意：默认情况下，angularjs配置文件将在 <code>javascripts</code> 目录中创建文件。您可以在配置中使用 <code>grails.codegen.angular.assettir</code> 键更改该行为。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-ng-domain foo.bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在 <code>grails app/assets/javascripts/foo/domains</code> 中生成一个 <code>Bar.js</code> 文件。它还将创建 <code>FoO</code> 模块，如果它不存在的话。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-ng-module foo.bar</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在 <code>grails app/assets/javascripts/foo/bar</code> 中生成一个 <code>foo.bar.js</code> 文件。注意模块的命名约定与其他人工制品不同。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-ng-service foo.bar --type constant</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在 <code>grails app/assets/javascripts/foo/services</code> 中生成一个 <code>bar.js</code> 文件。它还将创建 <code>FoO</code> 模块，如果它不存在的话。 <code>create ng service</code> 命令接受标志 <code>type</code>。可使用的类型有：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>服务</p>
</li>
<li>
<p>工厂_默认值_</p>
</li>
<li>
<p>价值</p>
</li>
<li>
<p>提供者</p>
</li>
<li>
<p>常数</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>除了artefacts本身，概要文件还将为每个create命令在 <code>src/test/javascripts</code> 下生成一个框架单元测试文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_客户端依赖性">客户端依赖性</h4>
<div class="paragraph">
<p><a href="https://github.com/craigburke/bowerinstallergradle">gradle bower Plugin</a> 用于管理与bower的依赖关系。访问插件文档了解如何使用插件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_单元测试">单元测试</h4>
<div class="paragraph">
<p><a href="https://github.com/craigburke/karmagradle">gradle karma Plugin</a>用于执行客户端单元测试。所有生成的测试都是用Jasmine编写的。访问插件文档了解如何使用插件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_资产管道">资产管道</h4>
<div class="paragraph">
<p>AngularJS概要文件包括几个资产管道插件，使开发更容易。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/craigburke/js-closure-wrap-asset-pipeline">js closure wrap asset pipeline</a>将在立即调用的函数表达式中包装角度代码。</p>
</li>
<li>
<p><a href="https://github.com/craigburke/angular-annotate-asset-pipeline">annotate-asset-pipeline</a>将对依赖项进行注释，以便安全地进行缩小。</p>
</li>
<li>
<p><a href="https://github.com/craigburke/angular-template-asset-pipeline">template-asset-pipeline</a>会将模板放入 <code>$templateCache</code> 中，以防止http请求检索模板。</p>
</li>
</ul>
</div>
</div>


<h2 id="angularProfile">10.9 Angular 配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/angularProfile.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>从Grails 3.2.1开始，Grails支持使用Angular创建应用程序的配置文件，该配置文件提供了面向未来的设置。此配置文件的最大变化是，该配置文件创建了一个多项目gradle构建。这是第一个这样做的配置文件。 Angular配置文件依赖于 <a href="https://github.com/angular/angular-cli">Angular CLI</a>来管理客户端应用程序。服务器端应用程序与使用 <code>rest-api</code> 配置文件创建的应用程序相同。要开始使用Angular概要文件，请创建一个应用程序，将 <code>angular</code> 指定为概要文件的名称：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ grails create-app my-app --profile angular</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将创建一个包含以下内容的 <code>my-app</code> 目录：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>client/
gradle/
gradlew
gradlew.bat
server/
settings.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p>整个客户端应用程序位于 <code>client</code> 文件夹中，而整个服务器应用程序位于 <code>server</code> 文件夹中。</p>
</div>
<div class="sect3">
<h4 id="_先决条件">先决条件</h4>
<div class="paragraph">
<p>要使用此配置文件，您应该安装了Node，NPM和Angular CLI。节点至少应为版本5​​，NPM应至少为版本3。</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.npmjs.com/getting-started/installing-node">Node &amp;&amp; NPM</a></p>
</li>
<li>
<p><a href="https://github.com/angular/angular-cli#installation">Angular CLI</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_项目结构">项目结构</h4>
<div class="paragraph">
<p>Angular配置文件旨在与 <a href="https://github.com/angular/angular-cli">Angular CLI</a>一起使用。 CLI用于创建概要文件的客户端应用程序端。 CLI提供了用于执行客户端应用程序要执行的大多数操作的命令，包括创建组件或服务。因此，概要文件本身不提供执行相同操作的命令。</p>
</div>
</div>
<div class="sect3">
<h4 id="_运行应用">运行应用</h4>
<div class="paragraph">
<p>仅执行服务器端应用程序，您可以在 <code>server</code> 项目中执行 <code>bootRun</code> 任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew server:bootRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以对客户端应用程序执行相同的操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew client:bootRun</code></pre>
</div>
</div>
<div class="paragraph">
<p>要同时执行这两项，您必须并行执行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew bootRun --parallel</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
必须并行执行此操作，因为默认情况下，Gradle会同步执行任务，并且两个bootRun任务都不会 <code>完成</code>。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_测试">测试</h4>
<div class="paragraph">
<p>配置文件随附的默认客户端应用程序提供了一些可以执行的测试。要在应用程序中执行测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew test</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>test</code> 任务将与Karma和Jasmine一起执行单元测试。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew integrationTest</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>integrationTest</code> 任务将使用量角器执行e2e测试。
TIP: 您可以在每个子项目上执行 <code>test</code> 和 <code>integrationTest</code> 任务，就像执行 <code>bootRun</code> 一样。</p>
</div>
</div>
<div class="sect3">
<h4 id="_cors">CORS</h4>
<div class="paragraph">
<p>由于客户端和服务器端将在单独的端口上运行，因此需要进行CORS配置。默认情况下，配置文件将配置服务器端以允许通过以下配置来自所有主机的CORS：</p>
</div>
<div class="listingblock">
<div class="title">server/grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">grails</span>:
    <span class="key">cors</span>:
        <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>请参阅以下部分 <a href="theWebLayer.html#cors">CORS</a> 在用户指南中获取有关根据需要配置此功能的信息。</p>
</div>
</div>


<h2 id="jsonViews">10.10 JSON 视图</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/jsonViews.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如上一节所述，REST概要文件默认情况下使用JSON视图来呈现JSON响应。它们起着与GSP类似的作用，但是经过优化，可用于输出JSON响应而不是HTML。</p>
</div>
<div class="paragraph">
<p>您可以根据MVC继续分离应用程序，而应用程序的逻辑位于控制器和服务中，而视图相关事务则由JSON视图处理。</p>
</div>
<div class="paragraph">
<p>JSON视图还提供了灵活性，可以轻松地自定义呈现给客户端的JSON，而不必诉诸相对复杂的编组库，例如Jackson或Grails的marshaller API。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
自从 Grails 3.1, JSON Grails团队认为，视图是向客户端显示JSON输出的最佳方法，有关编写自定义编组器的部分已从用户指南中删除。如果您正在寻找有关该主题的信息，请参阅 <a href="http://grails.github.io/grails-doc/3.0.x/guide/webServices.html#objectMarshallers">the Grails 3.0.x guide</a>.
</td>
</tr>
</table>
</div>


<h2 id="jsonViewsSetup">10.10.1 入门</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/jsonViews/jsonViewsSetup.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果您使用的是REST或AngularJS配置文件，那么JSON视图插件将已经包括在内，您可以跳过本节的其余部分。否则，您需要修改 <code>build.gradle</code> 以包含激活JSON视图所需的插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:views-json:1.0.0</span><span class="delimiter">'</span></span> <span class="comment">// or whatever is the latest version</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>提示：如果您需要更多的文档和贡献，可以在github上找到 <a href="https://github.com/grails/grails视图">JSON视图的源代码存储库</a></p>
</div>
<div class="paragraph">
<p>为了编译用于生产部署的JSON视图，还应该首先修改 <code>buildscript</code> 块来激活Gradle插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">buildscript {
    ...
    dependencies {
        ...
        classpath <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:views-gradle:1.0.0</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后在任何grails核心Gradle插件之后应用 <code>org.grails.plugins.views json</code> Gradle插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">...
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.grails-web</span><span class="delimiter">&quot;</span></span>
apply <span class="key">plugin</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins.views-json</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将向Gradle添加一个 <code>compileGsonViews</code> 任务，该任务在创建生产JAR或WAR文件之前被调用。</p>
</div>


<h2 id="jsonViewsCreating">10.10.2 创建 JSON 视图</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/jsonViews/jsonViewsCreating.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>JSON视图进入 <code>grails-app / views</code> 目录，并以 <code>.gson</code> 后缀结尾。它们是常规的Groovy脚本，可以在任何Groovy编辑器中打开</p>
</div>
<div class="paragraph">
<p>JSON视图示例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">json.person {
    name <span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
要在Intellij IDEA的Groovy编辑器中打开它们，请双击该文件，然后在询问与之关联的文件时，选择 <code>Groovy</code>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>上面的JSON视图产生:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{<span class="key"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>:{<span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">bob</span><span class="delimiter">&quot;</span></span>}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有一个隐式的 <code>json</code> 变量，它是 <a href="http://docs.groovy-lang.org/latest/html/api/groovy/json/StreamingJsonBuilder.html">StreamingJsonBuilder</a>的实例。</p>
</div>
<div class="paragraph">
<p>用法示例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">json(<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>) == <span class="string"><span class="delimiter">&quot;</span><span class="content">[1,2,3]</span><span class="delimiter">&quot;</span></span>
json { name <span class="string"><span class="delimiter">&quot;</span><span class="content">Bob</span><span class="delimiter">&quot;</span></span> } == <span class="string"><span class="delimiter">'</span><span class="content">{&quot;name&quot;:&quot;Bob&quot;}</span><span class="delimiter">'</span></span>
json([<span class="integer">1</span>,<span class="integer">2</span>,<span class="integer">3</span>]) { n <span class="local-variable">it</span> } == <span class="string"><span class="delimiter">'</span><span class="content">[{&quot;n&quot;:1},{&quot;n&quot;:2},{&quot;n&quot;:3}]</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>有关可能的更多信息，请参阅 <a href="http://docs.groovy-lang.org/latest/html/api/groovy/json/StreamingJsonBuilder.html">StreamingJsonBuilder</a>上的API文档。</p>
</div>


<h2 id="jsonViewsAndTemplates">10.10.3 JSON 视图模板</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/jsonViews/jsonViewsAndTemplates.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>您可以定义下划线 <code>_</code> 开头的模板。例如，给定以下名为 <code>_person.gson</code> 的模板：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    Person person
}
json {
    name person.name
    age person.age
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用如下视图进行渲染：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    Family family
}
json {
    name family.father.name
    age family.father.age
    oldestChild g.render(<span class="key">template</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>:[<span class="key">person</span>: family.children.max { Person p -&gt; p.age } ])
    children g.render(<span class="key">template</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">person</span><span class="delimiter">&quot;</span></span>, <span class="key">collection</span>: family.children, <span class="key">var</span>:<span class="string"><span class="delimiter">'</span><span class="content">person</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，使用tmpl变量以更简洁的方式调用模板：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    Family family
}
json {
    name family.father.name
    age family.father.age
    oldestChild tmpl.person( family.children.max { Person p -&gt; p.age } ] )
    children tmpl.person( family.children )
}</code></pre>
</div>
</div>


<h2 id="jsonViewsAndDomainClasses">10.10.4 使用 JSON 视图呈现域类</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/jsonViews/jsonViewsAndDomainClasses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>通常，您的模型可能涉及一个或多个域实例。 JSON视图提供了一种渲染方法。</p>
</div>
<div class="paragraph">
<p>例如，给定以下域类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>和以下模板：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">model {
    <span class="predefined-type">Book</span> book
}

json g.render(book)</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果输出为：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">{<span class="key">id</span>:<span class="integer">1</span>, <span class="key">title</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以通过包含或排除属性来自定义渲染：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">json g.render(book, [<span class="key">includes</span>:[<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>]])</code></pre>
</div>
</div>
<div class="paragraph">
<p>或通过提供一个闭包来添加其他JSON输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">json g.render(book) {
    pages <span class="integer">1000</span>
}</code></pre>
</div>
</div>


<h2 id="jsonViewsTemplatesAndConventions">10.10.5 按约定进行的 JSON 视图</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/jsonViews/jsonViewsTemplatesAndConventions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>创建JSON视图时，可以遵循一些有用的约定。例如，如果您有一个名为 <code>Book</code> 的域类，然后在 <code>grails-app/views/book/_book.gson</code> 处创建一个模板，并使用<a href="../ref/Controllers/respond.html">respond</a>方法将导致呈现模板：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>(<span class="predefined-type">Long</span> id) {
    respond <span class="predefined-type">Book</span>.get(id)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>另外，如果默认情况下在验证过程中发生错误，Grails将尝试渲染一个名为 <code>grails-app/views/book/_errors.gson</code> 的模板，否则它将尝试渲染 <code>grails-app/views/errors/_errors.gson</code>  如果前者不存在。这很有用，因为当持久化对象时，您可以 <code>响应</code> 验证错误以呈现上述模板：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Transactional</span>
<span class="keyword">def</span> <span class="function">save</span>(<span class="predefined-type">Book</span> book) {
    <span class="keyword">if</span> (book.hasErrors()) {
        transactionStatus.setRollbackOnly()
        respond book.errors
    }
    <span class="keyword">else</span> {
        <span class="comment">// valid object</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果在上面的示例中发生验证错误，则会显示 <code>grails-app/views/book/_errors.gson</code> 模板。有关JSON视图（和标记视图）的更多信息，请参见 <a href="http://views.grails.org/latest/">JSON Views user guide</a>.</p>
</div>


<h2 id="renderers">10.11 自定义响应呈现</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/renderers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果您正在寻找更底层的API，而JSON或Markup视图不适合您的需求，那么您可能要考虑实现自定义渲染器。</p>
</div>


<h2 id="defaultRenderers">10.11.1 自定义默认渲染器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/renderers/defaultRenderers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>XML和JSON的默认呈现器分别位于 <code>grails.rest.render.XML</code> 和 <code>grails.rest.render.JSON</code> 包中。默认情况下，它们使用Grails转换器（ <code>Grails.converters.XML</code> 和 <code>Grails.converters.JSON</code> ）进行响应呈现。</p>
</div>
<div class="paragraph">
<p>可以使用这些默认呈现器轻松自定义响应呈现。您可能要进行的一个常见更改是在渲染中包含或排除某些属性。</p>
</div>
<div class="sect3">
<h4 id="_包括或排除渲染中的属性">包括或排除渲染中的属性</h4>
<div class="paragraph">
<p>如前所述，Grails维护 <code>Grails.rest.render.Renderer</code> 实例的注册表。有一些默认配置的呈现器以及为给定域类甚至为域类集合注册或重写呈现器的能力。要包含来自呈现的特定属性，您需要通过在 <code>grails app/conf/spring/resources.groovy</code> 中定义bean来注册自定义呈现器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.xml.*</span>

beans = {
    bookRenderer(XmlRenderer, <span class="predefined-type">Book</span>) {
        includes = [<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：bean名称并不重要（Grails将扫描所有注册的呈现器bean的应用程序上下文），但出于组织和可读性的目的，建议您将其命名为有意义的名称。</p>
</div>
<div class="paragraph">
<p>要排除属性，可以使用 <code>XmlRenderer</code> 类的 <code>excludes</code> 属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.xml.*</span>

beans = {
    bookRenderer(XmlRenderer, <span class="predefined-type">Book</span>) {
        excludes = [<span class="string"><span class="delimiter">'</span><span class="content">isbn</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_自定义转换器">自定义转换器</h3>
<div class="paragraph">
<p>如前所述，默认呈现使用封面下的 <code>grails.converters</code> 包。换言之，在封面下，他们基本上做了以下工作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.converters.*</span>

...
render book <span class="keyword">as</span> XML

<span class="comment">// or render book as JSON</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>为什么转换器和渲染器之间要分离？渲染器有更大的灵活性来使用你所选择的渲染技术。在实现自定义渲染器时，可以使用 <a href="http://wiki.fasterxml.com/JacksonHome">Jackson</a>、 <a href="http://code.google.com/p/googlegson/">gson</a>或任何Java库来实现渲染器。另一方面，转换器与Grails自己的封送处理实现紧密相连。</p>
</div>
</div>


<h2 id="customRenderers">10.11.2 实现自定义渲染器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/renderers/customRenderers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果您想要对呈现进行更多的控制，或者更喜欢使用自己的封送处理技术，那么可以实现自己的 <code>Renderer</code> 实例。例如，下面是一个自定义 <code>Book</code> 类呈现的简单实现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myapp
<span class="keyword">import</span> <span class="include">grails.rest.render.*</span>
<span class="keyword">import</span> <span class="include">grails.web.mime.MimeType</span>

<span class="type">class</span> <span class="class">BookXmlRenderer</span> <span class="directive">extends</span> AbstractRenderer&lt;<span class="predefined-type">Book</span>&gt; {
    BookXmlRenderer() {
        <span class="local-variable">super</span>(<span class="predefined-type">Book</span>, [MimeType.XML,MimeType.TEXT_XML] <span class="keyword">as</span> MimeType<span class="type">[]</span>)
    }

    <span class="type">void</span> render(<span class="predefined-type">Book</span> object, <span class="predefined-type">RenderContext</span> context) {
        context.contentType = MimeType.XML.name

        <span class="keyword">def</span> xml = <span class="keyword">new</span> groovy.xml.MarkupBuilder(context.writer)
        xml.book(<span class="key">id</span>: object.id, <span class="key">title</span>:object.title)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>AbstractRenderer</code> 超级类有一个构造函数，该构造函数接受它所呈现的类和（通过ACCEPT头或文件扩展名）为呈现器接受的 <code>MimeType</code> 。
要配置这个渲染器，只需将它作为一个bean添加到 <code>grails app/conf/spring/resources.groovy</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    bookRenderer(myapp.BookXmlRenderer)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果将是所有 <code>Book</code> 实例将以以下格式呈现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;book id=<span class="string"><span class="delimiter">&quot;</span><span class="content">1</span><span class="delimiter">&quot;</span></span> title=<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意：如果您将呈现更改为与上述完全不同的格式，那么如果您计划支持POST和PUT请求，还需要更改绑定。否则Grails将不会自动知道如何将数据从自定义XML格式绑定到域类。有关详细信息，请参阅 <code>自定义资源绑定</code> 一节。</p>
</div>
<div class="sect3">
<h4 id="_容器渲染器">容器渲染器</h4>
<div class="paragraph">
<p><code>grails.rest.render.ContainerRenderer</code> 是为对象容器（列表、映射、集合等）呈现响应的呈现程序。该接口与 <code>Renderer</code> 接口基本相同，只是添加了 <code>getComponentType（）</code> 方法，该方法应返回 <code>contained</code> 类型。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookListRenderer</span> <span class="directive">implements</span> ContainerRenderer&lt;<span class="predefined-type">List</span>, <span class="predefined-type">Book</span>&gt; {
    <span class="predefined-type">Class</span>&lt;<span class="predefined-type">List</span>&gt; getTargetType() { <span class="predefined-type">List</span> }
    <span class="predefined-type">Class</span>&lt;<span class="predefined-type">Book</span>&gt; getComponentType() { <span class="predefined-type">Book</span> }
    MimeType<span class="type">[]</span> getMimeTypes() { [ MimeType.XML] <span class="keyword">as</span> MimeType<span class="type">[]</span> }
    <span class="type">void</span> render(<span class="predefined-type">List</span> object, <span class="predefined-type">RenderContext</span> context) {
        ....
    }
}</code></pre>
</div>
</div>
</div>


<h2 id="gspRenderers">10.11.3 使用 GSP 自定义渲染</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/renderers/gspRenderers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>您还可以使用Groovy服务器页面（GSP）根据每个操作自定义呈现。例如，考虑到前面提到的 <code>show</code> 操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>(<span class="predefined-type">Book</span> book) {
    respond book
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以提供一个 <code>show.xml.gsp</code> 文件来自定义xml的呈现：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;%<span class="annotation">@page</span> contentType=<span class="string"><span class="delimiter">&quot;</span><span class="content">application/xml</span><span class="delimiter">&quot;</span></span>%&gt;
&lt;book id=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>book.id<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> title=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>book.title<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>


<h2 id="hypermedia">10.12 超媒体作为应用程序状态的引擎</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/hypermedia.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://en.wikipedia.org/wiki/HATEOAS">HATEOAS</a>是Hypermedia作为应用程序状态引擎的缩写，是一种应用到REST体系结构的通用模式，该模式使用超媒体并通过链接来定义REST API。</p>
</div>
<div class="paragraph">
<p>超媒体（也称为Mime或媒体类型）用于描述REST资源的状态，链接告诉客户端如何过渡到下一个状态。响应的格式通常为JSON或XML，尽管标准格式如 <a href="http://tools.ietf.org/html/rfc4287">Atom</a>和/或 <a href="http://stateless.co/hal_specification.html">HAL</a>是经常使用。</p>
</div>


<h2 id="hal">10.12.1 HAL 支持</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/hypermedia/hal.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://stateless.co/hal_specification.html">HAL</a>是开发遵循HATEOAS原理的REST API时常用的标准交换格式。代表订单列表的示例HAL文档如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/orders</span><span class="delimiter">&quot;</span></span> },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">next</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/orders?page=2</span><span class="delimiter">&quot;</span></span> },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">find</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/orders{?id}</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">templated</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>
        },
        <span class="key"><span class="delimiter">&quot;</span><span class="content">admin</span><span class="delimiter">&quot;</span></span>: [{
            <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/admins/2</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
        }, {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/admins/5</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Kate</span><span class="delimiter">&quot;</span></span>
        }]
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">currentlyProcessing</span><span class="delimiter">&quot;</span></span>: <span class="integer">14</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">shippedToday</span><span class="delimiter">&quot;</span></span>: <span class="integer">20</span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">_embedded</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">order</span><span class="delimiter">&quot;</span></span>: [{
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/orders/123</span><span class="delimiter">&quot;</span></span> },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">basket</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/baskets/98712</span><span class="delimiter">&quot;</span></span> },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/customers/7809</span><span class="delimiter">&quot;</span></span> }
            },
            <span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>: <span class="float">30.00</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">USD</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">shipped</span><span class="delimiter">&quot;</span></span>
        }, {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
                <span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/orders/124</span><span class="delimiter">&quot;</span></span> },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">basket</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/baskets/97213</span><span class="delimiter">&quot;</span></span> },
                <span class="key"><span class="delimiter">&quot;</span><span class="content">customer</span><span class="delimiter">&quot;</span></span>: { <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/customers/12369</span><span class="delimiter">&quot;</span></span> }
            },
            <span class="key"><span class="delimiter">&quot;</span><span class="content">total</span><span class="delimiter">&quot;</span></span>: <span class="float">20.00</span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">currency</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">USD</span><span class="delimiter">&quot;</span></span>,
            <span class="key"><span class="delimiter">&quot;</span><span class="content">status</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">processing</span><span class="delimiter">&quot;</span></span>
        }]
    }
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_使用hal公开资源">使用HAL公开资源</h4>
<div class="paragraph">
<p>要为资源返回HAL而不是常规JSON，您可以简单地在 <code>grails-app/conf/spring/resources.groovy</code> 中使用 <code>grails.rest.render.hal.HalJsonRenderer</code> （或 <code>HalXmlRenderer</code> ）实例覆盖渲染器对于XML版本）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.hal.*</span>
beans = {
    halBookRenderer(HalJsonRenderer, rest.test.Book)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还需要更新资源的可接受响应格式，以便包含HAL格式。不这样做将导致服务器返回406-Not Acceptable响应。</p>
</div>
<div class="paragraph">
<p>这可以通过设置 <code>资源</code> 转换的 <code>格式</code> 属性来完成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.*</span>

<span class="annotation">@Resource</span>(uri=<span class="string"><span class="delimiter">'</span><span class="content">/books</span><span class="delimiter">'</span></span>, formats=[<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">hal</span><span class="delimiter">'</span></span>])
<span class="type">class</span> <span class="class">Book</span> {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或通过更新控制器中的 <code>responseFormats</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> <span class="directive">extends</span> RestfulController {
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">hal</span><span class="delimiter">'</span></span>]

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>放置适当的bean并请求HAL内容类型时，将返回HAL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Accept: application/hal+json</span><span class="delimiter">&quot;</span></span> <span class="key">http</span>:<span class="comment">//localhost:8080/books/1</span>

HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
<span class="key">Server</span>: Apache-Coyote/<span class="float">1.1</span>
Content-<span class="predefined-type">Type</span>: application/hal+json;charset=ISO-<span class="integer">8859</span>-<span class="integer">1</span>

{
  <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
      <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/1</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">The Stand</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要使用HAL XML格式，只需更改渲染器即可：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.hal.*</span>
beans = {
    halBookRenderer(HalXmlRenderer, rest.test.Book)
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用hal渲染集合">使用HAL渲染集合</h4>
<div class="paragraph">
<p>要返回HAL而不是常规JSON作为资源列表，您可以简单地在 <code>grails-app / conf / spring / resources.groovy</code> 中使用 <code>grails.rest.render.hal.HalJsonCollectionRenderer</code> 实例覆盖渲染器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.hal.*</span>
beans = {
    halBookCollectionRenderer(HalJsonCollectionRenderer, rest.test.Book)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>放置适当的bean并请求HAL内容类型时，将返回HAL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Accept: application/hal+json</span><span class="delimiter">&quot;</span></span> <span class="key">http</span>:<span class="comment">//localhost:8080/books</span>
HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
<span class="key">Server</span>: Apache-Coyote/<span class="float">1.1</span>
Content-<span class="predefined-type">Type</span>: application/hal+json;charset=UTF-<span class="integer">8</span>
Transfer-<span class="key">Encoding</span>: chunked
<span class="predefined-type">Date</span>: Thu, <span class="integer">17</span> Oct <span class="integer">2013</span> <span class="octal">02</span>:<span class="integer">34</span>:<span class="integer">14</span> GMT

{
  <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
      <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="string"><span class="delimiter">&quot;</span><span class="content">_embedded</span><span class="delimiter">&quot;</span></span>: {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">book</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
          <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/1</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>
      },
      {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
          <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/2</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Infinite Jest</span><span class="delimiter">&quot;</span></span>
      },
      {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
          <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/3</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Walden</span><span class="delimiter">&quot;</span></span>
      }
    ]
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>注意，与呈现的JSON中的Book对象列表相关的键是book，它是从集合中的对象类型Book派生的。为了自定义此键的值，将一个值分配给 <code>HalJsonCollectionRenderer</code>  bean上的 <code>collectionName</code> 属性，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.hal.*</span>
beans = {
    halBookCollectionRenderer(HalCollectionJsonRenderer, rest.test.Book) {
        collectionName = <span class="string"><span class="delimiter">'</span><span class="content">publications</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置好之后，渲染的HAL将如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Accept: application/hal+json</span><span class="delimiter">&quot;</span></span> <span class="key">http</span>:<span class="comment">//localhost:8080/books</span>
HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
<span class="key">Server</span>: Apache-Coyote/<span class="float">1.1</span>
Content-<span class="predefined-type">Type</span>: application/hal+json;charset=UTF-<span class="integer">8</span>
Transfer-<span class="key">Encoding</span>: chunked
<span class="predefined-type">Date</span>: Thu, <span class="integer">17</span> Oct <span class="integer">2013</span> <span class="octal">02</span>:<span class="integer">34</span>:<span class="integer">14</span> GMT

{
  <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
      <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="string"><span class="delimiter">&quot;</span><span class="content">_embedded</span><span class="delimiter">&quot;</span></span>: {
    <span class="string"><span class="delimiter">&quot;</span><span class="content">publications</span><span class="delimiter">&quot;</span></span>: [
      {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
          <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/1</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>
      },
      {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
          <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/2</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Infinite Jest</span><span class="delimiter">&quot;</span></span>
      },
      {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
          <span class="string"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/3</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
            <span class="string"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/hal+json</span><span class="delimiter">&quot;</span></span>
          }
        },
        <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Walden</span><span class="delimiter">&quot;</span></span>
      }
    ]
  }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用自定义媒体_mime类型">使用自定义媒体/ MIME类型</h4>
<div class="paragraph">
<p>如果您想使用自定义的Mime类型，则首先需要在grails-app/conf/application.groovy中声明Mime类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.mime.types = [
    <span class="key">all</span>:      <span class="string"><span class="delimiter">&quot;</span><span class="content">*/*</span><span class="delimiter">&quot;</span></span>,
    <span class="key">book</span>:     <span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.book+json</span><span class="delimiter">&quot;</span></span>,
    <span class="key">bookList</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.booklist+json</span><span class="delimiter">&quot;</span></span>,
    ...
]</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
将新的MIME类型放在 <code>所有</code>  MIME类型之后非常重要，因为如果无法建立请求的内容类型，则映射中的第一个条目将用作响应。如果您的新Mime类型位于顶部，那么在无法建立请求的Mime类型时，Grails将始终尝试发送新的Mime类型。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>然后覆盖渲染器以使用自定义Mime类型返回HAL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.hal.*</span>
<span class="keyword">import</span> <span class="include">grails.web.mime.*</span>

beans = {
    halBookRenderer(HalJsonRenderer, rest.test.Book, <span class="keyword">new</span> MimeType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.book+json</span><span class="delimiter">&quot;</span></span>, [<span class="key">v</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>]))
    halBookListRenderer(HalJsonCollectionRenderer, rest.test.Book, <span class="keyword">new</span> MimeType(<span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.booklist+json</span><span class="delimiter">&quot;</span></span>, [<span class="key">v</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>]))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，第一个bean为单个图书实例定义了一个HAL渲染器，该实例返回Mime类型为application/vnd.books.org.book + json的Hime渲染器。第二个bean定义了用于呈现书籍集合的Mime Type（在本例中为application/vnd.books.org.booklist + json）。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>application/vnd.books.org.booklist+json</code> 是媒体范围的一个例子 (<a href="http://www.w3.org/Protocols/rfc2616/rfc2616.html" class="bare">http://www.w3.org/Protocols/rfc2616/rfc2616.html</a> - 标头字段定义).  本示例使用实体（书）和操作（列表）形成媒体​​范围值，但实际上，可能没有必要为每个操作创建单独的Mime类型。此外，可能没有必要在实体级别创建Mime类型。有关如何定义自己的Mime类型的更多信息，请参见 <code>版本化REST资源</code> 部分。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>通过此操作发出对新Mime类型的请求，将返回必要的HAL：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -i -H &quot;Accept: application/vnd.books.org.book+json&quot; http://localhost:8080/books/1

HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
Content-Type: application/vnd.books.org.book+json;charset=ISO-8859-1

{
  &quot;_links&quot;: {
    &quot;self&quot;: {
      &quot;href&quot;: &quot;http://localhost:8080/books/1&quot;,
      &quot;hreflang&quot;: &quot;en&quot;,
      &quot;type&quot;: &quot;application/vnd.books.org.book+json&quot;
    }
  },
  &quot;title&quot;: &quot;\&quot;The Stand\&quot;&quot;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_自定义链接渲染">自定义链接渲染</h4>
<div class="paragraph">
<p>HATEOAS的一个重要方面是链接的使用，这些链接描述了客户端可以用来与REST API交互的过渡。默认情况下， <code>HalJsonRenderer</code> 将自动为您创建关联以链接到资源本身（使用 <code>自我</code> 关系）。</p>
</div>
<div class="paragraph">
<p>但是，您可以使用 <code>链接</code> 方法来自定义链接渲染，该方法添加到所有以 <code>grails.rest.Resource</code> 注释的域类或任何以 <code>grails.rest.Linkable</code> 注释的类中。例如，可以对show动作进行如下修改，以在结果输出中提供新的链接：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>(<span class="predefined-type">Book</span> book) {
    book.link <span class="key">rel</span>:<span class="string"><span class="delimiter">'</span><span class="content">publisher</span><span class="delimiter">'</span></span>, <span class="key">href</span>: g.createLink(<span class="key">absolute</span>: <span class="predefined-constant">true</span>, <span class="key">resource</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>, <span class="key">params</span>:[<span class="key">bookId</span>: book.id])
    respond book
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将导致输出，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="javascript">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">self</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/1</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/vnd.books.org.book+json</span><span class="delimiter">&quot;</span></span>
    }
    <span class="string"><span class="delimiter">&quot;</span><span class="content">publisher</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/books/1/publisher</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">hreflang</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">en</span><span class="delimiter">&quot;</span></span>
    }
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="char">\&quot;</span><span class="content">The Stand</span><span class="char">\&quot;</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以传递 <code>link</code> 方法的命名参数来匹配 <code>grails.rest.Link</code> 类的属性。</p>
</div>
</div>


<h2 id="atom">10.12.2 Atom 支持</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/hypermedia/atom.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="http://tools.ietf.org/html/rfc4287">Atom</a> 是用于实现REST API的另一种标准交换格式。 Atom输出的示例如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="preprocessor">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="tag">&lt;feed</span> <span class="attribute-name">xmlns</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.w3.org/2005/Atom</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>

 <span class="tag">&lt;title&gt;</span>Example Feed<span class="tag">&lt;/title&gt;</span>
 <span class="tag">&lt;link</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.org/</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
 <span class="tag">&lt;updated&gt;</span>2003-12-13T18:30:02Z<span class="tag">&lt;/updated&gt;</span>
 <span class="tag">&lt;author&gt;</span>
   <span class="tag">&lt;name&gt;</span>John Doe<span class="tag">&lt;/name&gt;</span>
 <span class="tag">&lt;/author&gt;</span>
 <span class="tag">&lt;id&gt;</span>urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6<span class="tag">&lt;/id&gt;</span>

 <span class="tag">&lt;entry&gt;</span>
   <span class="tag">&lt;title&gt;</span>Atom-Powered Robots Run Amok<span class="tag">&lt;/title&gt;</span>
   <span class="tag">&lt;link</span> <span class="attribute-name">href</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">http://example.org/2003/12/13/atom03</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
   <span class="tag">&lt;id&gt;</span>urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a<span class="tag">&lt;/id&gt;</span>
   <span class="tag">&lt;updated&gt;</span>2003-12-13T18:30:02Z<span class="tag">&lt;/updated&gt;</span>
   <span class="tag">&lt;summary&gt;</span>Some text.<span class="tag">&lt;/summary&gt;</span>
 <span class="tag">&lt;/entry&gt;</span>

<span class="tag">&lt;/feed&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要再次使用Atom渲染，只需定义一个自定义渲染器即可：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.rest.render.atom.*</span>
beans = {
    halBookRenderer(AtomRenderer, rest.test.Book)
    halBookListRenderer(AtomCollectionRenderer, rest.test.Book)
}</code></pre>
</div>
</div>


<h2 id="vndError">10.12.3 Vnd.错误支持</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/hypermedia/vndError.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://github.com/blongden/vnd.error">Vnd.Error</a> 是表达错误响应的标准化方法。</p>
</div>
<div class="paragraph">
<p>默认情况下，当尝试发布新资源时发生验证错误时，错误对象将以422响应代码发送回allow：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Accept: application/json</span><span class="delimiter">&quot;</span></span>  -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type: application/json</span><span class="delimiter">&quot;</span></span> -X POST -d <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="key">http</span>:<span class="comment">//localhost:8080/books</span>

HTTP/<span class="float">1.1</span> <span class="integer">422</span> Unprocessable <span class="predefined-type">Entity</span>
<span class="key">Server</span>: Apache-Coyote/<span class="float">1.1</span>
Content-<span class="predefined-type">Type</span>: application/json;charset=ISO-<span class="integer">8859</span>-<span class="integer">1</span>

{
  <span class="string"><span class="delimiter">&quot;</span><span class="content">errors</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="string"><span class="delimiter">&quot;</span><span class="content">object</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">rest.test.Book</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">field</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">rejected-value</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">null</span>,
      <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Property [title] of class [class rest.test.Book] cannot be null</span><span class="delimiter">&quot;</span></span>
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您想将格式更改为Vnd.Error，则只需在grails-app/conf/spring/resources.groovy中注册 <code>grails.rest.render.errors.VndErrorJsonRenderer</code>  bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    vndJsonErrorRenderer(grails.rest.render.errors.VndErrorJsonRenderer)
    <span class="comment">// for Vnd.Error XML format</span>
    vndXmlErrorRenderer(grails.rest.render.errors.VndErrorXmlRenderer)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，如果您更改客户端请求以接受Vnd.Error，则会得到适当的响应：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> curl -i -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Accept: application/vnd.error+json,application/json</span><span class="delimiter">&quot;</span></span> -H <span class="string"><span class="delimiter">&quot;</span><span class="content">Content-Type: application/json</span><span class="delimiter">&quot;</span></span> -X POST -d <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span> <span class="key">http</span>:<span class="comment">//localhost:8080/books</span>
HTTP/<span class="float">1.1</span> <span class="integer">200</span> OK
<span class="key">Server</span>: Apache-Coyote/<span class="float">1.1</span>
Content-<span class="predefined-type">Type</span>: application/vnd.error+json;charset=ISO-<span class="integer">8859</span>-<span class="integer">1</span>

[
    {
        <span class="string"><span class="delimiter">&quot;</span><span class="content">logref</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">book.nullable,</span></span><span class="error">
</span>        <span class="string"><span class="delimiter">&quot;</span><span class="content">message</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Property [title] of class [class rest.test.Book] cannot be null</span><span class="delimiter">&quot;</span></span>,
        <span class="string"><span class="delimiter">&quot;</span><span class="content">_links</span><span class="delimiter">&quot;</span></span>: {
            <span class="string"><span class="delimiter">&quot;</span><span class="content">resource</span><span class="delimiter">&quot;</span></span>: {
                <span class="string"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:8080/rest-test/books</span><span class="delimiter">&quot;</span></span>
            }
        }
    }
]</code></pre>
</div>
</div>


<h2 id="binding">10.13 自定义资源绑定</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/binding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>该框架提供了一种复杂而简单的机制，用于将REST请求绑定到域对象和命令对象。利用这种方法的一种方法是在控制器中将 <code>request</code> 属性绑定到域类的 <code>properties</code>。给定以下XML作为请求的主体，<code>createBook</code> 操作将创建一个新的 <code>Book</code>，并将 <code>The Stand</code> 分配给 <code>title</code> 属性，并将 <code>Stephen King</code> 分配给 <code>authorName</code> 属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;book&gt;
    &lt;title&gt;The Stand&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;authorName&gt;Stephen King&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">authorName&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">book&gt;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {

    <span class="keyword">def</span> <span class="function">createBook</span>() {
        <span class="keyword">def</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>()
        book.properties = request

        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>命令对象将自动与请求主体绑定：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">createBook</span>(BookCommand book) {

        <span class="comment">// ...</span>
    }
}

<span class="type">class</span> <span class="class">BookCommand</span> {
    <span class="predefined-type">String</span> title
    <span class="predefined-type">String</span> authorName
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果命令对象类型是域类，并且XML文档的根元素包含id属性，则id值将用于从数据库中检索相应的持久化实例，然后其余文档将被保存。绑定到实例。如果在数据库中找不到相应的记录，则命令对象引用将为null。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;?xml version=<span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span> encoding=<span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>?&gt;
&lt;book id=<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span>&gt;
    &lt;title&gt;Walden&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;authorName&gt;Henry David Thoreau&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">authorName&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">book&gt;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">updateBook</span>(<span class="predefined-type">Book</span> book) {
        <span class="comment">// The book will have been retrieved from the database and updated</span>
        <span class="comment">// by doing something like this:</span>
        <span class="comment">//</span>
        <span class="comment">// book == Book.get('42')</span>
        <span class="comment">// if(book != null) {</span>
        <span class="comment">//    book.properties = request</span>
        <span class="comment">// }</span>
        <span class="comment">//</span>
        <span class="comment">// the code above represents what the framework will</span>
        <span class="comment">// have done. There is no need to write that code.</span>

        <span class="comment">// ...</span>

    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>数据绑定取决于<a href="http://docs.grails.org/4.0.0/api/org/grails/databinding/bindingsource/DataBindingSourceCreator.html">DataBindingSourceCreator</a>接口的实例创建的<a href="http://docs.grails.org/4.0.0/api/grails/databinding/DataBindingSource.html">DataBindingSource</a>接口的实例。将根据请求的 <code>contentType</code> 选择 <code>DataBindingSourceCreator</code> 的特定实现。提供了几种实现来处理常见的内容类型。对于大多数用例，默认实现都可以。下表列出了核心框架支持的内容类型以及每种类型使用的 <code>DataBindingSourceCreator</code> 实现。所有的实现类都在org.grails.databinding.bindingsource包中。</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 100%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">内容类型，Bean名称，DataBindingSourceCreator Impl。</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application / xml，text / xml</code>，xmlDataBindingSourceCreator，XmlDataBindingSourceCreator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application / json，text / json</code>，jsonDataBindingSourceCreator，JsonDataBindingSourceCreator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">应用程序/ hal + json，halJsonDataBindingSourceCreator，HalJsonDataBindingSourceCreator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">应用程序/ hal + xml，halXmlDataBindingSourceCreator，HalXmlDataBindingSourceCreator</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>为了为任何这些内容类型提供自己的 <code>DataBindingSourceCreator</code>，请编写一个实现
使用DataBindingSourceCreator并在Spring应用程序上下文中注册该类的实例。如果你
要替换现有的帮助程序之一，请使用上面的相应Bean名称。如果您要提供
内容类型的助手，而不是核心框架所考虑的内容，bean名称可以是
您喜欢，但应注意不要与上述bean名称之一冲突。</p>
</div>
<div class="paragraph">
<p>DataBindingSourceCreator接口仅定义了两种方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.grails.databinding.bindingsource

<span class="keyword">import</span> <span class="include">grails.web.mime.MimeType</span>
<span class="keyword">import</span> <span class="include">grails.databinding.DataBindingSource</span>

<span class="comment">/**
 * A factory for DataBindingSource instances
 *
 * @since 2.3
 * @see DataBindingSourceRegistry
 * @see DataBindingSource
 *
 */</span>
<span class="type">interface</span> DataBindingSourceCreator {

    <span class="comment">/**
     * `return All of the {`link MimeType} supported by this helper
     */</span>
    MimeType<span class="type">[]</span> getMimeTypes()

    <span class="comment">/**
     * Creates a DataBindingSource suitable for binding bindingSource to bindingTarget
     *
     * @param mimeType a mime type
     * @param bindingTarget the target of the data binding
     * @param bindingSource the value being bound
     * @return a DataBindingSource
     */</span>
    DataBindingSource createDataBindingSource(MimeType mimeType, <span class="predefined-type">Object</span> bindingTarget, <span class="predefined-type">Object</span> bindingSource)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/org/grails/web/databinding/bindingsource/AbstractRequestBodyDataBindingSourceCreator.html">AbstractRequestBodyDataBindingSourceCreator</a>
是一个抽象类，旨在扩展以简化编写自定义 <code>DataBindingSourceCreator</code> 类的过程。哪个班
扩展 <code>AbstractRequestbodyDatabindingSourceCreator</code> 需要实现一个名为 <code>createBindingSource</code> 的方法
它接受InputStream作为参数并返回DataBindingSource以及实现getMimeTypes
上面的 <code>DataBindingSourceCreator</code> 接口中描述的方法。 createBindingSource的InputStream参数
提供对请求正文的访问。</p>
</div>
<div class="paragraph">
<p>下面的代码展示了一个简单的实现。</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/com/demo/myapp/databinding/MyCustomDataBindingSourceCreator.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.demo.myapp.databinding

<span class="keyword">import</span> <span class="include">grails.web.mime.MimeType</span>
<span class="keyword">import</span> <span class="include">grails.databinding.DataBindingSource</span>
<span class="keyword">import</span> <span class="include">org</span>...<span class="include">databinding.SimpleMapDataBindingSource</span>
<span class="keyword">import</span> <span class="include">org</span>...<span class="include">databinding.bindingsource.AbstractRequestBodyDataBindingSourceCreator</span>

<span class="comment">/**
 * A custom DataBindingSourceCreator capable of parsing key value pairs out of
 * a request body containing a comma separated list of key:value pairs like:
 *
 * name:Herman,age:99,town:STL
 *
 */</span>
<span class="type">class</span> <span class="class">MyCustomDataBindingSourceCreator</span> <span class="directive">extends</span> AbstractRequestBodyDataBindingSourceCreator {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> MimeType<span class="type">[]</span> getMimeTypes() {
        [<span class="keyword">new</span> MimeType(<span class="string"><span class="delimiter">'</span><span class="content">text/custom+demo+csv</span><span class="delimiter">'</span></span>)] <span class="keyword">as</span> MimeType<span class="type">[]</span>
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> DataBindingSource createBindingSource(<span class="predefined-type">InputStream</span> inputStream) {
        <span class="keyword">def</span> map = [:]

        <span class="keyword">def</span> reader = <span class="keyword">new</span> <span class="predefined-type">InputStreamReader</span>(inputStream)

        <span class="comment">// this is an obviously naive parser and is intended</span>
        <span class="comment">// for demonstration purposes only.</span>

        reader.eachLine { line -&gt;
            <span class="keyword">def</span> keyValuePairs = line.split(<span class="string"><span class="delimiter">'</span><span class="content">,</span><span class="delimiter">'</span></span>)
            keyValuePairs.each { keyValuePair -&gt;
                <span class="keyword">if</span>(keyValuePair?.trim()) {
                    <span class="keyword">def</span> keyValuePieces = keyValuePair.split(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>)
                    <span class="keyword">def</span> key = keyValuePieces[<span class="integer">0</span>].trim()
                    <span class="keyword">def</span> value = keyValuePieces[<span class="integer">1</span>].trim()
                    map&lt;&lt;key&gt;&gt; = value
                }
            }
        }

        <span class="comment">// create and return a DataBindingSource which contains the parsed data</span>
        <span class="keyword">new</span> SimpleMapDataBindingSource(map)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>需要在spring应用程序上下文中注册 <code>MyCustomDataSourceCreator</code> 的实例。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {

    myCustomCreator com.demo.myapp.databinding.MyCustomDataBindingSourceCreator

    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了它，框架将在任何需要 <code>DataBindingSourceCreator</code> 的时候使用 <code>myCustomCreator</code> bean
处理 <code>contentType</code> 为 <code>text/custom+demo+csv</code> 的请求。</p>
</div>

<a name="8.3 RSS &#21644; Atom"><!-- Legacy link --></a>
<h2 id="RSSAndAtom">10.14 RSS 和 Atom</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/REST/RSSAndAtom.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails中没有为RSS或Atom提供直接支持。您可以使用<a href="../ref/Controllers/render.html">render</a>方法的XML功能来构造RSS或ATOM提要。</p>
</div>

<a name="8 &#24322;&#27493;&#32534;&#31243;"><!-- Legacy link --></a>
<h1 id="async">11 异步编程</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/async.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>随着具有多个内核的现代硬件的出现，许多编程语言都在添加异步并行编程API，Groovy也不例外。</p>
</div>
<div class="paragraph">
<p>流行的异步库包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RxJava - <a href="http://reactivex.io" class="bare">http://reactivex.io</a></p>
</li>
<li>
<p>GPars - <a href="http://gpars.org" class="bare">http://gpars.org</a></p>
</li>
<li>
<p>Reactor - <a href="https://projectreactor.io" class="bare">https://projectreactor.io</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>通过在这些各种库的顶部构建 <a href="https://async.grails.org">Async features of Grails</a> 旨在简化框架内的并发编程，并包括Promises和统一事件模型的概念。</p>
</div>
<div class="paragraph">
<p>通常，由于Reactive编程模型是一个不断发展的空间，Grails试图为集成一系列异步库提供通用支持，并且不建议使用任何单个库，因为它们都有各种优点和缺点。</p>
</div>
<div class="paragraph">
<p>有关使用Grails进行异步编程的更多信息，请参见 <a href="https://async.grails.org">Grails Asynchronous Framework</a> 用户指南。</p>
</div>

<a name="10. &#39564;&#35777;"><!-- Legacy link --></a>
<h1 id="validation">12 验证</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/validation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails验证功能基于<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/package-summary.html">Spring’s Validator API</a> 和数据绑定功能构建。 但是Grails对此进行了进一步的介绍，并提供了一种统一的方法来定义带有其约束机制的验证 "constraints" 。</p>
</div>
<div class="paragraph">
<p>Grails中的约束是一种以声明方式指定验证规则的方法。最常见的是将它们应用于 <a href="GORM.html">domain classes</a> , 然而 <a href="theWebLayer.html#urlmappings">URL Mappings</a>和 <a href="theWebLayer.html#commandObjects">Command Objects</a> 也支持约束。</p>
</div>

<a name="10.1 &#22768;&#26126;&#32422;&#26463;"><!-- Legacy link --></a>
<h2 id="constraints">12.1 声明约束</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/validation/constraints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>在域类中 <a href="../ref/Domain%20Classes/constraints.html">constraints</a> 使用为代码块分配的constraints属性定义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
    <span class="predefined-type">String</span> login
    <span class="predefined-type">String</span> password
    <span class="predefined-type">String</span> email
    <span class="predefined-type">Integer</span> age

    <span class="directive">static</span> constraints = {
      ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您可以使用与要应用约束的属性名称相匹配的方法调用，并结合命名参数来指定约束：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
    ...

    static constraints = {
        login <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">15</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">unique</span>: <span class="predefined-constant">true</span>
        password <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">15</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
        email <span class="key">email</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
        age <span class="key">min</span>: <span class="integer">18</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，我们声明了 <code>login</code> 属性的长度必须在5到15个字符之间，不能为空，并且必须是唯一的。 我们还对 <code>password</code>, <code>email</code> 和 <code>age</code> 属性应用了其他约束。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认情况下，所有域类属性都不为空（即，它们具有隐式的 <code>nullable：false</code> 约束）。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>有关可用约束的完整参考，请参见约束标题下的快速参考部分。</p>
</div>
<div class="paragraph">
<p>请注意，约束仅评估一次，这可能与依赖于像 <code>java.util.Date</code> 实例的值的约束有关。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
    ...

    static constraints = {
        <span class="comment">// this Date object is created when the constraints are evaluated, not</span>
        <span class="comment">// each time an instance of the User class is validated.</span>
        birthDate <span class="key">max</span>: <span class="keyword">new</span> <span class="predefined-type">Date</span>()
    }
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_一句警告_从约束中引用域类属性">一句警告-从约束中引用域类属性</h3>
<div class="paragraph">
<p>尝试从静态约束块中引用实例变量非常容易，但这在Groovy（或Java）中是不合法的。 如果这样做，您将因遇到麻烦而得到 <code>MissingPropertyException</code>。 例如，您可以尝试</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Response</span> {
    Survey survey
    Answer answer

    <span class="directive">static</span> constraints = {
        survey <span class="key">blank</span>: <span class="predefined-constant">false</span>
        answer <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">inList</span>: survey.answers
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>看看 <code>inList</code> 约束如何引用实例属性 <code>survey</code> ？ 那行不通。 而是使用自定义 <a href="../ref/Constraints/validator.html">validator</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Response</span> {
    ...
    static constraints = {
        survey <span class="key">blank</span>: <span class="predefined-constant">false</span>
        answer <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">validator</span>: { val, obj -&gt; val <span class="keyword">in</span> obj.survey.answers }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，自定义验证器的 <code>obj</code> 参数是正在验证的域实例，因此我们可以访问其 <code>Survey</code> 属性并返回一个布尔值以指示 <code>answer</code> 属性的新值 <code>val</code> 是否有效</p>
</div>
</div>

<a name="10.2 &#39564;&#35777;&#32422;&#26463;"><!-- Legacy link --></a>
<h2 id="validatingConstraints">12.2 验证约束</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/validation/validatingConstraints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_验证基础">验证基础</h4>
<div class="paragraph">
<p>调用链接 <a href="../ref/Domain%20Classes/validate.html">validate</a> 方法以验证域类实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> user = <span class="keyword">new</span> User(params)

<span class="keyword">if</span> (user.validate()) {
    <span class="comment">// do something with user</span>
}
<span class="keyword">else</span> {
    user.errors.allErrors.each {
        println <span class="local-variable">it</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>域类的 <code>errors</code> 属性是Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/Errors.html">Errors</a> 接口的实例。 <code>Errors</code> 界面提供了导航验证错误并检索原始值的方法。</p>
</div>
</div>
<div class="sect3">
<h4 id="_验证阶段">验证阶段</h4>
<div class="paragraph">
<p>在Grails中，验证分为两个阶段，第一个阶段是 <a href="theWebLayer.html#dataBinding">data binding</a>，该阶段是在将请求参数绑定到实例上时发生的，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> user = <span class="keyword">new</span> User(params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>此时，由于类型转换（例如将字符串转换为日期），您的 <code>error</code> 属性可能已经有错误。 您可以使用 <code>Errors</code> API进行检查并获取原始输入值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span> (user.hasErrors()) {
    <span class="keyword">if</span> (user.errors.hasFieldErrors(<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>)) {
        println user.errors.getFieldError(<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>).rejectedValue
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>验证的第二阶段发生在您调用 <a href="../ref/Domain%20Classes/validate.html">validate</a> 或 <a href="../ref/Domain%20Classes/save.html">save</a> 时。 这是Grails将根据您定义的链接验证绑定值的时间：<a href="../ref/Domain%20Classes/constraints.html">constraints</a>。 例如，默认情况下，<a href="../ref/Domain%20Classes/save.html">save</a>方法在执行之前调用  <code>validate</code> ，使您可以编写如下代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span> (user.save()) {
    <span class="keyword">return</span> user
}
<span class="keyword">else</span> {
    user.errors.allErrors.each {
        println <span class="local-variable">it</span>
    }
}</code></pre>
</div>
</div>
</div>


<h2 id="sharingConstraints">12.3 类之间的共享约束</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/validation/sharingConstraints.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails中常见的模式是使用 <a href="theWebLayer.html#commandObjects">Command Objects</a> 或验证用户提交的数据，然后将命令对象的属性复制到相关的域类。 这通常意味着您的命令对象和域类共享属性及其约束。 您可以手动在这两者之间复制并粘贴约束，但这是一种非常容易出错的方法。 而是使用Grails的全局约束和导入机制。</p>
</div>
<div class="sect2">
<h3 id="_全球约束">全球约束</h3>
<div class="paragraph">
<p>除了在域类，命令对象和<a href="#validationNonDomainAndCommandObjectClasses">other validateable classes</a>中定义约束之外，您还可以在 <code>grails-app/conf/application.groovy</code> 中定义它们：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.gorm.default.constraints = {
    <span class="string"><span class="delimiter">'</span><span class="content">*</span><span class="delimiter">'</span></span>(<span class="key">nullable</span>: <span class="predefined-constant">true</span>, <span class="key">size</span>: <span class="integer">1</span>..<span class="integer">20</span>)
    myShared(<span class="key">nullable</span>: <span class="predefined-constant">false</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些约束没有附加到任何特定的类，但是可以从任何可验证的类中轻松引用它们：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
    ...

    static constraints = {
        login <span class="key">shared</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myShared</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意 <code>shared</code> 参数的使用，其值是 <code>grails.gorm.default.constraints</code> 中定义的约束之一的名称。 尽管有配置设置的名称，但是您可以从任何可验证的类（例如命令对象）中引用这些共享约束。</p>
</div>
<div class="paragraph">
<p>'*'约束是一种特殊情况：这意味着关联的约束（在上面的示例中为 <code>nullable</code> 和 <code>size</code> ）将应用于所有可验证类中的所有属性。 这些默认值可以由可验证类中声明的约束覆盖。</p>
</div>
</div>
<div class="sect2">
<h3 id="_导入约束">导入约束</h3>
<div class="paragraph">
<p>Grails 2引入了共享约束的另一种方法，该方法允许您将一组约束从一个类导入另一个类。</p>
</div>
<div class="paragraph">
<p>假设您有一个像这样的域类</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">User</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">String</span> passwordHash

    <span class="directive">static</span> constraints = {
        firstName <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        lastName <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        passwordHash <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">nullable</span>: <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，您要创建一个命令对象 <code>UserCommand</code>，该对象共享域类的某些属性和相应的约束。 您可以使用 <code>importFrom()</code> 方法执行此操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">UserCommand</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">String</span> password
    <span class="predefined-type">String</span> confirmPassword

    <span class="directive">static</span> constraints = {
        importFrom User

        password <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">nullable</span>: <span class="predefined-constant">false</span>
        confirmPassword <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">nullable</span>: <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将从 <code>User</code> 域类中导入所有约束，并将它们应用于 <code>UserCommand</code> 。 导入将忽略源类（ <code>User</code> ）中任何在导入类（ <code>UserCommand</code> ）中没有相应属性的约束。 在上面的示例中，仅将&#8217;firstName&#8217;和&#8217;lastName&#8217;约束导入 <code>UserCommand</code> ，因为这是两个类共享的唯一属性。</p>
</div>
<div class="paragraph">
<p>如果要控制导入哪些约束，请使用 <code>include</code> 和 <code>exclude</code> 参数。 这两个都接受与源约束中的属性名称匹配的简单或正则表达式字符串列表。 因此，例如，如果您只想导入"lastName"约束，则可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">...
static constraints = {
    importFrom User, <span class="key">include</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">lastName</span><span class="delimiter">&quot;</span></span>]
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者如果您想要所有以&#8217;Name&#8217;结尾的约束：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">...
static constraints = {
    importFrom User, <span class="key">include</span>: [<span class="regexp"><span class="delimiter">/</span><span class="content">.*Name</span><span class="delimiter">/</span></span>]
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当然， <code>exclude</code> 做相反的操作，指定不应导入哪些约束。</p>
</div>
</div>

<a name="10.3 &#23545;&#23458;&#25143;&#31471;&#30340;&#39564;&#35777;"><!-- Legacy link --></a>
<h2 id="validationOnTheClient">12.4 对客户端的验证</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/validation/validationOnTheClient.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_显示错误">显示错误</h4>
<div class="paragraph">
<p>通常，如果遇到验证错误，则将您重定向回视图以进行渲染。 到达那里后，您需要某种方式来显示错误。 Grails支持用于处理错误的丰富标签集。 要将错误显示为列表，可以使用 <a href="http://gsp.grails.org/latest/ref/Tags/renderErrors.html">renderErrors</a>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:renderErrors</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果需要更多控制，可以使用<a href="http://gsp.grails.org/latest/ref/Tags/hasErrors.html">hasErrors</a>和<a href="http://gsp.grails.org/latest/ref/Tags/eachError.html">eachError</a>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:hasErrors</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;ul&gt;</span>
   <span class="tag">&lt;g:eachError</span> <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">err</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       <span class="tag">&lt;li&gt;</span>${err}<span class="tag">&lt;/li&gt;</span>
   <span class="tag">&lt;/g:eachError&gt;</span>
  <span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;/g:hasErrors&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_突出显示错误">突出显示错误</h4>
<div class="paragraph">
<p>当错误输入字段时，使用红色框或某些指示符突出显示通常很有用。 也可以通过将<a href="http://gsp.grails.org/latest/ref/Tags/hasErrors.html">hasErrors</a>作为方法调用来实现。 例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;div</span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">'</span><span class="content">value ${hasErrors(bean:user,field:</span><span class="delimiter">'</span></span><span class="attribute-name">login</span><span class="error">'</span><span class="error">,</span><span class="error">'</span><span class="attribute-name">errors</span><span class="error">'</span><span class="error">)</span><span class="error">}</span><span class="error">'</span><span class="tag">&gt;</span>
   <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${fieldValue(bean:user,field:'login')}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
<span class="tag">&lt;/div&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>该代码检查 <code>user</code> bean的 <code>login</code> 字段是否有错误，如果有，则向 <code>div</code> 添加一个 <code>errors</code> CSS类，从而允许您使用CSS规则突出显示 <code>div</code>。</p>
</div>
</div>
<div class="sect3">
<h4 id="_检索输入值">检索输入值</h4>
<div class="paragraph">
<p>每个错误实际上是Spring中<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/FieldError.html">FieldError</a>类的一个实例，该类在其中保留了原始输入值。 这很有用，因为您可以使用错误对象来恢复用户使用 <a href="../ref/Tags/fieldValue.html">fieldValue</a> 标记输入的值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">text</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${fieldValue(bean:user,field:'login')}</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>此代码将检查 <code>User</code>  Bean中是否存在现有的 <code>FieldError</code> ，以及是否获得 <code>login</code> 字段的原始输入值。</p>
</div>
</div>

<a name="10.4 &#39564;&#35777;&#21644;&#22269;&#38469;&#21270;"><!-- Legacy link --></a>
<h2 id="validationAndInternationalization">12.5 验证和国际化</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/validation/validationAndInternationalization.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>关于Grails中的错误，要注意的另一重要事项是，错误消息未在任何地方进行硬编码。 Spring中的<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/FieldError.html">FieldError</a>类使用Grails的 <a href="i18n.html">i18n</a>支持来解析消息束中的消息。</p>
</div>
<div class="sect3">
<h4 id="_约束和消息代码">约束和消息代码</h4>
<div class="paragraph">
<p>编码本身是由惯例规定的。 例如，考虑一下我们前面讨论的约束：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.mycompany.myapp

<span class="type">class</span> <span class="class">User</span> {
    ...

    static constraints = {
        login <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">15</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">unique</span>: <span class="predefined-constant">true</span>
        password <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">15</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
        email <span class="key">email</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
        age <span class="key">min</span>: <span class="integer">18</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果违反了约束，Grails将按照约定查找消息代码：</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Constraint</th>
<th class="tableblock halign-left valign-top">Error Code</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/blank.html">blank</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.blank</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/creditCard.html">creditCard</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.creditCard.invalid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/email.html">email</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.email.invalid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/inList.html">inList</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.not.inList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/matches.html">matches</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.matches.invalid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/max.html">max</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.max.exceeded</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/maxSize.html">maxSize</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.maxSize.exceeded</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/min.html">min</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.min.notmet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/minSize.html">minSize</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.minSize.notmet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/notEqual.html">notEqual</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.notEqual</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/nullable.html">nullable</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.nullable</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/range.html">range</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.range.toosmall</code> or <code>className.propertyName.range.toobig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/size.html">size</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.size.toosmall</code> or <code>className.propertyName.size.toobig</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/unique.html">unique</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.unique</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/url.html">url</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>className.propertyName.url.invalid</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="../ref/Constraints/validator.html">validator</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>classname.propertyName.</code> + String returned by Closure</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>在 <code>blank</code> 约束的情况下，它将是 <code>user.login.blank</code>，因此您需要在 <code>grails-app/i18n/messages.properties</code> 文件中输入如下消息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">user.login.blank=Your login name must be specified!</code></pre>
</div>
</div>
<div class="paragraph">
<p>在有或没有包的情况下都查找类名，其中以打包版本优先。 因此，例如，将在 <code>user.login.blank</code> 之前使用 <code>com.mycompany.myapp.User.login.blank</code>。 这允许您的域类消息代码与插件冲突的情况。</p>
</div>
<div class="paragraph">
<p>有关哪些约束适用于哪些代码的参考，请参阅每个约束的参考指南（例如 <a href="../ref/Constraints/blank.html">blank</a>）</p>
</div>
</div>
<div class="sect3">
<h4 id="_显示讯息">显示讯息</h4>
<div class="paragraph">
<p><a href="http://gsp.grails.org/latest/ref/Tags/renderErrors.html">renderErrors</a>标签将使用<a href="http://gsp.grails.org/latest/ref/Tags/message.html">message</a>标签为您自动查找消息。 如果需要更多的渲染控制，可以自己处理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:hasErrors</span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  <span class="tag">&lt;ul&gt;</span>
   <span class="tag">&lt;g:eachError</span> <span class="attribute-name">var</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">err</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">bean</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${user}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
       <span class="tag">&lt;li&gt;</span><span class="tag">&lt;g:message</span> <span class="attribute-name">error</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${err}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span><span class="tag">&lt;/li&gt;</span>
   <span class="tag">&lt;/g:eachError&gt;</span>
  <span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;/g:hasErrors&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，在<a href="http://gsp.grails.org/latest/ref/Tags/eachError.html">eachError</a>标记的正文中，我们结合使用<a href="http://gsp.grails.org/latest/ref/Tags/message.html">message</a>标记及其 <code>error</code> 参数来读取给定错误的消息。</p>
</div>
</div>

<a name="10.5 &#39564;&#35777;&#38750;&#22495;&#21644;&#21629;&#20196;&#23545;&#35937;&#31867;"><!-- Legacy link --></a>
<h2 id="validationNonDomainAndCommandObjectClasses">12.6 将验证应用于其他类</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/validation/validationNonDomainAndCommandObjectClasses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="GORM.html">Domain classes</a> 和<a href="theWebLayer.html#commandObjects">Command Objects</a>默认情况下支持验证。 通过在类中定义静态的 <code>constraints</code> 属性（如上所述），然后将其告知框架，可以使其他类可验证。 应用程序向框架注册可验证的类很重要。 仅定义 <code>constraints</code> 属性是不够的。</p>
</div>
<div class="sect3">
<h4 id="_可验证的特征">可验证的特征</h4>
<div class="paragraph">
<p>定义静态 <code>constraints</code> 属性并实现 <a href="http://docs.grails.org/4.0.0/api/grails/validation/Validateable.html">Validateable</a> 特征的类将是可验证的。 考虑以下示例：</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/com/mycompany/myapp/User.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.mycompany.myapp

<span class="keyword">import</span> <span class="include">grails.validation.Validateable</span>

<span class="type">class</span> <span class="class">User</span> <span class="directive">implements</span> Validateable {
    ...

    static constraints = {
        login <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">15</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">unique</span>: <span class="predefined-constant">true</span>
        password <span class="key">size</span>: <span class="integer">5</span>..<span class="integer">15</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
        email <span class="key">email</span>: <span class="predefined-constant">true</span>, <span class="key">blank</span>: <span class="predefined-constant">false</span>
        age <span class="key">min</span>: <span class="integer">18</span>
    }
}</code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_程序访问">程序访问</h5>
<div class="paragraph">
<p>访问可验证对象上的约束略有不同。 您可以通过访问类的 <code>constraintsMap</code> 静态属性，在另一个上下文中以编程方式访问命令对象的约束。 该属性是 <code>Map &lt;String，<a href="http://docs.grails.org/4.0.0/api/grails/validation/ConstrainedProperty.html">ConstrainedProperty</a>&gt;</code> 的实例。</p>
</div>
<div class="paragraph">
<p>在上面的示例中，访问 <code>User.constraintsMap.login.blank</code> 将产生 <code>false</code> ，而 <code>User.constraintsMap.login.unique</code> 将产生 <code>true</code> 。</p>
</div>
</div>
</div>

<a name="11. &#26381;&#21153;&#23618;"><!-- Legacy link --></a>
<h1 id="services">13 服务层</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/services.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails定义了服务层的概念。 Grails团队不鼓励将核心应用程序逻辑嵌入控制器内部，因为它不会促进重用和关注点的清晰分离。</p>
</div>
<div class="paragraph">
<p>Grails中的服务是将大多数逻辑放入应用程序中的地方，而控制器则负责通过重定向等处理请求流。</p>
</div>
<div class="sect3">
<h4 id="_创建服务">创建服务</h4>
<div class="paragraph">
<p>您可以通过在终端窗口的项目根目录中运行 <a href="../ref/Command%20Line/create-service.html">create-service</a>命令来创建Grails服务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-service helloworld.simple</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果没有使用create-service脚本指定软件包，Grails会自动使用在 <code>grails-app/conf/application.yml</code> 中定义的 <code>grails.defaultPackage</code> 作为软件包名称。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>上面的示例将在 <code>grails-app/services/helloworld/SimpleService.groovy</code> 位置创建服务。服务的名称以约定 <code>Service</code> 结尾，但服务是普通的Groovy类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> helloworld

<span class="type">class</span> <span class="class">SimpleService</span> {
}</code></pre>
</div>
</div>
</div>

<a name="11 . 1 &#22768;&#26126;&#24335;&#20107;&#29289;"><!-- Legacy link --></a>
<h2 id="declarativeTransactions">13.1 声明性事物</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/services/declarativeTransactions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_declarative_transactions">Declarative Transactions</h3>
<div class="paragraph">
<p>服务通常涉及协调逻辑 <a href="GORM.html">domain classes</a>，因此常常涉及跨越大型操作的持久性。考虑到服务的性质，它们经常需要事务行为。您可以使用程序化事务 <a href="../ref/Domain%20Classes/withTransaction.html">withTransaction</a> 方法。然而，这是重复的，并没有充分利用Spring底层事务抽象的功能。</p>
</div>
<div class="paragraph">
<p>服务支持事务界定，这是一种声明性的方法，用于定义哪些方法将成为事务性的。要启用服务上的事务，请使用 <code>Transactional</code> 转换:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.transactions.*</span>

<span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">CountryService</span> {

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果是所有方法都包装在一个事务中，如果一个方法抛出一个异常(检查或运行时异常)或一个错误，就会自动回滚。事务的传播水平是默认设置为 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/transaction/TransactionDefinition.html#PROPAGATION_REQUIRED">PROPAGATION_REQUIRED</a>. 。</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
默认情况下，版本Grails 3.2.0是第一个使用GORM 6的版本。受控异常在GORM 6之前没有回滚事务。只有抛出运行时异常(即扩展RuntimeException)的方法才回滚事务。
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<a href="#dependencyInjectionServices">dependency injection</a>是声明性事务工作的“唯一”方式。如果使用 <code>new</code> 操作符，如 <code>new BookService()</code> ，则不会得到事务性服务
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_the_transactional_annotation_vs_the_transactional_property">The Transactional annotation vs the transactional property</h4>
<div class="paragraph">
<p>在Grails 3.1之前的Grails版本中，Grails创建了Spring代理，并使用 <code>transactional</code> 属性来启用和禁用代理创建。默认情况下，在使用Grails 3.1及以上版本创建的应用程序中，为了支持 <code>@Transactional</code> 转换，这些代理是禁用的。</p>
</div>
<div class="paragraph">
<p>下载Grails 3.1版本和3.2版本 ，如果您希望重新启用此功能(不推荐)，则必须设置 <code>grails.spring.transactionManagement</code> 为true 或者在 <code>grails-app/conf/application.yml</code> 或 <code>grails-app/conf/application.groovy</code> 中移除配置。</p>
</div>
<div class="paragraph">
<p>在Grails 3.3。事务管理的x Spring代理已经被完全删除，您必须使用Grails的AST转换。在Grails 3.3。如果您希望继续使用Spring代理进行事务管理，则必须使用适当的Spring配置手动配置它们。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
另外，在Grails 3.1之前，服务默认是事务性的，在Grails 3.1之后，只有在应用了 <code>@Transactional</code> 转换时，服务才是事务性的。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_custom_transaction_configuration">Custom Transaction Configuration</h3>
<div class="paragraph">
<p>Grails还提供了 <code>@Transactional</code> 和 <code>@NotTransactional</code> 注释，用于需要在每个方法级别对事务进行更细粒度控制或需要指定其他传播级别的情况。例如，可以使用 <code>@NotTransactional</code> 注释来标记一个特定的方法，当用 <code>@Transactional</code> 注释一个类时，该方法将被跳过。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
使用 <code>Transactional</code> 注释服务方法会禁用该服务的默认Grails事务行为(与添加 <code>Transactional =false</code> 的方法相同)，所以如果使用任何注释，必须注释所有需要事务的方法。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在本例中，<code>listBooks</code> 使用只读事务，<code>updateBook</code> 使用默认的读写事务，而 <code>deleteBook</code> 不是事务性的(考虑到它的名称，可能不是个好主意)。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.transactions.Transactional</span>

<span class="type">class</span> <span class="class">BookService</span> {

    <span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
    <span class="keyword">def</span> <span class="function">listBooks</span>() {
        <span class="predefined-type">Book</span>.list()
    }

    <span class="annotation">@Transactional</span>
    <span class="keyword">def</span> <span class="function">updateBook</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">deleteBook</span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以对该类进行注释，以定义整个服务的默认事务行为，然后覆盖每个方法的默认事务行为:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.transactions.Transactional</span>

<span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">BookService</span> {

    <span class="keyword">def</span> <span class="function">listBooks</span>() {
        <span class="predefined-type">Book</span>.list()
    }

    <span class="keyword">def</span> <span class="function">updateBook</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">deleteBook</span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个版本默认所有的方法都是读写事务的(由于类级别的注释)，但是 <code>listBooks</code> 方法覆盖了这个，使用只读事务:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.transactions.Transactional</span>

<span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">BookService</span> {

    <span class="annotation">@Transactional</span>(readOnly = <span class="predefined-constant">true</span>)
    <span class="keyword">def</span> <span class="function">listBooks</span>() {
        <span class="predefined-type">Book</span>.list()
    }

    <span class="keyword">def</span> <span class="function">updateBook</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">deleteBook</span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>虽然本例中没有注释 <code>updateBook</code> 和 <code>deleteBook</code>，但是它们从类级注释中继承了配置。</p>
</div>
<div class="paragraph">
<p>有关更多信息，请参阅Spring用户指南的有关部分 <a href="http://docs.spring.io/spring/docs/current/spring-framework-reference/html/transaction.html#transaction-declarative-annotations">Using @Transactional</a>.</p>
</div>
<div class="paragraph">
<p>与Spring不同，您不需要任何预先配置就可以使用 <code>Transactional</code> ;只需根据需要指定注释，Grails就会自动检测它们。</p>
</div>
<div class="sect3">
<h4 id="_transaction_status">Transaction status</h4>
<div class="paragraph">
<p>一个实例 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/transaction/TransactionStatus.html">TransactionStatus</a>在Grails事务服务方法中是默认可用的。</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.transactions.Transactional</span>

<span class="annotation">@Transactional</span>
<span class="type">class</span> <span class="class">BookService</span> {

    <span class="keyword">def</span> <span class="function">deleteBook</span>() {
        transactionStatus.setRollbackOnly()
    }
}</code></pre>
</div>
</div>
</div>
</div>

<a name="11.1.1 &#22810;&#25968;&#25454;&#28304;&#20107;&#29289;"><!-- Legacy link --></a>
<h2 id="transactionsMultiDataSource">13.1.1 多数据源事物</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/services/declarativeTransactions/transactionsMultiDataSource.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>给定两个域类，如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Movie</span> {
    <span class="predefined-type">String</span> title
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title

    <span class="directive">static</span> mapping = {
        datasource <span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以向 <code>@Transactional</code> 或 <code>@ReadOnly</code> 注释提供所需的数据源。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.gorm.transactions.ReadOnly</span>
<span class="keyword">import</span> <span class="include">grails.gorm.transactions.Transactional</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">BookService</span> {

    <span class="annotation">@ReadOnly</span>(<span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; findAll() {
        <span class="predefined-type">Book</span>.where {}.findAll()
    }

    <span class="annotation">@Transactional</span>(<span class="string"><span class="delimiter">'</span><span class="content">books</span><span class="delimiter">'</span></span>)
    <span class="type">void</span> save(<span class="predefined-type">String</span> title) {
        <span class="predefined-type">Book</span> book = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">title</span>: title)
        book.save()
        book
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">MovieService</span> {

    <span class="annotation">@ReadOnly</span>
    <span class="predefined-type">List</span>&lt;Movie&gt; findAll() {
        Movie.where {}.findAll()
    }
}</code></pre>
</div>
</div>

<a name="11.1.1 &#20107;&#21153;&#22238;&#28378;&#21644;&#20250;&#35805;"><!-- Legacy link --></a>
<h2 id="transactionsRollbackAndTheSession">13.1.2 事务回滚和会话</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/services/declarativeTransactions/transactionsRollbackAndTheSession.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_理解事务和hibernate会话">理解事务和Hibernate会话</h3>
<div class="paragraph">
<p>在使用事务时，对于Hibernate如何处理底层持久性会话，有一些重要的注意事项必须考虑。当事务回滚时，GORM使用的Hibernate会话将被清除。这意味着会话中的任何对象都将被分离，访问未初始化的延迟加载集合将导致 <code>LazyInitializationException</code> 。</p>
</div>
<div class="paragraph">
<p>为了理解为什么清除Hibernate会话很重要。考虑下面的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Author</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> age

    <span class="directive">static</span> hasMany = [<span class="key">books</span>: <span class="predefined-type">Book</span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果你要保存两个作者使用连续事务如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Author.withTransaction { status -&gt;
    <span class="keyword">new</span> Author(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Stephen King</span><span class="delimiter">&quot;</span></span>, <span class="key">age</span>: <span class="integer">40</span>).save()
    status.setRollbackOnly()
}

Author.withTransaction { status -&gt;
    <span class="keyword">new</span> Author(<span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Stephen King</span><span class="delimiter">&quot;</span></span>, <span class="key">age</span>: <span class="integer">40</span>).save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>只有第二个作者将被保存，因为第一个事务通过清除Hibernate会话回滚了作者 <code>save()</code> 。如果Hibernate会话没有被清除，那么两个author实例都将被持久化，这将导致非常意外的结果。</p>
</div>
<div class="paragraph">
<p>然而，由于会话被清除而导致 <code>LazyInitializationException</code> 可能会令人沮丧。</p>
</div>
<div class="paragraph">
<p>例如，考虑下面的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorService</span> {

    <span class="type">void</span> updateAge(id, <span class="type">int</span> age) {
        <span class="keyword">def</span> author = Author.get(id)
        author.age = age
        <span class="keyword">if</span> (author.isTooOld()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> AuthorException(<span class="string"><span class="delimiter">&quot;</span><span class="content">too old</span><span class="delimiter">&quot;</span></span>, author)
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorController</span> {

    <span class="keyword">def</span> authorService

    <span class="keyword">def</span> <span class="function">updateAge</span>() {
        <span class="keyword">try</span> {
            authorService.updateAge(params.id, params.int(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>))
        }
        <span class="keyword">catch</span>(e) {
            render <span class="string"><span class="delimiter">&quot;</span><span class="content">Author books </span><span class="inline"><span class="inline-delimiter">${</span>e.author.books<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，如果 <code>Author</code> 的年龄超过了通过抛出 <code>AuthorException</code> 来在 <code>isTooOld()</code> 方法中定义的最大值，则事务将回滚。 <code>AuthorException</code> 指的是作者，但是当 <code>books</code> 关联被访问时，会抛出一个 <code>LazyInitializationException</code> ，因为底层的Hibernate会话已经被清除了。</p>
</div>
<div class="paragraph">
<p>要解决这个问题，你有很多选择。一是确保你急切地查询你需要的数据:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorService</span> {
    ...
    void updateAge(id, <span class="type">int</span> age) {
        <span class="keyword">def</span> author = Author.findById(id, [<span class="key">fetch</span>:[<span class="key">books</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">eager</span><span class="delimiter">&quot;</span></span>]])
        ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>在本例中，在检索 <code>Author</code> 时将查询 <code>books</code> 关联。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
这是最佳解决方案，因为它比以下建议的解决方案需要更少的查询。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>另一个解决方案是在事务回滚后重定向请求:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorController</span> {

    AuthorService authorService

    <span class="keyword">def</span> <span class="function">updateAge</span>() {
        <span class="keyword">try</span> {
            authorService.updateAge(params.id, params.int(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>))
        }
        <span class="keyword">catch</span>(e) {
            flash.message = <span class="string"><span class="delimiter">&quot;</span><span class="content">Can't update age</span><span class="delimiter">&quot;</span></span>
            redirect <span class="key">action</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>, <span class="key">id</span>:params.id
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，新的请求将处理再次检索 <code>Author</code> 。最后，第三个解决方案是再次为 <code>Author</code> 检索数据，以确保会话保持在正确的状态:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorController</span> {

    <span class="keyword">def</span> authorService

    <span class="keyword">def</span> <span class="function">updateAge</span>() {
        <span class="keyword">try</span> {
            authorService.updateAge(params.id, params.int(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>))
        }
        <span class="keyword">catch</span>(e) {
            <span class="keyword">def</span> author = Author.read(params.id)
            render <span class="string"><span class="delimiter">&quot;</span><span class="content">Author books </span><span class="inline"><span class="inline-delimiter">${</span>author.books<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_validation_errors_and_rollback">Validation Errors and Rollback</h3>
<div class="paragraph">
<p>一个常见的用例是，如果存在验证错误，则回滚事务。例如，考虑这个服务:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.validation.ValidationException</span>

<span class="type">class</span> <span class="class">AuthorService</span> {

    <span class="type">void</span> updateAge(id, <span class="type">int</span> age) {
        <span class="keyword">def</span> author = Author.get(id)
        author.age = age
        <span class="keyword">if</span> (!author.validate()) {
            <span class="keyword">throw</span> <span class="keyword">new</span> ValidationException(<span class="string"><span class="delimiter">&quot;</span><span class="content">Author is not valid</span><span class="delimiter">&quot;</span></span>, author.errors)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要重新呈现事务回滚的同一个视图，可以在呈现之前将错误与刷新的实例重新关联:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.validation.ValidationException</span>

<span class="type">class</span> <span class="class">AuthorController</span> {

    <span class="keyword">def</span> authorService

    <span class="keyword">def</span> <span class="function">updateAge</span>() {
        <span class="keyword">try</span> {
            authorService.updateAge(params.id, params.int(<span class="string"><span class="delimiter">&quot;</span><span class="content">age</span><span class="delimiter">&quot;</span></span>))
        }
        <span class="keyword">catch</span> (ValidationException e) {
            <span class="keyword">def</span> author = Author.read(params.id)
            author.errors = e.errors
            render <span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">edit</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: [<span class="key">author</span>:author]
        }
    }
}</code></pre>
</div>
</div>
</div>

<a name="11.2 &#20316;&#29992;&#22495;&#26381;&#21153;"><!-- Legacy link --></a>
<h2 id="scopedServices">13.2 Service 的作用域</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/services/scopedServices.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>默认情况下，对服务方法的访问是不同步的，因此没有什么可以阻止这些方法的并发执行。实际上，由于服务是单例的，可以并发使用，所以应该非常小心地在服务中存储状态。或者走简单(更好)的路，永远不要在服务中存储状态。</p>
</div>
<div class="paragraph">
<p>您可以通过将服务放在特定的范围内来改变这种行为。支持的范围是:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>prototype</code>-每次将新服务注入另一个类时都会创建一个新服务</p>
</li>
<li>
<p><code>request</code>-每个请求将创建一个新服务</p>
</li>
<li>
<p><code>flash</code>-仅针对当前和下一个请求创建新服务</p>
</li>
<li>
<p><code>flow</code>-在网络流中，针对该流的范围存在服务</p>
</li>
<li>
<p><code>conversation</code>-在网络流中，将存在用于对话范围的服务。 即根流及其子流</p>
</li>
<li>
<p><code>session</code>-为用户会话范围创建的服务</p>
</li>
<li>
<p><code>singleton</code>（默认）-仅存在一个服务实例</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果你的服务是 <code>flash</code> 、 <code>flow</code> 或 <code>conversation</code> ，那么它必须实现 <code>java.io.Serializable</code> 。只能在Web流的上下文中使用。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要启用其中一个作用域，可以向您的类添加一个静态作用域属性，其值为上述值之一</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> scope = <span class="string"><span class="delimiter">&quot;</span><span class="content">flow</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Upgrading</div>
<div class="paragraph">
<p>从Grails 2.3开始，新应用程序的配置将默认控制器的作用域为 <code>singleton</code> 。
如果 <code>singleton</code> 控制器与 <code>prototype</code> 作用域内的服务交互，服务就会有效地表现为每个控制器的单例对象。
如果需要非单例服务，也应该更改控制器范围。</p>
</div>
<div class="paragraph">
<p>有关更多信息，请参见用户指南中的 link:theWebLayer.html＃controllersAndScopes [Controllers and Scopes]。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_延迟初始化">延迟初始化</h4>
<div class="paragraph">
<p>您还可以配置服务是否延迟初始化。默认情况下，这是设置为 <code>true</code> ，但你可以禁用它，并使初始化急于与 <code>lazyInit</code> 属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> lazyInit = <span class="predefined-constant">false</span></code></pre>
</div>
</div>
</div>

<a name="11.3 &#20381;&#36182;&#27880;&#20837;&#21644;&#26381;&#21153;"><!-- Legacy link --></a>
<h2 id="dependencyInjectionServices">13.3 依赖项注入和服务</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/services/dependencyInjectionServices.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_dependency_injection_basics">Dependency Injection Basics</h4>
<div class="paragraph">
<p>Grails服务的一个关键方面是使用 <a href="http://www.springframework.org/">Spring Framework</a> 的依赖注入特性。Grails支持 <code>dependency injection by convention(约定的依赖注入)</code> 。换句话说，您可以使用服务类名的属性名表示来自动将它们注入控制器、标记库等等。</p>
</div>
<div class="paragraph">
<p>例如，给定一个名为 <code>BookService</code> 的服务，如果您在控制器中定义一个名为 <code>BookService</code> 的属性，如下所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> bookService
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，Spring容器将根据其配置的范围自动注入该服务的实例。所有依赖项注入都是按名称进行的。你也可以指定类型如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorService</span> {
    BookService bookService
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
注意:通常属性名是由类型的第一个字母的小写生成的。例如，<code>BookService</code> 类的实例将映射到名为 <code>bookService</code> 的属性。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>为了与标准JavaBean约定保持一致，如果类名的前两个字母是大写的，则属性名与类名相同。例如，<code>JDBCHelperService</code> 类的属性名应该是 <code>JDBCHelperService</code> ，而不是 <code>jDBCHelperService</code> 或 <code>jdbcHelperService</code>。</p>
</div>
<div class="paragraph">
<p>有关降级规则的更多信息，请参见JavaBean规范的8.8节。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
只有顶层对象才会被注入，因为遍历所有嵌套对象来执行注入是一个性能问题。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在注入非默认数据源时要小心。例如，使用这个配置:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">dataSources</span>:
    <span class="key">dataSource</span>:
        <span class="key">pooled</span>: <span class="predefined-constant">true</span>
        <span class="key">jmxExport</span>: <span class="predefined-constant">true</span>
        .....
    secondary:
        <span class="key">pooled</span>: <span class="predefined-constant">true</span>
        <span class="key">jmxExport</span>: <span class="predefined-constant">true</span>
        .....</code></pre>
</div>
</div>
<div class="paragraph">
<p>你可以注入主要 <code>dataSource</code> 如你所期望的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">BookSqlService</span> {

      def dataSource
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是要注入 <code>secondary</code> 数据源，您必须使用Spring的 <code>Autowired</code> 注入或 <code>resources.groovy</code>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="type">class</span> <span class="class">BookSqlSecondaryService</span> {

  <span class="annotation">@Autowired</span>
  <span class="annotation">@Qualifier</span>(<span class="string"><span class="delimiter">'</span><span class="content">dataSource_secondary</span><span class="delimiter">'</span></span>)
  def dataSource2
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dependency_injection_and_services">Dependency Injection and Services</h4>
<div class="paragraph">
<p>您可以使用相同的技术将服务注入到其他服务中。如果您有一个需要使用 <code>BookService</code> 的 <code>AuthorService</code>，则可以声明 <code>AuthorService</code> 如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorService</span> {
    <span class="keyword">def</span> bookService
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_dependency_injection_and_domain_classes_tag_libraries">Dependency Injection and Domain Classes / Tag Libraries</h4>
<div class="paragraph">
<p>您甚至可以将服务注入域类和标记库，这有助于开发富域模型和视图:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    ...
    def bookService

    <span class="keyword">def</span> <span class="function">buyBook</span>() {
        bookService.buyBook(<span class="local-variable">this</span>)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
因为默认情况下Grails 3.2.8是不支持的。如果您想再次启用它，请查看 <a href="http://docs.grails.org/latest/ref/Domain%20Classes/Usage.html#_spring_autowiring_of_domain_instances">Spring Autowiring of Domain Instance</a>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_service_bean_names">Service Bean Names</h4>
<div class="paragraph">
<p>如果在不同的程序包中定义了多个具有相同名称的服务，则与服务关联的缺省bean名称可能会出现问题。例如，考虑以下情况：应用程序定义了一个名为 <code>com.demo.ReportingService</code> 的服务类，并且该应用程序使用了一个名为 <code>ReportingUtilities</code> 的插件，并且该插件提供了一个名为 <code>com.reporting.util.ReportingService</code> 的服务类。</p>
</div>
<div class="paragraph">
<p>每个bean的默认bean名称将是 <code>reportingService</code> ，因此它们将彼此冲突。 Grails通过使用插件名称前缀Bean名称来更改插件提供的服务的默认Bean名称来进行管理。</p>
</div>
<div class="paragraph">
<p>在上述情况下，<code>reportingService</code> bean将是应用程序中定义的 <code>com.demo.ReportingService</code> 类的实例，而 <code>reportingUtilitiesReportingService</code> bean将是 <code>com.reporting.util.ReportingService</code> 类的实例。由 <code>ReportingUtilities</code> 插件提供。</p>
</div>
<div class="paragraph">
<p>对于插件提供的所有服务Bean，如果应用程序中没有其他具有相同名称的服务或应用程序中的其他插件，则将创建一个不包含插件名称的Bean别名，并且该别名指向所引用的Bean包含不包含插件名称前缀的名称。</p>
</div>
<div class="paragraph">
<p>例如，如果 <code>ReportingUtilities</code> 插件提供名为 <code>com.reporting.util.AuthorService</code> 的服务，并且应用程序或该应用程序使用的任何插件中没有其他 <code>AuthorService</code> ，那么将有一个bean。名为 <code>reportingUtilitiesAuthorService</code> ，它是此com.reporting.util.AuthorService类的实例，并且在上下文中定义了一个名为 <code>authorService</code> 的bean别名，该别名指向同一bean。</p>
</div>
</div>


<h1 id="staticTypeCheckingAndCompilation">14 静态类型检查和编译</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/staticTypeCheckingAndCompilation.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Groovy是一种动态语言，默认情况下，Groovy使用动态调度机制来执行方法调用和属性访问。这种动态的分配机制为语言提供了很大的灵活性和功能。例如，可以在运行时动态地将方法添加到类中，并且可以在运行时动态地替换现有方法。这些功能很重要，并且为语言提供了强大的功能。但是，有时您可能希望禁用此动态调度，而采用更静态的调度机制，而Groovy提供了一种方法来做到这一点。告诉Groovy编译器特定类应该静态编译的方法是用 <a href="http://docs.groovy-lang.org/docs/latest/html/api/groovy/transform/CompileStatic.html">groovy.transform.CompileStatic</a>批注，如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">MyClass</span> {

    <span class="comment">// 此类将被静态编译...</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>请参阅 <a href="http://docs.groovy-lang.org/latest/html/documentation/#_static_compilation">有关Groovy静态编译的这些说明</a> 以获取有关 <code>CompileStatic</code> 的工作原理以及为什么要使用它的更多详细信息。</p>
</div>
<div class="paragraph">
<p>使用 <code>CompileStatic</code> 的一个限制是，当您使用它时，您将放弃使用动态调度所提供的功能和灵活性。例如，在Grails中，您将无法从带有标记的类中调用GORM动态查找器，<code>CompileStatic</code> 因为编译器无法验证动态查找器方法是否存在，因为它在编译时不存在。可能是您想利用Groovy的静态编译优势而不放弃对Grails特定事物（例如动态查找器）的动态分配的访问权限，
而这正是 <a href="http://docs.grails.org/4.0.0/api/grails/compiler/GrailsCompileStatic.html">grails.compiler.GrailsCompileStatic</a> 出现的地方。 <code>GrailsCompileStatic</code> 其行为类似于 <code>CompileStatic</code> 但知道某些Grails功能并允许动态访问对这些特定功能的访问。</p>
</div>


<h2 id="grailsCompileStatic">14.1 Grails 编译静态注释</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/staticTypeCheckingAndCompilation/grailsCompileStatic.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_grails编译静态tic">Grails编译静态tic</h4>
<div class="paragraph">
<p><code>GrailsCompileStatic</code> 注释可以应用于类中的类或方法。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">SomeClass</span> {

    <span class="comment">// all of the code in this class will be statically compiled</span>

    <span class="keyword">def</span> <span class="function">methodOne</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">methodTwo</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">methodThree</span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="type">class</span> <span class="class">SomeClass</span> {

    <span class="comment">// methodOne and methodThree will be statically compiled</span>
    <span class="comment">// methodTwo will be dynamically compiled</span>

    <span class="annotation">@GrailsCompileStatic</span>
    <span class="keyword">def</span> <span class="function">methodOne</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">methodTwo</span>() {
        <span class="comment">// ...</span>
    }

    <span class="annotation">@GrailsCompileStatic</span>
    <span class="keyword">def</span> <span class="function">methodThree</span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以用 <code>GrailsCompileStatic</code> 标记类，并通过用 <code>GrailsCompileStatic</code> 标记类并指定应该跳过该特定方法的类型检查来排除特定方法，如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>
<span class="keyword">import</span> <span class="include">groovy.transform.TypeCheckingMode</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="type">class</span> <span class="class">SomeClass</span> {

    <span class="comment">// methodOne and methodThree will be statically compiled</span>
    <span class="comment">// methodTwo will be dynamically compiled</span>

    <span class="keyword">def</span> <span class="function">methodOne</span>() {
        <span class="comment">// ...</span>
    }

    <span class="annotation">@GrailsCompileStatic</span>(TypeCheckingMode.SKIP)
    <span class="keyword">def</span> <span class="function">methodTwo</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">methodThree</span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>标记为 <code>GrailsCompileStatic</code> 的代码将全部被静态编译，除非Grails特定的交互不能被静态编译，但 <code>GrailsCompileStatic</code> 可以识别为动态调度允许的交互。这包括在配置块中调用动态查找器和DSL代码，比如在域类中调用约束和映射闭包。</p>
</div>
<div class="paragraph">
<p>在决定静态编译代码时必须小心。静态编译有一些好处，但是为了利用这些好处，您放弃了动态调度的能力和灵活性。例如，如果代码是静态编译的，它就不能利用由插件提供的运行时元编程增强功能。</p>
</div>
</div>


<h2 id="grailsTypeChecked">14.2 Grails 类型检查注释</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/staticTypeCheckingAndCompilation/grailsTypeChecked.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_已检查grails类型">已检查Grails类型</h4>
<div class="paragraph">
<p>这个 <a href="http://docs.grails.org/4.0.0/api/grails/compiler/GrailsTypeChecked.html">grails.compiler.GrailsTypeChecked</a> 注释的工作原理与 <code>GrailsCompileStatic</code> 注释非常相似，只是它只支持静态类型检查，而不支持静态编译。这为那些不能在编译时静态验证的表达式提供了编译时反馈，同时仍然为类保留了动态分派。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.compiler.GrailsTypeChecked</span>

<span class="annotation">@GrailsTypeChecked</span>
<span class="type">class</span> <span class="class">SomeClass</span> {

    <span class="comment">// all of the code in this class will be statically type</span>
    <span class="comment">// checked and will be dynamically dispatched at runtime</span>

    <span class="keyword">def</span> <span class="function">methodOne</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">methodTwo</span>() {
        <span class="comment">// ...</span>
    }

    <span class="keyword">def</span> <span class="function">methodThree</span>() {
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
</div>

<a name="12. &#27979;&#35797;"><!-- Legacy link --></a>
<h1 id="testing">15 测试</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/testing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>自动化测试是Grails的关键部分。因此，Grails提供了许多方法来简化测试，从低级单元测试到高级功能测试。本节详细介绍了Grails为测试提供的不同功能。</p>
</div>
<div class="paragraph">
<p>首先要注意的是，所有的 <code>create-*</code> 和 <code>generate-\*</code> 命令都会自动创建 <code>unit</code> 或 <code>integration</code> 测试。例如，如果您运行链接：<a href="../ref/Command%20Line/create-controller.html">create-controller</a> 命令，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-controller com.acme.app.simple</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails将在 <code>grails-app/controllers/com/acme/app/SimpleController.groovy</code> 中创建一个控制器，并在 <code>src/test/groovy/com/acme/app/SimpleControllerSpec.groovy</code> 中创建一个单元测试。但是Grails不会做的是在测试内部填充逻辑！这取决于您。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认的类名后缀是 <code>Tests</code> ，但是从Grails 1.2.2开始，还支持 <code>Test</code> 后缀。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_运行测试">运行测试</h4>
<div class="paragraph">
<p>使用 <a href="../ref/Command%20Line/test-app.html">test-app</a>命令运行测试:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>该命令将产生如下输出:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">-------------------------------------------------------
Running Unit Tests...
Running test FooTests...FAILURE
Unit Tests Completed <span class="keyword">in</span> <span class="integer">464</span>ms ...
-------------------------------------------------------

Tests <span class="key">failed</span>: <span class="integer">0</span> errors, <span class="integer">1</span> failures</code></pre>
</div>
</div>
<div class="paragraph">
<p>同时显示每次测试失败的原因.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
您可以在运行测试之前通过将 <code>-clean</code> 传递给 <code>test-app</code> 命令来强制执行clean。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Grails将纯文本和HTML测试报告与原始XML文件一起写入 <code>targe/test-reports</code> 目录。 HTML报告通常是最好的报告。</p>
</div>
<div class="paragraph">
<p>使用Grails的 <a href="commandLine.html#interactiveMode">互动模式</a> 在执行测试时具有一些明显的优势。首先，测试将在第二次及以后的运行中明显更快地执行。其次，可以使用快捷方式在浏览器中打开HTML报告：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">open test-report</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以在大多数IDE中运行单元测试.</p>
</div>
</div>
<div class="sect3">
<h4 id="_定位测试">定位测试</h4>
<div class="paragraph">
<p>您可以有选择地针对要以不同方式运行的测试。要为名为 <code>SimpleController</code> 的控制器运行所有测试，请运行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app SimpleController</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将为名为 <code>SimpleController</code> 的类运行任何测试。可以使用通配符&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app *Controller</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将测试所有以 <code>Controller</code> 结尾的类。包名称可以选择指定&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app some.org.*Controller</code></pre>
</div>
</div>
<div class="paragraph">
<p>或运行一个包中的所有测试&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app some.org.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>或运行包含子包的包中的所有测试&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app some.org.**.*</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以针对特定的测试方法&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app SimpleController.testLogin</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在 <code>SimpleController</code> 测试中运行 <code>testLogin</code> 测试。您可以根据需要指定任意多个组合模式&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app some.org.* SimpleController.testLogin BookController</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在Grails 2.x中, 添加 <code>-rerun</code> 作为参数只会运行那些在之前的test-app运行中失败的测试。不再支持该参数.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在Grails 3.x中, 您可能需要在类名称之前指定包名称，并在末尾附加 <code>Spec</code> ,例如，如果要为ProductController运行测试，则应使用 <code>grails test-app * .ProductControllerSpec</code> 。. 请注意，如果您不想键入整个程序包层次结构，可以使用星号.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_调试">调试</h4>
<div class="paragraph">
<p>为了通过远程调试器调试测试，可以在任何命令的 <code>grails</code> 之后添加 <code>--debug-jvm</code> ，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails --debug-jvm test-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将打开默认的Java远程调试端口5005，供您从所选的编辑器/ IDE连接远程调试器。
NOTE: 这与Grails 2.3及之前的版本不同，在该版本中存在 <code>grails-debug</code> 命令.</p>
</div>
</div>
<div class="sect3">
<h4 id="_定位测试阶段">定位测试阶段</h4>
<div class="paragraph">
<p>除了针对某些测试, 您也可以针对测试_phases。_默认情况下，Grails有两个测试阶段，分别是 <code>unit</code> 和 <code>integration</code> 。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Grails 2.x使用 <code>phase:type</code> 语法。在Grails 3.0中已将其删除，因为在Gradle上下文中它没有意义。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>要执行 <code>unit</code> 测试，以运行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app -unit</code></pre>
</div>
</div>
<div class="paragraph">
<p>要运行 <code>integration</code> 测试，您将运行。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app -integration</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用阶段时的定向测试">使用阶段时的定向测试</h4>
<div class="paragraph">
<p>可以同时应用测试和阶段定位:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails test-app some.org.**.* -unit</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在软件包 <code>some.org</code> 或子软件包中的 <code>unit</code> 运行所有测试。</p>
</div>
</div>

<a name="12.1 &#21333;&#20803;&#27979;&#35797;"><!-- Legacy link --></a>
<h2 id="unitTesting">15.1 单元测试</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/testing/unitTesting.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>单元测试是"unit"级别的测试。换句话说，您正在测试单个方法或代码块，而不考虑周围的基础结构。单元测试通常在没有涉及I/O的物理资源（例如数据库，套接字连接或文件）的情况下运行。这是为了确保它们尽可能快地运行，因为快速反馈很重要。</p>
</div>
<div class="paragraph">
<p>从Grails 3.3开始，<a href="https://testing.grails.org">Grails Testing Support Framework</a>用于所有单元测试。这种支持提供了一组特征。下面是一个示例hello world测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">grails.testing.web.controllers.ControllerUnitTest</span>

<span class="type">class</span> <span class="class">HelloControllerTests</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ControllerUnitTest&lt;HelloController&gt; {

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Test message action</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The message action is invoked</span><span class="delimiter">&quot;</span></span>
        controller.message()

        <span class="key">then</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Hello is returned</span><span class="delimiter">&quot;</span></span>
        response.text == <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关使用Grails测试支持编写测试的更多信息，请参见 <a href="https://testing.grails.org">dedicated documentation</a>。</p>
</div>
<div class="paragraph">
<p>3.2以下的Grails版本使用 <a href="https://grails-plugins.github.io/grails-test-mixin-plugin/latest/guide/index.html">Grails Test Mixin Framework</a>，它基于AST <code>@TestMixin</code> 转型。该库已被更简单，更基于IDE友好特性的实现所取代。但是，您仍然可以通过在Grails应用程序中添加以下依赖项来使用它：</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-test-mixins:3.3.0.RC1</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>例如，如果您要将现有应用程序升级到Grails 3.3.x，这可能会很有用。</p>
</div>

<a name="12.2 &#38598;&#25104;&#27979;&#35797;"><!-- Legacy link --></a>
<h2 id="integrationTesting">15.2 集成测试</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/testing/integrationTesting.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>集成测试与单元测试的不同之处在于，您可以完全访问测试中的Grails环境。您可以使用以下链接创建集成测试<a href="../ref/Command%20Line/create-integration-test.html">create-integration-test</a>命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> grails create-integration-test Example</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的命令将在 <code>src/integration-test/groovy/&lt;PACKAGE&gt;/ExampleSpec.groovy</code> 位置创建一个新的集成测试。</p>
</div>
<div class="paragraph">
<p>Grails使用测试环境进行集成测试，并在第一次测试运行之前加载应用程序。所有测试都使用相同的应用程序状态。</p>
</div>
<div class="sect3">
<h4 id="_交易">交易</h4>
<div class="paragraph">
<p>默认情况下，集成测试方法在其自己的数据库事务中运行，该事务将在每个测试方法的末尾回滚。这意味着测试期间保存的数据不会持久保存到数据库（所有测试之间共享）。默认生成的集成测试模板包括<a href="http://docs.grails.org/4.0.0/api/grails/transaction/Rollback.html">Rollback</a>批注：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">grails.gorm.transactions.*</span>
<span class="keyword">import</span> <span class="include">spock.lang.*</span>

<span class="annotation">@Integration</span>
<span class="annotation">@Rollback</span>
<span class="type">class</span> <span class="class">ExampleSpec</span> <span class="directive">extends</span> Specification {

    ...

    void <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">fix me</span><span class="delimiter">&quot;</span></span>
            <span class="predefined-constant">true</span> == <span class="predefined-constant">false</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>Rollback</code> 注释可确保每种测试方法都在回滚的事务中运行。通常，这是可取的，因为您不希望根据订单或应用程序状态进行测试。</p>
</div>
<div class="paragraph">
<p>在Grails 3.0中，测试依赖于 <code>grails.gorm.transactions.Rollback</code> 批注来绑定集成测试中的会话。尽管每个测试方法事务都会回滚，但是 <code>setup()</code> 方法使用的是一个单独的事务，该事务不会回滚。
数据将保留在数据库中，并且如果 <code>setup()</code> 设置数据并将其保留，则需要手动清除，如以下示例所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">grails.gorm.transactions.*</span>
<span class="keyword">import</span> <span class="include">spock.lang.*</span>

<span class="annotation">@Integration</span>
<span class="annotation">@Rollback</span>
<span class="type">class</span> <span class="class">BookSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> setup() {
        <span class="comment">// Below line would persist and not roll back</span>
        <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails in Action</span><span class="delimiter">'</span></span>).save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        <span class="predefined-type">Book</span>.count() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了自动回滚设置逻辑，需要从测试方法本身调用任何持久性操作，以便它们在测试方法的回滚事务中运行。类似于下面显示的 <code>setupData()</code> 方法的用法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">grails.gorm.transactions.*</span>
<span class="keyword">import</span> <span class="include">spock.lang.*</span>

<span class="annotation">@Integration</span>
<span class="annotation">@Rollback</span>
<span class="type">class</span> <span class="class">BookSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> setupData() {
        <span class="comment">// Below line would roll back</span>
        <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails in Action</span><span class="delimiter">'</span></span>).save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        setupData()

        <span class="key">expect</span>:
        <span class="predefined-type">Book</span>.count() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用spring的rollback批注">使用Spring的Rollback批注</h4>
<div class="paragraph">
<p>另一种事务处理方法可能是改用Spring的<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/test/annotation/Rollback.html">@Rollback</a>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">org.springframework.test.annotation.Rollback</span>
<span class="keyword">import</span> <span class="include">spock.lang.*</span>

<span class="annotation">@Integration</span>
<span class="annotation">@Rollback</span>
<span class="type">class</span> <span class="class">BookSpec</span> <span class="directive">extends</span> Specification {

    <span class="type">void</span> setup() {
        <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Grails in Action</span><span class="delimiter">'</span></span>).save(<span class="key">flush</span>: <span class="predefined-constant">true</span>)
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test something</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
        <span class="predefined-type">Book</span>.count() == <span class="integer">1</span>
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
不可能使 <code>grails.gorm.transactions.Rollback</code> 的行为与Spring的Rollback注释相同，因为 <code>grails.gorm.transactions.Rollback</code> 会转换类的字节码，从而无需代理（Spring的版本要求）。
不利之处在于您无法针对不同的情况（如Spring用于测试）不同地实施它。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_dirtiescontext">DirtiesContext</h4>
<div class="paragraph">
<p>如果您确实有一系列共享状态的测试，则可以删除 <code>Rollback</code>，并且套件中的最后一个测试应包含<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/test/annotation/DirtiesContext.html">DirtiesContext</a>批注，它将关闭环境并重新启动它（请注意，这将影响测试运行时间）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_自动装配">自动装配</h4>
<div class="paragraph">
<p>要获取对bean的引用，可以使用<a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/annotation/Autowired.html">Autowired</a>批注。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">...
import org.springframework.beans.factory.annotation.*

<span class="annotation">@Integration</span>
<span class="annotation">@Rollback</span>
<span class="type">class</span> <span class="class">ExampleServiceSpec</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Autowired</span>
    ExampleService exampleService
    ...

    void <span class="string"><span class="delimiter">&quot;</span><span class="content">Test example service</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">expect</span>:
            exampleService.countExamples() == <span class="integer">0</span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_测试控制器">测试控制器</h4>
<div class="paragraph">
<p>要集成测试控制器，建议您使用 <a href="../ref/Command%20Line/create-functional-test.html">create-functional-test</a> 命令创建Geb功能测试。有关更多信息，请参见以下有关功能测试的部分。</p>
</div>
</div>

<a name="12.3 &#21151;&#33021;&#27979;&#35797;"><!-- Legacy link --></a>
<h2 id="functionalTesting">15.3 功能测试</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/testing/functionalTesting.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>功能测试包括针对正在运行的应用程序发出HTTP请求，并验证由此产生的行为。这对于端到端测试方案很有用，例如针对JSON API进行REST调用。
默认情况下，Grails附带支持使用 <a href="http://www.gebish.org">Geb framework</a> [Geb框架]编写功能测试的功能。要创建功能测试，可以使用 <code>create-functional-test</code> 命令，该命令将创建一个新的功能测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> grails create-functional-test MyFunctional</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的命令将在 <code>src/integration-test/groovy</code> 目录下创建一个名为 <code>MyFunctionalSpec.groovy</code> 的新Spock规范。该测试带有 <a href="http://docs.grails.org/4.0.0/api/grails/test/mixin/integration/Integration.Integration.html">Integration</a> 批注，以表明它是一个集成测试，并扩展了 <code>GebSpec</code> 超类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Integration</span>
<span class="type">class</span> <span class="class">HomeSpec</span> <span class="directive">extends</span> GebSpec {

    <span class="keyword">def</span> <span class="function">setup</span>() {
    }

    <span class="keyword">def</span> <span class="function">cleanup</span>() {
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Test the home page renders correctly</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The home page is visited</span><span class="delimiter">&quot;</span></span>
            go <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>

        <span class="key">then</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The title is correct</span><span class="delimiter">&quot;</span></span>
            <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">title</span><span class="delimiter">'</span></span>).text() == <span class="string"><span class="delimiter">&quot;</span><span class="content">Welcome to Grails</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>运行测试时，应用程序容器将在后台加载，您可以使用Geb API向正在运行的应用程序发送请求。</p>
</div>
<div class="paragraph">
<p>请注意，在整个测试运行中，该应用程序仅加载一次，因此功能测试在整个套件中共享应用程序的状态。</p>
</div>
<div class="paragraph">
<p>另外，将应用程序作为测试加载到JVM中，这意味着该测试具有对应用程序状态的完全访问权限，并且可以直接与数据服务（例如GORM）进行交互以设置和清除测试数据。</p>
</div>
<div class="paragraph">
<p><code>Integration</code> 注解支持可选的 <code>applicationClass</code> 属性，该属性可用于指定用于功能测试的应用程序类。该类必须扩展 <a href="http://docs.grails.org/4.0.0/api/grails/boot/config/GrailsAutoConfiguration.html">GrailsAutoConfiguration</a>。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Integration</span>(applicationClass=com.demo.Application)
<span class="type">class</span> <span class="class">HomeSpec</span> <span class="directive">extends</span> GebSpec {

    <span class="comment">// ...</span>

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果未指定 <code>applicationClass</code>，则测试运行时环境将尝试动态定位应用程序类，这在可能存在多个应用程序类的多项目构建中可能会出现问题。</p>
</div>
<div class="paragraph">
<p>运行服务器时，默认情况下将随机分配端口。如果要扩展应用程序 <code>GebSpec</code>，不需要了解应用程序在哪个端口上运行，则 <code>Integration</code> 批注将 <code>serverPort</code> 的属性添加到测试类中，您可以使用该属性。是有用的信息。</p>
</div>
<div class="paragraph">
<p>如果要在固定端口（由 <code>server.port</code> 配置属性定义）上运行测试，则需要使用 <code>@SpringBootTest</code> 手动注释测试：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">org.springframework.boot.test.context.SpringBootTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="annotation">@Integration</span>
<span class="annotation">@SpringBootTest</span>(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT)
<span class="type">class</span> <span class="class">MySpec</span> <span class="directive">extends</span> Specification {

    <span class="comment">// ...</span>

}</code></pre>
</div>
</div>

<a name="13. &#22269;&#38469;&#21270;"><!-- Legacy link --></a>
<h1 id="i18n">16 国际化</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/i18n.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails通过利用潜在的Spring MVC国际化支持来开箱即用地支持国际化（i18n）。使用Grails，您可以根据用户的区域设置来自定义视图中显示的文本。引用 <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Locale.html">Locale</a> 类的javadoc：</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>语言环境对象代表特定的地理，政治或文化区域。需要语言环境执行其任务的操作称为对语言环境敏感的操作，并使用该语言环境为用户定制信息。例如，显示数字是对语言环境敏感的操作-数字应根据用户的祖国，地区或文化的习俗/惯例进行格式化。</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>语言环境由 <a href="http://www.loc.gov/standards/iso639-2/php/English_list.php">语言代码</a> 和 <a href="http://www.iso.org/iso/country_codes/iso_3166_code_lists/country_names_and_code_elements.htm">国家代码</a>.例如，"en_US"是美国英语的代码，而" en_GB"是英国英语的代码。</p>
</div>

<a name="13.1 &#20102;&#35299;&#28040;&#24687;&#21253;"><!-- Legacy link --></a>
<h2 id="understandingMessageBundles">16.1 了解消息包</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/i18n/understandingMessageBundles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>现在您已经了解了 locale，要在 Grails 中使用它们，还需要创建包含你希望呈现的不同语言的消息包文件。 Grails 中的消息包位于 <code>rails-app/i18n</code> 目录中，是简单的 Java 属性文件。</p>
</div>
<div class="paragraph">
<p>每个包（bundle）按照约定以名称 <code>messages</code> 开始，以语言环境结束。 Grails 在 <code>grails-app/i18n</code> 目录中附带了几种消息包，适用于所有语言。 例如:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>messages.properties</p>
</li>
<li>
<p>messages_da.properties</p>
</li>
<li>
<p>messages_de.properties</p>
</li>
<li>
<p>messages_es.properties</p>
</li>
<li>
<p>messages_fr.properties</p>
</li>
<li>
<p>&#8230;&#8203;</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>默认情况下，除非用户指定了语言环境，否则 Grails 会在 <code>messages.properties</code> 中查找消息。您可以通过简单地创建一个以您感兴趣的语言环境结尾的新属性文件来创建自己的消息包文件。例如，针对英式英语的 <code>messages_en_GB.properties</code></p>
</div>

<a name="13.2 &#21306;&#22495;&#20999;&#25442;"><!-- Legacy link --></a>
<h2 id="changingLocales">16.2 更改区域设置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/i18n/changingLocales.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>默认情况下，从传入的 <code>Accept-Language</code> 请求头中检测到用户区域设置。但是，您可以通过简单地将名为 <code>lang</code> 的参数传递给 Grails 作为请求参数来为用户提供切换语言环境的功能：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="regexp"><span class="delimiter">/</span><span class="content">book</span><span class="delimiter">/</span></span>list?lang=es</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails 将自动切换用户的语言环境并将其存储在 Cookie 中，以便后续请求将具有新的请求头。</p>
</div>

<a name="13.3 &#38405;&#35835;&#28040;&#24687;"><!-- Legacy link --></a>
<h2 id="readingMessages">16.3 阅读消息</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/i18n/readingMessages.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_在视图_view_中显示消息">在视图（View）中显示消息</h4>
<div class="paragraph">
<p>您最需要 <a href="http://gsp.grails.org/latest/ref/Tags/message.html">message</a> 的地方是视图内。为此，请使用消息标签：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:message</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.localized.content</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>只要您在 <code>messages.properties</code>（具有适当的语言环境后缀）中键入一个密钥（例如以下代码），<code>Grails</code> 就会查找该消息</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">my.localized.content=Hola, me llamo John. Hoy es domingo.</code></pre>
</div>
</div>
<div class="paragraph">
<p>消息也可以包含参数，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:message</span> <span class="attribute-name">code</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.localized.content</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">args</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${ ['Juan', 'lunes'] }</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>消息声明指定了动态指定的位置参数：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">my.localized.content=Hola, me llamo {<span class="integer">0</span>}. Hoy es {<span class="integer">1</span>}.</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用_messagesource_阅读_grails_工件中的消息">使用 MessageSource 阅读 Grails 工件中的消息</h4>
<div class="paragraph">
<p>在 Grails 工件中，您可以注入 <code>messageSource</code> 并将 <code>getMessage</code> 方法与以下参数一起使用：消息代码，消息参数，默认消息和语言环境来检索消息。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.context.MessageSource</span>

<span class="type">class</span> <span class="class">MyappController</span> {

    MessageSource messageSource

    <span class="keyword">def</span> <span class="function">show</span>() {
        <span class="keyword">def</span> msg = messageSource.getMessage(<span class="string"><span class="delimiter">'</span><span class="content">my.localized.content</span><span class="delimiter">'</span></span>, [<span class="string"><span class="delimiter">'</span><span class="content">Juan</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lunes</span><span class="delimiter">'</span></span>] <span class="keyword">as</span> <span class="predefined-type">Object</span><span class="type">[]</span>, <span class="string"><span class="delimiter">'</span><span class="content">Default Message</span><span class="delimiter">'</span></span>, request.locale)
    }</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_在带有消息标签的控制器和标签库中读取消息">在带有消息标签的控制器和标签库中读取消息</h4>
<div class="paragraph">
<p>此外，您可以在控制器和标签库中读取带有 <a href="http://gsp.grails.org/latest/ref/Tags/message.html">消息标签</a> 的消息。 但是，使用 message 标记依赖于 Grails 应用程序不一定具有的 GSP 支持。例如：其余的应用程序。</p>
</div>
<div class="paragraph">
<p>在控制器中，您可以将标签作为方法来调用。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    <span class="keyword">def</span> msg = message(<span class="key">code</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my.localized.content</span><span class="delimiter">&quot;</span></span>, <span class="key">args</span>: [<span class="string"><span class="delimiter">'</span><span class="content">Juan</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lunes</span><span class="delimiter">'</span></span>])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 <a href="theWebLayer.html#taglibs">标记库</a> 中可以使用相同的技术，但是如果标记库使用自定义名称空间，则必须在调用之前加上 <code>g.</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> myTag = { attrs, body -&gt;
    <span class="keyword">def</span> msg = g.message(<span class="key">code</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my.localized.content</span><span class="delimiter">&quot;</span></span>, <span class="key">args</span>: [<span class="string"><span class="delimiter">'</span><span class="content">Juan</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lunes</span><span class="delimiter">'</span></span>])
}</code></pre>
</div>
</div>
</div>

<a name="13.4 &#33050;&#25163;&#26550;&#21644; i18n"><!-- Legacy link --></a>
<h2 id="scaffoldingAndI18n">16.4 脚手架和 i18n</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/i18n/scaffoldingAndI18n.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>用于控制器和视图的 Grails <a href="scaffolding.html">scaffolding</a> 模板完全支持 i18n。GSP 将 <a href="http://gsp.grails.org/latest/ref/Tags/message.html">message</a> 标签用于标签，按钮等，而控制器 <code>flash</code> 消息则使用 i18n 解析特定于区域的消息。</p>
</div>
<div class="paragraph">
<p>scaffolding 包括域类和域字段的特定于语言环境的标签。 例如，如果您有一个带有 <code>title</code> 字段的 <code>Book</code> 域类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    <span class="predefined-type">String</span> title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>scaffolding 将使用带有以下键的标签：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">book.label = Libro
book.title.label = T<span class="error">í</span>tulo del libro</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以根据需要使用此属性模式，也可以自己提出一种。 除了 scaffolding 使用的约定外，将单词 <code>标签</code> 用作键的一部分也是可以的</p>
</div>

<a name="14. &#23433;&#20840;"><!-- Legacy link --></a>
<h1 id="security">17 安全性</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/security.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails的安全性与Java Servlet差不多。 但是，由于Java虚拟机是代码的基础，因此Java Servlet（因此还有Grails）非常安全，并且不受常见缓冲区溢出和URL格式错误的影响。</p>
</div>
<div class="paragraph">
<p>Web安全性问题通常是由于开发人员的幼稚或错误而发生的，Grails可以采取一些措施来避免常见错误并使编写安全的应用程序更容易编写。</p>
</div>
<div class="sect3">
<h4 id="_grails自动执行的操作">Grails自动执行的操作</h4>
<div class="paragraph">
<p>默认情况下，Grails具有一些内置的安全机制。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>通过<a href="GORM.html">GORM</a>域对象进行的所有标准数据库访问都将自动转义SQL，以防止SQL注入攻击</p>
</li>
<li>
<p>默认 <a href="scaffolding.html">scaffolding</a>模板HTML在显示时会转义所有数据字段</p>
</li>
<li>
<p>Grails链接创建标签（<a href="http://gsp.grails.org/latest/ref/Tags/link.html">link</a>, <a href="http://gsp.grails.org/latest/ref/Tags/form.html">form</a>, <a href="http://gsp.grails.org/latest/ref/Tags/createLink.html">createLink</a>, <a href="http://gsp.grails.org/latest/ref/Tags/createLinkTo.html">createLinkTo</a>等）均使用适当的转义机制来防止代码注入</p>
</li>
<li>
<p>Grails提供了&lt;&lt; codecs，codecs &gt;&gt;，当您将它们呈现为HTML，JavaScript和URL时，可以轻松地对数据进行转义，以防止注入攻击。</p>
</li>
</ul>
</div>
</div>

<a name="14.1 &#38450;&#33539;&#25915;&#20987;"><!-- Legacy link --></a>
<h2 id="securingAgainstAttacks">17.1 防范攻击</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/security/securingAgainstAttacks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_sql注入">SQL注入</h4>
<div class="paragraph">
<p>Hibernate是GORM域类的底层技术，它在提交到数据库时自动转义数据，所以这不是问题。但是，仍然有可能编写出错误的动态HQL代码在使用未检查请求参数情况下。例如，以下代码是容易受到HQL注入攻击:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">vulnerable</span>() {
    <span class="keyword">def</span> books = <span class="predefined-type">Book</span>.find(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b where b.title ='</span><span class="delimiter">&quot;</span></span> + params.title + <span class="string"><span class="delimiter">&quot;</span><span class="content">'</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>还有类似的使用GString的调用:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">vulnerable</span>() {
    <span class="keyword">def</span> books = <span class="predefined-type">Book</span>.find(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b where b.title ='</span><span class="inline"><span class="inline-delimiter">${</span>params.title<span class="inline-delimiter">}</span></span><span class="content">'</span><span class="delimiter">&quot;</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>不要这样做。使用命名或位置参数代替传递参数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">safe</span>() {
    <span class="keyword">def</span> books = <span class="predefined-type">Book</span>.find(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b where b.title = ?</span><span class="delimiter">&quot;</span></span>,
                          [params.title])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">safe</span>() {
<span class="keyword">def</span> books = <span class="predefined-type">Book</span>.find(<span class="string"><span class="delimiter">&quot;</span><span class="content">from Book as b where b.title = :title</span><span class="delimiter">&quot;</span></span>,
                          [<span class="key">title</span>: params.title])
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_网络钓鱼">网络钓鱼</h4>
<div class="paragraph">
<p>这是一个公共关系问题，因为它可以避免你的品牌被劫持，同时也可以避免与你的客户进行公开的沟通。客户需要知道如何识别有效的电子邮件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_跨站点脚本注入">跨站点脚本注入</h4>
<div class="paragraph">
<p>重要的是，应用程序要尽可能多地验证传入的请求来自应用程序，而不是来自其他站点。确保所有呈现到视图中的数据值都正确转义也很重要。例如，在将其呈现为HTML或XHTML时，必须确保人们不能恶意地将JavaScript或其他HTML注入到其他人看到的数据或标记中。</p>
</div>
<div class="paragraph">
<p>Grails 2.3及以上版本包括对放置在GSP页面中的自动编码数据的特殊支持。有关更多信息，请参见<a href="#xssPrevention">Cross Site Scripting (XSS) prevention</a>的文档。</p>
</div>
<div class="paragraph">
<p>您还必须避免使用请求参数或数据字段来确定要将用户重定向到的下一个URL。如果你使用 <code>successURL</code> 参数例如确定将用户重定向到登录成功后,攻击者可以模仿你的登录过程使用您自己的网站,然后将用户重定向回自己的网站一旦登录,可能允许JavaScript代码然后利用登录账户在网站上。</p>
</div>
</div>
<div class="sect3">
<h4 id="_跨站点请求伪造">跨站点请求伪造</h4>
<div class="paragraph">
<p>CSRF涉及从网站信任的用户发送未经授权的命令。一个典型的例子是另一个网站嵌入一个链接来执行一个操作，如果用户仍然是认证的。</p>
</div>
<div class="paragraph">
<p>降低此类攻击风险的最佳方法是在表单上使用 <code>useToken</code> 属性。详情请参阅链接：<a href="theWebLayer.html#formtokens">Handling Duplicate Form Submissions</a>，以获取有关如何使用它的更多信息。另一个措施是不要使用记住我cookies。</p>
</div>
</div>
<div class="sect3">
<h4 id="_html_url注入">HTML / URL注入</h4>
<div class="paragraph">
<p>这是提供错误数据的地方，以便在以后用于在页面中创建链接时，单击它不会导致预期的行为，并且可能重定向到另一个站点或更改请求参数。</p>
</div>
<div class="paragraph">
<p>Grails提供的 <a href="#codecs">codecs</a> 和Grails提供的标记库都可以在适当的地方使用 <a href="#codecs">encodeAsURL</a> 轻松地处理HTML/URL注入。如果你创建自己的标签来生成url，你也需要注意这一点。</p>
</div>
</div>
<div class="sect3">
<h4 id="_拒绝服务">拒绝服务</h4>
<div class="paragraph">
<p>负载均衡器和其他设备在这里更有用，但也存在与过度查询有关的问题，例如，攻击者创建一个链接来设置结果集的最大值，以便查询可以超过服务器的内存限制或使得系统慢下来。这里的解决方案是在将请求参数传递给动态查找程序或其他GORM查询方法之前始终对其进行清理：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">int</span> limit = <span class="integer">100</span>
<span class="keyword">def</span> safeMax = <span class="predefined-type">Math</span>.min(params.max?.toInteger() ?: limit, limit) <span class="comment">// limit to 100 results</span>
<span class="keyword">return</span> <span class="predefined-type">Book</span>.list(<span class="key">max</span>:safeMax)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_可推测的id">可推测的id</h4>
<div class="paragraph">
<p>许多应用程序使用URL的最后一部分作为某个对象的"id"，以便从GORM或其他地方检索。特别是在GORM的情况下，这些很容易猜测，因为它们通常是连续整数。</p>
</div>
<div class="paragraph">
<p>因此，您必须断言，在将响应返回给用户之前，允许请求用户使用所请求的id查看对象。</p>
</div>
<div class="paragraph">
<p>不这样做就是"通过隐藏实现安全性"，这是不可避免的，就像拥有默认密码"letmein"等等。</p>
</div>
<div class="paragraph">
<p>您必须假设每个未受保护的URL都可以通过某种方式公开访问。</p>
</div>
</div>

<a name="13.2 &#36328;&#31449;&#28857;&#33050;&#26412; &#65288;XSS&#65289; &#39044;&#38450;"><!-- Legacy link --></a>
<h2 id="xssPrevention">17.2 跨站点脚本 （XSS） 预防</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/security/xssPrevention.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>跨站点脚本攻击(XSS)是web应用程序的常见攻击载体。它们通常涉及以这样的形式提交HTML或Javascript代码，即当代码显示时，浏览器会做一些令人讨厌的事情。它可以是简单的弹出一个警告框，也可以是更糟糕的，例如可以通过 <a href="https://blog.codinghorror.com/protecting-your-cookies-httponly/">access other users session cookies</a>访问其他用户的会话cookie。</p>
</div>
<div class="paragraph">
<p>解决方案是在页面中显示所有不受信任的用户输入时对其进行转义。例如，</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;script&gt;alert(<span class="string"><span class="delimiter">'</span><span class="content">Got ya!</span><span class="delimiter">'</span></span>);&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">script&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>会变成</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&amp;lt;script&amp;gt;alert(<span class="string"><span class="delimiter">'</span><span class="content">Got ya!</span><span class="delimiter">'</span></span>);&amp;lt;<span class="regexp"><span class="delimiter">/</span><span class="content">script&amp;gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>呈现时，取消恶意输入的效果。</p>
</div>
<div class="paragraph">
<p>默认情况下，Grails会安全地运行它，并在gsp中转义 <code>${}</code> 表达式中的所有内容。默认情况下，所有标准GSP标记也都是安全的，可以转义任何相关的属性值。</p>
</div>
<div class="paragraph">
<p>那么当你想阻止Grails转义某些内容时会发生什么呢？只要内容是 <strong>可信的</strong> ，就有将HTML放入数据库并按原样呈现的有效用例。在这种情况下，您可以告诉Grails，内容是安全的，应该原始呈现，即不需要任何转义：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;section&gt;<span class="error">$</span>{raw(page.content)}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">section&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您在这里看到的 <code>raw()</code> 方法可以从控制器、标记库和GSP页面获得。</p>
</div>
<div class="paragraph">
<p><strong>XSS的预防是困难的，需要开发人员的大量关注</strong></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
尽管Grails在默认情况下是安全的，但这不能保证您的应用程序不会受到XSS风格的攻击。这种攻击不太可能成功，但开发人员应该始终注意潜在的攻击载体，并在测试期间尝试发现应用程序中的漏洞。切换到不安全的默认设置也很容易，从而增加了引入漏洞的风险。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>关于XSS的更多细节可以看 <a href="https://www.owasp.org/index.php/XSS_%28Cross_Site_Scripting%29_Prevention_Cheat_Sheet#XSS_Prevention_Rules">OWASP - XSS prevention rules</a>和 <a href="https://www.owasp.org/index.php/Types_of_Cross-Site_Scripting">OWASP - Types of Cross-Site Scripting</a>.
XSS的种类见： <a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)#Stored_XSS_Attacks">Stored XSS</a>, <a href="https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)#Reflected_XSS_Attacks">Reflected XSS</a> 和 <a href="https://www.owasp.org/index.php/DOM_Based_XSS">DOM based XSS</a>. <a href="https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet">DOM based XSS prevention</a>随着Javascript客户端模板和单页应用程序的流行，它变得越来越重要。</p>
</div>
<div class="paragraph">
<p>Grails编解码器主要用于防止存储和反射XSS类型的攻击。Grails 2.4包含HTMLJS编解码器,它可以帮助防止一些基于DOM的XSS攻击。</p>
</div>
<div class="paragraph">
<p>很难让一个解决方案,适用于每个人,所以Grails提供了很大的灵活性对于微调逃离是如何工作的,让你保持你的大多数应用程序安全,同时关闭默认逃离或者改变编解码器用于页面,标签,页面片段,等等。</p>
</div>
<div class="sect3">
<h4 id="_配置">配置</h4>
<div class="paragraph">
<p>建议您查看新创建的Grails应用程序的配置，以了解Grails中的XSS预防工作。</p>
</div>
<div class="paragraph">
<p>当您使用HttpOnly标记标记cookie时,它会告诉浏览器该特定cookie只应被服务器访问。严禁从客户端脚本访问cookie。这可以在 <code>application.yml</code> 配置文件中进行配置，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">server</span>:
    <span class="key">session</span>:
        <span class="key">cookie</span>:
            <span class="key">domain</span>: example.org
            http-<span class="key">only</span>: <span class="predefined-constant">true</span>
            <span class="key">path</span>: <span class="regexp"><span class="delimiter">/</span></span><span class="error">
</span>            <span class="key">secure</span>: <span class="predefined-constant">true</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>GSP具有自动对GSP表达式进行HTML编码的功能，从Grails 2.3开始，这是默认配置。新创建的Grails应用程序的默认配置（见 <code>application.yml</code> ）如下：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">views</span>:
        <span class="key">gsp</span>:
            <span class="key">encoding</span>: UTF-<span class="integer">8</span>
            <span class="key">htmlcodec</span>: xml <span class="error">#</span> use xml escaping instead of HTML4 escaping
            <span class="key">codecs</span>:
                <span class="key">expression</span>: html <span class="error">#</span> escapes values inside <span class="error">$</span>{}
                <span class="key">scriptlets</span>: html <span class="error">#</span> escapes output from scriptlets <span class="keyword">in</span> GSPs
                <span class="key">taglib</span>: none <span class="error">#</span> escapes output from taglibs
                <span class="key">staticparts</span>: none <span class="error">#</span> escapes output from <span class="directive">static</span> template parts</code></pre>
</div>
</div>
<div class="paragraph">
<p>GSP具有几个编解码器，在将页面写入响应时使用这些编解码器。编解码器在 <code>codecs</code> 块中配置，如下所述：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>expression</code> -这个表达式编解码器用于对在${..}表达式中找到的任何代码进行编码。新创建的应用程序的默认值是 <code>html</code> 编码。</p>
</li>
<li>
<p><code>scriptlet</code> -这个用于GSP的输出（&lt;% %&gt;，&lt;%= %&gt;块）。新创建的应用程序的默认值是 <code>html</code> 编码</p>
</li>
<li>
<p><code>taglib</code> -用于对GSP标记库的输出进行编码。对于新应用程序，默认值为 <code>none</code> ，因为通常由标记作者负责定义给定标记的编码，并通过指定 <code>none</code> Grails才能保持与旧标记库的向下兼容。</p>
</li>
<li>
<p><code>staticparts</code> -用于对GSP页的原始标记输出进行编码。默认值为 <code>none</code> 。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_双重编码的预防">双重编码的预防</h4>
<div class="paragraph">
<p>在2.3之前的Grails版本，包括了将默认的编解码器设置 <code>html</code> 的能力，但是，在使用现有的插件时，启用这个设置有时会被证明是有问题的，因为编码被应用了两次(一次是 <code>html</code> 编解码器，一次是手动调用的插件 <code>encodeAsHTML</code> )。</p>
</div>
<div class="paragraph">
<p>Grails 2.3包含双重编码保护，这样在计算表达式时，如果数据已经编码，它就不会进行编码（例如 <code>${foo.encodeAsHTML()}</code> ）。</p>
</div>
</div>
<div class="sect3">
<h4 id="_原始的输出">原始的输出</h4>
<div class="paragraph">
<p>如果您百分百确定您希望在页面上显示的值尚未从用户输入中收到，并且您不希望对该值进行编码，则可以使用 <code>raw</code> 方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span>{raw(book.title)}</code></pre>
</div>
</div>
<div class="paragraph">
<p>'raw' 方法在标记库、控制器和GSP页面中可用。</p>
</div>
</div>
<div class="sect3">
<h4 id="_每个插件编码">每个插件编码</h4>
<div class="paragraph">
<p>Grails还具有控制每个插件使用的编解码器的功能。例如，如果安装了名为 <code>foo</code> 的插件，那么将以下配置放在 <code>application.groovy</code> 中将只对 <code>foo</code> 插件禁用编码</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">foo.grails.views.gsp.codecs.expression = <span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_每页的编码">每页的编码</h4>
<div class="paragraph">
<p>还可以使用page指令控制用于每页呈现GSP页的各种编解码器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;%<span class="annotation">@page</span> expressionCodec=<span class="string"><span class="delimiter">&quot;</span><span class="content">none</span><span class="delimiter">&quot;</span></span> %&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_每个标记库编码">每个标记库编码</h4>
<div class="paragraph">
<p>创建的每个标记库都有机会指定一个默认编解码器，用于使用"defaultEncodeAs"属性对来自标记库的输出进行编码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> defaultEncodeAs = <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>也可以使用"encodeAsForTags"在每个标记的基础上指定编码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> encodeAsForTags = [<span class="key">tagName</span>: <span class="string"><span class="delimiter">'</span><span class="content">raw</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_上下文敏感编码切换">上下文敏感编码切换</h4>
<div class="paragraph">
<p>某些标记需要特定的编码，Grails的功能是使用"withCodec"方法只启用标记执行的特定部分的编解码器。例如，考虑一下"&lt;g:javascript&gt;""标记，它允许您在页面中嵌入javascript代码。此标记需要JavaScript编码，而不是HTML编码以执行标记主体（但不用于输出的标记）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">out.println <span class="string"><span class="delimiter">'</span><span class="content">&lt;script type=&quot;text/javascript&quot;&gt;</span><span class="delimiter">'</span></span>
    withCodec(<span class="string"><span class="delimiter">&quot;</span><span class="content">JavaScript</span><span class="delimiter">&quot;</span></span>) {
        out &lt;&lt; body()
    }
    out.println()
    out.println <span class="string"><span class="delimiter">'</span><span class="content">&lt;/script&gt;</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_标签的强制编码">标签的强制编码</h4>
<div class="paragraph">
<p>如果标记指定的默认编码与您的要求不同，则可以通过传递可选的&#8217;encodeAs&#8217;属性强制对任何标记进行编码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:message code=<span class="string"><span class="delimiter">&quot;</span><span class="content">foo.bar</span><span class="delimiter">&quot;</span></span> encodeAs=<span class="string"><span class="delimiter">&quot;</span><span class="content">JavaScript</span><span class="delimiter">&quot;</span></span> /&gt;</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_所有输出的默认编码">所有输出的默认编码</h4>
<div class="paragraph">
<p>新应用程序的默认配置对于大多数用例来说是很好的，并且与现有的插件和标签库向后兼容。但是，通过配置Grails始终在响应结束时对所有输出进行编码，您还可以使您的应用程序更加安全。这是使用 <code>application.groovy</code> 中的 <code>filteringCodecForContentType</code> 配置完成的：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.views.gsp.filteringCodecForContentType.<span class="string"><span class="delimiter">'</span><span class="content">text/html</span><span class="delimiter">'</span></span> = <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，如果激活了 <code>staticparts</code> 编解码器，则通常需要将其设置为 <code>raw</code> ，以便不对静态标记进行编码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">codecs {
        expression = <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span> <span class="comment">// escapes values inside ${}</span>
        scriptlet = <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span> <span class="comment">// escapes output from scriptlets in GSPs</span>
        taglib = <span class="string"><span class="delimiter">'</span><span class="content">none</span><span class="delimiter">'</span></span> <span class="comment">// escapes output from taglibs</span>
        staticparts = <span class="string"><span class="delimiter">'</span><span class="content">raw</span><span class="delimiter">'</span></span> <span class="comment">// escapes output from static template parts</span>
    }</code></pre>
</div>
</div>
</div>

<a name="14.2 &#32534;&#30721;&#21644;&#35299;&#30721;&#23545;&#35937;"><!-- Legacy link --></a>
<h2 id="codecs">17.3 编码和解码对象</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/security/codecs.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails支持动态编码/解码方法的概念。Grails附带了一组标准的编解码器。Grails还支持一种简单的机制，让开发人员贡献自己的代码，这些代码将在运行时被识别出来。</p>
</div>
<div class="sect3">
<h4 id="_codec_classes">Codec Classes</h4>
<div class="paragraph">
<p>Grails编解码器类可能包含一个编码闭包、一个解码闭包或两者都包含。当Grails应用程序启动时，Grails框架将从 <code>Grails -app/utils/</code> 目录动态加载编解码器。</p>
</div>
<div class="paragraph">
<p>该框架在 <code>grails-app/utils/</code> 下查找以约定 <code>Codec</code> 结尾的类名。例如，Grails附带的标准编码器之一是 <code>HTMLCodec</code>。</p>
</div>
<div class="paragraph">
<p>如果一个编解码器包含一个 <code>encode</code> 闭包，Grails将创建一个动态的 <code>encode</code> 方法，并将该方法添加到 <code>Object</code> 类中，其名称表示定义了encode闭包的编解码器。例如， <code>HTMLCodec</code> 类定义了一个 <code>encode</code> 闭包，因此Grails将其命名为 <code>encodeAsHTML</code> 。</p>
</div>
<div class="paragraph">
<p><code>HTMLCodec</code> 和 <code>URLCodec</code> 类还定义了一个 <code>decode</code> 闭包，因此Grails分别将这两个类的名称命名为 <code>decodeHTML</code> 和 <code>decodeURL</code> 。可以在Grails应用程序的任何地方调用动态编解码器方法。例如，考虑这样一种情况，报表包含一个名为 <code>description</code> 的属性，该属性可能包含必须转义才能在HTML文档中显示的特殊字符。在GSP中处理这个问题的一种方法是使用如下所示的动态编码方法对description属性进行编码:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span>{report.description.encodeAsHTML()}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>value.decodeHTML()</code> 语法进行解码。</p>
</div>
</div>
<div class="sect3">
<h4 id="_用于静态编译代码的编码器和解码器接口">用于静态编译代码的编码器和解码器接口</h4>
<div class="paragraph">
<p>使用codecs的首选方法是使用codecLookup bean获取 <code>Encoder</code> 和 <code>Decoder</code> 实例</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.grails.encoder;

<span class="directive">public</span> <span class="type">interface</span> CodecLookup {
    <span class="directive">public</span> <span class="predefined-type">Encoder</span> lookupEncoder(<span class="predefined-type">String</span> codecName);
    <span class="directive">public</span> Decoder lookupDecoder(<span class="predefined-type">String</span> codecName);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>例子使用 <code>CodecLookup</code> 和 <code>Encoder</code> 接口</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.grails.encoder.CodecLookup</span>

<span class="type">class</span> <span class="class">CustomTagLib</span> {
    CodecLookup codecLookup

    <span class="keyword">def</span> myTag = { <span class="predefined-type">Map</span> attrs, body -&gt;
        out &lt;&lt; codecLookup.lookupEncoder(<span class="string"><span class="delimiter">'</span><span class="content">HTML</span><span class="delimiter">'</span></span>).encode(attrs.something)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_standard_codecs">Standard Codecs</h4>
<div class="paragraph">
<p><strong>HTMLCodec</strong></p>
</div>
<div class="paragraph">
<p>这个编解码器执行HTML转义和反转义，因此可以在HTML页面中安全地呈现值，而不需要创建任何HTML标记或破坏页面布局。例如,给定一个价值 <code>你不知道2 &gt; 1 ?</code> 你不能显示这安全地在一个HTML页面,因为&gt;将看起来关闭标签,尤其糟糕的如果你渲染这个数据在一个属性,如一个输入字段的值属性。</p>
</div>
<div class="paragraph">
<p>使用示例 :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;input name=<span class="string"><span class="delimiter">&quot;</span><span class="content">comment.message</span><span class="delimiter">&quot;</span></span> value=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>comment.message.encodeAsHTML()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
HTML编码不会重新编码撇号/单引号，因此必须对属性值使用双引号，以避免撇号影响页面的文本。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>HTMLCodec默认为HTML4格式转义(在2.3.0之前的Grails版本中遗留的HTMLCodec实现)，它转义非ascii字符</p>
</div>
<div class="paragraph">
<p>您可以使用普通的XML转义而不是HTML4转义，通过在 <code>application.groovy</code> 中设置这个配置属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.views.gsp.htmlcodec = <span class="string"><span class="delimiter">'</span><span class="content">xml</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>XMLCodec</strong></p>
</div>
<div class="paragraph">
<p>这个编解码器执行XML转义和反转义。它转义&amp;，&lt;，&gt;，"，'，'，\\\\，@，'，不间断空格(\\\\u00a0)，行分隔符(\\\\u2028)和段落分隔符(\\\\u2029)。）</p>
</div>
<div class="paragraph">
<p><strong>HTMLJSCodec</strong></p>
</div>
<div class="paragraph">
<p>这个编解码器执行HTML和JS编码。它用于防止一些DOM-XSS漏洞。有关防止基于DOM的XSS攻击的指南，请参阅 <a href="https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet">OWASP - DOM based XSS Prevention Cheat Sheet</a>。</p>
</div>
<div class="paragraph">
<p><strong>URLCodec</strong></p>
</div>
<div class="paragraph">
<p>当在链接或表单操作中创建URL时，或者在使用数据创建URL时，都需要URL编码。它可以防止非法字符进入URL并改变其含义，例如"Apple &amp; Blackberry"作为GET请求中的一个参数将不能很好地工作，因为&amp;将破坏参数解析。</p>
</div>
<div class="paragraph">
<p>使用的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;a href=<span class="string"><span class="delimiter">&quot;</span><span class="content">/mycontroller/find?searchKey=</span><span class="inline"><span class="inline-delimiter">${</span>lastSearch.encodeAsURL()<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
Repeat last search
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">a&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Base64Codec</strong></p>
</div>
<div class="paragraph">
<p>执行Base64编码/解码功能。使用的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Your registration code <span class="key">is</span>: <span class="error">$</span>{user.registrationCode.encodeAsBase64()}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>JavaScriptCodec</strong></p>
</div>
<div class="paragraph">
<p>转义字符串，使它们可以用作有效的JavaScript字符串。例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="predefined-type">Element</span>.update(<span class="string"><span class="delimiter">'</span><span class="content">${elementId}</span><span class="delimiter">'</span></span>,
    <span class="string"><span class="delimiter">'</span><span class="content">${render(template: &quot;/common/message&quot;).encodeAsJavaScript()}</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>HexCodec</strong></p>
</div>
<div class="paragraph">
<p>将字节数组或整数列表编码为小写十六进制字符串，并可以将十六进制字符串解码为字节数组。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Selected <span class="key">colour</span>: <span class="error">#</span><span class="error">$</span>{[<span class="integer">255</span>,<span class="integer">127</span>,<span class="integer">255</span>].encodeAsHex()}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>MD5Codec</strong></p>
</div>
<div class="paragraph">
<p>使用MD5算法将字节数组或整数列表或字符串字节(在默认系统编码中)消化为小写十六进制字符串</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Your API <span class="predefined-type">Key</span>: <span class="error">$</span>{user.uniqueID.encodeAsMD5()}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>MD5BytesCodec</strong></p>
</div>
<div class="paragraph">
<p>使用MD5算法将字节数组或整数列表或字符串字节(默认系统编码)消化为字节数组。使用的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">byte</span><span class="type">[]</span> passwordHash = params.password.encodeAsMD5Bytes()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>SHA1Codec</strong></p>
</div>
<div class="paragraph">
<p>使用SHA1算法将字节数组或整数列表或字符串字节(在默认系统编码中)分解为小写十六进制字符串</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Your API <span class="predefined-type">Key</span>: <span class="error">$</span>{user.uniqueID.encodeAsSHA1()}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>SHA1BytesCodec</strong></p>
</div>
<div class="paragraph">
<p>使用SHA1算法将字节数组或整数列表或字符串字节(默认系统编码)消化为字节数组。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">byte</span><span class="type">[]</span> passwordHash = params.password.encodeAsSHA1Bytes()</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>SHA256Codec</strong></p>
</div>
<div class="paragraph">
<p>使用SHA256算法将字节数组或整数列表或字符串字节(在默认系统编码中)消化为小写十六进制字符串。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Your API <span class="predefined-type">Key</span>: <span class="error">$</span>{user.uniqueID.encodeAsSHA256()}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>SHA256BytesCodec</strong></p>
</div>
<div class="paragraph">
<p>使用SHA256算法将字节数组或整数列表或字符串字节(默认系统编码)消化为字节数组。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">byte</span><span class="type">[]</span> passwordHash = params.password.encodeAsSHA256Bytes()</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_custom_codecs">Custom Codecs</h4>
<div class="paragraph">
<p>应用程序可以定义自己的编解码器，Grails会将它们与标准的编解码器一起加载。自定义的编解码器类必须在 <code>grails-app/utils/</code> 目录中定义，类名必须以 <code>codec</code> 结尾。该编解码器可能包含一个 <code>静态</code> 的 <code>encode</code> 闭包，一个 <code>静态</code> 的 <code>decode</code> 闭包，或者两者都包含。闭包必须接受一个参数，该参数将是调用动态方法的对象。例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">PigLatinCodec</span> {
  <span class="directive">static</span> encode = { str -&gt;
    <span class="comment">// convert the string to pig latin and return the result</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了上面的编解码器，应用程序可以做这样的事情:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">${lastName.encodeAsPigLatin()}</code></pre>
</div>
</div>
</div>

<a name="14.3 &#36523;&#20221;&#39564;&#35777;"><!-- Legacy link --></a>
<h2 id="authentication">17.4 身份验证</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/security/authentication.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails没有默认的身份验证机制，因为可以通过许多不同的方式实现身份验证。然而，很容易实现一个简单的认证机制使用 <a href="theWebLayer.html#interceptors">interceptors</a>.这对于简单的用例来说已经足够了，但是最好使用一个已经建立的安全框架，例如使用&lt;springSecurity,Spring Security&gt;或者&lt;shiro,Shiro&gt;插件。</p>
</div>
<div class="paragraph">
<p>拦截器允许跨所有控制器或跨URI空间应用身份验证。例如，你可以在一个名为 <code>grails-app/controllers/SecurityInterceptor</code> 的类中创建一组新的过滤器。groovy的运行:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-interceptor security</code></pre>
</div>
</div>
<div class="paragraph">
<p>and implement your interception logic there:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">SecurityInterceptor</span> {

    SecurityInterceptor() {
        matchAll()
        .except(<span class="key">controller</span>:<span class="string"><span class="delimiter">'</span><span class="content">user</span><span class="delimiter">'</span></span>, <span class="key">action</span>:<span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>)
    }

    <span class="type">boolean</span> before() {
        <span class="keyword">if</span> (!session.user &amp;&amp; actionName != <span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>) {
            redirect(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">user</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>)
            <span class="keyword">return</span> <span class="predefined-constant">false</span>
        }
        <span class="keyword">return</span> <span class="predefined-constant">true</span>
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里，拦截器拦截执行_before_除了 <code>登录</code> 之外的所有操作都被执行，如果会话中没有用户，则重定向到 <code>登录</code> 操作。</p>
</div>
<div class="paragraph">
<p><code>login</code> 操作本身也很简单:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">login</span>() {
    <span class="keyword">if</span> (request.get) {
        <span class="keyword">return</span> <span class="comment">// render the login view</span>
    }

    <span class="keyword">def</span> u = User.findByLogin(params.login)
    <span class="keyword">if</span> (u) {
        <span class="keyword">if</span> (u.password == params.password) {
            session.user = u
            redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">home</span><span class="delimiter">&quot;</span></span>)
        }
        <span class="keyword">else</span> {
            render(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: [<span class="key">message</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Password incorrect</span><span class="delimiter">&quot;</span></span>])
        }
    }
    <span class="keyword">else</span> {
        render(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">login</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: [<span class="key">message</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">User not found</span><span class="delimiter">&quot;</span></span>])
    }
}</code></pre>
</div>
</div>

<a name="14.4 &#23433;&#20840;&#25554;&#20214;"><!-- Legacy link --></a>
<h2 id="securityPlugins">17.5 安全插件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/security/securityPlugins.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果您需要比简单的身份验证更高级的功能，比如授权、角色等，那么您应该考虑使用spring security core插件。</p>
</div>

<a name="14.4.1 Spring Security"><!-- Legacy link --></a>
<h2 id="springSecurity">17.5.1 Spring 安全机制</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/security/securityPlugins/springSecurity.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Spring安全插件构建在place项目上 <a href="http://projects.spring.io/spring-security/">Spring Security</a>项目为构建各种身份验证和授权方案提供了灵活的、可扩展的框架。插件是模块化的，因此您可以安装您的应用程序所需的功能。Spring安全插件是Grails的官方安全插件，受到积极的维护和支持。</p>
</div>
<div class="paragraph">
<p>有一种 <a href="http://grails.org/plugins.html#plugin/spring-security-core">Core plugin</a>支持基于表单的身份验证、加密/加验密码、HTTP基本身份验证等。次要的依赖插件提供替代功能，如 <a href="https://grails.org/plugins.html#plugin/spring-security-acl">ACL support</a>等等，和安全工作流。</p>
</div>
<div class="paragraph">
<p>基本信息参见 <a href="http://grails.org/plugins.html#plugin/spring-security-core">Core plugin page</a>
详细信息参见 <a href="http://grails-plugins.github.io/grails-spring-security-core/">user guide</a></p>
</div>

<a name="15. &#25554;&#20214;"><!-- Legacy link --></a>
<h1 id="plugins">18 插件</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails是首先是一个Web应用程序框架，但它也是一个平台。 通过暴露了一些可以让你在命令行界面运行时配置引擎扩展任何扩展点，Grails的可定制，以适应几乎任何需求。 挂接到这个平台上，所有你需要做的就是创建一个插件。</p>
</div>
<div class="paragraph">
<p>扩展平台可能听起来很复杂，但是插件的范围从简单到功能强大。 如果您知道如何构建Grails应用程序，那么您将知道如何为<a href="#providingBasicArtefacts">共享数据模型</a>或一些静态资源创建插件。</p>
</div>

<a name="15.1 &#21019;&#24314;&#21644;&#23433;&#35013;&#25554;&#20214;"><!-- Legacy link --></a>
<h2 id="creatingAndInstallingPlugins">18.1 创建和安装插件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/creatingAndInstallingPlugins.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_创建插件">创建插件</h4>
<div class="literalblock">
<div class="content">
<pre>创建 Grails 插件只需运行以下命令：</pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-plugin &lt;&lt;PLUGIN NAME&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将为您指定的名称创建一个插件项目。例如，运行 <code>grails create-plugin example</code> 将创建一个名为 <code>example</code> 的新插件项目。</p>
</div>
<div class="paragraph">
<p>在 Grails 3.0 中，您应该考虑创建的插件是否需要Web环境，或者该插件是否可以与其他配置文件一起使用。如果您的插件不需要网络环境，请使用 <code>plugin</code> 配置文件，而不是 <code>web-plugin</code> 配置文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails create-plugin &lt;&lt;PLUGIN NAME&gt;&gt; --profile=plugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>确保插件名称不能连续包含多个大写字母，否则将无法正常工作。驼峰命名法的是个很好的选择。</p>
</div>
<div class="paragraph">
<p>作为常规的 Grails 项目有很多好处，您可以通过运行立即测试您的插件（如果该插件针对 <code>web</code> 配置文件）：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails run-app</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
默认情况下，插件项目不提供 index.gsp，因为大多数插件都不需要它。因此，如果您尝试在创建插件后立即查看在浏览器中运行的插件，则会收到页面未找到错误。如果愿意，您可以轻松为插件创建 <code>grails-app/views/index.gsp</code>。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Grails 插件的结构与 Grails 应用程序项目的结构几乎相同，除了在插件包结构下的 <code>src/main/groovy</code> 目录中，您会找到插件描述符类（以 <code>GrailsPlugin</code> 结尾的类）。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.plugins.*</span>

<span class="type">class</span> <span class="class">ExampleGrailsPlugin</span> <span class="directive">extends</span> Plugin {
   ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有插件都必须在 <code>src/main/groovy</code> 目录下具有此类，否则它们将不被视为插件。plugin 类定义有关插件的元数据，以及可选的各种插件扩展点的钩子（很快就会发现）。</p>
</div>
<div class="paragraph">
<p>您还可以使用几个特殊属性提供有关插件的其他信息：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>title</code> - 插件的一句话简短描述</p>
</li>
<li>
<p><code>grailsVersion</code> - 插件支持的Grails的版本范围，例如：<code>1.2&gt; *</code>（表示1.2或更高）</p>
</li>
<li>
<p><code>author</code> - 插件作者的名字</p>
</li>
<li>
<p><code>authorEmail</code> - 插件作者的联系电子邮件</p>
</li>
<li>
<p><code>developers</code> - 除上述作者之外的任何其他开发人员。</p>
</li>
<li>
<p><code>description</code> - 插件功能的完整多行描述</p>
</li>
<li>
<p><code>documentation</code> - 插件文档的URL</p>
</li>
<li>
<p><code>license</code> - 插件的许可证</p>
</li>
<li>
<p><code>issueManagement</code> - 插件的问题跟踪器</p>
</li>
<li>
<p><code>scm</code> - 插件的源代码管理位置</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这是一个精简的例子 <a href="https://github.com/grails-plugins/grails-quartz">Quartz Grails plugin</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> quartz

<span class="annotation">@Slf4j</span>
<span class="type">class</span> <span class="class">QuartzGrailsPlugin</span> <span class="directive">extends</span> Plugin {
    <span class="comment">// the version or versions of Grails the plugin is designed for</span>
    <span class="keyword">def</span> grailsVersion = <span class="string"><span class="delimiter">&quot;</span><span class="content">3.0.0.BUILD-SNAPSHOT &gt; *</span><span class="delimiter">&quot;</span></span>
    <span class="comment">// resources that are excluded from plugin packaging</span>
    <span class="keyword">def</span> pluginExcludes = [
            <span class="string"><span class="delimiter">&quot;</span><span class="content">grails-app/views/error.gsp</span><span class="delimiter">&quot;</span></span>
    ]
    <span class="keyword">def</span> title = <span class="string"><span class="delimiter">&quot;</span><span class="content">Quartz</span><span class="delimiter">&quot;</span></span> <span class="comment">// Headline display name of the plugin</span>
    <span class="keyword">def</span> author = <span class="string"><span class="delimiter">&quot;</span><span class="content">Jeff Brown</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> authorEmail = <span class="string"><span class="delimiter">&quot;</span><span class="content">zzz@yyy.com</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> description = <span class="string"><span class="delimiter">'''</span><span class="content">\
</span><span class="content">Adds Quartz job scheduling features
</span><span class="delimiter">'''</span></span>
    <span class="keyword">def</span> profiles = [<span class="string"><span class="delimiter">'</span><span class="content">web</span><span class="delimiter">'</span></span>]
    <span class="predefined-type">List</span> loadAfter = [<span class="string"><span class="delimiter">'</span><span class="content">hibernate3</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">hibernate4</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">hibernate5</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">services</span><span class="delimiter">'</span></span>]
    <span class="keyword">def</span> documentation = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://grails.org/plugin/quartz</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> license = <span class="string"><span class="delimiter">&quot;</span><span class="content">APACHE</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> issueManagement = [ <span class="key">system</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Github Issues</span><span class="delimiter">&quot;</span></span>, <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://github.com/grails3-plugins/quartz/issues</span><span class="delimiter">&quot;</span></span> ]
    <span class="keyword">def</span> developers = [
            [ <span class="key">name</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Joe Dev</span><span class="delimiter">&quot;</span></span>, <span class="key">email</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">joedev@gmail.com</span><span class="delimiter">&quot;</span></span> ]
    ]
    <span class="keyword">def</span> scm = [ <span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://github.com/grails3-plugins/quartz/</span><span class="delimiter">&quot;</span></span> ]

    Closure doWithSpring()......</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_安装本地插件">安装本地插件</h4>
<div class="paragraph">
<p>为了使您的插件可在Grails应用程序中使用，请运行 <code>install</code> 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails install</code></pre>
</div>
</div>
<div class="paragraph">
<p>这会将插件安装到本地 Maven 缓存中。 然后要在应用程序中使用插件，请在 <code>build.gradle</code> 文件中声明对该插件的依赖性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:quartz:0.1</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在 Grails 2.x 中，插件打包为 ZIP 文件，但是在 Grails 3.x 中，插件是简单的 JAR 文件，可以将其添加到IDE的类路径中。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_插件和多项目构建">插件和多项目构建</h4>
<div class="paragraph">
<p>如果您希望将插件设置为多项目构建的一部分，请遵循以下步骤。</p>
</div>
<div class="paragraph">
<p><strong>步骤1：创建应用程序和插件</strong></p>
</div>
<div class="paragraph">
<p>使用 <code>grails</code> 命令创建一个应用程序和一个插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> grails create-app myapp
<span class="error">$</span> grails create-plugin myplugin</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>步骤2：建立 settings.gradle 文件</strong></p>
</div>
<div class="paragraph">
<p>在同一目录中，创建一个具有以下内容的 <code>settings.gradle</code> 文件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">&quot;</span><span class="content">myapp</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">myplugin</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>目录结构应如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">PROJECT_DIR
  - settings.gradle
  - myapp
    - build.gradle
  - myplugin
    - build.gradle</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>步骤3：声明对插件的项目依赖</strong></p>
</div>
<div class="paragraph">
<p>在应用程序的 <code>build.gradle</code> 中，声明对 plugins 块中插件的依赖：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    plugins {
        compile project(<span class="string"><span class="delimiter">'</span><span class="content">:myplugin</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
您也可以在 <code>dependencies</code> 块中声明依赖项，但是如果这样做，子项目将不会同步刷新！
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>步骤4：运行应用程序</strong></p>
</div>
<div class="paragraph">
<p>现在，从应用程序目录的根目录使用 <code>grails run-app</code> 命令运行应用程序，您可以使用 <code>verbose</code> 标志查看Gradle输出：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> cd myapp
<span class="error">$</span> grails run-app -verbose</code></pre>
</div>
</div>
<div class="paragraph">
<p>您将从Gradle输出中注意到，插件源已构建并放置在应用程序的类路径中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">:<span class="key">myplugin</span>:compileAstJava UP-TO-DATE
:<span class="key">myplugin</span>:compileAstGroovy UP-TO-DATE
:<span class="key">myplugin</span>:processAstResources UP-TO-DATE
:<span class="key">myplugin</span>:astClasses UP-TO-DATE
:<span class="key">myplugin</span>:compileJava UP-TO-DATE
:<span class="key">myplugin</span>:configScript UP-TO-DATE
:<span class="key">myplugin</span>:compileGroovy
:<span class="key">myplugin</span>:copyAssets UP-TO-DATE
:<span class="key">myplugin</span>:copyCommands UP-TO-DATE
:<span class="key">myplugin</span>:copyTemplates UP-TO-DATE
:<span class="key">myplugin</span>:processResources
:<span class="key">myapp</span>:compileJava UP-TO-DATE
:<span class="key">myapp</span>:compileGroovy
:<span class="key">myapp</span>:processResources UP-TO-DATE
:<span class="key">myapp</span>:classes
:<span class="key">myapp</span>:findMainClass
:<span class="key">myapp</span>:bootRun
Grails application running at <span class="key">http</span>:<span class="comment">//localhost:8080 in environment: development</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_关于排除文物的注意事项">关于排除文物的注意事项</h4>
<div class="paragraph">
<p>虽然 <a href="../ref/Command%20Line/create-plugin.html">create-plugin</a> 命令会为您创建某些文件，以便该插件可以作为 Grails 应用程序运行，但在打包插件时，并非所有这些文件都被包括在内。以下是创建但未包含的文件类别的列表 <a href="../ref/Command%20Line/package-plugin.html">package-plugin</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails-app/build.gradle</code>（尽管它用于生成 <code>dependencies.groovy</code>）</p>
</li>
<li>
<p><code>grails-app/conf/application.yml</code>（重命名为plugin.yml）</p>
</li>
<li>
<p><code>grails-app/conf/spring/resources.groovy</code></p>
</li>
<li>
<p><code>grails-app/conf/logback.groovy</code></p>
</li>
<li>
<p><code>/src/test/*\*</code> 下的一切文件</p>
</li>
<li>
<p>SCM 管理文件，路径：<code>*\*/.svn/*\*</code> 和 <code>*\*/CVS/*\*</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_自定义插件内容">自定义插件内容</h4>
<div class="paragraph">
<p>开发插件时，您可以创建在插件开发和测试期间使用的测试类和源，但不应将其导出到应用程序。</p>
</div>
<div class="paragraph">
<p>要排除测试源，您需要修改插件描述符的 <code>pluginExcludes</code> 属性，并排除 <code>build.gradle</code> 文件中的资源。例如，说在 <code>com.demo</code> 包下有一些类，这些类在插件源代码树中，但不应打包在应用程序中。在您的插件描述符中，您应该排除以下这些：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// resources that should be loaded by the plugin once installed in the application</span>
  <span class="keyword">def</span> pluginExcludes = [
    <span class="string"><span class="delimiter">'</span><span class="content">**/com/demo/**</span><span class="delimiter">'</span></span>
  ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>并且在您的 <code>build.gradle</code> 中，您应该从 JAR 文件中排除已编译的类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">jar {
  exclude <span class="string"><span class="delimiter">&quot;</span><span class="content">com/demo/**/**</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_grails_3_0_中的嵌入式插件">Grails 3.0 中的嵌入式插件</h4>
<div class="paragraph">
<p>在 Grails 2.x 中，可以在 <code>BuildConfig</code> 中指定内联插件，在 Grails 3.x 中，此功能已被 Gradle 的多项目构建功能所取代。</p>
</div>
<div class="paragraph">
<p>要设置多项目构建，请在父目录中创建一个应用程序和一个插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> grails create-app myapp
<span class="error">$</span> grails create-plugin myplugin</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后在父目录中创建一个 <code>settings.gradle</code> 文件，指定您的应用程序和插件的位置：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">include <span class="string"><span class="delimiter">'</span><span class="content">myapp</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">myplugin</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，在插件的应用程序的 <code>build.gradle</code> 中添加一个依赖项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">compile project(<span class="string"><span class="delimiter">'</span><span class="content">:myplugin</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>这样一来，您就可以获得 Grails 2.x 等效的嵌入式插件。</p>
</div>
</div>

<a name="15.2 &#25554;&#20214;&#23384;&#20648;&#24211;"><!-- Legacy link --></a>
<h2 id="repositories">18.2 插件库</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/repositories.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_在_grails_中央插件库中分发插件">在 Grails 中央插件库中分发插件</h4>
<div class="paragraph">
<p>分发插件的首选方法是发布到官方 Grails 中央插件库。这将使您的插件 <a href="../ref/Command%20Line/listplugins.html">list plugins</a> 可见命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails list-plugins</code></pre>
</div>
</div>
<div class="paragraph">
<p>它列出了中央存储库中的所有插件。您的插件也可以访问 <a href="../ref/Command%20Line/plugininfo.html">plugin info</a> 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails plugin-info [plugin-name]</code></pre>
</div>
</div>
<div class="paragraph">
<p>它打印关于它的额外信息，比如它的描述，谁写的，等等。</p>
</div>
<div class="paragraph">
<p>注意：如果您已经创建了一个 Grails 插件并希望它托管在中央存储库中，那么您可以在 <a href="http://plugins.Grails.org/">plugin portal</a>网站上找到获取帐户的说明。</p>
</div>
</div>

<a name="15.4 &#25552;&#20379;&#22522;&#26412;&#25991;&#29289;"><!-- Legacy link --></a>
<h2 id="providingBasicArtefacts">18.3 提供基本文物</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/providingBasicArtefacts.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_添加命令行命令">添加命令行命令</h4>
<div class="paragraph">
<p>插件可以通过以下两种方式之一向 Grails 3.0 交互式 shell 添加新命令。首先，使用 <a href="../ref/Command%20Line/createscript.html">create script</a> 可以创建代码生成脚本，该脚本将对应用程序可用。<code>create script</code> 命令将在 <code>src/main/scripts</code> 目录中创建脚本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">+ src/main/scripts     &lt;-- additional scripts here
 + grails-app
      + controllers
      + services
      + etc.</code></pre>
</div>
</div>
<div class="paragraph">
<p>代码生成脚本可用于在项目树中创建人工制品并自动与 Gradle 交互。</p>
</div>
<div class="paragraph">
<p>如果要创建与加载的 Grails 应用程序实例交互的新 shell 命令，则应使用 <code>create command</code> 命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> grails create-command MyExampleCommand</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将创建一个名为 <code>grails app/commands/PACKAGE/PATH/MyExampleCommand.groovy</code> 的文件，扩展<a href="http://docs.grails.org/4.0.0/api/grails/dev/commands/ApplicationCommand.html">ApplicationCommand</a>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.dev.commands.*</span>

<span class="type">class</span> <span class="class">MyExampleCommand</span> <span class="directive">implements</span> ApplicationCommand {

  <span class="type">boolean</span> handle(ExecutionContext ctx) {
      println <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World</span><span class="delimiter">&quot;</span></span>
      <span class="keyword">return</span> <span class="predefined-constant">true</span>
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>ApplicationCommand</code> 可以访问 <code>GrailsApplication</code> 实例，并像任何其他 Spring bean 一样接受自动连接。</p>
</div>
<div class="paragraph">
<p>您还可以通知Grails跳过 <code>Bootstrap.groovy</code> 文件的执行，命令中有一个简单的属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyExampleCommand</span> <span class="directive">implements</span> ApplicationCommand {

  <span class="type">boolean</span> skipBootstrap = <span class="predefined-constant">true</span>

  <span class="type">boolean</span> handle(ExecutionContext ctx) {
      ...
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于每个 <code>ApplicationCommand</code>，Grails 将创建一个 shell 命令和一个 Gradle 任务来调用 <code>ApplicationCommand</code>。在上面的示例中，可以使用以下任一方法调用 <code>MyExampleCommand</code> 类：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> grails my-example</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">$</span> gradle myExample</code></pre>
</div>
</div>
<div class="paragraph">
<p>Grails 版本都是小写连字符分隔的，不包括 <code>Command</code> 后缀。</p>
</div>
<div class="paragraph">
<p>代码生成脚本和 <code>ApplicationCommand</code> 实例的主要区别在于后者可以完全访问 Grails 应用程序状态，因此可以用于执行与数据库交互的任务、调用 GORM 等。</p>
</div>
<div class="paragraph">
<p>在 Grails 2.x 中，甘特图脚本可以用来执行这两个任务，在 Grails 3.x 中，代码生成和与运行时应用程序的交互状态已经完全分离。</p>
</div>
</div>
<div class="sect3">
<h4 id="_添加新的_grails_应用程序工件_控制器_标记库_服务等">添加新的 grails 应用程序工件（控制器、标记库、服务等）</h4>
<div class="paragraph">
<p>插件可以通过在 <code>grails app</code> 树中创建相关文件来添加新工件。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">+ grails-app
      + controllers  &lt;-- additional controllers here
      + services &lt;-- additional services here
      + etc.  &lt;-- additional XXX here</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_提供视图_模板和视图分辨率">提供视图、模板和视图分辨率</h4>
<div class="paragraph">
<p>当插件提供控制器时，它也可以提供要呈现的默认视图。这是通过插件模块化应用程序的一个很好的方法。Grails 的视图解析机制将首先在安装到其中的应用程序中查找视图，如果失败，将尝试在插件中查找视图。这意味着您可以通过在应用程序的 <code>grails app/views</code> 目录中创建相应的 gsp 来覆盖插件提供的视图。</p>
</div>
<div class="paragraph">
<p>例如，考虑一个名为 <code>BookController</code> 的控制器，它是由一个 <code>amazon</code> 插件提供的。如果正在执行的操作是 <code>list</code>，Grails将首先查找名为 <code>Grails app/views/book/list.gsp</code> 的视图，如果失败，它将查找与插件相关的同一视图。</p>
</div>
<div class="paragraph">
<p>但是，如果视图使用插件提供的模板，则可能需要以下语法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:render template=<span class="string"><span class="delimiter">&quot;</span><span class="content">fooTemplate</span><span class="delimiter">&quot;</span></span> plugin=<span class="string"><span class="delimiter">&quot;</span><span class="content">amazon</span><span class="delimiter">&quot;</span></span>/&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意 <code>plugin</code> 属性的用法，该属性包含模板所在的插件的名称。如果未指定，Grails 将寻找相对于应用程序的模板。</p>
</div>
</div>
<div class="sect3">
<h4 id="_排除文物">排除文物</h4>
<div class="paragraph">
<p>默认情况下，Grails 在打包过程中不包括以下文件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>grails-app/conf/logback.groovy</code></p>
</li>
<li>
<p><code>grails-app/conf/application.yml</code> (重命名为 <code>plugin.yml</code>)</p>
</li>
<li>
<p><code>grails-app/conf/spring/resources.groovy</code></p>
</li>
<li>
<p>一切内的 <code>/src/test/*\*</code></p>
</li>
<li>
<p>scm管理文件内的 <code>*\*/.svn/*\*</code> and <code>*\*/cvs/*\*</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>不排除默认的 <code>UrlMappings.groovy</code> 文件，因此请删除该插件正常工作不需要的任何映射。您还可以随意使用其他名称（包含*将*）添加 UrlMappings 定义。例如，名为 <code>grails-app/controllers/BlogUrlMappings.groovy</code>.的文件就可以了。
排除列表可通过 <code>pluginExcludes</code> 属性进行扩展：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// resources that are excluded from plugin packaging</span>
<span class="keyword">def</span> pluginExcludes = [
    <span class="string"><span class="delimiter">&quot;</span><span class="content">grails-app/views/error.gsp</span><span class="delimiter">&quot;</span></span>
]</code></pre>
</div>
</div>
<div class="paragraph">
<p>例如，这对于将演示或测试资源包括在插件存储库中，而不在最终发行版中包括它们很有用。</p>
</div>
</div>

<a name="15.5 &#35780;&#20272;&#32422;&#23450;"><!-- Legacy link --></a>
<h2 id="evaluatingConventions">18.4 评估约定</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/evaluatingConventions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>在查看基于约定的运行时配置之前，首先需要了解如何从插件评估这些约定。每个插件都有一个隐式的 <code>application</code> 变量，该变量是 <a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsApplication.html">GrailsApplication</a>接口的一个实例。
GrailsApplication接口提供了评估项目中约定的方法，并在内部存储对应用程序中所有工件类的引用
工件实现<a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsClass.html">GrailsClass</a>接口，该接口表示Grails资源，例如控制器或标签库。例如，要获取所有 <code>GrailsClass</code> 实例，您可以执行以下操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span> (grailsClass <span class="keyword">in</span> application.allClasses) {
    println grailsClass.name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>GrailsApplication</code> 具有一些 <code>魔术</code> 属性，可以缩小您感兴趣的伪像的类型。例如，要访问控制器，可以使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span> (controllerClass <span class="keyword">in</span> application.controllerClasses) {
    println controllerClass.name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>动态方法约定如下:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>* Classes</code>-检索特定文物名称的所有类。 例如 <code>application.controllerClasses</code>。</p>
</li>
<li>
<p><code>get * Class</code>-检索特定人工制品的命名类。例如 <code>application.getControllerClass（"PersonController"）</code></p>
</li>
<li>
<p><code>is * Class</code>-如果给定的类属于给定的伪像类型，则返回 <code>true</code>。例如 <code>application.isControllerClass（PersonController）</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>GrailsClass</code> 接口具有许多有用的方法，可让您进一步评估和使用约定。这些包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>getPropertyValue</code>-获取类中给定属性的初始值</p>
</li>
<li>
<p><code>hasProperty</code>-如果类具有指定的属性，则返回 <code>true</code></p>
</li>
<li>
<p><code>newInstance</code>-创建此类的新实例。</p>
</li>
<li>
<p><code>getName</code>-返回应用程序中类的逻辑名称，如果适用，则不包含结尾约定部分</p>
</li>
<li>
<p><code>getShortName</code>-返回没有包前缀的类的简称</p>
</li>
<li>
<p><code>getFullName</code>-返回带有尾部约定部分和包名的应用程序中类的全名</p>
</li>
<li>
<p><code>getPropertyName</code>-返回类的名称作为属性名称</p>
</li>
<li>
<p><code>getLogicalPropertyName</code>-返回应用程序中类的逻辑属性名称，不包含尾随约定部分（如果适用）</p>
</li>
<li>
<p><code>getNaturalName</code>-以自然术语返回属性的名称（例如 <code>lastName</code> 变为 <code>Last Name</code>）</p>
</li>
<li>
<p><code>getPackageName</code>-返回包名</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>有关完整参考，请参见<a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsClass.html">javadoc API</a>。</p>
</div>

<a name="15.7 &#25346;&#38057;&#21040;&#36816;&#34892;&#26102;&#37197;&#32622;"><!-- Legacy link --></a>
<h2 id="hookingIntoRuntimeConfiguration">18.5 挂钩到运行时配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/hookingIntoRuntimeConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 提供了许多挂钩（hook）来使用系统的不同部分并按照约定执行运行时配置。</p>
</div>
<div class="sect3">
<h4 id="_接触_grails_spring_配置">接触 Grails Spring 配置</h4>
<div class="paragraph">
<p>首先，您可以从 <a href="http://docs.grails.org/4.0.0/api/grails/plugins/Plugin.html">Plugin</a> 类中插入覆盖了 <code>doWithSpring</code> 方法的 Grails 运行时配置，并返回一个定义其他 bean 的闭包。例如，以下代码片段来自提供以下功能的核心 Grails 插件之一 <a href="i18n.html">i18n</a> 支持:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.web.servlet.i18n.CookieLocaleResolver</span>
<span class="keyword">import</span> <span class="include">org.springframework.web.servlet.i18n.LocaleChangeInterceptor</span>
<span class="keyword">import</span> <span class="include">org.springframework.context.support.ReloadableResourceBundleMessageSource</span>
<span class="keyword">import</span> <span class="include">grails.plugins.*</span>

<span class="type">class</span> <span class="class">I18nGrailsPlugin</span> <span class="directive">extends</span> Plugin {

    <span class="keyword">def</span> version = <span class="string"><span class="delimiter">&quot;</span><span class="content">0.1</span><span class="delimiter">&quot;</span></span>

    Closure doWithSpring() {{-&gt;
        messageSource(ReloadableResourceBundleMessageSource) {
            basename = <span class="string"><span class="delimiter">&quot;</span><span class="content">WEB-INF/grails-app/i18n/messages</span><span class="delimiter">&quot;</span></span>
        }
        localeChangeInterceptor(LocaleChangeInterceptor) {
            paramName = <span class="string"><span class="delimiter">&quot;</span><span class="content">lang</span><span class="delimiter">&quot;</span></span>
        }
        localeResolver(CookieLocaleResolver)
    }}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个插件配置 Grails 的 <code>messageSource bean</code> 和其他两个 bean 来管理 Locale 解析和切换。它使用 <a href="spring.html#theBeanBuilderDSLExplained">Spring Bean Builder</a> 这样做的语法。</p>
</div>
</div>
<div class="sect3">
<h4 id="_自定义_servlet_环境">自定义 Servlet 环境</h4>
<div class="paragraph">
<p>在早期的 Grails 版本中，可以动态修改生成的 <code>web.xml</code>。在 Grails 3.x 中，没有 <code>web.xml</code> 文件，并且无法以编程方式修改 <code>web.xml</code> 文件。
但是，可以在 Grails 3.x 中执行最常见的修改 Servlet 环境的任务。</p>
</div>
</div>
<div class="sect3">
<h4 id="_添加新的_servlet">添加新的 Servlet</h4>
<div class="paragraph">
<p>如果要添加一个新的 Servlet 实例，最简单的方法就是在 <code>doWithSpring</code> 方法中定义一个新的Spring bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Closure doWithSpring() {{-&gt;
  myServlet(MyServlet)
}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您需要自定义 servlet，则可以使用 Spring Boot 的 <a href="http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/context/embedded/ServletRegistrationBean.html">ServletRegistrationBean</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Closure doWithSpring() {{-&gt;
  myServlet(ServletRegistrationBean, <span class="keyword">new</span> MyServlet(), <span class="string"><span class="delimiter">&quot;</span><span class="content">/myServlet/*</span><span class="delimiter">&quot;</span></span>) {
    loadOnStartup = <span class="integer">2</span>
  }
}}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_添加新的_servlet_过滤器">添加新的 Servlet 过滤器</h4>
<div class="paragraph">
<p>就像 Servlets 一样，配置新过滤器的最简单方法是简单地定义一个 Spring bean：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">Closure doWithSpring() {{-&gt;
  myFilter(MyFilter)
}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，如果您想控制过滤器注册的顺序，则需要使用 Spring Boot 的 <a href="http://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/web/servlet/FilterRegistrationBean.html">FilterRegistrationBean</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">myFilter(FilterRegistrationBean) {
    filter = bean(MyFilter)
    urlPatterns = [<span class="string"><span class="delimiter">'</span><span class="content">/*</span><span class="delimiter">'</span></span>]
    order = Ordered.HIGHEST_PRECEDENCE
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
通过将 <code>HIGHEST_PRECEDENCE</code> 增加 10 来定义 Grails 内部注册的过滤器（ <code>GrailsWebRequestFilter</code>，<code>HiddenHttpMethodFilter</code> 等），从而允许在 Grails 过滤器之前或之间插入多个过滤器。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_执行后期初始化配置">执行后期初始化配置</h4>
<div class="paragraph">
<p>有时，在构建 <a href="Springhttps://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html">ApplicationContext</a> 之后进行一些运行时配置会很有用。在这种情况下，您可以定义一个 <code>doWithApplicationContext</code> 关闭属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">SimplePlugin</span> <span class="directive">extends</span> Plugin{

    <span class="keyword">def</span> name = <span class="string"><span class="delimiter">&quot;</span><span class="content">simple</span><span class="delimiter">&quot;</span></span>
    <span class="keyword">def</span> version = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.1</span><span class="delimiter">&quot;</span></span>

    <span class="annotation">@Override</span>
    <span class="type">void</span> doWithApplicationContext() {
        <span class="keyword">def</span> sessionFactory = applicationContext.sessionFactory
        <span class="comment">// do something here with session factory</span>
    }
}</code></pre>
</div>
</div>
</div>


<h2 id="addingMethodsAtCompileTime">18.6 在编译时添加方法</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/addingMethodsAtCompileTime.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 3.0 使得从插件向现有人工类型添加新特征（trait）变得容易。例如，说您想向控制器添加用于操纵日期的方法。这可以通过在 src/main/groovy 中定义一个特征（trait）来完成：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myplugin

<span class="annotation">@Enhances</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">Controller</span><span class="delimiter">&quot;</span></span>)
trait DateTrait {
  <span class="predefined-type">Date</span> currentDate() {
    <span class="keyword">return</span> <span class="keyword">new</span> <span class="predefined-type">Date</span>()
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>@Enhances</code> 注解定义了应将特征（trait）应用到的工件（artefacts）的类型。</p>
</div>
<div class="paragraph">
<p>作为使用以上 <code>@Enhances</code> 批注的替代方法，您可以实现 <a href="http://docs.grails.org/4.0.0/api/grails/compiler/traits/TraitInjector.html">TraitInjector</a> 来告诉 Grails 在编译时要将特征注入到哪些工件（artefacts）中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myplugin

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">ControllerTraitInjector</span> <span class="directive">implements</span> TraitInjector {

    <span class="annotation">@Override</span>
    <span class="predefined-type">Class</span> getTrait() {
        SomeTrait
    }

    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span><span class="type">[]</span> getArtefactTypes() {
        [<span class="string"><span class="delimiter">'</span><span class="content">Controller</span><span class="delimiter">'</span></span>] <span class="keyword">as</span> <span class="predefined-type">String</span><span class="type">[]</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的 <code>TraitInjector</code> 会将 <code>SomeTrait</code> 添加到所有控制器（Controller）。 <code>getArtefactTypes</code> 方法定义应将特征应用到的工件（artefacts）的类型。</p>
</div>
<div class="sect3">
<h4 id="_有条件地应用特质">有条件地应用特质</h4>
<div class="paragraph">
<p><code>TraitInjector</code> 实现还可以实现 <a href="http://docs.grails.org/4.0.0/api/grails/compiler/ast/SupportsClassNode.html">SupportsClassNode</a> 接口，以将特征仅应用于那些满足自定义要求的人工制品。</p>
</div>
<div class="paragraph">
<p>例如，如果仅在目标工件（artefacts）类具有特定注解时才应用特征，则可以按以下方式完成</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myplugin

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">AnnotationBasedTraitInjector</span> <span class="directive">implements</span> TraitInjector, SupportsClassNode {

    <span class="annotation">@Override</span>
    <span class="predefined-type">Class</span> getTrait() {
        SomeTrait
    }

    <span class="annotation">@Override</span>
    <span class="predefined-type">String</span><span class="type">[]</span> getArtefactTypes() {
        [<span class="string"><span class="delimiter">'</span><span class="content">Controller</span><span class="delimiter">'</span></span>] <span class="keyword">as</span> <span class="predefined-type">String</span><span class="type">[]</span>
    }

    <span class="type">boolean</span> supports(ClassNode classNode) {
      <span class="keyword">return</span> GrailsASTUtils.hasAnnotation(classNode, SomeAnnotation)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 <code>TraitInjector</code> 之上将仅向声明了 <code>SomeAnnotation</code> 的那些控制器添加 <code>SomeTrait</code>。</p>
</div>
<div class="paragraph">
<p>该框架通过 .jar 文件中的 <code>META-INF/grails.factories</code> 描述符发现特征注入器。该描述符是自动生成的。 为上面显示的代码生成的描述符如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>#Grails Factories File
grails.compiler.traits.TraitInjector=
myplugin.ControllerTraitInjector,myplugin.DateTraitTraitInjector</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
由于格式问题，以上代码段在等号后包含换行符。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>该文件会自动生成，并在构建时添加到 .jar 文件中。 如果应用程序出于任何原因在 <code>src/main/resources/META-INF/grails.factories</code> 上定义了自己的 <code>grails.factories</code> 文件，则在该文件中明确定义特征注入器非常重要。 仅当应用程序未定义自己的 <code>src/main/resources/META-INF/grails.factores</code> 文件时，自动生成的元数据才是可靠的。</p>
</div>
</div>

<a name="15.8 &#22312;&#36816;&#34892;&#26102;&#28155;&#21152;&#21160;&#24577;&#26041;&#27861;"><!-- Legacy link --></a>
<h2 id="addingDynamicMethodsAtRuntime">18.7 在运行时添加动态方法</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/addingDynamicMethodsAtRuntime.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_基础">基础</h4>
<div class="paragraph">
<p>Grails 插件使您可以在运行时向任何 Grails 管理的或其他类注册动态方法。 这项工作是通过 <code>doWithDynamicMethods</code> 方法完成的。
注意：请注意，Grails 3.x 具有较新的功能，例如可从使用 <code>CompileStatic</code> 编译的代码中使用的特征。建议仅对特征无法实现的情况添加动态行为。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ExamplePlugin</span> <span class="directive">extends</span> Plugin {
    <span class="type">void</span> doWithDynamicMethods() {
        <span class="keyword">for</span> (controllerClass <span class="keyword">in</span> grailsApplication.controllerClasses) {
             controllerClass.metaClass.myNewMethod = {-&gt; println <span class="string"><span class="delimiter">&quot;</span><span class="content">hello world</span><span class="delimiter">&quot;</span></span> }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，我们使用隐式应用程序对象获取对所有控制器类的 MetaClass 实例的引用，并向每个控制器添加一个名为 <code>myNewMethod</code> 的新方法。 如果您事先知道该类，则希望添加一个方法，您只需引用其 <code>metaClass</code> 属性即可。</p>
</div>
<div class="paragraph">
<p>例如我们可以在 <code>java.lang.String</code> 中添加一个新的方法 <code>swapCase</code> ：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ExamplePlugin</span> <span class="directive">extends</span> Plugin  {

    <span class="annotation">@Override</span>
    <span class="type">void</span> doWithDynamicMethods() {
        <span class="predefined-type">String</span>.metaClass.swapCase = {-&gt;
             <span class="keyword">def</span> sb = <span class="keyword">new</span> <span class="predefined-type">StringBuilder</span>()
             delegate.each {
                 sb &lt;&lt; (<span class="predefined-type">Character</span>.isUpperCase(<span class="local-variable">it</span> <span class="keyword">as</span> <span class="type">char</span>) ?
                        <span class="predefined-type">Character</span>.toLowerCase(<span class="local-variable">it</span> <span class="keyword">as</span> <span class="type">char</span>) :
                        <span class="predefined-type">Character</span>.toUpperCase(<span class="local-variable">it</span> <span class="keyword">as</span> <span class="type">char</span>))
             }
             sb.toString()
        }

        <span class="keyword">assert</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">UpAndDown</span><span class="delimiter">&quot;</span></span> == <span class="string"><span class="delimiter">&quot;</span><span class="content">uPaNDdOWN</span><span class="delimiter">&quot;</span></span>.swapCase()
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_与applicationcontext交互">与ApplicationContext交互</h4>
<div class="paragraph">
<p><code>doWithDynamicMethods</code> 闭包通过了Spring <code>ApplicationContext</code> 实例。 这很有用，因为它使您可以与其中的对象进行交互。 例如，如果您正在实现与Hibernate交互的方法，则可以将 <code>SessionFactory</code> 实例与 <code>HibernateTemplate</code> 结合使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.orm.hibernate3.HibernateTemplate</span>

<span class="type">class</span> <span class="class">ExampleHibernatePlugin</span> <span class="directive">extends</span> Plugin{

   <span class="type">void</span> doWithDynamicMethods() {

       <span class="keyword">for</span> (domainClass <span class="keyword">in</span> grailsApplication.domainClasses) {

           domainClass.metaClass.static.load = { <span class="predefined-type">Long</span> id-&gt;
                <span class="keyword">def</span> sf = applicationContext.sessionFactory
                <span class="keyword">def</span> template = <span class="keyword">new</span> HibernateTemplate(sf)
                template.load(delegate, id)
           }
       }
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>同样由于 Spring 容器的自动装配和依赖注入功能，您可以实现更强大的动态构造函数，这些构造函数使用应用程序上下文在运行时将依赖关系连接到对象中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyConstructorPlugin</span> {

    <span class="type">void</span> doWithDynamicMethods()
         <span class="keyword">for</span> (domainClass <span class="keyword">in</span> grailsApplication.domainClasses) {
              domainClass.metaClass.constructor = {-&gt;
                  <span class="keyword">return</span> applicationContext.getBean(domainClass.name)
              }
         }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里，我们实际上将默认构造函数替换为一个查找原型 Spring bean 的构造函数！</p>
</div>
</div>

<a name="15.9 &#21442;&#19982;&#33258;&#21160;&#37325;&#26032;&#21152;&#36733;&#20107;&#20214;"><!-- Legacy link --></a>
<h2 id="participatingInAutoReloadEvents">18.8 参与自动重新加载事件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/participatingInAutoReloadEvents.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_监视资源的更改">监视资源的更改</h4>
<div class="paragraph">
<p>通常，监视资源的更改并在发生更改时执行某些操作是很有价值的。这就是 Grails 如何在运行时实现应用程序状态的高级重新加载。例如，考虑 Grails <code>ServicesPlugin</code> 中的这个简化片段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ServicesGrailsPlugin</span> <span class="directive">extends</span> Plugin {
    ...
    def watchedResources = <span class="string"><span class="delimiter">&quot;</span><span class="content">file:./grails-app/services/**/*Service.groovy</span><span class="delimiter">&quot;</span></span>

    ...
    void onChange( <span class="predefined-type">Map</span>&lt;<span class="predefined-type">String</span>, <span class="predefined-type">Object</span>&gt; event) {
        <span class="keyword">if</span> (event.source) {
            <span class="keyword">def</span> serviceClass = grailsApplication.addServiceClass(event.source)
            <span class="keyword">def</span> serviceName = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>serviceClass.propertyName<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
            beans {
                <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">$</span>serviceName</span><span class="delimiter">&quot;</span></span>(serviceClass.getClazz()) { bean -&gt;
                    bean.autowire =  <span class="predefined-constant">true</span>
                }
            }
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>首先，它将 <code>watchedResources</code> 定义为包含要监视的资源的引用或模式的字符串或字符串列表。如果关注的资源指定了一个 Groovy 文件，当它被更改时，它将自动被重新加载并传递到 <code>event</code> 对象中的 <code>onChange</code> 闭包中。</p>
</div>
<div class="paragraph">
<p><code>event</code> 对象定义了许多有用的属性：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>event.source</code> - 事件的源，可以是重新加载的 <code>类</code> 资源，也可以是 Spring 资源</p>
</li>
<li>
<p><code>event.ctx</code> - Spring <code>ApplicationContext</code> 实例</p>
</li>
<li>
<p><code>event.plugin</code> - 管理资源的插件对象（通常是 <code>this</code>）</p>
</li>
<li>
<p><code>event.application</code> - <code>GrailsApplication</code> 实例</p>
</li>
<li>
<p><code>event.manager</code> - <code>grailspruginmanager</code> 实例</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些对象可帮助您根据更改内容应用适当的更改。在上面的 <code>Services</code> 示例中，当其中一个服务类更改时，新的服务bean将重新注册到 <code>ApplicationContext</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_影响其他插件">影响其他插件</h4>
<div class="paragraph">
<p>除了对变化做出反应外，有时插件还需要 <code>影响</code> 另一个插件。</p>
</div>
<div class="paragraph">
<p>以服务和控制器插件为例。重新加载服务时，除非您也重新加载控制器，否则当您尝试将重新加载的服务自动连接到较旧的控制器类时，将出现问题。</p>
</div>
<div class="paragraph">
<p>为了解决这个问题，您可以指定哪些插件是另一个插件 <code>影响</code>。这意味着当一个插件检测到更改时，它将重新加载自己，然后重新加载其受影响的插件。例如，考虑来自 <code>ServicesGrailsPlugin</code> 的这个片段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> influences = [<span class="string"><span class="delimiter">'</span><span class="content">controllers</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_观察其他插件">观察其他插件</h4>
<div class="paragraph">
<p>如果有一个特定的插件，您希望观察其更改，但不需要观察它所监视的资源，则可以使用 <code>observe</code> 属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> observe = [<span class="string"><span class="delimiter">&quot;</span><span class="content">controllers</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，当控制器被更改时，您还将收到来自控制器插件的事件链。</p>
</div>
<div class="paragraph">
<p>插件还可以使用通配符来观察所有加载的插件：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> observe = [<span class="string"><span class="delimiter">&quot;</span><span class="content">*</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>日志插件正是这样做的，以便它可以将 <code>log</code> 属性添加回应用程序运行时更改的任何事实。</p>
</div>
</div>

<a name="15.10 &#20102;&#35299;&#25554;&#20214;&#21152;&#36733;&#39034;&#24207;"><!-- Legacy link --></a>
<h2 id="understandingPluginLoadOrder">18.9 了解插件加载顺序</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/understandingPluginLoadOrder.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_控制插件依赖项">控制插件依赖项</h4>
<div class="paragraph">
<p>插件通常依赖于其他插件的存在，并且可以根据其他插件的存在进行调整。这是用两个属性实现的。第一种叫做 <code>dependsOn</code>。例如，查看 Hibernate 插件中的以下代码片段：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">HibernateGrailsPlugin</span> {

    <span class="keyword">def</span> version = <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>

    <span class="keyword">def</span> dependsOn = [<span class="key">dataSource</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>,
                     <span class="key">domainClass</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>,
                     <span class="key">i18n</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>,
                     <span class="key">core</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Hibernate 插件依赖于四个插件的存在：<code>dataSource</code>、<code>domainClass</code>、<code>i18n</code> 和 <code>core</code> 插件。</p>
</div>
<div class="paragraph">
<p>依赖项将在 Hibernate 插件之前加载，如果所有依赖项都未加载，则插件将不会加载。</p>
</div>
<div class="paragraph">
<p>dependsOn 属性还支持用于指定版本范围的小型表达式语言。下面是一些语法示例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> dependsOn = [<span class="key">foo</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">* &gt; 1.0</span><span class="delimiter">&quot;</span></span>]
<span class="keyword">def</span> dependsOn = [<span class="key">foo</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0 &gt; 1.1</span><span class="delimiter">&quot;</span></span>]
<span class="keyword">def</span> dependsOn = [<span class="key">foo</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0 &gt; *</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>当使用通配符 * 时，它表示 <code>任意</code> 版本。表达式语法还排除了任何后缀，如 -BETA、-ALPHA 等。因此，例如，表达式 <code>1.0&gt;1.1</code> 将匹配以下任何版本：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1.1</p>
</li>
<li>
<p>1.0</p>
</li>
<li>
<p>1.0.1</p>
</li>
<li>
<p>1.0.3-SNAPSHOT</p>
</li>
<li>
<p>1.1-BETA2</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_控制负载顺序">控制负载顺序</h4>
<div class="paragraph">
<p>使用 dependsOn 建立一个 <code>硬</code> 依赖关系，如果依赖关系没有被解析，插件将放弃并且不会加载。不过，使用 <code>loadAfter</code> 和 <code>loadBefore</code> 属性可能会有较弱的依赖关系：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> loadAfter = [<span class="string"><span class="delimiter">'</span><span class="content">controllers</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里，插件将被加载到 <code>控制器</code> 插件，如果它存在，否则它将被加载。然后，该插件可以适应其他插件的存在，例如 Hibernate 插件在其 <code>doWithSpring</code> 闭包中包含以下代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">if</span> (manager?.hasGrailsPlugin(<span class="string"><span class="delimiter">&quot;</span><span class="content">controllers</span><span class="delimiter">&quot;</span></span>)) {
    openSessionInViewInterceptor(OpenSessionInViewInterceptor) {
        flushMode = HibernateAccessor.FLUSH_MANUAL
        sessionFactory = sessionFactory
    }
    grailsUrlHandlerMapping.interceptors &lt;&lt; openSessionInViewInterceptor
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里，如果 <code>controllers</code> 插件已经加载，Hibernate 插件将只注册一个 <code>OpenSessionInViewInterceptor</code> 。manager 变量是 <a href="http://docs.grails.org/4.0.0/api/grails/plugins/grailspruginmanager.html">grailspruginmanager</a> 接口的一个实例，它提供了与其他插件交互的方法。</p>
</div>
<div class="paragraph">
<p>您还可以使用 <code>load before</code> 属性指定一个或多个插件，您的插件应在以下时间之前加载：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> loadBefore = [<span class="string"><span class="delimiter">'</span><span class="content">rabbitmq</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_范围和环境">范围和环境</h4>
<div class="paragraph">
<p>你不仅可以控制插件的加载顺序。您还可以指定插件应加载在哪些环境中以及应加载哪些作用域（生成阶段）。只需在插件描述符中声明这些属性中的一个或两个：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> environments = [<span class="string"><span class="delimiter">'</span><span class="content">development</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">test</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">myCustomEnv</span><span class="delimiter">'</span></span>]
<span class="keyword">def</span> scopes = [<span class="key">excludes</span>:<span class="string"><span class="delimiter">'</span><span class="content">war</span><span class="delimiter">'</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>在本例中，插件将只在 <code>开发</code> 和 <code>测试</code> 环境中加载。也不会打包到 WAR 文件中，因为它被排除在 <code>WAR</code> 阶段之外。这允许 <code>仅开发</code> 插件不打包供生产使用。</p>
</div>
<div class="paragraph">
<p>可用作用域的完整列表由 <a href="enumhttp://docs.grails.org/4.0.0/api/grails/util/BuildScope.html">BuildScope</a> 定义，但这里有一个摘要：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>test</code> - 运行测试时</p>
</li>
<li>
<p><code>functional-test</code> - 运行功能测试时</p>
</li>
<li>
<p><code>run</code> - 用于run app和run war</p>
</li>
<li>
<p><code>war</code> - 将应用程序打包为war文件时</p>
</li>
<li>
<p><code>all</code> - 插件应用于所有作用域（默认）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>两个属性都可以是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>a string - 唯一的包裹物</p>
</li>
<li>
<p>a list - 要包括的环境或范围的列表</p>
</li>
<li>
<p>a map - 用于完全控制，具有 <code>includes</code> 和/或 <code>excludes</code> 键，这些键可以具有字符串或列表值</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>例如，</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> environments = <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>将只在测试环境中包含插件，而</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> environments = [<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>将它包括在开发和测试环境中。最后，</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> environments = [<span class="key">includes</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">development</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>会做同样的事。</p>
</div>
</div>


<h2 id="artefactApi">18.10 艺术品 API</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/artefactApi.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>您现在应该了解 Grails 具有工件（artefact）的概念：它了解的特殊类型的类，可以将其与常规 Groovy 和 Java 类区别对待，例如通过使用额外的属性和方法对其进行增强。工件（artefact）的示例包括域类和控制器。 您可能没有意识到，Grails 允许应用程序和插件开发人员访问工件（artefact）的基础结构，这意味着您可以找到可用的工件（artefacts），甚至自己进行增强。您甚至可以提供自己的自定义工件（artefact）类型。</p>
</div>


<h2 id="queryingArtefacts">18.10.1 询问可用文物</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/artefactApi/queryingArtefacts.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>作为插件开发人员，重要的是要了解应用程序中可用的域类，控制器或其他类型的人工制品。例如， <a href="https://grails.org/plugins.html#plugin/elasticsearch">Elasticsearch插件</a> 需要知道存在哪些域类，以便可以检查它们的任何 <code>可搜索</code> 属性并为适当的属性建立索引。那么它是如何做到的呢？答案取决于 <code>grailsApplication</code> 对象，以及 <a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsApplication.html">GrailsApplication</a> 的实例，该实例可在控制器和 GSP 中自动使用，并且可以在其他任何地方 <a href="services.html＃dependencyInjectionServices">injected</a> 。</p>
</div>
<div class="paragraph">
<p><code>grailsApplication</code> 对象具有一些重要的属性和查询伪像的方法。可能最常见的是为您提供特定文物类型的所有类别的文物：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span> (cls <span class="keyword">in</span> grailsApplication.&lt;artefactType&gt;Classes) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，<code>artefactType</code> 是工件类型的属性名称形式。使用核心 Grails，您可以：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>domain</p>
</li>
<li>
<p>controller</p>
</li>
<li>
<p>tagLib</p>
</li>
<li>
<p>service</p>
</li>
<li>
<p>codec</p>
</li>
<li>
<p>bootstrap</p>
</li>
<li>
<p>urlMappings</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>因此，例如，如果要遍历所有域类，请使用：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span> (cls <span class="keyword">in</span> grailsApplication.domainClasses) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于 URL 映射：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span> (cls <span class="keyword">in</span> grailsApplication.urlMappingsClasses) {
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您需要注意，这些属性返回的对象不是 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html">Class</a> 的实例。相反，它们是 <a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsClass.html">GrailsClass</a> 的实例，这些实例具有一些特别有用的属性和方法，包括一个用于基础 <code>类</code> 的属性和方法：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>shortName</code> - 没有包的人工制品的类名（等同于 <code>Class.simpleName</code> ）。</p>
</li>
<li>
<p><code>logicalPropertyName</code>- 属性形式的名称，不带 <code>type</code> 后缀。因此，<code>MyGreatController</code> 成为 <code>myGreat</code> 。</p>
</li>
<li>
<p><code>isAbstract()</code> - 一个布尔值，指示 artefact 类是否为抽象类。</p>
</li>
<li>
<p><code>getPropertyValue(name)</code> - 返回给定属性的值，无论它是静态的还是实例的。如果属性是在声明时初始化的，则效果最好。<code>static transactional = true</code>。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>artefact API 还允许您按名称获取类，并检查类是否为 artefact：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>get&lt;type&gt;Class(String name)</p>
</li>
<li>
<p>is&lt;type&gt;Class(Class clazz)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>第一种方法将检索给定名称的 GrailsClass 实例，例如 <code>MyGreatController</code> 。第二个将检查类是否为特定类型的人工制品。 例如，您可以使用 <code>grailsApplication.isControllerClass(org.example.MyGreatController)</code> 检查 <code>MyGreatController</code> 是否实际上是控制器。</p>
</div>


<h2 id="customArtefacts">18.10.2 添加您自己的艺术品类型</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/plugins/artefactApi/customArtefacts.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>插件可以轻松提供自己的工件（artefacts），以便他们可以轻松地找到可用的实现并参与重新加载。您需要做的就是创建一个 ArtefactHandler 实现，并将其注册到您的主插件类中：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">MyGrailsPlugin</span> {
    <span class="keyword">def</span> artefacts = [ org.somewhere.MyArtefactHandler ]
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>artefacts</code> 列表可以包含处理程序类（如上所述）或处理程序实例。</p>
</div>
<div class="paragraph">
<p>那么，Artefact 是怎样处理的？好吧，简单地说，它是 <a href="http://docs.grails.org/4.0.0/api/grails/core/ArtefactHandler.html">ArtefactHandler</a> 接口的实现。为了使生活更轻松，可以轻松扩展以下框架实现: <a href="http://docs.grails.org/4.0.0/api/grails/core/ArtefactHandlerAdapter.html">ArtefactHandlerAdapter</a> 。</p>
</div>
<div class="paragraph">
<p>除了处理程序本身之外，每个新的工件都需要一个相应的包装器类，该包装器类可实现 <a href="http://docs.grails.org/4.0.0/api/grails/core/GrailsClass.html">GrailsClass</a>。同样，可以使用骨架实现，例如 <a href="http://docs.grails.org/4.0.0/api/org/grails/core/AbstractInjectableGrailsClass.html">AbstractInjectableGrailsClass</a>，它特别有用，因为它可以将工件变成自动注入的 Spring bean，就像控制器和服务一样。</p>
</div>
<div class="paragraph">
<p>理解处理程序类和包装程序类如何工作的最好方法是查看 Quartz 插件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-plugins/grails-quartz/blob/master/src/main/groovy/grails/plugins/quartz/GrailsJobClass.java">GrailsJobClass</a></p>
</li>
<li>
<p><a href="https://github.com/grails-plugins/grails-quartz/blob/master/src/main/groovy/grails/plugins/quartz/DefaultGrailsJobClass.java">DefaultGrailsJobClass</a></p>
</li>
<li>
<p><a href="https://github.com/grails-plugins/grails-quartz/blob/master/src/main/groovy/grails/plugins/quartz/JobArtefactHandler.groovy">JobArtefactHandler</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>另一个示例是 <a href="http://github.com/pledbrook/grails-shiro">Shiro plugin</a>，它添加了一个领域工件。</p>
</div>

<a name="16. Grails &#21644; Spring"><!-- Legacy link --></a>
<h1 id="spring">19 Grails 与 Spring</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/spring.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>本部分面向高级用户和对Grails如何与 <a href="http://spring.io/">Spring Framework</a>集成并在其上构建感兴趣的用户. 考虑进行运行时配置Grails时，它对于 <a href="plugins.html">插件开发人员</a> 也是有用的。</p>
</div>

<a name="16.2 &#37197;&#32622;&#20854;&#20182; Bean"><!-- Legacy link --></a>
<h2 id="springdslAdditional">19.1 配置其他 bean</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/spring/springdslAdditional.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_使用spring_bean_dsl">使用Spring Bean DSL</h4>
<div class="paragraph">
<p>您可以通过在 <code>grails-app/conf/spring/resources.groovy</code> 中配置新的(或覆盖现有的)bean来轻松注册它们。使用Grails <a href="#springdsl">Spring DSL</a>。bean定义在一个 <code>beans</code> 属性(一个闭包)中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    <span class="comment">// beans here</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>作为一个简单的例子，你可以用下面的语法配置一个bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">my.company.MyBeanImpl</span>

beans = {
    myBean(MyBeanImpl) {
        someProperty = <span class="integer">42</span>
        otherProperty = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>一旦配置好，bean就可以自动连接到Grails工件和其他支持依赖注入的类中(例如 <code>BootStrap.groovy</code> )。通过声明一个公共字段，它的名字是你的bean的名字(在本例中是 <code>myBean</code>):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ExampleController</span> {

     <span class="keyword">def</span> myBean
     ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用DSL的好处是你可以混合bean声明和逻辑，例如基于链接:<a href="conf.html#environments">environment</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.util.Environment</span>
<span class="keyword">import</span> <span class="include">my.company.mock.MockImpl</span>
<span class="keyword">import</span> <span class="include">my.company.MyBeanImpl</span>

beans = {
    <span class="keyword">switch</span>(Environment.current) {
        <span class="keyword">case</span> Environment.PRODUCTION:
            myBean(MyBeanImpl) {
                someProperty = <span class="integer">42</span>
                otherProperty = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>
            }
            <span class="keyword">break</span>

        <span class="keyword">case</span> Environment.DEVELOPMENT:
            myBean(MockImpl) {
                someProperty = <span class="integer">42</span>
                otherProperty = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>
            }
            <span class="keyword">break</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用 <code>application</code> 变量访问 <code>GrailsApplication</code> 对象，并可用于访问Grails配置(以及其他配置):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.util.Environment</span>
<span class="keyword">import</span> <span class="include">my.company.mock.MockImpl</span>
<span class="keyword">import</span> <span class="include">my.company.MyBeanImpl</span>

beans = {
    <span class="keyword">if</span> (application.config.my.company.mockService) {
        myBean(MockImpl) {
            someProperty = <span class="integer">42</span>
            otherProperty = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>
        }
    } <span class="keyword">else</span> {
        myBean(MyBeanImpl) {
            someProperty = <span class="integer">42</span>
            otherProperty = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果在 <code>resources.groovy</code> 中定义bean。您的bean将使用与以前Grails或已安装的插件注册的名称相同的名称来替代以前的注册。这是一种方便的定制行为的方法，而不需要编辑插件代码或其他会影响可维护性的方法。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_使用xml">使用XML</h4>
<div class="paragraph">
<p>还可以使用 <code>grails-app/conf/spring/resources.xml</code> 配置bean。在Grails的早期版本中，这个文件是由 <code>run-app</code> 脚本自动生成的，但是DSL在 <code>resources.groovy</code> 中。现在首选的方法是groovy，所以现在不会自动生成它。但它仍然是受支持的-您只需要自己创建它。</p>
</div>
<div class="paragraph">
<p>这个文件是典型的Spring XML文件，Spring文档有一个 <a href="http://docs.spring.io/spring/docs/4.0.x/spring-framework-reference/html/beans.html#beans-basics">优秀参考</a>。关于如何配置Spring bean的基本知识。</p>
</div>
<div class="paragraph">
<p>我们使用DSL配置的 <code>myBean</code> bean将在XML文件中配置如下语法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.MyBeanImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someProperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">otherProperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>和其他bean一样，它可以自动连接到任何支持依赖注入的类中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ExampleController</span> {

     <span class="keyword">def</span> myBean
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_引用现有的bean">引用现有的bean</h4>
<div class="paragraph">
<p>在约定中声明的 <code>resources.groovy</code> 或 <code>resources.xml</code> 可以按照约定引用其他bean。例如，如果你有一个 <code>BookService</code> 类，它的Spring bean名会是 <code>bookService</code>，所以你的bean会像这样在DSL中引用它:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    myBean(MyBeanImpl) {
        someProperty = <span class="integer">42</span>
        otherProperty = <span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span>
        bookService = ref(<span class="string"><span class="delimiter">&quot;</span><span class="content">bookService</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者像这样的XML:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myBean</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.MyBeanImpl</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">someProperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">42</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">otherProperty</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">blue</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookService</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">ref</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookService</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>bean需要一个用于bean引用的公共setter(以及两个简单属性)，在Groovy中定义如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> my.company

<span class="type">class</span> <span class="class">MyBeanImpl</span> {
    <span class="predefined-type">Integer</span> someProperty
    <span class="predefined-type">String</span> otherProperty
    BookService bookService <span class="comment">// 或者只是 &quot;def bookService&quot;</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者在Java中是这样的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> my.company;

<span class="type">class</span> <span class="class">MyBeanImpl</span> {

    <span class="directive">private</span> BookService bookService;
    <span class="directive">private</span> <span class="predefined-type">Integer</span> someProperty;
    <span class="directive">private</span> <span class="predefined-type">String</span> otherProperty;

    <span class="directive">public</span> <span class="type">void</span> setBookService(BookService theBookService) {
        <span class="local-variable">this</span>.bookService = theBookService;
    }

    <span class="directive">public</span> <span class="type">void</span> setSomeProperty(<span class="predefined-type">Integer</span> someProperty) {
        <span class="local-variable">this</span>.someProperty = someProperty;
    }

    <span class="directive">public</span> <span class="type">void</span> setOtherProperty(<span class="predefined-type">String</span> otherProperty) {
        <span class="local-variable">this</span>.otherProperty = otherProperty;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用 <code>ref</code> (在XML或DSL中)非常强大，因为它配置了一个运行时引用，所以引用的bean不必存在。只要在最后的应用程序上下文配置发生时它已经就位，就可以正确地解决所有问题。</p>
</div>
<div class="paragraph">
<p>有关可用bean的完整参考，请参阅参考指南中的插件参考。</p>
</div>
</div>

<a name="16.3 &#24102; Bebe DSL &#30340;&#36816;&#34892;&#26102; Spring"><!-- Legacy link --></a>
<h2 id="springdsl">19.2 使用 Bean DSL 运行时Spring</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/spring/springdsl.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails中的这个Bean builder旨在提供一种简化的方式，将依赖项连接在一起，并在其核心部分使用Spring。</p>
</div>
<div class="paragraph">
<p>此外，Spring的常规配置方式(通过XML和注释)是静态的，很难在运行时修改和配置，除了编程式的XML创建之外，这种方式容易出错，而且冗长。Grails的<a href="http://docs.grails.org/4.0.0/api/grails/spring/BeanBuilder.html">BeanBuilder</a>通过在运行时以编程方式将组件连接在一起改变了这一切，允许您根据系统属性或环境变量调整逻辑。</p>
</div>
<div class="paragraph">
<p>这使代码能够适应其环境，并避免了不必要的代码重复(为测试、开发和生产环境提供不同的Spring配置)</p>
</div>
<div class="sect3">
<h4 id="_beanbuilder类">BeanBuilder类</h4>
<div class="paragraph">
<p>Grails提供了一个<a href="http://docs.grails.org/4.0.0/api/grails/spring/BeanBuilder.html">grails.spring.BeanBuilder</a>。使用动态Groovy构造bean定义的类。基本情况如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.commons.dbcp.BasicDataSource</span>
<span class="keyword">import</span> <span class="include">org.grails.orm.hibernate.ConfigurableLocalSessionFactoryBean</span>
<span class="keyword">import</span> <span class="include">org.springframework.context.ApplicationContext</span>
<span class="keyword">import</span> <span class="include">grails.spring.BeanBuilder</span>

<span class="keyword">def</span> bb = <span class="keyword">new</span> BeanBuilder()

bb.beans {

    dataSource(BasicDataSource) {
        driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:grailsDB</span><span class="delimiter">&quot;</span></span>
        username = <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>
        password = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
    }

    sessionFactory(ConfigurableLocalSessionFactoryBean) {
        dataSource = ref(<span class="string"><span class="delimiter">'</span><span class="content">dataSource</span><span class="delimiter">'</span></span>)
        hibernateProperties = [<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>,
                               <span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span>:     <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>]
    }
}

ApplicationContext appContext = bb.createApplicationContext()</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
内部链接 <a href="plugins.html">plugins</a> 和 <code>grails-app/conf/spring/resources.groovy</code> 资源。你不需要创建一个新的实例 <code>BeanBuilder</code> 。相反，DSL可以隐式地分别在 <code>doWithSpring</code> 和 <code>beans</code> 块中使用。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这个示例展示了如何使用`BeanBuilder`类的数据源配置Hibernate。</p>
</div>
<div class="paragraph">
<p>在Spring中，每个方法调用(在本例中是 <code>dataSource</code> 和 <code>sessionFactory</code> 调用)都映射到bean的名称。该方法的第一个参数是bean的类，而最后一个参数是块。在块体中，可以使用标准的Groovy语法设置bean的属性。</p>
</div>
<div class="paragraph">
<p>使用Bean的名称自动解析Bean引用。在上面的例子中，可以看到 <code>sessionFactory</code> bean解析 <code>dataSource</code> 引用的方式。</p>
</div>
<div class="paragraph">
<p>构建器还可以设置与bean管理相关的某些特殊属性，如下面的代码所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sessionFactory(ConfigurableLocalSessionFactoryBean) { bean -&gt;
    <span class="comment">// Autowiring behaviour. The other option is 'byType'. &lt;&lt;autowire&gt;&gt;</span>
    bean.autowire = <span class="string"><span class="delimiter">'</span><span class="content">byName</span><span class="delimiter">'</span></span>
    <span class="comment">// Sets the initialisation method to 'init'. [init-method]</span>
    bean.initMethod = <span class="string"><span class="delimiter">'</span><span class="content">init</span><span class="delimiter">'</span></span>
    <span class="comment">// Sets the destruction method to 'destroy'. [destroy-method]</span>
    bean.destroyMethod = <span class="string"><span class="delimiter">'</span><span class="content">destroy</span><span class="delimiter">'</span></span>
    <span class="comment">// Sets the scope of the bean. &lt;&lt;scope&gt;&gt;</span>
    bean.scope = <span class="string"><span class="delimiter">'</span><span class="content">request</span><span class="delimiter">'</span></span>
    dataSource = ref(<span class="string"><span class="delimiter">'</span><span class="content">dataSource</span><span class="delimiter">'</span></span>)
    hibernateProperties = [<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>,
                           <span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span>:     <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>方括号中的字符串是Spring XML定义中等价bean属性的名称。</p>
</div>
</div>
<div class="sect3">
<h4 id="_在spring_mvc中使用beanbuilder">在Spring MVC中使用BeanBuilder</h4>
<div class="paragraph">
<p>包括 <code>grails-spring-&lt;version&gt;.jar</code> 。在常规的Spring MVC应用程序中使用BeanBuilder。然后将以下 <code>&lt;context-param&gt;</code> 值添加到您的 <code>/WEB-INF/web.xml</code> 的文件:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>contextConfigLocation<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>/WEB-INF/applicationContext.groovy<span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span>

<span class="tag">&lt;context-param&gt;</span>
    <span class="tag">&lt;param-name&gt;</span>contextClass<span class="tag">&lt;/param-name&gt;</span>
    <span class="tag">&lt;param-value&gt;</span>
      grails.web.servlet.context.GrailsWebApplicationContext
    <span class="tag">&lt;/param-value&gt;</span>
<span class="tag">&lt;/context-param&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后创建一个 <code>/WEB-INF/applicationContext.groovy</code> 。完成其余工作的groovy文件:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.commons.dbcp.BasicDataSource</span>

beans {
    dataSource(BasicDataSource) {
        driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:grailsDB</span><span class="delimiter">&quot;</span></span>
        username = <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>
        password = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_从文件系统加载bean定义">从文件系统加载Bean定义</h4>
<div class="paragraph">
<p>您可以使用 <code>BeanBuilder</code> 类来加载外部Groovy脚本，这些脚本使用与这里定义的语法相同的路径来定义bean。例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bb = <span class="keyword">new</span> BeanBuilder()
bb.loadBeans(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:*SpringBeans.groovy</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">def</span> applicationContext = bb.createApplicationContext()</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里， <code>BeanBuilder</code> 加载以 <code>SpringBeans.groovy</code> 结尾的类路径上的所有Groovy文件。并将它们解析为bean定义。一个例子脚本可以看到如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.apache.commons.dbcp.BasicDataSource</span>
<span class="keyword">import</span> <span class="include">org.grails.orm.hibernate.ConfigurableLocalSessionFactoryBean</span>

beans {

    dataSource(BasicDataSource) {
        driverClassName = <span class="string"><span class="delimiter">&quot;</span><span class="content">org.h2.Driver</span><span class="delimiter">&quot;</span></span>
        url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc:h2:mem:grailsDB</span><span class="delimiter">&quot;</span></span>
        username = <span class="string"><span class="delimiter">&quot;</span><span class="content">sa</span><span class="delimiter">&quot;</span></span>
        password = <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>
    }

    sessionFactory(ConfigurableLocalSessionFactoryBean) {
        dataSource = dataSource
        hibernateProperties = [<span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.hbm2ddl.auto</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">create-drop</span><span class="delimiter">&quot;</span></span>,
                               <span class="string"><span class="delimiter">&quot;</span><span class="content">hibernate.show_sql</span><span class="delimiter">&quot;</span></span>:     <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_向绑定_上下文_添加变量">向绑定(上下文)添加变量</h4>
<div class="paragraph">
<p>如果你从脚本中加载bean，你可以通过创建一个Groovy <code>Binding</code> 来设置绑定:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> binding = <span class="keyword">new</span> <span class="predefined-type">Binding</span>()
binding.maxSize = <span class="integer">10000</span>
binding.productGroup = <span class="string"><span class="delimiter">'</span><span class="content">finance</span><span class="delimiter">'</span></span>

<span class="keyword">def</span> bb = <span class="keyword">new</span> BeanBuilder()
bb.binding = binding
bb.loadBeans(<span class="string"><span class="delimiter">&quot;</span><span class="content">classpath:*SpringBeans.groovy</span><span class="delimiter">&quot;</span></span>)

<span class="keyword">def</span> ctx = bb.createApplicationContext()</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后可以在DSL文件中访问 <code>maxSize</code> 和 <code>productGroup</code> 属性。</p>
</div>
</div>

<a name="16.4 Bean &#26500;&#24314;&#22120; DSL &#35299;&#37322;"><!-- Legacy link --></a>
<h2 id="theBeanBuilderDSLExplained">19.3 Bean构建器DSL解释</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/spring/theBeanBuilderDSLExplained.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_使用构造函数参数">使用构造函数参数</h4>
<div class="paragraph">
<p>可以使用每个bean定义方法的参数来定义构造函数参数。将它们放在第一个参数(类)之后:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {
    exampleBean(MyExampleBean, <span class="string"><span class="delimiter">&quot;</span><span class="content">firstArgument</span><span class="delimiter">&quot;</span></span>, <span class="integer">2</span>) {
        someProperty = [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这个配置对应于一个 <code>MyExampleBean</code> ，其构造函数如下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">MyExampleBean(<span class="predefined-type">String</span> foo, <span class="type">int</span> bar) {
   ...
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置beandefinition_使用工厂方法">配置BeanDefinition(使用工厂方法)</h4>
<div class="paragraph">
<p>关闭的第一个参数是一个引用bean配置实例,可以配置使用工厂方法和调用任何方法 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/support/AbstractBeanDefinition.html">AbstractBeanDefinition</a>类:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {
    exampleBean(MyExampleBean) { bean -&gt;
        bean.factoryMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">getInstance</span><span class="delimiter">&quot;</span></span>
        bean.singleton = <span class="predefined-constant">false</span>
        someProperty = [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>作为替代，你也可以使用bean定义方法的返回值来配置bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {
    <span class="keyword">def</span> example = exampleBean(MyExampleBean) {
        someProperty = [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>]
    }
    example.factoryMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">getInstance</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用工厂bean">使用工厂bean</h4>
<div class="paragraph">
<p>Spring定义了工厂bean的概念，通常bean不是直接从类的新实例创建的，而是从这些工厂之一创建的。在这种情况下，bean没有类参数，相反，您必须将工厂bean的名称传递给bean定义方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {

    myFactory(ExampleFactoryBean) {
        someProperty = [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>]
    }

    myBean(myFactory) {
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">blah</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>另一种常见的方法是提供工厂方法的名称来调用工厂bean。这可以使用Groovy的命名参数语法实现:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {

    myFactory(ExampleFactoryBean) {
        someProperty = [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>]
    }

    myBean(<span class="key">myFactory</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">getInstance</span><span class="delimiter">&quot;</span></span>) {
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">blah</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里， <code>ExampleFactoryBean</code>  bean上的 <code>getInstance</code> 方法将被调用来创建 <code>myBean</code> bean。</p>
</div>
</div>
<div class="sect3">
<h4 id="_在运行时创建bean引用">在运行时创建Bean引用</h4>
<div class="paragraph">
<p>有时直到运行时您才知道要创建的bean的名称。在这种情况下，你可以使用一个字符串插值表达式来动态调用一个bean定义方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> beanName = <span class="string"><span class="delimiter">&quot;</span><span class="content">example</span><span class="delimiter">&quot;</span></span>
bb.beans {
    <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>beanName<span class="inline-delimiter">}</span></span><span class="content">Bean</span><span class="delimiter">&quot;</span></span>(MyExampleBean) {
        someProperty = [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，在调用bean定义方法时使用前面定义的 <code>beanName</code> 变量。这个例子有一个硬编码的值，但是对于根据配置、系统属性等以编程方式生成的名称也同样适用。</p>
</div>
<div class="paragraph">
<p>此外，由于有时直到运行时才知道bean的名称，所以在连接其他bean时，可能需要按名称引用它们，在这种情况下使用 <code>ref</code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> beanName = <span class="string"><span class="delimiter">&quot;</span><span class="content">example</span><span class="delimiter">&quot;</span></span>
bb.beans {

    <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>beanName<span class="inline-delimiter">}</span></span><span class="content">Bean</span><span class="delimiter">&quot;</span></span>(MyExampleBean) {
        someProperty = [<span class="integer">1</span>, <span class="integer">2</span>, <span class="integer">3</span>]
    }

    anotherBean(AnotherBean) {
        example = ref(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>beanName<span class="inline-delimiter">}</span></span><span class="content">Bean</span><span class="delimiter">&quot;</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这里， <code>AnotherBean</code> 的示例属性是使用 <code>exampleBean</code> 的运行时引用设置的。 <code>ref</code> 方法也可以用来引用来自父类 <code>ApplicationContext</code> 的bean，该父类在 <code>BeanBuilder</code> 的构造函数中提供:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">ApplicationContext parent = ...<span class="comment">//</span>
<span class="keyword">def</span> bb = <span class="keyword">new</span> BeanBuilder(parent)
bb.beans {
    anotherBean(AnotherBean) {
        example = ref(<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>beanName<span class="inline-delimiter">}</span></span><span class="content">Bean</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这里第二个参数 <code>true</code> 指定引用将在父上下文中查找bean。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用匿名_内部_bean">使用匿名(内部)bean</h4>
<div class="paragraph">
<p>您可以使用匿名内部bean，方法是将bean的一个属性设置为一个块，该块接受一个bean类型的参数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {

    marge(Person) {
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Marge</span><span class="delimiter">&quot;</span></span>
        husband = { Person p -&gt;
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Homer</span><span class="delimiter">&quot;</span></span>
            age = <span class="integer">45</span>
            props = [<span class="key">overweight</span>: <span class="predefined-constant">true</span>, <span class="key">height</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.8m</span><span class="delimiter">&quot;</span></span>]
        }
        children = [ref(<span class="string"><span class="delimiter">'</span><span class="content">bart</span><span class="delimiter">'</span></span>), ref(<span class="string"><span class="delimiter">'</span><span class="content">lisa</span><span class="delimiter">'</span></span>)]
    }

    bart(Person) {
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Bart</span><span class="delimiter">&quot;</span></span>
        age = <span class="integer">11</span>
    }

    lisa(Person) {
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Lisa</span><span class="delimiter">&quot;</span></span>
        age = <span class="integer">9</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的例子中，我们将 <code>marge</code> bean的husband属性设置为一个创建内部bean引用的块。或者，如果你有一个工厂bean，你可以省略类型，只使用指定的bean定义来设置工厂:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {

    personFactory(PersonFactory)

    marge(Person) {
        name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Marge</span><span class="delimiter">&quot;</span></span>
        husband = { bean -&gt;
            bean.factoryBean = <span class="string"><span class="delimiter">&quot;</span><span class="content">personFactory</span><span class="delimiter">&quot;</span></span>
            bean.factoryMethod = <span class="string"><span class="delimiter">&quot;</span><span class="content">newInstance</span><span class="delimiter">&quot;</span></span>
            name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Homer</span><span class="delimiter">&quot;</span></span>
            age = <span class="integer">45</span>
            props = [<span class="key">overweight</span>: <span class="predefined-constant">true</span>, <span class="key">height</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.8m</span><span class="delimiter">&quot;</span></span>]
        }
        children = [ref(<span class="string"><span class="delimiter">'</span><span class="content">bart</span><span class="delimiter">'</span></span>), ref(<span class="string"><span class="delimiter">'</span><span class="content">lisa</span><span class="delimiter">'</span></span>)]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_抽象bean和父bean定义">抽象Bean和父Bean定义</h4>
<div class="paragraph">
<p>创建一个抽象的bean定义定义一个没有 <code>Class</code> 参数的bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">HolyGrailQuest</span> {
    <span class="keyword">def</span> <span class="function">start</span>() { println <span class="string"><span class="delimiter">&quot;</span><span class="content">lets begin</span><span class="delimiter">&quot;</span></span> }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">KnightOfTheRoundTable</span> {

    <span class="predefined-type">String</span> name
    <span class="predefined-type">String</span> leader
    HolyGrailQuest quest

    KnightOfTheRoundTable(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name
    }

    <span class="keyword">def</span> <span class="function">embarkOnQuest</span>() {
        quest.start()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.spring.BeanBuilder</span>

<span class="keyword">def</span> bb = <span class="keyword">new</span> BeanBuilder()
bb.beans {
    abstractBean {
        leader = <span class="string"><span class="delimiter">&quot;</span><span class="content">Lancelot</span><span class="delimiter">&quot;</span></span>
    }
    ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这里，我们定义了一个抽象bean，它有一个 <code>leader</code> 属性，其值为 <code>"Lancelot"</code> 。要使用抽象bean，请将它设置为子bean的父bean:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">bb.beans {
    ...
    quest(HolyGrailQuest)

    knights(KnightOfTheRoundTable, <span class="string"><span class="delimiter">&quot;</span><span class="content">Camelot</span><span class="delimiter">&quot;</span></span>) { bean -&gt;
        bean.parent = abstractBean
        quest = ref(<span class="string"><span class="delimiter">'</span><span class="content">quest</span><span class="delimiter">'</span></span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>笔记: 使用父bean时，必须在设置bean上的任何其他属性之前设置bean的父属性!</p>
</div>
<div class="paragraph">
<p>如果你想要一个抽象的bean有一个指定的 <code>Class</code> ，你可以这样做:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.spring.BeanBuilder</span>

<span class="keyword">def</span> bb = <span class="keyword">new</span> BeanBuilder()
bb.beans {

    abstractBean(KnightOfTheRoundTable) { bean -&gt;
        bean.<span class="string"><span class="delimiter">'</span><span class="content">abstract</span><span class="delimiter">'</span></span> = <span class="predefined-constant">true</span>
        leader = <span class="string"><span class="delimiter">&quot;</span><span class="content">Lancelot</span><span class="delimiter">&quot;</span></span>
    }

    quest(HolyGrailQuest)

    knights(<span class="string"><span class="delimiter">&quot;</span><span class="content">Camelot</span><span class="delimiter">&quot;</span></span>) { bean -&gt;
        bean.parent = abstractBean
        quest = quest
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在本例中，我们创建了一个类型为 <code>KnightOfTheRoundTable</code> 的抽象bean，并使用bean参数将其设置为abstract。稍后我们将定义一个knights bean，它没有定义 <code>Class</code> ，但是继承了父bean的 <code>Class</code> 。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用spring名称空间">使用Spring名称空间</h4>
<div class="paragraph">
<p>自Spring 2.0以来，Spring的用户更容易通过XML名称空间访问关键特性。你可以在BeanBuilder中使用Spring命名空间，用如下语法声明:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">xmlns <span class="key">context</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/context</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后调用一个方法来匹配Spring名称空间标签及其相关属性的名称:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">context.<span class="string"><span class="delimiter">'</span><span class="content">component-scan</span><span class="delimiter">'</span></span>(<span class="string"><span class="delimiter">'</span><span class="content">base-package</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">my.company.domain</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用Spring名称空间做一些有用的事情，比如查找JNDI资源:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">xmlns <span class="key">jee</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/jee</span><span class="delimiter">&quot;</span></span>

jee.<span class="string"><span class="delimiter">'</span><span class="content">jndi-lookup</span><span class="delimiter">'</span></span>(<span class="key">id</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">jndi-name</span><span class="delimiter">'</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">java:comp/env/myDataSource</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>此示例将通过对给定的JNDI名称执行JNDI查找来创建标识符为 <code>dataSource</code> 的Spring bean。使用Spring名称空间，您还可以完全访问BeanBuilder在Spring中提供的所有强大的AOP支持。例如，给定这两个类:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {

    <span class="type">int</span> age
    <span class="predefined-type">String</span> name

    <span class="type">void</span> birthday() {
        ++age;
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BirthdayCardSender</span> {

    <span class="predefined-type">List</span> peopleSentCards = <span class="type">[]</span>

    <span class="type">void</span> onBirthday(Person person) {
        peopleSentCards &lt;&lt; person
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以定义一个方面，它使用切入点来检测何时调用 <code>birthday()</code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">xmlns <span class="key">aop</span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.springframework.org/schema/aop</span><span class="delimiter">&quot;</span></span>

fred(Person) {
    name = <span class="string"><span class="delimiter">&quot;</span><span class="content">Fred</span><span class="delimiter">&quot;</span></span>
    age = <span class="integer">45</span>
}

birthdayCardSenderAspect(BirthdayCardSender)

aop {
    config(<span class="string"><span class="delimiter">&quot;</span><span class="content">proxy-target-class</span><span class="delimiter">&quot;</span></span>: <span class="predefined-constant">true</span>) {
        aspect(<span class="key">id</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">sendBirthdayCard</span><span class="delimiter">&quot;</span></span>, <span class="key">ref</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">birthdayCardSenderAspect</span><span class="delimiter">&quot;</span></span>) {
            after <span class="key">method</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">onBirthday</span><span class="delimiter">&quot;</span></span>,
            <span class="key">pointcut</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">execution(void ..Person.birthday()) and this(person)</span><span class="delimiter">&quot;</span></span>
        }
    }
}</code></pre>
</div>
</div>
</div>

<a name="16.5 &#23646;&#24615;&#21344;&#20301;&#31526;&#37197;&#32622;"><!-- Legacy link --></a>
<h2 id="propertyPlaceholderConfiguration">19.4 属性占位符配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/spring/propertyPlaceholderConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails支持通过一个扩展属性占位符配置的概念版本的Spring的 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html">PropertyPlaceholderConfigurer</a>。</p>
</div>
<div class="paragraph">
<p>在 <a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/util/ConfigSlurper.html">ConfigSlurper</a> 中定义的设置或Java属性文件可以用作Spring配置的占位符值在 <code>grails-app/conf/spring/resources.xml</code>  和 <code>grails-app/conf/spring/resources.groovy</code> 。例如，在 <code>grails-app/conf/application.groovy</code> (或外部化配置)中给出以下条目。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">database.driver=<span class="string"><span class="delimiter">&quot;</span><span class="content">com.mysql.jdbc.Driver</span><span class="delimiter">&quot;</span></span>
database.dbname=<span class="string"><span class="delimiter">&quot;</span><span class="content">mysql:mydb</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后可以在 <code>resources.xml</code> 中指定占位符。使用熟悉的${..}语法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;bean</span> <span class="attribute-name">id</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">dataSource</span><span class="delimiter">&quot;</span></span>
      <span class="attribute-name">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.jdbc.datasource.DriverManagerDataSource</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">driverClassName</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>${database.driver}<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
    <span class="tag">&lt;property</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">url</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;value&gt;</span>jdbc:${database.dbname}<span class="tag">&lt;/value&gt;</span>
    <span class="tag">&lt;/property&gt;</span>
 <span class="tag">&lt;/bean&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在 <code>resources.groovy</code> 中指定占位符。你需要使用单引号:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource(org.springframework.jdbc.datasource.DriverManagerDataSource) {
    driverClassName = <span class="string"><span class="delimiter">'</span><span class="content">${database.driver}</span><span class="delimiter">'</span></span>
    url = <span class="string"><span class="delimiter">'</span><span class="content">jdbc:${database.dbname}</span><span class="delimiter">'</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将属性值设置为文字字符串，该字符串稍后由Spring的PropertyPlaceholderConfigurer根据配置解析。</p>
</div>
<div class="paragraph">
<p>资源的更好选择 <code>resources.groovy</code> 是通过 <code>grailsApplication</code> 变量来访问属性的:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dataSource(org.springframework.jdbc.datasource.DriverManagerDataSource) {
    driverClassName = grailsApplication.config.database.driver
    url = <span class="string"><span class="delimiter">&quot;</span><span class="content">jdbc</span><span class="content">\:</span><span class="inline"><span class="inline-delimiter">${</span>grailsApplication.config.database.dbname<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用此方法将保留配置中定义的类型。</p>
</div>

<a name="16.6 &#23646;&#24615;&#35206;&#30422;&#37197;&#32622;"><!-- Legacy link --></a>
<h2 id="propertyOverrideConfiguration">19.5 属性覆盖配置</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/spring/propertyOverrideConfiguration.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails支持通过 <a href="conf.html">configuration</a>设置bean属性。</p>
</div>
<div class="paragraph">
<p>定义一个 <code>bean</code> 块，其中包含bean的名称和它们的值:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans {
    bookService {
        webServiceURL = <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.amazon.com</span><span class="delimiter">&quot;</span></span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>一般格式为:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;&lt;bean name&gt;&gt;.&lt;&lt;property name&gt;&gt; = &lt;&lt;value&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Java属性文件中的相同配置是:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans.bookService.webServiceURL=<span class="key">http</span>:<span class="comment">//www.amazon.com</span></code></pre>
</div>
</div>


<h2 id="actuators">19.6 Spring Boot 执行器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/spring/actuators.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-endpoints.html">Spring Boot Actuator endpoints</a>允许您监视应用程序并与之交互。Spring Boot包含许多内置的端点。例如， <code>health</code> 端点提供基本的应用程序健康信息。</p>
</div>
<div class="paragraph">
<p>从grails 3.1.8开始，这些端点默认是禁用的。</p>
</div>
<div class="paragraph">
<p>您可以在 <code>application.yml</code> 启用执行器端点。如下:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">endpoints</span>:
    <span class="key">enabled</span>: <span class="string"><span class="content">true</span></span></code></pre>
</div>
</div>

<a name="18. &#33050;&#25163;&#26550;"><!-- Legacy link --></a>
<h1 id="scaffolding">20 脚手架</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/scaffolding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Scaffolding使您可以为域类生成一些基本的CRUD接口，包括：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>链接<a href="theWebLayer.html#gsp">views</a></p>
</li>
<li>
<p>用于create/read/update/delete（CRUD）操作的控制器操作</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>应用程序表达对Scaffolding插件的依赖性的方法是在 <code>build.gradle</code> 中包含以下内容。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">dependencies {
        <span class="comment">// ...</span>
        compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails.plugins:scaffolding</span><span class="delimiter">&quot;</span></span>
        <span class="comment">// ...</span>
    }</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_动态脚手架">动态脚手架</h4>
<div class="paragraph">
<p>开始使用Scaffolding的最简单方法是通过将控制器中的`scaffold`属性设置为特定的域类来启用它：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="directive">static</span> scaffold = <span class="predefined-type">Book</span>  <span class="comment">// 或任何其他域类，例如 &quot;Author&quot;, &quot;Publisher&quot;</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用此配置，当您启动应用程序时，操作和视图将在运行时自动生成。 默认情况下，运行时Scaffolding机制将动态实施以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>index</p>
</li>
<li>
<p>show</p>
</li>
<li>
<p>edit</p>
</li>
<li>
<p>delete</p>
</li>
<li>
<p>create</p>
</li>
<li>
<p>save</p>
</li>
<li>
<p>update</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>CRUD接口也将生成。 要访问此文件，请在浏览器中打开 <code>http//localhost:8080/book</code> 。
注意：定义 <code>scaffold</code> 属性的旧方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="directive">static</span> scaffold = <span class="predefined-constant">true</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在Grails 3.0之上不再受支持。
如果希望将域模型保持在Java和 <code><a href="https://hibernate.org/" class="bare">https://hibernate.org/</a></code> [与Hibernate映射]中，仍然可以使用Scaffolding，只需导入域类并将其名称设置为`scaffold`参数即可。
可以将新操作添加到Scaffolding控制器，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {

    <span class="directive">static</span> scaffold = <span class="predefined-type">Book</span>

    <span class="keyword">def</span> <span class="function">changeAuthor</span>() {
        <span class="keyword">def</span> b = <span class="predefined-type">Book</span>.get(params.id)
        b.author = Author.get(params[<span class="string"><span class="delimiter">&quot;</span><span class="content">author.id</span><span class="delimiter">&quot;</span></span>])
        b.save()

        <span class="comment">// redirect to a scaffolded action</span>
        redirect(<span class="key">action</span>:show)
     }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以覆盖scaffolded操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {

    <span class="directive">static</span> scaffold = <span class="predefined-type">Book</span>

    <span class="comment">// overrides scaffolded action to return both authors and books</span>
    <span class="keyword">def</span> <span class="function">index</span>() {
        [<span class="key">bookInstanceList</span>: <span class="predefined-type">Book</span>.list(),
         <span class="key">bookInstanceTotal</span>: <span class="predefined-type">Book</span>.count(),
         <span class="key">authorInstanceList</span>: Author.list()]
    }

    <span class="keyword">def</span> <span class="function">show</span>() {
        <span class="keyword">def</span> book = <span class="predefined-type">Book</span>.get(params.id)
        log.error(<span class="string"><span class="delimiter">&quot;</span><span class="content">{}</span><span class="delimiter">&quot;</span></span>, book)
        [bookInstance : book]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>所有这些就是所谓的"dynamic scaffolding"，其中CRUD接口在运行时动态生成。
NOTE: 默认情况下，scaffolded视图中文本区域的大小是在CSS中定义的，因此添加&#8217;行&#8217;和&#8217;列&#8217;属性将无效。
同样，标准的scaffold视图期望模型变量的形式为集合的 <code>&lt;propertyName&gt; InstanceList</code> ，以及单个实例的 <code>&lt;propertyName&gt; Instance</code> 。 使用 <code>books</code> 和 <code>book</code> 之类的属性很诱人，但这些属性不起作用。</p>
</div>
</div>
<div class="sect3">
<h4 id="_静态脚手架">静态脚手架</h4>
<div class="paragraph">
<p>Grails使您可以从命令行生成控制器和用于创建上述界面的视图。 生成控制器类型：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails generate-controller <span class="predefined-type">Book</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>或生成视图：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails generate-views <span class="predefined-type">Book</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>或生成一切：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails generate-all <span class="predefined-type">Book</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您在包中包含域类，或者是从 <code><a href="https://hibernate.org" class="bare">https://hibernate.org</a></code> [Hibernate映射类]生成，请记住包括标准包名称：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails generate-all com.bookstore.Book</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_自定义生成的视图">自定义生成的视图</h4>
<div class="paragraph">
<p>这些视图适用于<a href="constraints.html">Validation constraints</a>. 例如，只需更改构建器中的约束，即可更改字段在视图中显示的顺序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> constraints = {
    title()
    releaseDate()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用 <code>inList</code> 约束，还可以让生成器生成列表而不是文本输入：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> constraints = {
    title()
    category(<span class="key">inList</span>: [<span class="string"><span class="delimiter">&quot;</span><span class="content">Fiction</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Non-fiction</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Biography</span><span class="delimiter">&quot;</span></span>])
    releaseDate()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，如果对数字使用 <code>range</code> 约束：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> constraints = {
    age(<span class="key">range</span>:<span class="integer">18</span>..<span class="integer">65</span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>使用约束来限制大小也会影响在d视图中可以输入多少个字符：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> constraints = {
    name(<span class="key">size</span>:<span class="integer">0</span>..<span class="integer">30</span>)
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_字段插件">字段插件</h4>
<div class="paragraph">
<p>GrailsScaffolding模板利用The Fields插件。 生成scaffolding视图后，您可以使用插件提供的 <code>Taglib</code> 自定义表单和表格（有关详细信息，请参见Fields插件文档）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="error">&lt;</span>%-- Generate an HTML table from bookInstanceList, showing only 'title' and 'category' columns --%<span class="error">&gt;</span>
<span class="tag">&lt;f:table</span> <span class="attribute-name">collection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">bookInstanceList</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">properties</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">['title', 'category']</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_自定义scaffolding模板">自定义Scaffolding模板</h4>
<div class="paragraph">
<p>可以通过使用链接安装模板来定制Grails用来生成控制器和视图的模板：<a href="../ref/Command%20Line/install-templates.html">install-templates</a> .</p>
</div>
</div>

<a name="19. &#37096;&#32626;"><!-- Legacy link --></a>
<h1 id="deployment">21 部署</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/deployment.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails应用程序可以通过多种方式进行部署，每种方式都有其优缺点。</p>
</div>


<h2 id="deploymentStandalone">21.1 独立</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/deployment/deploymentStandalone.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="__grails_run_app">"grails run-app"</h3>
<div class="paragraph">
<p>您现在应该非常熟悉这种方法，因为它是在开发阶段运行应用程序的最常用方法。将启动嵌入式 Tomcat 服务器，该服务器从开发源中加载 Web 应用程序，从而使其可以接收对应用程序文件的任何更改。</p>
</div>
<div class="paragraph">
<p>您可以使用以下方法在生产环境中运行应用程序：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails prod run-app</code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用 <code>bootRun</code> Gradle任务运行该应用程序。 下一条命令使用 <a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html">Gradle Wrapper</a>。</p>
</div>
<div class="paragraph">
<p><code>./gradlew bootRun</code></p>
</div>
<div class="paragraph">
<p>您可以指定提供 <code>grails.env</code> 系统属性的环境。</p>
</div>
<div class="paragraph">
<p><code>./gradlew -Dgrails.env=prod bootRun</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_可执行的_war_或_jar_文件">可执行的 WAR 或 JAR 文件</h3>
<div class="paragraph">
<p>在 Grails 3.0 或更高版本中进行部署的另一种方法是对可运行的 JAR 或 WAR 文件使用新的支持。要创建可运行的档案，运行 <code>grails package</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">grails package</code></pre>
</div>
</div>
<div class="paragraph">
<p>或者，您可以使用 <code>assemble</code> Gradle 任务。</p>
</div>
<div class="paragraph">
<p><code>./gradlew assemble</code></p>
</div>
<div class="paragraph">
<p>然后，可以使用 Java 安装程序运行 WAR 文件或 JAR：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">java -Dgrails.env=prod -jar build/libs/mywar-<span class="float">0.1</span>.war  (<span class="error">或</span> .jar)</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_tar_zip_发行">TAR / ZIP 发行</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
注意：TAR / ZIP 发布组件已从 Grails 3.1 中删除。
</td>
</tr>
</table>
</div>
</div>


<h2 id="deploymentContainer">21.2 容器部署（例如，Tomcat）</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/deployment/deploymentContainer.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 应用程序可以部署到 Servlet 容器或应用程序服务器。</p>
</div>
<div class="sect2">
<h3 id="_war文件">WAR文件</h3>
<div class="paragraph">
<p>在生产中部署 Grails 应用程序的常见方法是通过 WAR 文件部署到现有的 Servlet 容器。容器允许将多个应用程序部署在具有不同路径的同一端口上。</p>
</div>
<div class="paragraph">
<p>创建WAR文件就像执行以下链接一样简单：<a href="../ref/Command%20Line/war.html">war</a> 命令:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails war</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将生成一个WAR文件，该文件可以部署到 <code>build/libs</code> 目录中的容器中。</p>
</div>
<div class="paragraph">
<p>请注意，默认情况下，Grails 会在 WAR 文件中包括 Tomcat 的可嵌入版本，以便它可以运行（请参阅上一节），如果您部署到其他版本的 Tomcat，则可能会导致问题。如果您不打算使用嵌入式容器，则应在将其部署到 <code>build.gradle</code> 中的生产容器之前，将Tomcat依赖项的范围更改为 <code>provided</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">provided <span class="string"><span class="delimiter">&quot;</span><span class="content">org.springframework.boot:spring-boot-starter-tomcat</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_应用服务器">应用服务器</h2>
<div class="sectionbody">
<div class="paragraph">
<p>理想情况下，您应该能够简单地将 Grails 创建的 WAR 文件拖放到任何应用程序服务器中，并且该文件应立即可用。但是，事情很少如此简单。 <a href="http://grails.org/Deployment">Grails website</a> 包含经过 Grails 测试的应用程序服务器列表，以及使 Grails WAR 文件正常工作所需的任何其他步骤。</p>
</div>
</div>
</div>


<h2 id="deploymentTasks">21.3 部署配置任务</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/deployment/deploymentTasks.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_设置_https_和_ssl_证书以进行独立部署">设置 HTTPS 和 SSL 证书以进行独立部署</h3>
<div class="paragraph">
<p>要配置 SSL 证书并在 HTTPS 端口而不是 HTTP 上进行侦听，请将以下属性添加到 <code>application.yml</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">server</span>:
    <span class="key">port</span>: <span class="integer">8443</span>                                             <span class="error">#</span> The port to listen on
    <span class="key">ssl</span>:
        <span class="key">enabled</span>: <span class="predefined-constant">true</span>                                      <span class="error">#</span> Activate HTTPS mode on the server port
        key-<span class="key">store</span>: &lt;the-location-of-your-keystore&gt;         <span class="error">#</span> e.g. <span class="regexp"><span class="delimiter">/</span><span class="content">etc</span><span class="delimiter">/</span></span>tomcat7/keystore/tomcat.keystore
        key-store-<span class="key">password</span>: &lt;your-key-store-password&gt;      <span class="error">#</span> e.g. changeit
        key-<span class="key">alias</span>: &lt;your-key-alias&gt;                        <span class="error">#</span> e.g. tomcat
        key-<span class="key">password</span>: &lt;usually-the-same-<span class="keyword">as</span>-your-key-store-password&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些设置控制用于生产部署的嵌入式 Tomcat 容器。或者，可以在命令行上指定属性。例: <code>-Dserver.ssl.enabled=true -Dserver.ssl.key-store=/path/to/keystore</code>。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
不支持通过应用程序属性配置 HTTP 和 HTTPS 连接器。如果要同时拥有两者，则需要以编程方式配置其中之一。（有关如何执行此操作的更多信息，请参见下面的操作指南。）
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>还有其他相关设置。进一步参考：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/howto-embedded-servlet-containers.html#howto-configure-ssl">Spring Boot: 如何在嵌入式Servlet容器上配置SSL</a></p>
</li>
<li>
<p><a href="https://docs.spring.io/spring-boot/docs/current/reference/html/common-application-properties.html">Spring Boot: 通用应用程序属性</a></p>
</li>
</ul>
</div>
</div>


<h1 id="contributing">22 给 Grails 贡献代码</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/contributing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails是一个拥有活跃社区的开源项目，我们在很大程度上依赖于该社区来帮助Grails变得更好。
因此，人们可以通过多种方式为Grails做出贡献。
其中之一是通过 <a href="plugins.html">编写有用的插件</a> 并使它们公开可用。
在本章中，我们将介绍其他一些选项。</p>
</div>


<h2 id="issues">22.1 在 Github 中报告问题</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/contributing/issues.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails 使用 Github 跟踪 <a href="https://github.com/grails/grails-core/issues">core framework</a> 中的问题。同样，其文档也有一个 <a href="https://github.com/grails/grails-doc/issues">separate tracker</a>。如果您发现了错误或希望看到添加的特定功能，那么可以从这些地方开始。您需要创建一个（免费）github 帐户，以便提交问题或对其中任何一个问题进行评论。</p>
</div>
<div class="paragraph">
<p>提交问题时，请提供尽可能多的信息，如果出现错误，请确保您解释了所使用的 Groovy、Grails 版本和各种插件。其他环境详细信息-操作系统版本，JDK、Gradle 等也应包括在内。此外，如果您在 github 存储库上载可复制的示例应用程序并提供问题链接，则更有可能解决该问题。</p>
</div>
<div class="sect2">
<h3 id="_正在审查问题">正在审查问题</h3>
<div class="paragraph">
<p>github中有很多旧问题，其中一些可能不再有效。核心团队无法单独跟踪这些问题，因此您可以做出的一个非常简单的贡献就是偶尔验证一个或两个问题。</p>
</div>
<div class="paragraph">
<p>哪些问题需要验证？转到 <a href="https://github.com/grails/grails-core/issues?q=is%3Aopen+is%3Aissue">issue tracker</a> 将显示所有尚未解决的问题。</p>
</div>
<div class="paragraph">
<p>确认问题后，只需添加简短的注释，说明发现的内容。确保提及您的环境详细</p>
</div>
</div>


<h2 id="build">22.2 从源代码编译并运行测试</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/contributing/build.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果您有兴趣为 grails 的任何部分提供修补程序和功能，则必须学习如何掌握项目的源代码，进行构建并使用自己的应用程序进行测试，开始之前,请确保您拥有：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A JDK (7 or above)</p>
</li>
<li>
<p>A git client</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>一旦安装了所有必备软件包，下一步就是下载 Grails 源代码，该源代码托管在 <a href="http://github.com">GitHub</a> 上拥有几个存储库中。 <a href="http://github.com/grails">"grails" GitHub user</a>。 这是克隆您感兴趣的存储库的简单案例。例如，要运行核心框架：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">git clone <span class="key">http</span>:github.com/grails/grails-core.git</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将在当前工作目录中创建一个包含所有项目源文件的 "grails-core" 目录。下一步是从源代码获取 Grails 安装。</p>
</div>
<div class="sect2">
<h3 id="_创建_grails_安装">创建 Grails 安装</h3>
<div class="paragraph">
<p>如果查看项目结构，您会发现它看起来不太像标准的 <code>GRILS_HOME</code> 安装。但是，将其转换过来非常简单。只需从项目的根目录运行此命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew install</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将获取 Grails 所需的所有标准依赖项，然后构建 <code>GRAILS_HOME</code> 安装。请注意，此目标跳过了广泛的 Grails 测试类集合，这可能需要一些时间才能完成。</p>
</div>
<div class="paragraph">
<p>上述命令完成后，只需将 <code>GRAILS_HOME</code> 环境变量设置到 checkout 目录,然后将 "bin" 目录添加到您的路径。当您下次输入 <code>grails</code> 命令运行时，将使用刚刚构建的版本。</p>
</div>
<div class="paragraph">
<p>如果您使用的是 <a href="http://sdkman.io">SDKMAN</a>, 则也可以通过以下方式将其用于此本地安装：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">sdk install grails dev /path/to/grails-core</code></pre>
</div>
</div>
<div class="paragraph">
<p>现在，您将在本地拥有一个开发版本，可用于测试功能。</p>
</div>
</div>
<div class="sect2">
<h3 id="_运行测试套件">运行测试套件</h3>
<div class="paragraph">
<p>运行全套测试所需要做的就是：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew test</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将花费一些时间（15-30分钟），因此请考虑使用命令行运行各个测试。例如，要运行测试规范 <code>BinaryPluginSpec</code> ，只需执行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew :grails-core:test --tests *.BinaryPluginSpec</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，您需要指定测试用例所在的子项目，因为顶级 "测试" 目标将不起作用。</p>
</div>
</div>
<div class="sect2">
<h3 id="_在_intellij_idea_中开发">在 IntelliJ IDEA 中开发</h3>
<div class="paragraph">
<p>您需要运行以下gradle任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew idea</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后打开在IDEA中生成的项目文件。 简单!</p>
</div>
</div>
<div class="sect2">
<h3 id="_在_sts_eclipse_中进行开发">在 STS / Eclipse 中进行开发</h3>
<div class="paragraph">
<p>您需要运行以下gradle任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">.<span class="regexp"><span class="delimiter">/</span><span class="content">gradlew cleanEclipse eclipse</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>在将项目导入 STS 之前，请执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>编辑 grails-scripts/.classpath 并删除 "&lt;classpathentry kind ="src" path ="../scripts"/&gt; 。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>使用 "Import&#8594;General&#8594;Existing Projects into Workspace" 将所有项目导入 STS，会有一些构建错误。要修复它们,请执行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>将 $GRAILS_HOME/lib/org.springsource.springloaded/springloaded-core/jars中的springloaded-core JAR 文件添加到 grails-core 的类路径中。</p>
</li>
<li>
<p>从 grails-plugin-testing 的源路径 GRECLIPSE-1067 中删除 "src/test/groovy"</p>
</li>
<li>
<p>将 $GRAILS_HOME/lib/javax.servlet.jsp/jsp-api/jars中的jsp-api JAR 文件添加到 grails-web 的类路径中</p>
</li>
<li>
<p>修复 grails-scripts 的源路径，添加链接到 "../scripts" 的链接源文件夹。如果在 grails 脚本中出现构建错误,请在该目录中执行 "../gradlew cleanEclipse eclipse"，然后再次编辑 .classpath 文件(删除 "&lt;classpathentry kind ="src" path ="../scripts"/&gt;").如果您无法添加链接的文件夹，请删除 grails-scripts 下可能的空 "scripts" 目录。</p>
</li>
<li>
<p>对整个工作区进行干净的构建。</p>
</li>
<li>
<p>要使用 Eclipse GIT scm team provider：在导航中选择所有项目("Servers"除外),然后右键单击&#8594; Team &#8594; Share project (not "Share projects")。选择 "Git"，然后选中 "Use or create repository in parent folder of project"，然后单击 "Finish"。</p>
</li>
<li>
<p>从 <a href="http://grails.1312388.n4.nabble.com/Grails-development-code-style-IDE-formatting-settings-tp3854216p3854216.html">mailing list thread</a> 中获取推荐的代码样式设置(最终样式尚未确定)但是，当前为 <a href="http://grails.1312388.n4.nabble.com/attachment/3854262/0/profile.xml">profile.xml</a>。在 Window &#8594; Preferences&#8594; Java&#8594; Code Style &#8594; Formatter &#8594; Import 中将代码样式 xml 文件导入 STS。 Grails 代码使用空格而不是制表符进行缩进。</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_调试_grails_或_grails应用程序">调试 Grails 或 Grails应用程序</h3>
<div class="paragraph">
<p>要启用调试，请运行：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails run-app --debug-jvm</code></pre>
</div>
</div>
<div class="paragraph">
<p>默认情况下，Grails 派生一个 JVM 来运行应用程序. <code>-debug-jvm</code> 参数使调试器与派生的 JVM 关联。为了将调试器附加到派生 JVM 的构建系统，请使用 <code>-debug</code> 选项：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails -debug run-app</code></pre>
</div>
</div>
</div>


<h2 id="patchesCore">22.3 将补丁提交到 Grails</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/contributing/patchesCore.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>如果要向项目提交补丁，则只需要将存储库 fork 到 GitHub 上，而不是直接克隆它。然后，您将对分支进行更改，并发送请求请求以供核心团队成员进行审核。</p>
</div>
<div class="sect2">
<h3 id="_分支和拉取请求">分支和拉取请求</h3>
<div class="paragraph">
<p><a href="http://github.com">GitHub</a> 的好处之一是您可以通过 <a href="https://help.github.com/articles/fork-a-repo/">forking the repository</a> 轻松地为项目做出贡献的方式和 <a href="https://help.github.com/articles/creating-a-pull-request/">sending pull requests</a> 进行更改。</p>
</div>
<div class="paragraph">
<p>以下是一些准则，可帮助确保快速处理您的请求并提供我们所需的信息。它们还将使您的生活更轻松！</p>
</div>
<div class="sect3">
<h4 id="_确保您的_fork_是最新的">确保您的 fork 是最新的</h4>
<div class="paragraph">
<p>对过时的来源进行更改不是一个好主意。其他人可能已经进行了更改。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">git pull upstream master</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_为您的更改创建本地分支">为您的更改创建本地分支</h4>
<div class="paragraph">
<p>如果您创建一个本地分支来进行更改，那么您的生活将会大大简化。例如，一旦您分叉存储库并在本地克隆该分叉，就执行</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">git checkout -b issue_123</code></pre>
</div>
</div>
<div class="paragraph">
<p>这将基于"master"分支创建一个名为 "issue_123" 的新本地分支。当然，您可以随意命名分支，但是一个好主意是引用与更改相关的 <code>GitHub</code> 问题编号。每个拉取请求都应该有自己的分支。</p>
</div>
</div>
<div class="sect3">
<h4 id="_为不重要的更改创建_github_问题">为不重要的更改创建 Github 问题</h4>
<div class="paragraph">
<p>对于任何不重要的更改，如果尚不存在，请在 github 上提出一个问题。这有助于我们跟踪 <code>Grails</code> 的每个新版本中进行了哪些更改。</p>
</div>
</div>
<div class="sect3">
<h4 id="_在提交消息中包含_github_的问题id">在提交消息中包含 github 的问题ID</h4>
<div class="paragraph">
<p>这似乎并不特别重要，但是在提交消息中具有 github 问题ID意味着我们可以在以后找到进行更改的原因。在与该问题有关的所有提交中都包含ID。如果提交与问题无关，则无需包含问题ID。</p>
</div>
</div>
<div class="sect3">
<h4 id="_再次确保您的_fork_是最新状态并重新设置基准">再次确保您的 fork 是最新状态并重新设置基准</h4>
<div class="paragraph">
<p>由于核心开发人员必须将您的提交合并到主存储库中，因此如果在发送拉取请求之前在GitHub上的fork是最新的，则可以使工作变得更加轻松。</p>
</div>
<div class="paragraph">
<p>假设您已将主存储库设置为名为"上游"的远程站点，并且要提交拉取请求。另外，所有更改当前都在本地 "issue_123" 分支上，但不在 "master" 上。第一步涉及从主存储库中提取自上次获取和合并以来已添加的所有更改：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">git checkout master
git pull upstream master</code></pre>
</div>
</div>
<div class="paragraph">
<p>这应该没有任何问题或冲突地完成。接下来，使用最新的主数据库重新建立本地分支的基础：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">git checkout issue_123
git rebase master</code></pre>
</div>
</div>
<div class="paragraph">
<p>这样做是对提交进行重新排列，使所有更改都紧随母版中的最新更改之后。可以考虑将一些卡片添加到牌组的顶部，而不是将它们混入包装中。</p>
</div>
</div>
<div class="sect3">
<h4 id="_将您的分支推送到_github_并发送请求请求">将您的分支推送到 GitHub 并发送请求请求</h4>
<div class="paragraph">
<p>最后，您必须将所做的更改推送到 GitHub上 的 fork 中，否则核心开发人员将无法将其提取：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">git push origin issue_123</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
您不应该将分支合并到 master。如果不接受请求请求，则您的主服务器将永远与上游不同步。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>现在您已经准备好从 GitHub 用户界面发送拉取请求。</p>
</div>
</div>
<div class="sect3">
<h4 id="_清晰描述您的请求是做什么的">清晰描述您的请求是做什么的</h4>
<div class="paragraph">
<p>拉取请求可以包含任意数量的提交，并且可能与任意数量的问题有关。在拉取请求消息中，请指定请求涉及的所有问题的ID。还简要说明您已完成的工作，例如："我重构了数据绑定器，并增加了对自定义数字编辑器的支持。修复了#xxxx"。</p>
</div>
</div>
</div>


<h2 id="patchesDoc">22.4 将修补程序提交到 Grails 文档</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/contributing/patchesDoc.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_贡献简单的改变">贡献简单的改变</h3>
<div class="paragraph">
<p>使用 <a href="http://asciidoctor.org/docs/user-manual/">Asciidoctor</a> 编写用户指南。提交修补程序的最简单方法是，只需单击文档各部分右侧的"改进此文档"链接。</p>
</div>
<div class="paragraph">
<p>这将链接到 <code>Github</code> 编辑屏幕，您可以在其中进行更改，预览并创建拉取请求。</p>
</div>
</div>
<div class="sect2">
<h3 id="_构建指南">构建指南</h3>
<div class="paragraph">
<p>如果要进行重大更改，例如更改目录的结构等，则建议您构建用户指南。为此，只需从 <code>github</code> 检出源代码：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ git clone https://github.com/grails/grails-doc/
$ cd grails-doc</code></pre>
</div>
</div>
<div class="paragraph">
<p>源文件可以在 <code>src/en/guide</code> 目录中找到。目录（TOC）是在 src/en/guide/toc.yml 文件中定义的。</p>
</div>
<div class="paragraph">
<p>每个 YAML 密钥都指向一个 Asciidoc 模板。例如，考虑以下YAML：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">introduction</span>:
  <span class="key">title</span>: <span class="string"><span class="content">Introduction</span></span>
  <span class="key">whatsNew</span>:
    <span class="key">title</span>: <span class="string"><span class="content">What's new in Grails 3.2?</span></span>
  <span class="error">...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>introduction</code> 键指向 "src/en/guide/introduction.adoc"。标题键定义在目录中分配的标题。因为 <code>whatsNew</code> 键嵌套在 <code>introduction</code> 键的下面，所以它指向 src/en/guide/introduction/whatsNew.adoc，它嵌套在一个名为 <code>introduction</code> 的目录中。</p>
</div>
<div class="paragraph">
<p>本质上，使用 <code>toc.yml</code> 文件和目录结构，您可以操纵用户指南的结构</p>
</div>
<div class="paragraph">
<p>要生成文档，请运行 <code>publishGuide</code> 任务：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./gradlew publishGuide -x apiDocs</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
在上面的示例中，我们跳过了 <code>apiDocs</code> 任务以加快指南的构建，否则所有 <code>Groovydoc</code> 文档也将被构建！
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>构建指南后，只需在浏览器中打开 "build/docs/index.html" 文件即可查看您的更改。</p>
</div>
</div>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/bug-report.html">bug-report</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/clean.html">clean</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/compile.html">compile</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/console.html">console</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-app.html">create-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-command.html">create-command</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-controller.html">create-controller</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-domain-class.html">create-domain-class</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-functional-test.html">create-functional-test</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-hibernate-cfg-xml.html">create-hibernate-cfg-xml</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-integration-test.html">create-integration-test</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-interceptor.html">create-interceptor</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-plugin.html">create-plugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-profile.html">create-profile</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-script.html">create-script</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-service.html">create-service</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-taglib.html">create-taglib</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/create-unit-test.html">create-unit-test</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/dependency-report.html">dependency-report</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/docs.html">docs</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/generate-all.html">generate-all</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/generate-controller.html">generate-controller</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/generate-views.html">generate-views</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/help.html">help</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/install-templates.html">install-templates</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/list-plugins.html">list-plugins</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/list-profiles.html">list-profiles</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/package-plugin.html">package-plugin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/package.html">package</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/plugin-info.html">plugin-info</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/profile-info.html">profile-info</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/run-app.html">run-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/run-command.html">run-command</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/run-script.html">run-script</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/schema-export.html">schema-export</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/shell.html">shell</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/stats.html">stats</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/stop-app.html">stop-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/test-app.html">test-app</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Command%20Line/war.html">war</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Constraints</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Constraints/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Constraints/attributes.html">attributes</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/bindable.html">bindable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/blank.html">blank</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/creditCard.html">creditCard</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/email.html">email</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/inList.html">inList</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/matches.html">matches</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/max.html">max</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/maxSize.html">maxSize</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/min.html">min</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/minSize.html">minSize</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/notEqual.html">notEqual</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/nullable.html">nullable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/range.html">range</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/scale.html">scale</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/size.html">size</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/unique.html">unique</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/url.html">url</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/validator.html">validator</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Constraints/widget.html">widget</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Controllers</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Controllers/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Controllers/actionName.html">actionName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/allowedMethods.html">allowedMethods</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/bindData.html">bindData</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/chain.html">chain</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/controllerName.html">controllerName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/defaultAction.html">defaultAction</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/errors.html">errors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/flash.html">flash</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/forward.html">forward</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/grailsApplication.html">grailsApplication</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/hasErrors.html">hasErrors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/namespace.html">namespace</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/params.html">params</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/redirect.html">redirect</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/render.html">render</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/request.html">request</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/respond.html">respond</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/response.html">response</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/responseFormats.html">responseFormats</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/scope.html">scope</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/servletContext.html">servletContext</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/session.html">session</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/withForm.html">withForm</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Controllers/withFormat.html">withFormat</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Database Mapping</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/autoImport.html">autoImport</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/autoTimestamp.html">autoTimestamp</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/batchSize.html">batchSize</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/cache.html">cache</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/cascade.html">cascade</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/column.html">column</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/comment.html">comment</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/discriminator.html">discriminator</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/dynamicInsert.html">dynamicInsert</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/dynamicUpdate.html">dynamicUpdate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/fetch.html">fetch</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/id.html">id</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/ignoreNotFound.html">ignoreNotFound</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/indexColumn.html">indexColumn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/insertable.html">insertable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/joinTable.html">joinTable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/lazy.html">lazy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/order.html">order</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/sort.html">sort</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/table.html">table</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/type.html">type</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/updateable.html">updateable</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Database%20Mapping/version.html">version</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/addTo.html">addTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/attach.html">attach</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/belongsTo.html">belongsTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/clearErrors.html">clearErrors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/constraints.html">constraints</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/count.html">count</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/countBy.html">countBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/createCriteria.html">createCriteria</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/delete.html">delete</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/discard.html">discard</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/embedded.html">embedded</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/errors.html">errors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/executeQuery.html">executeQuery</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/executeUpdate.html">executeUpdate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/exists.html">exists</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/fetchMode.html">fetchMode</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/find.html">find</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findAll.html">findAll</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findAllBy.html">findAllBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findAllWhere.html">findAllWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findBy.html">findBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrCreateBy.html">findOrCreateBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrCreateWhere.html">findOrCreateWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrSaveBy.html">findOrSaveBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findOrSaveWhere.html">findOrSaveWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findWhere.html">findWhere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/first.html">first</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/get.html">get</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/getAll.html">getAll</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/getDirtyPropertyNames.html">getDirtyPropertyNames</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/getPersistentValue.html">getPersistentValue</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/hasErrors.html">hasErrors</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/hasMany.html">hasMany</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/hasOne.html">hasOne</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/ident.html">ident</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/instanceOf.html">instanceOf</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/isAttached.html">isAttached</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/isDirty.html">isDirty</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/last.html">last</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/list.html">list</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/listOrderBy.html">listOrderBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/load.html">load</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/lock.html">lock</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/mapWith.html">mapWith</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/mappedBy.html">mappedBy</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/mapping.html">mapping</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/merge.html">merge</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/namedQueries.html">namedQueries</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/properties.html">properties</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/read.html">read</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/refresh.html">refresh</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/removeFrom.html">removeFrom</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/save.html">save</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/transients.html">transients</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/validate.html">validate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/where.html">where</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/whereAny.html">whereAny</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withCriteria.html">withCriteria</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withNewSession.html">withNewSession</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withSession.html">withSession</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withTransaction.html">withTransaction</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plug-ins</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/URL%20mappings.html">URL mappings</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/codecs.html">codecs</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/controllers.html">controllers</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/core.html">core</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/dataSource.html">dataSource</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/domainClasses.html">domainClasses</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/hibernate.html">hibernate</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/i18n.html">i18n</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/logging.html">logging</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/scaffolding.html">scaffolding</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/services.html">services</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Plug-ins/servlets.html">servlets</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Services</h1><div class="menu-sub">
                        
                        <div class="menu-item"><a href="../ref/Services/Usage.html">Usage</a></div>
                        
                        
                        <div class="menu-item"><a href="../ref/Services/scope.html">scope</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Services/transactional.html">transactional</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Servlet API</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/request.html">request</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/response.html">response</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/servletContext.html">servletContext</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Servlet%20API/session.html">session</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
