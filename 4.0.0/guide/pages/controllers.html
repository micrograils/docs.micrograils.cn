<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script src="/cdn-cgi/apps/head/3cOPSgo5Omz84ycX7CvigfX4cpw.js"></script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-82213539-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'UA-82213539-2');
    </script>
    <title>8.1 &#25511;&#21046;&#22120; 4.0.0</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        The Grails Framework
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/introduction.html"><strong>1</strong><span>&#31616;&#20171;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/gettingStarted.html"><strong>2</strong><span>&#20837;&#38376;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/upgrading.html"><strong>3</strong><span>&#20174; Grails 3.3.x &#21319;&#32423;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/conf.html"><strong>4</strong><span>&#37197;&#32622;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/commandLine.html"><strong>5</strong><span>&#21629;&#20196;&#34892;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/profiles.html"><strong>6</strong><span>&#24212;&#29992;&#31243;&#24207;&#37197;&#32622;&#25991;&#20214;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/GORM.html"><strong>7</strong><span>&#23545;&#35937;&#20851;&#31995;&#26144;&#23556; &#65288;GORM&#65289;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/theWebLayer.html"><strong>8</strong><span>Web &#23618;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/traits.html"><strong>9</strong><span>&#29305;&#24449;&#65288;Trait&#65289;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/REST.html"><strong>10</strong><span>REST</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/async.html"><strong>11</strong><span>&#24322;&#27493;&#32534;&#31243;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/validation.html"><strong>12</strong><span>&#39564;&#35777;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/services.html"><strong>13</strong><span>&#26381;&#21153;&#23618;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/staticTypeCheckingAndCompilation.html"><strong>14</strong><span>&#38745;&#24577;&#31867;&#22411;&#26816;&#26597;&#21644;&#32534;&#35793;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/testing.html"><strong>15</strong><span>&#27979;&#35797;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/i18n.html"><strong>16</strong><span>&#22269;&#38469;&#21270;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/security.html"><strong>17</strong><span>&#23433;&#20840;&#24615;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/plugins.html"><strong>18</strong><span>&#25554;&#20214;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/spring.html"><strong>19</strong><span>Grails &#19982; Spring</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/scaffolding.html"><strong>20</strong><span>&#33050;&#25163;&#26550;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/deployment.html"><strong>21</strong><span>&#37096;&#32626;</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../../guide/contributing.html"><strong>22</strong><span>&#32473; Grails &#36129;&#29486;&#20195;&#30721;</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
            <li class="separator selected">
                <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../../guide/GORM.html">&lt;&lt; <strong>7</strong><span>&#23545;&#35937;&#20851;&#31995;&#26144;&#23556; &#65288;GORM&#65289;</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../../guide/traits.html"><strong>9</strong><span>&#29305;&#24449;&#65288;Trait&#65289;</span> >></a></div>
                


                <div class="project">
                    <h1>8.1 &#25511;&#21046;&#22120;</h1>

                    <p><strong>Version:</strong> 4.0.0</p>
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#understandingControllersAndActions"><strong>8.1</strong><span>&#20102;&#35299;&#25511;&#21046;&#22120;&#21644;&#25805;&#20316;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#controllersAndScopes"><strong>8.2</strong><span>&#25511;&#21046;&#22120;&#21644;&#20316;&#29992;&#22495;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#modelsAndViews"><strong>8.3</strong><span>&#27169;&#22411;&#21644;&#35270;&#22270;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#redirectsAndChaining"><strong>8.4</strong><span>&#37325;&#23450;&#21521;&#21644;&#38142;&#25509;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#dataBinding"><strong>8.5</strong><span>&#25968;&#25454;&#32465;&#23450;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#jsonResponses"><strong>8.6</strong><span>&#20351;&#29992; JSON &#21709;&#24212;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#moreOnJSONBuilder"><strong>8.7</strong><span>&#20851;&#20110; JSONBuilder</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#xmlResponses"><strong>8.8</strong><span>&#20351;&#29992; XML &#21709;&#24212;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#uploadingFiles"><strong>8.9</strong><span>&#19978;&#20256;&#25991;&#20214;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#commandObjects"><strong>8.10</strong><span>&#21629;&#20196;&#23545;&#35937;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#formtokens"><strong>8.11</strong><span>&#22788;&#29702;&#37325;&#22797;&#34920;&#21333;&#25552;&#20132;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#typeConverters"><strong>8.12</strong><span>&#22522;&#26412;&#31867;&#22411;&#36716;&#25442;&#22120;</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#controllerExceptionHandling"><strong>8.13</strong><span>&#22768;&#26126;&#24615;&#25511;&#21046;&#22120;&#24322;&#24120;&#22788;&#29702;</span></a>
                    </div>
                    
                </div>
                

                
<a name="7.1 &#25511;&#21046;&#22120;"><!-- Legacy link --></a>
<h2 id="controllers">8.1 控制器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>控制器处理请求并创建或准备响应。 控制器可以直接生成响应或委托给视图。 要创建控制器，只需在 <code>grails-app/controllers</code> 目录（如果在软件包中，则在子目录中）中创建一个名称以 <code>Controller</code> 结尾的类。</p>
</div>
<div class="paragraph">
<p>默认的 <a href="#urlmappings">URL Mapping</a> 配置可确保将控制器名称的第一部分映射到URI，并且在控制器中定义的每个操作都将映射到控制器名称URI中的URI。</p>
</div>

<a name="7.1.1 &#20102;&#35299;&#25511;&#21046;&#22120;&#21644;&#25805;&#20316;"><!-- Legacy link --></a>
<h2 id="understandingControllersAndActions">8.1.1 了解控制器和操作</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/understandingControllersAndActions.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_creating_a_controller">Creating a controller</h4>
<div class="paragraph">
<p>可以 <a href="../ref/Command％20Line/create-controller.html">create-controller</a> 或 <a href="../ref/Command％20Lin/generate-controller.html">generate-controller</a> 命令创建控制器 。 例如，尝试从Grails项目的根目录运行以下命令：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">grails create-controller book</code></pre>
</div>
</div>
<div class="paragraph">
<p>该命令将在 <code>grails-app/controllers/myapp/BookController.groovy</code> 位置创建一个控制器：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> myapp

<span class="type">class</span> <span class="class">BookController</span> {

    <span class="keyword">def</span> <span class="function">index</span>() { }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>其中 <code>myapp</code> 将是你的应用程序的名称，如果未指定，则为默认软件包名称。
默认情况下，<code>BookController</code> 映射到/book URI（相对于你的应用程序根目录）。</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>create-controller</code> 和 <code>generate-controller</code> 命令只是为了方便起见，也可以使用自己喜欢的文本编辑器或IDE轻松创建控制器。
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_创建动作">创建动作</h4>
<div class="paragraph">
<p>一个控制者可以有多种公共行动方法。 每个映射到一个URI：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {

    <span class="keyword">def</span> <span class="function">list</span>() {

        <span class="comment">// do controller logic</span>
        <span class="comment">// create model</span>

        <span class="keyword">return</span> model
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于该属性被命名为 <code>list</code> ，因此该示例默认情况下映射到 <code>/book/list</code> URI</p>
</div>
</div>
<div class="sect3">
<h4 id="_默认动作">默认动作</h4>
<div class="paragraph">
<p>控制器具有默认URI的概念，该默认URI映射到控制器的根URI，例如，<code>/book</code> 代表 <code>BookController</code> ，请求默认URI时调用的操作由以下规则决定：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>如果只有一个action，则为默认</p>
</li>
<li>
<p>如果有一个名为 <code>index</code> 的动作，则为默认</p>
</li>
<li>
<p>或者，可以使用 <code>defaultAction</code> 属性显式设置</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> defaultAction = <span class="string"><span class="delimiter">&quot;</span><span class="content">list</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
</div>

<a name="7.1.2 &#25511;&#21046;&#22120;&#21644;&#20316;&#29992;&#22495;"><!-- Legacy link --></a>
<h2 id="controllersAndScopes">8.1.2 控制器和作用域</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/controllersAndScopes.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_可用范围">可用范围</h4>
<div class="paragraph">
<p>范围是类似于哈希的对象，您可以在其中存储变量。以下作用域可用于控制器：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../ref/Controllers/servletContext.html">servletContext</a> - 也称为应用程序范围，此范围使您可以在整个Web应用程序之间共享状态。servletContext是 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/ServletContext.html">ServletContext</a> 的实例</p>
</li>
<li>
<p><a href="../ref/Controllers/session.html">session</a> - 会话允许将状态与给定用户相关联，并且通常使用Cookie将会话与客户端相关联。会话对象是 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpSession.html">HttpSession</a> 的实例</p>
</li>
<li>
<p><a href="../ref/Controllers/request.html">request</a> - 请求对象仅允许存储当前请求的对象。请求对象是 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html">HttpServletRequest</a> 的实例</p>
</li>
<li>
<p><a href="../ref/Controllers/params.html">params</a> - 传入请求查询字符串或POST参数的可变映射</p>
</li>
<li>
<p><a href="../ref/Controllers/flash.html">flash</a> - 参见下文</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_访问范围">访问范围</h4>
<div class="paragraph">
<p>可以使用上面的变量名结合Groovy的数组索引运算符来访问作用域，即使在Servlet API提供的类上，例如 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletRequest.html">HttpServletRequest</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">find</span>() {
        <span class="keyword">def</span> findBy = params[<span class="string"><span class="delimiter">&quot;</span><span class="content">findBy</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">def</span> appContext = request[<span class="string"><span class="delimiter">&quot;</span><span class="content">foo</span><span class="delimiter">&quot;</span></span>]
        <span class="keyword">def</span> loggedUser = session[<span class="string"><span class="delimiter">&quot;</span><span class="content">logged_user</span><span class="delimiter">&quot;</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您还可以使用取消引用运算符访问范围内的值，从而使语法更加清晰：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">find</span>() {
        <span class="keyword">def</span> findBy = params.findBy
        <span class="keyword">def</span> appContext = request.foo
        <span class="keyword">def</span> loggedUser = session.logged_user
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这是Grails统一访问不同范围的方式之一。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用flash范围">使用Flash范围</h4>
<div class="paragraph">
<p>Grails支持将 <a href="../ref/Controllers/flash.html">flash</a> 作用域作为临时存储区的概念，以使该属性仅可用于此请求和下一个请求。然后清除属性。这对于直接在重定向之前设置消息很有用，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre>def delete() {
    def b = Book.get(params.id)
    if (!b) {
        flash.message = "User not found for id ${params.id}"
        redirect(action:list)
    }
    ... // remaining code
}</pre>
</div>
</div>
<div class="paragraph">
<p>当请求 <code>delete</code> 动作时，<code>message</code> 值将在范围内，可用于显示信息消息。在第二次请求后，它将被从 <code>flash</code> 作用域中删除。</p>
</div>
<div class="paragraph">
<p>请注意，属性名称可以是任何您想要的名称，并且值通常是用于显示消息的字符串，但可以是任何对象类型。</p>
</div>
</div>
<div class="sect3">
<h4 id="_作用域控制器">作用域控制器</h4>
<div class="paragraph">
<p>新创建的应用程序在 <code>application.yml</code> 中将 <code>grails.controllers.defaultScope</code> 属性设置为"singleton"。您可以将此值更改为任何
下面列出的受支持范围。如果根本没有为属性分配任何值，则控制器将默认为"prototype"范围。</p>
</div>
<div class="paragraph">
<p>支持的控制器范围是：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>prototype</code> （默认）-将为每个请求创建一个新的控制器（建议将其作为“闭合”属性使用）</p>
</li>
<li>
<p><code>session</code> - 为用户会话的范围创建一个控制器</p>
</li>
<li>
<p><code>singleton</code> - 控制器仅存在一个实例（建议将操作作为方法使用）</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>要启用其中一个作用域，请使用上面列出的有效作用域值之一向您的类添加静态 <code>scope</code> 属性，例如</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="directive">static</span> scope = <span class="string"><span class="delimiter">&quot;</span><span class="content">singleton</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>您可以使用 <code>grails.controllers.defaultScope</code> 键在 <code>application.yml</code> 中定义默认策略，例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">controllers</span>:
        <span class="key">defaultScope</span>: singleton</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
明智地使用作用域控制器。例如，我们不建议在单例作用域的控制器中包含任何属性，因为它们将为_all_请求共享。
</td>
</tr>
</table>
</div>
</div>

<a name="7.1.3 &#27169;&#22411;&#21644;&#35270;&#22270;"><!-- Legacy link --></a>
<h2 id="modelsAndViews">8.1.3 模型和视图</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/modelsAndViews.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_退回模型">退回模型</h4>
<div class="paragraph">
<p>模型是视图在渲染时使用的Map。 该Map中的键对应于视图可访问的变量名。 有两种返回模型的方法。 首先，您可以显式返回Map实例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
上面的内容不会_not_反映您应该在脚手架视图中使用的内容-有关更多详细信息，请参见 <a href="scaffolding.html">scaffolding section</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>一种更高级的方法是返回Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/ModelAndView.html">ModelAndView</a> 类的实例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">org.springframework.web.servlet.ModelAndView</span>

<span class="keyword">def</span> <span class="function">index</span>() {
    <span class="comment">// get some books just for the index page, perhaps your favorites</span>
    <span class="keyword">def</span> favoriteBooks = ...

    <span class="comment">// forward to the list view to show them</span>
    <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string"><span class="delimiter">&quot;</span><span class="content">/book/list</span><span class="delimiter">&quot;</span></span>, [ bookList : favoriteBooks ])
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要记住的一件事是某些变量名称不能在模型中使用:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>attributes</code></p>
</li>
<li>
<p><code>application</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>目前，如果您使用它们，将不会报告任何错误，但是希望在将来的Grails版本中会有所改变.</p>
</div>
</div>
<div class="sect3">
<h4 id="_选择视图">选择视图</h4>
<div class="paragraph">
<p>在前两个示例中，没有代码指定要呈现的 <a href="#gsp">view</a> . 那么Grails如何知道该选哪个呢？ 答案在于约定。 Grails将在此 <code>show</code> 操作中在 <code>grails-app/views/book/show.gsp</code> 位置查找视图:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">show</span>() {
         [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>要渲染其他视图，请使用 <a href="../ref/Controllers/render.html">render</a> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    <span class="keyword">def</span> map = [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
    render(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">display</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: map)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，Grails将尝试在该位置
渲染视图 <code>grails-app/views/book/display.gsp</code>. 请注意，Grails会自动通过 <code>grails-app/views</code> 目录的 <code>book</code> 目录限定视图位置。 这很方便，但是要访问共享视图，请使用绝对路径而不是相对路径:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">show</span>() {
    <span class="keyword">def</span> map = [<span class="key">book</span>: <span class="predefined-type">Book</span>.get(params.id)]
    render(<span class="key">view</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/shared/display</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: map)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，Grails将尝试在该位置渲染视图 <code>grails-app/views/shared/display.gsp</code>.</p>
</div>
<div class="paragraph">
<p>Grails还支持将JSP用作视图，因此，如果在预期的位置找不到GSP，但是在JSP所在的位置，则会使用它.</p>
</div>
</div>
<div class="sect3">
<h4 id="_为命名空间的控制器选择视图">为命名空间的控制器选择视图</h4>
<div class="paragraph">
<p>如果控制器使用 <a href="#namespacedControllers">namespace</a> 属性为其自身定义了名称空间，这将影响Grails在根目录中查找用相对路径指定的视图的根目录.  由命名空间控制器呈现的视图的默认根目录为 <code>grails-app/views/&lt;namespace name&gt;/&lt;controller name&gt;/</code>.  如果在命名空间目录中找不到该视图，则Grails将回退以在非命名空间目录中查找该视图.</p>
</div>
<div class="paragraph">
<p>参见下面的例子.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ReportingController</span> {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">'</span><span class="content">business</span><span class="delimiter">'</span></span>

    <span class="keyword">def</span> <span class="function">humanResources</span>() {
        <span class="comment">// This will render grails-app/views/business/reporting/humanResources.gsp</span>
        <span class="comment">// if it exists.</span>

        <span class="comment">// If grails-app/views/business/reporting/humanResources.gsp does not</span>
        <span class="comment">// exist the fallback will be grails-app/views/reporting/humanResources.gsp.</span>

        <span class="comment">// The namespaced GSP will take precedence over the non-namespaced GSP.</span>

        [<span class="key">numberOfEmployees</span>: <span class="integer">9</span>]
    }


    <span class="keyword">def</span> <span class="function">accountsReceivable</span>() {
        <span class="comment">// This will render grails-app/views/business/reporting/numberCrunch.gsp</span>
        <span class="comment">// if it exists.</span>

        <span class="comment">// If grails-app/views/business/reporting/numberCrunch.gsp does not</span>
        <span class="comment">// exist the fallback will be grails-app/views/reporting/numberCrunch.gsp.</span>

        <span class="comment">// The namespaced GSP will take precedence over the non-namespaced GSP.</span>

        render <span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">numberCrunch</span><span class="delimiter">'</span></span>, <span class="key">model</span>: [<span class="key">numberOfEmployees</span>: <span class="integer">13</span>]
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_呈现回应">呈现回应</h4>
<div class="paragraph">
<p>有时，直接从控制器将文本或代码片段呈现给响应会更容易（例如，对于Ajax应用程序）。 为此，可以使用高度灵活的 <code>render</code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">render <span class="string"><span class="delimiter">&quot;</span><span class="content">Hello World!</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的代码写了文本"Hello World！"。 回应。 其他例子包括:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// write some markup</span>
render {
   <span class="keyword">for</span> (b <span class="keyword">in</span> books) {
      div(<span class="key">id</span>: b.id, b.title)
   }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// render a specific view</span>
render(<span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">show</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// render a template for each item in a collection</span>
render(<span class="key">template</span>: <span class="string"><span class="delimiter">'</span><span class="content">book_template</span><span class="delimiter">'</span></span>, <span class="key">collection</span>: <span class="predefined-type">Book</span>.list())</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// render some text with encoding and content type</span>
render(<span class="key">text</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;xml&gt;some xml&lt;/xml&gt;</span><span class="delimiter">&quot;</span></span>, <span class="key">contentType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">text/xml</span><span class="delimiter">&quot;</span></span>, <span class="key">encoding</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">UTF-8</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果计划使用Groovy的 <code>MarkupBuilder</code> 来生成与 <code>render</code> 方法一起使用的HTML，请小心命名HTML元素和Grails标签之间的冲突。例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">groovy.xml.MarkupBuilder</span>
...
def login() {
    <span class="keyword">def</span> writer = <span class="keyword">new</span> <span class="predefined-type">StringWriter</span>()
    <span class="keyword">def</span> builder = <span class="keyword">new</span> MarkupBuilder(writer)
    builder.html {
        head {
            title <span class="string"><span class="delimiter">'</span><span class="content">Log in</span><span class="delimiter">'</span></span>
        }
        body {
            h1 <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
            form {
            }
        }
    }

    <span class="keyword">def</span> html = writer.toString()
    render html
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>实际上，这将 <a href="#tagsAsMethodCalls">call the form tag</a> 它将返回一些文本，这些文本将被 <code>MarkupBuilder</code> 忽略）。 要正确输出 <code>&lt;form&gt;</code> 元素，请使用以下命令:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">login</span>() {
    <span class="comment">// ...</span>
    body {
        h1 <span class="string"><span class="delimiter">'</span><span class="content">Hello</span><span class="delimiter">'</span></span>
        builder.form {
        }
    }
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
</div>

<a name="7.1.4 &#37325;&#23450;&#21521;&#21644;&#38142;&#25509;"><!-- Legacy link --></a>
<h2 id="redirectsAndChaining">8.1.4 重定向和链接</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/redirectsAndChaining.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_重新导向">重新导向</h4>
<div class="paragraph">
<p>可以使用 <a href="../ref/Controllers/redirect.html">redirect</a> 控制器方式:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">OverviewController</span> {

    <span class="keyword">def</span> <span class="function">login</span>() {}

    <span class="keyword">def</span> <span class="function">find</span>() {
        <span class="keyword">if</span> (!session.user)
            redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">login</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>内部 <a href="../ref/Controllers/redirect.html">redirect</a> 方法使用 <a href="https://docs.oracle.com/javaee/7/api/javax/servlet/http/HttpServletResponse.html">HttpServletResponse</a> 对象的 <code>sendRedirect</code> 方法.</p>
</div>
<div class="paragraph">
<p><code>redirect</code> 方法期望以下之一:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>动作名称（如果不是当前控制器中的重定向，则为控制器名称）:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Also redirects to the index action in the home controller</span>
redirect(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">home</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">index</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>相对于应用程序上下文路径的资源的URI:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Redirect to an explicit URI</span>
redirect(<span class="key">uri</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/login.html</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>或完整网址:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Redirect to a URL</span>
redirect(<span class="key">url</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://grails.org</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="GORM.html">domain class</a> 实例:</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// Redirect to the domain instance</span>
<span class="predefined-type">Book</span> book = ... <span class="comment">// obtain a domain instance</span>
redirect book</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，Grails将使用域类 <code>id</code> 来构造链接(如果存在).</p>
</div>
<div class="paragraph">
<p>可以选择使用方法的参数 <code>params</code> 从一个动作传递到下一个动作:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">myaction</span><span class="delimiter">'</span></span>, <span class="key">params</span>: [<span class="key">myparam</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">myvalue</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些参数可通过链接 <a href="../ref/Controllers/params.html">params</a> 动态属性访问请求参数。 如果使用与请求参数相同的名称指定了参数，则将覆盖请求参数并使用控制器参数.</p>
</div>
<div class="paragraph">
<p>由于 <code>params</code> 对象是Map，因此您可以使用它将当前请求参数从一个操作传递到下一个操作:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">next</span><span class="delimiter">&quot;</span></span>, <span class="key">params</span>: params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，您还可以在目标URI中包含一个片段:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">redirect(<span class="key">controller</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">test</span><span class="delimiter">&quot;</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">show</span><span class="delimiter">&quot;</span></span>, <span class="key">fragment</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">profile</span><span class="delimiter">&quot;</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>它将（取决于URL映射）重定向到类似"/myapp/test/show#profile"的内容.</p>
</div>
</div>
<div class="sect3">
<h4 id="_chaining">Chaining</h4>
<div class="paragraph">
<p>动作也可以被链接。 链接允许将模型从一个动作保留到另一个动作。 例如，在此操作中调用 <code>first</code> 操作:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ExampleChainController</span> {

    <span class="keyword">def</span> <span class="function">first</span>() {
        chain(<span class="key">action</span>: second, <span class="key">model</span>: [<span class="key">one</span>: <span class="integer">1</span>])
    }

    <span class="keyword">def</span> <span class="function">second</span> () {
        chain(<span class="key">action</span>: third, <span class="key">model</span>: [<span class="key">two</span>: <span class="integer">2</span>])
    }

    <span class="keyword">def</span> <span class="function">third</span>() {
        [<span class="key">three</span>: <span class="integer">3</span>])
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>结果在模型中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[<span class="key">one</span>: <span class="integer">1</span>, <span class="key">two</span>: <span class="integer">2</span>, <span class="key">three</span>: <span class="integer">3</span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以使用 <code>chainModel</code> 映射在链中的后续控制器操作中访问模型。 该动态属性仅存在于调用 <code>chain</code> 方法之后的动作中:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">ChainController</span> {

    <span class="keyword">def</span> <span class="function">nextInChain</span>() {
        <span class="keyword">def</span> model = chainModel.myModel
        ...
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>像 <code>redirect</code> 方法一样，您也可以将参数传递给 <code>chain</code> 方法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">chain(<span class="key">action</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">action1</span><span class="delimiter">&quot;</span></span>, <span class="key">model</span>: [<span class="key">one</span>: <span class="integer">1</span>], <span class="key">params</span>: [<span class="key">myparam</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">param1</span><span class="delimiter">&quot;</span></span>])</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
chain方法使用HTTP会话，因此仅在您的应用程序是有状态的时才应使用.
</td>
</tr>
</table>
</div>
</div>

<a name="7.1.6 &#25968;&#25454;&#32465;&#23450;"><!-- Legacy link --></a>
<h2 id="dataBinding">8.1.5 数据绑定</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/dataBinding.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>数据绑定是将传入请求参数"binding"到对象或对象的整个图上的行为。 数据绑定应处理所有必要的类型转换，因为通常由表单提交提供的请求参数始终是字符串，而Groovy或Java对象的属性可能不是.</p>
</div>
<div class="sect3">
<h4 id="_基于地图的绑定">基于地图的绑定</h4>
<div class="paragraph">
<p>数据绑定器能够将Map中的值转换并分配给对象的属性。 绑定器将使用Map中的键将Map中的条目与对象的属性相关联，这些键的值与对象上的属性名称相对应。 以下代码演示了基础知识:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/Person.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">Integer</span> age
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">63</span>]

<span class="keyword">def</span> person = <span class="keyword">new</span> Person(bindingMap)

<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.lastName == <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.age == <span class="integer">63</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>要更新域对象的属性，您可以将Map分配给域类的 <code>properties</code> 属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">63</span>]

<span class="keyword">def</span> person = Person.get(someId)
person.properties = bindingMap

<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.lastName == <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.age == <span class="integer">63</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>活页夹可以使用Maps of Maps填充对象的完整图.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    <span class="predefined-type">String</span> lastName
    <span class="predefined-type">Integer</span> age
    Address homeAddress
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> county
    <span class="predefined-type">String</span> country
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>, <span class="key">lastName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>, <span class="key">age</span>: <span class="integer">63</span>, <span class="key">homeAddress</span>: [<span class="key">county</span>: <span class="string"><span class="delimiter">'</span><span class="content">Surrey</span><span class="delimiter">'</span></span>, <span class="key">country</span>: <span class="string"><span class="delimiter">'</span><span class="content">England</span><span class="delimiter">'</span></span>] ]

<span class="keyword">def</span> person = <span class="keyword">new</span> Person(bindingMap)

<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Peter</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.lastName == <span class="string"><span class="delimiter">'</span><span class="content">Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.age == <span class="integer">63</span>
<span class="keyword">assert</span> person.homeAddress.county == <span class="string"><span class="delimiter">'</span><span class="content">Surrey</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.homeAddress.country == <span class="string"><span class="delimiter">'</span><span class="content">England</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_绑定到收藏夹和地图">绑定到收藏夹和地图</h4>
<div class="paragraph">
<p>数据绑定器可以填充和更新Collections 和 Maps。 以下代码显示了在域类中填充对象的 <code>List</code> 的简单示例:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Band</span> {
    <span class="predefined-type">String</span> name
    <span class="directive">static</span> hasMany = [<span class="key">albums</span>: Album]
    <span class="predefined-type">List</span> albums
}

<span class="type">class</span> <span class="class">Album</span> {
    <span class="predefined-type">String</span> title
    <span class="predefined-type">Integer</span> numberOfTracks
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Genesis</span><span class="delimiter">'</span></span>,
                  <span class="string"><span class="delimiter">'</span><span class="content">albums[0]</span><span class="delimiter">'</span></span>: [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Foxtrot</span><span class="delimiter">'</span></span>, <span class="key">numberOfTracks</span>: <span class="integer">6</span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">albums[1]</span><span class="delimiter">'</span></span>: [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Nursery Cryme</span><span class="delimiter">'</span></span>, <span class="key">numberOfTracks</span>: <span class="integer">7</span>]]

<span class="keyword">def</span> band = <span class="keyword">new</span> Band(bindingMap)

<span class="keyword">assert</span> band.name == <span class="string"><span class="delimiter">'</span><span class="content">Genesis</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> band.albums.size() == <span class="integer">2</span>
<span class="keyword">assert</span> band.albums[<span class="integer">0</span>].title == <span class="string"><span class="delimiter">'</span><span class="content">Foxtrot</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> band.albums[<span class="integer">0</span>].numberOfTracks == <span class="integer">6</span>
<span class="keyword">assert</span> band.albums[<span class="integer">1</span>].title == <span class="string"><span class="delimiter">'</span><span class="content">Nursery Cryme</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> band.albums[<span class="integer">1</span>].numberOfTracks == <span class="integer">7</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果 <code>albums</code> 是数组而不是 <code>List</code>，则该代码将以相同的方式工作.</p>
</div>
<div class="paragraph">
<p>请注意，当绑定到 <code>Set</code> 时，将Map绑定到Set的结构与将 <code>Map</code> 绑定到 <code>List</code> 的结构相同，但是由于 <code>Set</code>  是无序的，因此 索引不一定与 <code>Set</code> 中元素的顺序相对应。 在上面的代码示例中，如果 <code>albums</code> 是 <code>Set</code> 而不是 <code>List</code>，则 <code>bindingMap</code> 可能看起来完全相同，但 <code>bindingMap</code>  可能是 <code>Set</code> 中的第一张专辑，也可能是第二。 当更新 <code>Set</code> 中的现有元素时，分配给 <code>Set</code> 的 <code>Map</code> 必须包含其中的id元素，这些id代表要更新 <code>Set</code> 中的元素，如以下示例所示:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">/*
 * The value of the indexes 0 and 1 in albums[0] and albums[1] are arbitrary
 * values that can be anything as long as they are unique within the Map.
 * They do not correspond to the order of elements in albums because albums
 * is a Set.
 */</span>
<span class="keyword">def</span> bindingMap = [<span class="string"><span class="delimiter">'</span><span class="content">albums[0]</span><span class="delimiter">'</span></span>: [<span class="key">id</span>: <span class="integer">9</span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>]
                  <span class="string"><span class="delimiter">'</span><span class="content">albums[1]</span><span class="delimiter">'</span></span>: [<span class="key">id</span>: <span class="integer">4</span>, <span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">Selling England By The Pound</span><span class="delimiter">'</span></span>]]

<span class="keyword">def</span> band = Band.get(someBandId)

<span class="comment">/*
 * This will find the Album in albums that has an id of 9 and will set its title
 * to 'The Lamb Lies Down On Broadway' and will find the Album in albums that has
 * an id of 4 and set its title to 'Selling England By The Pound'.  In both
 * cases if the Album cannot be found in albums then the album will be retrieved
 * from the database by id, the Album will be added to albums and will be updated
 * with the values described above.  If a Album with the specified id cannot be
 * found in the database, then a binding error will be created and associated
 * with the band object.  More on binding errors later.
 */</span>
band.properties = bindingMap</code></pre>
</div>
</div>
<div class="paragraph">
<p>当绑定到 <code>Map</code> 时，绑定 <code>Map</code> 的结构与用于绑定到 <code>List</code>  或 <code>Set</code> 的 <code>Map</code> 的结构相同，方括号内的索引对应于键 在绑定到的 <code>Map</code> 中。 看下面的代码:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Album</span> {
    <span class="predefined-type">String</span> title
    <span class="directive">static</span> hasMany = [<span class="key">players</span>: Player]
    <span class="predefined-type">Map</span> players
}

<span class="type">class</span> <span class="class">Player</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>,
                  <span class="string"><span class="delimiter">'</span><span class="content">players[guitar]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[vocals]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[keyboards]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span>]]

<span class="keyword">def</span> album = <span class="keyword">new</span> Album(bindingMap)

<span class="keyword">assert</span> album.title == <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.size() == <span class="integer">3</span>
<span class="keyword">assert</span> album.players.guitar.name == <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.vocals.name == <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.keyboards.name == <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>当更新现有的 <code>Map</code> 时，如果绑定的 <code>Map</code> 中指定的键在绑定的 <code>Map</code> 中不存在，则将创建一个新值，并使用指定的键将其添加到 <code>Map</code> 中，如 下面的例子:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> bindingMap = [<span class="key">title</span>: <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>,
                  <span class="string"><span class="delimiter">'</span><span class="content">players[guitar]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[vocals]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>],
                  <span class="string"><span class="delimiter">'</span><span class="content">players[keyboards]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span>]]

<span class="keyword">def</span> album = <span class="keyword">new</span> Album(bindingMap)

<span class="keyword">assert</span> album.title == <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.size() == <span class="integer">3</span>
<span class="keyword">assert</span> album.players.guitar.name == <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.vocals.name  == <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.keyboards.name  == <span class="string"><span class="delimiter">'</span><span class="content">Tony Banks</span><span class="delimiter">'</span></span>

<span class="keyword">def</span> updatedBindingMap = [<span class="string"><span class="delimiter">'</span><span class="content">players[drums]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Phil Collins</span><span class="delimiter">'</span></span>],
                         <span class="string"><span class="delimiter">'</span><span class="content">players[keyboards]</span><span class="delimiter">'</span></span>: [<span class="key">name</span>: <span class="string"><span class="delimiter">'</span><span class="content">Anthony George Banks</span><span class="delimiter">'</span></span>]]

album.properties = updatedBindingMap

<span class="keyword">assert</span> album.title == <span class="string"><span class="delimiter">'</span><span class="content">The Lamb Lies Down On Broadway</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.size() == <span class="integer">4</span>
<span class="keyword">assert</span> album.players.guitar.name == <span class="string"><span class="delimiter">'</span><span class="content">Steve Hackett</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.vocals.name == <span class="string"><span class="delimiter">'</span><span class="content">Peter Gabriel</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.keyboards.name == <span class="string"><span class="delimiter">'</span><span class="content">Anthony George Banks</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> album.players.drums.name == <span class="string"><span class="delimiter">'</span><span class="content">Phil Collins</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_将请求数据绑定到模型">将请求数据绑定到模型</h4>
<div class="paragraph">
<p><a href="../ref/Controllers/params.html">params</a>控制器中可用的对象具有特殊的行为，有助于将点的请求参数名称转换为数据绑定程序可以使用的嵌套Maps。 例如，如果请求包含名为 <code>person.homeAddress.country</code> 和 <code>person.homeAddress.city</code> 的请求参数，其值分别为 <code>USA</code> 和 <code>St</code> . 分别是路易斯，<code>params</code> 将包括这些条目:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">[<span class="key">person</span>: [<span class="key">homeAddress</span>: [<span class="key">country</span>: <span class="string"><span class="delimiter">'</span><span class="content">USA</span><span class="delimiter">'</span></span>, <span class="key">city</span>: <span class="string"><span class="delimiter">'</span><span class="content">St. Louis</span><span class="delimiter">'</span></span>]]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>有两种方法可以将请求参数绑定到域类的属性上。 第一个涉及使用域类的Map构造函数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">save</span>() {
    <span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)
    b.save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>数据绑定发生在代码 <code>new Book(params)</code> 中 . 通过传递 <a href="../ref/Controllers/params.html">params</a> 域类构造函数的对象Grails自动识别出您正在尝试从请求参数进行绑定。 因此，如果我们有一个传入请求，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/book/save?title=The%20Stand&amp;author=Stephen%20King</code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，将在域类上自动设置 <code>title</code> 和 <code>author</code> 请求参数。 您可以使用<a href="../ref/Domain%20Classes/properties.html">properties</a> 属性将数据绑定到现有实例上:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">save</span>() {
    <span class="keyword">def</span> b = <span class="predefined-type">Book</span>.get(params.id)
    b.properties = params
    b.save()
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>与使用隐式构造函数的效果相同.</p>
</div>
<div class="paragraph">
<p>绑定空字符串（其中没有字符，甚至没有空格的字符串）时，数据绑定器会将空字符串转换为null。 这简化了最常见的情况，其目的是将空表单字段视为具有值null，因为没有一种方法可以实际提交null作为请求参数。 当这种行为不是所希望的时，应用程序可以直接分配值.</p>
</div>
<div class="paragraph">
<p>质量属性绑定机制默认情况下将在绑定时自动修剪所有字符串。 要禁用此行为，请将 <code>grails-app/conf/application.groovy</code> 的 <code>grails.databinding.trimStrings</code> 属性设置为false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// the default value is true</span>
grails.databinding.trimStrings = <span class="predefined-constant">false</span>

<span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>质量属性绑定机制将默认在绑定时自动将所有空字符串转换为null。 要禁用此行为，请将  <code>grails-app/conf/application.groovy</code> 中的 <code>grails.databinding.convertEmptyStringsToNull</code> 属性设置为false.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// the default value is true</span>
grails.databinding.convertEmptyStringsToNull = <span class="predefined-constant">false</span>

<span class="comment">// ...</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>事件发生的顺序是发生字符串修整，然后发生空转换，因此，如果 <code>trimStrings</code>  为 <code>true</code> 和 <code>convertEmptyStringsToNull</code> 为 <code>true</code> ，不仅空字符串将转换为null，空字符串也将转换为空。 空字符串是任何字符串，这样 <code>trim（）</code> 方法将返回一个空字符串.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Grails中的这些形式的数据绑定非常方便，但也是不加区别的。 换句话说，它们将绑定目标对象的_all_非临时性，类型化实例属性，包括您可能不想绑定的属性。 仅仅因为UI中的表单没有提交所有属性，攻击者仍然可以通过原始HTTP请求发送恶意数据。 幸运的是，Grails还可轻松防止此类攻击-有关更多信息，请参见标题为 "Data Binding and Security concerns" 的部分.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和单端关联">数据绑定和单端关联</h4>
<div class="paragraph">
<p>如果您具有 <code>one-to-one</code> 或 <code>many-to-one</code> 关联，则也可以使用Grails的数据绑定功能来更新这些关系。 例如，如果您有一个传入请求，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/book/save?author.id=20</code></pre>
</div>
</div>
<div class="paragraph">
<p>在进行数据绑定（例如）时，Grails会自动检测request参数上的 <code>.id</code> 后缀，并在给定id的 <code>Author</code> 实例中查找:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过传递文字 <code>String</code>  "null"，可以将关联属性设置为 <code>null</code> 。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/book/save?author.id=null</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和多端关联">数据绑定和多端关联</h4>
<div class="paragraph">
<p>如果您具有一对多或多对多关联，则根据关联类型，可以使用不同的数据绑定技术.</p>
</div>
<div class="paragraph">
<p>如果您有一个基于 <code>Set</code> 的关联（<code>hasMany</code> 的默认设置），那么填充关联的最简单方法是发送一个标识符列表。 例如，考虑下面的 <code>&lt;g:select&gt;</code> 的用法:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${Book.list()}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">size</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">5</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">multiple</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">yes</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">optionKey</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这将产生一个选择框，使您可以选择多个值。 在这种情况下，如果您提交表单，Grails将自动使用选择框中的标识符来填充 <code>books</code> 关联.</p>
</div>
<div class="paragraph">
<p>但是，如果您想更新关联对象的属性，则此技术将不起作用。 而是使用下标运算符:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Stand</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Shining</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>但是，对于基于 <code>Set</code> 的关联，至关重要的是，以与计划进行更新时相同的顺序来呈现标记。这是因为 <code>Set</code> 没有顺序的概念，因此尽管我们指的是 对于 <code>books [0]</code> 和 <code>books [1]</code>，除非您自己进行一些明确的排序，否则不能保证关联的顺序在服务器端是正确的.</p>
</div>
<div class="paragraph">
<p>如果您使用基于 <code>List</code> 的关联，这不是问题，因为 <code>List</code> 具有定义的顺序和可以引用的索引。 基于 <code>Map</code> 的关联也是如此.</p>
</div>
<div class="paragraph">
<p>还要注意，如果要绑定的关联的大小为2，并且引用的元素超出了关联的大小:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Stand</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">the Shining</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
<span class="tag">&lt;g:textField</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[2].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">Red Madder</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后Grails将在定义的位置自动为您创建一个新实例.</p>
</div>
<div class="paragraph">
<p>您可以使用与单端关联相同的 <code>.id</code> 语法将关联类型的现有实例绑定到 <code>List</code> 。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${bookList}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[0]?.id}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${bookList}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[1]?.id}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>

<span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[2].id</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${bookList}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[2]?.id}</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>允许单独选择 <code>books List</code> 中的各个条目.</p>
</div>
<div class="paragraph">
<p>特定索引的条目也可以用相同的方法删除。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].id</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${Book.list()}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${author?.books[0]?.id}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">noSelection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">['null': '']</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果选择了空选项，将呈现一个选择框，该选择框将删除 <code>books[0]</code> 处的关联.</p>
</div>
<div class="paragraph">
<p>绑定到 <code>Map</code> 属性的工作方式相同，只是参数名中的列表索引被map键替换。:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:select</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">images[cover].id</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">from</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${Image.list()}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${book?.images[cover]?.id}</span><span class="delimiter">&quot;</span></span>
          <span class="attribute-name">noSelection</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">['null': '']</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这会将选定的图像绑定到 <code>"cover"</code> 键下的 <code>Map</code> 属性 <code>images</code> 中.</p>
</div>
<div class="paragraph">
<p>绑定到Maps，Arrays和Collections时，数据绑定器将根据需要自动增大collections的大小.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
绑定程序将集合增长到多大的默认限制是256。如果数据绑定器遇到一个要求将集合增长到该限制之外的条目，则该条目将被忽略。 可以通过为 <code>application.groovy</code> 中的 <code>grails.databinding.autoGrowCollectionLimit</code> 属性分配一个值来配置限制。.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// the default value is 256</span>
grails.databinding.autoGrowCollectionLimit = <span class="integer">128</span>

<span class="comment">// ...</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_具有多个域类的数据绑定">具有多个域类的数据绑定</h4>
<div class="paragraph">
<p>可以通过以下链接将数据绑定到多个域对象 <a href="../ref/Controllers/params.html">params</a> .</p>
</div>
<div class="paragraph">
<p>例如，您有一个传入请求:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/book/save?book.title=The%20Stand&amp;author.name=Stephen%20King</code></pre>
</div>
</div>
<div class="paragraph">
<p>您会注意到与上述请求的不同之处在于，每个参数都有一个前缀，例如 <code>author.</code> 或 <code>book.</code>，用于区分哪些参数属于哪种类型。 Grails的 <code>params</code> 对象就像一个多维哈希，您可以对其进行索引以仅隔离要绑定的参数的子集.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params.book)</code></pre>
</div>
</div>
<div class="paragraph">
<p>请注意，我们如何在 <code>book.title</code> 参数的第一个点之前使用前缀，以仅隔离此级别以下的参数进行绑定。 我们可以对 <code>Author</code> 域类做同样的事情:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> a = <span class="keyword">new</span> Author(params.author)</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和动作参数">数据绑定和动作参数</h4>
<div class="paragraph">
<p>控制器操作参数受请求参数数据绑定的约束。 控制器动作参数有2类。 第一类是命令对象。 复杂类型被视为命令对象。 有关详细信息，请参见用户指南中的<a href="theWebLayer.html#commandObjects">Command Objects</a> 部分。 另一类是基本对象类型。 支持的类型是8个原语，它们对应的类型包装器和 <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/String.html">java.lang.String</a>. 默认行为是按名称将请求参数映射到操作参数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AccountingController</span> {

   <span class="comment">// accountNumber will be initialized with the value of params.accountNumber</span>
   <span class="comment">// accountType will be initialized with params.accountType</span>
   <span class="keyword">def</span> <span class="function">displayInvoice</span>(<span class="predefined-type">String</span> accountNumber, <span class="type">int</span> accountType) {
       <span class="comment">// ...</span>
   }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>对于原始参数和作为任何原始类型包装器类实例的参数，必须在将请求参数值绑定到动作参数之前执行类型转换。 类型转换自动发生。 在上面显示的示例中， <code>params.accountType</code> 请求参数必须转换为 <code>int</code>. 如果由于某种原因类型转换失败，则该参数将具有每个常规Java行为的默认值（类型包装器引用为null，布尔值为false，数字为零），并且相应的错误将添加到定义的 <code>errors</code> 属性中 控制者.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/accounting/displayInvoice?accountNumber=B59786&amp;accountType=bogusValue</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于无法将"bogusValue"转换为int类型，accountType的值将为零，控制器的 <code>errors.hasErrors()</code> 为true，控制器的 <code>errors.errorCount</code> 将等于1，控制器的 <code>errors.getFieldError('accountType')</code> 将包含相应的错误.</p>
</div>
<div class="paragraph">
<p>如果参数名称与请求参数的名称不匹配，则可以将  <code>@grails.web.RequestParameter</code> 批注应用于参数，以表达应绑定到该参数的请求参数的名称:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.web.RequestParameter</span>

<span class="type">class</span> <span class="class">AccountingController</span> {

   <span class="comment">// mainAccountNumber will be initialized with the value of params.accountNumber</span>
   <span class="comment">// accountType will be initialized with params.accountType</span>
   <span class="keyword">def</span> <span class="function">displayInvoice</span>(<span class="annotation">@RequestParameter</span>(<span class="string"><span class="delimiter">'</span><span class="content">accountNumber</span><span class="delimiter">'</span></span>) <span class="predefined-type">String</span> mainAccountNumber, <span class="type">int</span> accountType) {
       <span class="comment">// ...</span>
   }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和类型转换错误">数据绑定和类型转换错误</h4>
<div class="paragraph">
<p>有时在执行数据绑定时，无法将特定的String转换为特定的目标类型。 这导致类型转换错误。 Grails将在Grails域类的<a href="../ref/Domain%20Classes/errors.html">errors</a>属性内保留类型转换错误。 例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Book</span> {
    ...
    URL publisherURL
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>这里我们有一个域类 <code>Book</code> ，它使用 <code>java.net.URL</code> 类来表示URL。 给定一个传入请求，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">/book/save?publisherURL=a-bad-url</code></pre>
</div>
</div>
<div class="paragraph">
<p>由于发生类型不匹配错误，因此无法将字符串 <code>a-bad-url</code> 绑定到 <code>publisherURL</code> 属性。 您可以像这样检查这些:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> b = <span class="keyword">new</span> <span class="predefined-type">Book</span>(params)

<span class="keyword">if</span> (b.hasErrors()) {
    println <span class="string"><span class="delimiter">&quot;</span><span class="content">The value </span><span class="inline"><span class="inline-delimiter">${</span>b.errors.getFieldError(<span class="string"><span class="delimiter">'</span><span class="content">publisherURL</span><span class="delimiter">'</span></span>).rejectedValue<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> +
            <span class="string"><span class="delimiter">&quot;</span><span class="content"> is not a valid URL!</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>尽管我们尚未涵盖错误代码（有关更多信息，请参见<a href="validation.html">validation</a>上的部分），但对于类型转换错误，您希望将消息从 <code>grails-app/i18n/messages.properties</code> 文件发送到 用于错误。 您可以使用通用错误消息处理程序，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">typeMismatch.java.net.URL=The field {<span class="integer">0</span>} is not a valid <span class="predefined-type">URL</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>或更具体的一个:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">typeMismatch.Book.publisherURL=The publisher <span class="predefined-type">URL</span> you specified is not a valid <span class="predefined-type">URL</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bindusing注释">BindUsing注释</h4>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindUsing.html">BindUsing</a> 注释可以用于为类中的特定字段定义自定义绑定机制。 每当将数据绑定应用于字段时，便会使用2个参数来调用注释的闭包值. 第一个参数是要应用数据绑定的对象，第二个参数是 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/DataBindingSource.html">DataBindingSource</a> 它是数据绑定的数据源. 从闭包返回的值将绑定到该属性。 以下示例将导致在数据绑定期间将源中的 <code>name</code> 值的大写版本应用于 <code>name</code> 字段.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindUsing</span>

<span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="annotation">@BindUsing</span>({obj, source -&gt;

        <span class="comment">//source is DataSourceBinding which is similar to a Map</span>
        <span class="comment">//and defines getAt operation but source.name cannot be used here.</span>
        <span class="comment">//In order to get name from source use getAt instead as shown below.</span>

        source[<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>]?.toUpperCase()
    })
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
请注意，仅当请求参数的名称与类中的字段名称匹配时，才可以进行数据绑定.
在这里，请求参数中的 <code>name</code> 与 <code>SomeClass</code> 中的 <code>name</code> 相匹配.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindUsing.html">BindUsing</a> 注释可用于为特定类上的所有字段定义自定义绑定机制. 当将注释应用于一个类时，分配给该注释的值应该是一个实现 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindingHelper.html">BindingHelper</a> 接口.  每当将值绑定到该注释已应用于的类中的属性时，都将使用该类的实例.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@BindUsing</span>(SomeClassWhichImplementsBindingHelper)
<span class="type">class</span> <span class="class">SomeClass</span> {
    <span class="predefined-type">String</span> someProperty
    <span class="predefined-type">Integer</span> someOtherProperty
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_bindinitializer批注">BindInitializer批注</h4>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindInitializer.html">BindInitializer</a> 如果未定义，则注释可用于初始化类中的关联字段.
不像 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindUsing.html">BindUsing</a> 注释，数据绑定将继续绑定此关联上的所有嵌套属性.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindInitializer</span>

<span class="type">class</span> <span class="class">Account</span>{}

<span class="type">class</span> <span class="class">User</span> {
  Account account

  <span class="comment">// BindInitializer expects you to return a instance of the type</span>
  <span class="comment">// where it's declared on. You can use source as a parameter, in this case user.</span>
  <span class="annotation">@BindInitializer</span>({user-&gt; <span class="keyword">new</span> Contact(<span class="key">account</span>:user.account) })
  Contact contact
}
<span class="type">class</span> <span class="class">Contact</span>{
  Account account
  <span class="predefined-type">String</span> firstName
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
根据此用例，@BindInitializer 仅对关联的实体有意义.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_定制数据转换器">定制数据转换器</h4>
<div class="paragraph">
<p>活页夹将自动执行很多类型转换。 一些应用程序可能想要定义自己的用于转换值的机制，而执行此操作的一种简单方法是编写一个实现 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/converters/ValueConverter.html">ValueConverter</a> 并在Spring应用程序上下文中将该类的实例注册为Bean.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.myapp.converters

<span class="keyword">import</span> <span class="include">grails.databinding.converters.ValueConverter</span>

<span class="comment">/**
 * A custom converter which will convert String of the
 * form 'city:state' into an Address object.
 */</span>
<span class="type">class</span> <span class="class">AddressValueConverter</span> <span class="directive">implements</span> ValueConverter {

    <span class="type">boolean</span> canConvert(value) {
        value <span class="keyword">instanceof</span> <span class="predefined-type">String</span>
    }

    <span class="keyword">def</span> <span class="function">convert</span>(value) {
        <span class="keyword">def</span> pieces = value.split(<span class="string"><span class="delimiter">'</span><span class="content">:</span><span class="delimiter">'</span></span>)
        <span class="keyword">new</span> com.myapp.Address(<span class="key">city</span>: pieces[<span class="integer">0</span>], <span class="key">state</span>: pieces[<span class="integer">1</span>])
    }

    <span class="predefined-type">Class</span>&lt;?&gt; getTargetType() {
        com.myapp.Address
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该类的实例需要在Spring应用程序上下文中注册为Bean。 Bean名称并不重要。 所有实现ValueConverter的bean将自动插入到数据绑定过程中.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    addressConverter com.myapp.converters.AddressValueConverter
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> firstName
    Address homeAddress
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
    <span class="predefined-type">String</span> state
}

<span class="keyword">def</span> person = <span class="keyword">new</span> Person()
person.properties = [<span class="key">firstName</span>: <span class="string"><span class="delimiter">'</span><span class="content">Jeff</span><span class="delimiter">'</span></span>, <span class="key">homeAddress</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">O'Fallon:Missouri</span><span class="delimiter">&quot;</span></span>]
<span class="keyword">assert</span> person.firstName == <span class="string"><span class="delimiter">'</span><span class="content">Jeff</span><span class="delimiter">'</span></span>
<span class="keyword">assert</span> person.homeAddress.city = <span class="string"><span class="delimiter">&quot;</span><span class="content">O'Fallon</span><span class="delimiter">&quot;</span></span>
<span class="keyword">assert</span> person.homeAddress.state = <span class="string"><span class="delimiter">'</span><span class="content">Missouri</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定的日期格式">数据绑定的日期格式</h4>
<div class="paragraph">
<p>通过将字符串绑定到Date值时，可以指定要使用的自定义日期格式 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindingFormat.html">BindingFormat</a> 日期字段的注释.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindingFormat</span>

<span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@BindingFormat</span>(<span class="string"><span class="delimiter">'</span><span class="content">MMddyyyy</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">Date</span> birthDate
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在 <code>application.groovy</code> 中配置一个全局设置来定义日期格式，当绑定到Date时将在整个应用程序中使用.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails.databinding.dateFormats = [<span class="string"><span class="delimiter">'</span><span class="content">MMddyyyy</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">yyyy-MM-dd HH:mm:ss.S</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">yyyy-MM-dd'T'hh:mm:ss'Z'</span><span class="delimiter">&quot;</span></span>]</code></pre>
</div>
</div>
<div class="paragraph">
<p>将尝试按照在列表中包含的顺序尝试 <code>grails.databinding.dateFormats</code> 中指定的格式。如果一个属性标有 <code>@BindingFormat</code> ，则 <code>@BindingFormat</code> 将优先于 <code>grails.databinding.dateFormats</code> 中指定的值。</p>
</div>
<div class="paragraph">
<p>默认配置的格式为：</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>yyyy-MM-dd HH:mm:ss.S</code></p>
</li>
<li>
<p><code>yyyy-MM-dd&#8217;T&#8217;hh:mm:ss&#8217;Z'</code></p>
</li>
<li>
<p><code>yyyy-MM-dd HH:mm:ss.S z</code></p>
</li>
<li>
<p><code>yyyy-MM-dd&#8217;T&#8217;HH:mm:ss.SSSX</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_定制格式转换器">定制格式转换器</h4>
<div class="paragraph">
<p>您可以通过编写实现<a href="http://docs.grails.org/4.0.0/api/grails/databinding/converters/FormattedValueConverter.html">FormattedValueConverter</a> 接口的类并注册一个实例来为 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/BindingFormat.html">BindingFormat</a> 注释提供自己的处理程序。 该类在Spring应用程序上下文中作为bean。 下面是一个简单的自定义String格式化程序的示例，该格式化程序可以根据分配给BindingFormat批注的值来转换String的大小写.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.myapp.converters

<span class="keyword">import</span> <span class="include">grails.databinding.converters.FormattedValueConverter</span>

<span class="type">class</span> <span class="class">FormattedStringValueConverter</span> <span class="directive">implements</span> FormattedValueConverter {
    <span class="keyword">def</span> <span class="function">convert</span>(value, <span class="predefined-type">String</span> format) {
        <span class="keyword">if</span>(<span class="string"><span class="delimiter">'</span><span class="content">UPPERCASE</span><span class="delimiter">'</span></span> == format) {
            value = value.toUpperCase()
        } <span class="keyword">else</span> <span class="keyword">if</span>(<span class="string"><span class="delimiter">'</span><span class="content">LOWERCASE</span><span class="delimiter">'</span></span> == format) {
            value = value.toLowerCase()
        }
        value
    }

    <span class="predefined-type">Class</span> getTargetType() {
        <span class="comment">// specifies the type to which this converter may be applied</span>
        <span class="predefined-type">String</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该类的实例需要在Spring应用程序上下文中注册为Bean。 Bean名称并不重要。 所有实现FormattedValueConverter的bean将自动插入到数据绑定过程中.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    formattedStringConverter com.myapp.converters.FormattedStringValueConverter
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有了适当的绑定之后，就可以将 <code>BindingFormat</code> 注释应用于 <code>String</code> 字段，以通知数据绑定器利用自定义转换器.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindingFormat</span>

<span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@BindingFormat</span>(<span class="string"><span class="delimiter">'</span><span class="content">UPPERCASE</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">String</span> someUpperCaseString

    <span class="annotation">@BindingFormat</span>(<span class="string"><span class="delimiter">'</span><span class="content">LOWERCASE</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">String</span> someLowerCaseString

    <span class="predefined-type">String</span> someOtherString
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_本地绑定格式">本地绑定格式</h4>
<div class="paragraph">
<p><code>BindingFormat</code> 批注通过使用可选的 <code>code</code> 属性来支持本地化的格式字符串。 如果将值分配给了code属性，则该值将用作消息代码，以在Spring应用程序上下文中从 <code>messageSource</code> bean中检索绑定格式字符串，并且该查找将被本地化.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">grails.databinding.BindingFormat</span>

<span class="type">class</span> <span class="class">Person</span> {
    <span class="annotation">@BindingFormat</span>(code=<span class="string"><span class="delimiter">'</span><span class="content">date.formats.birthdays</span><span class="delimiter">'</span></span>)
    <span class="predefined-type">Date</span> birthDate
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">#</span> grails-app/conf/i18n/messages.properties
date.formats.birthdays=MMddyyyy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="error">#</span> grails-app/conf/i18n/messages_es.properties
date.formats.birthdays=ddMMyyyy</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_结构化数据绑定编辑器">结构化数据绑定编辑器</h4>
<div class="paragraph">
<p>结构化数据绑定编辑器是一个帮助程序类，可以将结构化请求参数绑定到属性。 结构化绑定的常见用例是绑定到一个 <code>日期</code> 对象，该对象可能是由几个请求参数中包含的一些较小的信息片段构成的，它们的名称分别为 <code>birthday_month</code> , <code>birthday_date</code> 和 <code>birthday_year</code> 。 结构化的编辑器将检索所有这些单独的信息，并使用它们来构建一个 <code>Date</code>.</p>
</div>
<div class="paragraph">
<p>该框架提供了用于绑定到 <code>Date</code> 对象的结构化编辑器。 应用程序可以注册适合任何类型的自己的结构化编辑器。 考虑以下课程:</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/databinding/Gadget.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> databinding

<span class="type">class</span> <span class="class">Gadget</span> {
    <span class="predefined-type">Shape</span> expandedShape
    <span class="predefined-type">Shape</span> compressedShape
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/databinding/Shape.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> databinding

<span class="type">class</span> <span class="class">Shape</span> {
    <span class="type">int</span> area
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>一个 <code>Gadget</code> 具有2个 <code>Shape</code> 字段。 <code>Shape</code> 具有 <code>area</code> 属性。 可能是应用程序想要接受诸如 <code>width</code> 和 <code>height</code> 的请求参数，并在绑定时使用这些参数来计算 <code>Shape</code> 的 <code>area</code>。 结构化绑定编辑器非常适合.</p>
</div>
<div class="paragraph">
<p>在数据绑定过程中注册结构化编辑器的方法是将 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/TypedStructuredBindingEditor.html">grails.databinding.TypedStructuredBindingEditor</a> 接口的实例添加到Spring应用程序上下文。 实现 <code>TypedStructuredBindingEditor</code> 接口的最简单方法是继承 <a href="http://docs.grails.org/4.0.0/api/org/grails/databinding/converters/AbstractStructuredDateBindingEditor.html">org.grails.databinding.converters.AbstractStructuredBindingEditor</a> 抽象类并覆盖 <code>getPropertyValue</code> 方法，如图所示 下面:</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/databinding/converters/StructuredShapeEditor.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> databinding.converters

<span class="keyword">import</span> <span class="include">databinding.Shape</span>

<span class="keyword">import</span> <span class="include">org.grails.databinding.converters.AbstractStructuredBindingEditor</span>

<span class="type">class</span> <span class="class">StructuredShapeEditor</span> <span class="directive">extends</span> AbstractStructuredBindingEditor&lt;<span class="predefined-type">Shape</span>&gt; {

    <span class="directive">public</span> <span class="predefined-type">Shape</span> getPropertyValue(<span class="predefined-type">Map</span> values) {
        <span class="comment">// retrieve the individual values from the Map</span>
        <span class="keyword">def</span> width = values.width <span class="keyword">as</span> <span class="type">int</span>
        <span class="keyword">def</span> height = values.height <span class="keyword">as</span> <span class="type">int</span>

        <span class="comment">// use the values to calculate the area of the Shape</span>
        <span class="keyword">def</span> area = width * height

        <span class="comment">// create and return a Shape with the appropriate area</span>
        <span class="keyword">new</span> <span class="predefined-type">Shape</span>(<span class="key">area</span>: area)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该类的实例需要在Spring应用程序上下文中注册:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">beans = {
    shapeEditor databinding.converters.StructuredShapeEditor
    <span class="comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>当数据绑定器绑定到 <code>Gadget</code> 类的实例时，它将检查是否存在名称为 <code>compressedShape</code> 和 <code>expandedShape</code> 的请求参数，其值均为"struct"，如果确实存在，则会触发 使用 <code>StructuredShapeEditor</code> 。 结构的各个组件必须具有格式为propertyName_structuredElementName的参数名称。 在上述 <code>Gadget</code> 类的情况下，这意味着 <code>compressedShape</code> 请求参数应具有"struct"值，而 <code>compressedShape_width</code> 和 <code>compressedShape_height</code> 参数应具有代表宽度和高度的值。 压缩的 <code>Shape</code> 。 同样，expandedShape请求参数应具有"struct"值，expandedShape_width和expandedShape_height参数应具有表示扩展 <code>Shape</code> 宽度和高度的值.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createGadget</span>(Gadget gadget) {
        <span class="comment">/*
        /demo/createGadget?expandedShape=struct&amp;expandedShape_width=80&amp;expandedShape_height=30
                          &amp;compressedShape=struct&amp;compressedShape_width=10&amp;compressedShape_height=3

        */</span>

        <span class="comment">// with the request parameters shown above gadget.expandedShape.area would be 2400</span>
        <span class="comment">// and gadget.compressedShape.area would be 30</span>
        <span class="comment">// ...</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通常，以"struct"作为其值的请求参数将由隐藏的表单字段表示.</p>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定事件侦听器">数据绑定事件侦听器</h4>
<div class="paragraph">
<p><a href="http://docs.grails.org/4.0.0/api/grails/databinding/events/DataBindingListener.html">DataBindingListener</a> 接口提供了一种机制，可将数据绑定事件通知给侦听器。 界面看起来像这样:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> grails.databinding.events;

<span class="keyword">import</span> <span class="include">grails.databinding.errors.BindingError</span>;

<span class="comment">/**
 * A listener which will be notified of events generated during data binding.
 *
 * @author Jeff Brown
 * @since 3.0
 * @see DataBindingListenerAdapter
 */</span>
<span class="directive">public</span> <span class="type">interface</span> DataBindingListener {

    <span class="comment">/**
     * @return true if the listener is interested in events for the specified type.
     */</span>
    <span class="type">boolean</span> supports(<span class="predefined-type">Class</span>&lt;?&gt; clazz);

    <span class="comment">/**
     * Called when data binding is about to start.
     *
     * @param target The object data binding is being imposed upon
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     * @return true if data binding should continue
     */</span>
    <span class="predefined-type">Boolean</span> beforeBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called when data binding is about to imposed on a property
     *
     * @param target The object data binding is being imposed upon
     * @param propertyName The name of the property being bound to
     * @param value The value of the property being bound
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     * @return true if data binding should continue, otherwise return false
     */</span>
    <span class="predefined-type">Boolean</span> beforeBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">String</span> propertyName, <span class="predefined-type">Object</span> value, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called after data binding has been imposed on a property
     *
     * @param target The object data binding is being imposed upon
     * @param propertyName The name of the property that was bound to
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     */</span>
    <span class="type">void</span> afterBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">String</span> propertyName, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called after data binding has finished.
     *
     * @param target The object data binding is being imposed upon
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     */</span>
    <span class="type">void</span> afterBinding(<span class="predefined-type">Object</span> target, <span class="predefined-type">Object</span> errors);

    <span class="comment">/**
     * Called when an error occurs binding to a property
     * @param error encapsulates information about the binding error
     * @param errors the Spring Errors instance (a org.springframework.validation.BindingResult)
     * @see BindingError
     */</span>
    <span class="type">void</span> bindingError(BindingError error, <span class="predefined-type">Object</span> errors);
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Spring应用程序上下文中实现该接口的任何bean都会自动向数据绑定器注册.  <a href="http://docs.grails.org/4.0.0/api/grails/databinding/events/DataBindingListenerAdapter.html">DataBindingListenerAdapter</a> 类实现了 <code>DataBindingListener</code> 接口，并为接口中的所有方法提供了默认实现，因此此类非常适合于子类化，因此您的侦听器类仅需要为您的侦听器感兴趣的方法提供实现.</p>
</div>
</div>
<div class="sect3">
<h4 id="_直接使用数据绑定器">直接使用数据绑定器</h4>
<div class="paragraph">
<p>在某些情况下，应用程序可能希望直接使用数据绑定器。 例如，在服务上对不是域类的任意对象进行绑定。 以下内容将不起作用，因为 <code>properties</code> 属性是只读的.</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/bindingdemo/Widget.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">Widget</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> size
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/services/bindingdemo/WidgetService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">WidgetService</span> {

    <span class="keyword">def</span> <span class="function">updateWidget</span>(Widget widget, <span class="predefined-type">Map</span> data) {
        <span class="comment">// this will throw an exception because</span>
        <span class="comment">// properties is read-only</span>
        widget.properties = data
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>数据绑定器的一个实例在Spring应用程序上下文中，其bean名称为 <code>grailsWebDataBinder</code> .  该bean实现 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/DataBinder.html">DataBinder</a>接口.  以下代码演示了如何直接使用数据绑定器.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/bindingdmeo/WidgetService</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="keyword">import</span> <span class="include">grails.databinding.SimpleMapDataBindingSource</span>

<span class="type">class</span> <span class="class">WidgetService</span> {

    <span class="comment">// this bean will be autowired into the service</span>
    <span class="keyword">def</span> grailsWebDataBinder

    <span class="keyword">def</span> <span class="function">updateWidget</span>(Widget widget, <span class="predefined-type">Map</span> data) {
        grailsWebDataBinder.bind widget, data <span class="keyword">as</span> SimpleMapDataBindingSource
    }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>有关重载版本的更多信息，请参见 <a href="http://docs.grails.org/4.0.0/api/grails/databinding/DataBinder.html">DataBinder</a> 文档。
 <code>bind</code> 方法.</p>
</div>
</div>
<div class="sect3">
<h4 id="_数据绑定和安全问题">数据绑定和安全问题</h4>
<div class="paragraph">
<p>从请求参数批量更新属性时，需要注意不要允许客户端将恶意数据绑定到域类并保留在数据库中。 您可以使用下标运算符限制将哪些属性绑定到给定的域类:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = Person.get(<span class="integer">1</span>)

p.properties[<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>,<span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>] = params</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，只会绑定 <code>firstName</code> 和 <code>lastName</code> 属性.</p>
</div>
<div class="paragraph">
<p>另一种方法是使用 <a href="theWebLayer.html#commandObjects">Command Objects</a> 作为数据绑定的目标而不是域类. 另外，也有灵活的 <a href="../ref/Controllers/bindData.html">bindData</a> 方法.</p>
</div>
<div class="paragraph">
<p><code>bindData</code> 方法允许相同的数据绑定功能，但可以绑定到任意对象:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person()
bindData(p, params)</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>bindData</code> 方法还允许您排除某些不想更新的参数:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person()
bindData(p, params, [<span class="key">exclude</span>: <span class="string"><span class="delimiter">'</span><span class="content">dateOfBirth</span><span class="delimiter">'</span></span>])</code></pre>
</div>
</div>
<div class="paragraph">
<p>或仅包含某些属性:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> p = <span class="keyword">new</span> Person()
bindData(p, params, [<span class="key">include</span>: [<span class="string"><span class="delimiter">'</span><span class="content">firstName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">lastName</span><span class="delimiter">'</span></span>]])</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
如果提供了一个空的List作为 <code>include</code> 参数的值，那么如果未明确排除所有字段，则将对其进行绑定.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><a href="../ref/Constraints/bindable.html">bindable</a> 约束可用于全局阻止某些属性的数据绑定.</p>
</div>
</div>


<h2 id="jsonResponses">8.1.6 使用 JSON 响应</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/jsonResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_使用response方法输出json">使用response方法输出JSON</h4>
<div class="paragraph">
<p><code>响应</code> 方法是返回JSON的首选方法，并与 <a href="theWebLayer.html#contentNegotiation">Content Negotiation</a> 和 <a href="http://views.grails.org">JSON Views</a> 集成.</p>
</div>
<div class="paragraph">
<p><code>响应</code> 方法提供了内容协商策略，以智能地为给定客户端生成适当的响应.</p>
</div>
<div class="paragraph">
<p>例如给出以下控制器和动作:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/BookController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example

<span class="type">class</span> <span class="class">BookController</span> {
    <span class="keyword">def</span> <span class="function">index</span>() {
        respond <span class="predefined-type">Book</span>.list()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>respond</code> 方法将采取以下步骤:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>如果客户端的 <code>Accept</code> 标头指定了媒体类型（例如 <code>application/json</code>），请使用</p>
</li>
<li>
<p>如果URI的文件扩展名（例如 <code>/books.json</code>）包含在 <code>grails-app/conf/application.yml</code> 的 <code>grails.mime.types</code> 属性中定义的格式，请使用在组态</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>然后，<code>respond</code> 方法将查找适当 <a href="http://docs.grails.org/4.0.0/api/grails/rest/render/Renderer.html">Renderer</a> 用于对象，并从链接中计算出媒体类型 <a href="http://docs.grails.org/4.0.0/api/grails/rest/render/RendererRegistry.html">RendererRegistry</a>.</p>
</div>
<div class="paragraph">
<p>Grails包含许多预配置的 <code>Renderer</code> 实现，这些实现将为传递给 <code>respond</code> 的参数生成JSON响应的默认表示。 例如，转到 <code>/book.json</code> URI将产生JSON，例如:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
    {<span class="error">i</span><span class="error">d</span>:<span class="integer">1</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>},
    {<span class="error">i</span><span class="error">d</span>:<span class="integer">2</span>,<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Shining</span><span class="delimiter">&quot;</span></span>}
]</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_控制媒体类型的优先级">控制媒体类型的优先级</h4>
<div class="paragraph">
<p>默认情况下，如果您定义一个控制器，则在发送回客户端的格式方面没有优先级，Grails假定您希望将HTML作为响应类型提供.</p>
</div>
<div class="paragraph">
<p>但是，如果您的应用程序主要是API，则可以使用 <code>response Formats</code> 属性指定优先级:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/BookController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example

<span class="type">class</span> <span class="class">BookController</span> {
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">html</span><span class="delimiter">'</span></span>]
    <span class="keyword">def</span> <span class="function">index</span>() {
        respond <span class="predefined-type">Book</span>.list()
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在上面的示例中，如果无法通过`Accept`标头或文件扩展名计算出要响应的媒体类型，则Grails默认情况下将以 <code>json</code> 响应.</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用视图输出json响应">使用视图输出JSON响应</h4>
<div class="paragraph">
<p>如果您定义视图（GSP或一个 <a href="http://views.grails.org">JSON View</a>)，则在使用 <code>respond</code> 方法时，Grails将根据传递给 <code>respond</code> 的参数计算模型来渲染视图.</p>
</div>
<div class="paragraph">
<p>例如，在上一个清单中，如果要定义 <code>grails-app/views/index.gson</code> 和 <code>grails-app/views/index.gsp</code> 视图，则在客户端请求 <code>application/json</code> 时将使用这些视图或 <code>text/html</code> 媒体类型。 因此，您可以定义一个后端，该后端能够提供对Web浏览器的响应或代表您的应用程序的API.</p>
</div>
<div class="paragraph">
<p>渲染视图时，Grails将根据传递给 <code>respond</code> 方法的值的类型来计算要传递给视图的模型.</p>
</div>
<div class="paragraph">
<p>下表总结了此约定:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Example</th>
<th class="tableblock halign-left valign-top">Argument Type</th>
<th class="tableblock halign-left valign-top">Calculated Model Variable</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond Book.list()</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>bookList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [] )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>emptyList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond Book.get(1)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>example.Book</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>book</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [1,2] )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.List</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integerList</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [1,2] as Set )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>java.util.Set</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integerSet</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>respond( [1,2] as Integer[] )</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Integer[]</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>integerArray</code></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>使用此约定，您可以在视图中引用传递给 <code>respond</code> 的参数。:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/index.gson</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="annotation">@Field</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; bookList = <span class="type">[]</span>

json bookList, { <span class="predefined-type">Book</span> book -&gt;
    title book.title
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>您将注意到，如果 <code>Book.list（）</code> 返回一个空列表，则模型变量名称将转换为 <code>emptyList</code> 。 这是设计使然，如果未指定模型变量，则应在视图中提供默认值，例如上例中的 <code>List</code> :</p>
</div>
<div class="listingblock">
<div class="title">grails-app/views/book/index.gson</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="comment">// defaults to an empty list</span>
<span class="annotation">@Field</span> <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; bookList = <span class="type">[]</span>
...</code></pre>
</div>
</div>
<div class="paragraph">
<p>在某些情况下，您可能希望更明确一些并控制模型变量的名称。 例如，如果您有一个域继承层次结构，那么对 <code>list（）</code> 的调用可能会导致依赖于自动计算的其他子类返回不可靠.</p>
</div>
<div class="paragraph">
<p>在这种情况下，您应该使用 <code>respond</code> 和map参数直接传递模型:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">respond <span class="key">bookList</span>: <span class="predefined-type">Book</span>.list()</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
在集合中使用任何类型的混合参数类型进行响应时，请始终使用显式模型名称.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>如果您只是想扩充计算的模型，则可以通过传递一个 <code>model</code> 参数来实现:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">respond <span class="predefined-type">Book</span>.list(), [<span class="key">model</span>: [<span class="key">bookCount</span>: <span class="predefined-type">Book</span>.count()]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例将生成一个模型，如 <code>[bookList:books, bookCount:totalBooks]</code>,其中将计算出的模型与在 <code>model</code> 参数中传递的模型组合在一起.</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用render方法输出json">使用render方法输出JSON</h4>
<div class="paragraph">
<p><code>Render</code> 方法也可以用于输出JSON，但仅应用于不保证创建JSON视图的简单情况下:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">list</span>() {

    <span class="keyword">def</span> results = <span class="predefined-type">Book</span>.list()

    render(<span class="key">contentType</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/json</span><span class="delimiter">&quot;</span></span>) {
        books(results) { <span class="predefined-type">Book</span> b -&gt;
            title b.title
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这种情况下，结果将类似于:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">[
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">The Stand</span><span class="delimiter">&quot;</span></span>},
    {<span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>:<span class="string"><span class="delimiter">&quot;</span><span class="content">Shining</span><span class="delimiter">&quot;</span></span>}
]</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
对于非常简单的响应，这种呈现JSON的技术可能是可以的，但是通常，您应该支持使用 <a href="webServices.html#jsonViews">JSON Views</a> 并使用视图层，而不是在应用程序中嵌入逻辑.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>与上述XML命名冲突相同的危险也适用于JSON构建.</p>
</div>
</div>

<a name="7.1.8 &#20851;&#20110; JSONBuilder &#30340;&#25193;&#23637;"><!-- Legacy link --></a>
<h2 id="moreOnJSONBuilder">8.1.7 关于 JSONBuilder</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/moreOnJSONBuilder.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>上一节有关XML和JSON响应的部分介绍了呈现XML和JSON响应的简单示例。 尽管Grails使用的XML构建器是Groovy中的标准 <a href="http://groovy-lang.org/processing-xml.html#_xmlparser_and_xmlslurper">XmlSlurper</a> .</p>
</div>
<div class="paragraph">
<p>对于JSON，自Grails 3.1起，Grails默认使用Groovy的 <a href="http://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#_streamingjsonbuilder">StreamingJsonBuilder</a> 您可以参考 link: <a href="http://docs.groovy-lang.org/latest/html/documentation/core-domain-specific-languages.html#_streamingjsonbuilder">Groovy documentation</a> 和 <a href="http://docs.groovy-lang.org/latest/html/gapi/groovy/json/StreamingJsonBuilder.html">StreamingJsonBuilder</a> API文档 如何使用它.</p>
</div>


<h2 id="xmlResponses">8.1.8 使用 XML 响应</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/xmlResponses.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>




<a name="7.1.9 &#19978;&#20256;&#25991;&#20214;"><!-- Legacy link --></a>
<h2 id="uploadingFiles">8.1.9 上传文件</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/uploadingFiles.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect3">
<h4 id="_程序化文件上传">程序化文件上传</h4>
<div class="paragraph">
<p>Grails支持使用Spring的 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/multipart/MultipartHttpServletRequest.html">MultipartHttpServletRequest</a> 接口上传文件。 上传文件的第一步是创建一个多部分表单，如下所示：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml">Upload Form: <span class="tag">&lt;br</span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;g:uploadForm</span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">upload</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
        <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">file</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">myFile</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
        <span class="tag">&lt;input</span> <span class="attribute-name">type</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit</span><span class="delimiter">&quot;</span></span> <span class="tag">/&gt;</span>
    <span class="tag">&lt;/g:uploadForm&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p><code>uploadForm</code> 标签将 <code>enctype ="multipart/form-data"</code> 属性添加到标准 <code>&lt;g:form&gt;</code> 标签中。
有多种方法可以处理文件上传。 一种是直接使用Spring <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/multipart/MultipartFile.html">MultipartFile</a> 实例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> <span class="function">upload</span>() {
    <span class="keyword">def</span> f = request.getFile(<span class="string"><span class="delimiter">'</span><span class="content">myFile</span><span class="delimiter">'</span></span>)
    <span class="keyword">if</span> (f.empty) {
        flash.message = <span class="string"><span class="delimiter">'</span><span class="content">file cannot be empty</span><span class="delimiter">'</span></span>
        render(<span class="key">view</span>: <span class="string"><span class="delimiter">'</span><span class="content">uploadForm</span><span class="delimiter">'</span></span>)
        <span class="keyword">return</span>
    }

    f.transferTo(<span class="keyword">new</span> <span class="predefined-type">File</span>(<span class="string"><span class="delimiter">'</span><span class="content">/some/local/dir/myfile.txt</span><span class="delimiter">'</span></span>))
    response.sendError(<span class="integer">200</span>, <span class="string"><span class="delimiter">'</span><span class="content">Done</span><span class="delimiter">'</span></span>)
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过 <a href="https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/multipart/MultipartFile.html">MultipartFile</a> 界面可以获得 <code>InputStream</code> 等信息，方便对其他目的地的传输和直接处理文件。</p>
</div>
</div>
<div class="sect3">
<h4 id="_通过数据绑定上传文件">通过数据绑定上传文件</h4>
<div class="paragraph">
<p>文件上传也可以使用数据绑定来执行。 考虑这个 <code>Image</code> 域类:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Image</span> {
    <span class="type">byte</span><span class="type">[]</span> myFile

    <span class="directive">static</span> constraints = {
        <span class="comment">// Limit upload file size to 2MB</span>
        myFile <span class="key">maxSize</span>: <span class="integer">1024</span> * <span class="integer">1024</span> * <span class="integer">2</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果使用构造函数中的 <code>params</code> 对象创建图像，如下例所示，Grails会将文件的内容作为 <code>byte[]</code> 自动绑定到 <code>myFile</code> 属性：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> img = <span class="keyword">new</span> <span class="predefined-type">Image</span>(params)</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置 <a href="../ref/Constraints/size.html">size</a> 或<a href="../ref/Constraints/maxSize.html">maxSize</a> 约束很重要，否则数据库可能会以较小的列大小创建无法处理大小合理的文件。 例如，对于 <code>byte[]</code> 属性，H2和MySQL的默认Blob大小均为255个字节。
通过将图像上的 <code>myFile</code> 属性的类型更改为String类型，也可以将文件的内容设置为字符串：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">Image</span> {
   <span class="predefined-type">String</span> myFile
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_增加上传最大文件大小">增加上传最大文件大小</h4>
<div class="paragraph">
<p>Grails上载文件的默认大小为128000（〜128KB).当超出此限制时，将看到以下异常：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java">org.springframework.web.multipart.MultipartException: Could not parse multipart servlet request; nested exception is java.lang.IllegalStateException: org.apache.tomcat.util.http.fileupload.FileUploadBase<span class="error">$</span><span class="exception">SizeLimitExceededException</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>可以在 <code>application.yml</code> 中配置限制，如下所示：</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yml"><span class="key">grails</span>:
    <span class="key">controllers</span>:
        <span class="key">upload</span>:
            <span class="key">maxFileSize</span>: <span class="string"><span class="content">2000000</span></span>
            <span class="key">maxRequestSize</span>: <span class="string"><span class="content">2000000</span></span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`maxFileSize` = 允许上传文件的最大大小。</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>`maxRequestSize` =  多部分/表单数据请求所允许的最大大小。</pre>
</div>
</div>
<div class="paragraph">
<p>您应牢记 <a href="https://www.owasp.org/index.php/Unrestricted_File_Upload">OWASP recommendations - Unrestricted File Upload</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
将文件大小限制为最大值，以防止拒绝服务攻击。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>存在这些限制是为了防止DoS攻击并增强应用程序整体性能</p>
</div>
</div>

<a name="7.1.10 &#21629;&#20196;&#23545;&#35937;"><!-- Legacy link --></a>
<h2 id="commandObjects">8.1.10 命令对象</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/commandObjects.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails控制器支持命令对象的概念。命令对象是与 <a href="theWebLayer.html#dataBinding">data binding</a> 结合使用的类，通常用于验证可能不适合现有域类的数据。</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
仅当类用作操作的参数时，才将其视为命令对象。
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_声明命令对象">声明命令对象</h4>
<div class="paragraph">
<p>命令对象类的定义与其他任何类一样。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LoginCommand</span> <span class="directive">implements</span> grails.validation.Validateable {
    <span class="predefined-type">String</span> username
    <span class="predefined-type">String</span> password

    <span class="directive">static</span> constraints = {
        username(<span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">minSize</span>: <span class="integer">6</span>)
        password(<span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">minSize</span>: <span class="integer">6</span>)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，命令对象类实现了 <code>Validateable</code> 特征。<code>Validateable</code> 特征允许对 <a href="validation.html#constraints">Constraints</a> 的定义，就像在 <a href="GORM.html">domain classes</a> 中一样。如果命令对象与使用它的控制器在同一源文件中定义，则Grails会自动将其设为 <code>Validateable</code> 。不需要命令对象类是可验证的。</p>
</div>
<div class="paragraph">
<p>默认情况下，不是 <code>java.util.Collection</code> 或 <code>java.util.Map</code> 实例的所有 <code>Validateable</code> 对象属性都是 <code>nullable: false</code>。<code>java.util.Collection</code> 和 <code>java.util.Map</code> 的实例默认为 <code>nullable: true</code> 。如果您希望默认情况下具有 <code>nullable: true</code> 属性的 <code>Validateable</code>，则可以通过在类中定义 <code>defaultNullable</code> 方法来指定此值：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">AuthorSearchCommand</span> <span class="directive">implements</span> grails.validation.Validateable {
    <span class="predefined-type">String</span>  name
    <span class="predefined-type">Integer</span> age

    <span class="directive">static</span> <span class="type">boolean</span> defaultNullable() {
        <span class="predefined-constant">true</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，<code>name</code> 和 <code>age</code> 在验证期间都将允许空值。</p>
</div>
</div>
<div class="sect3">
<h4 id="_使用命令对象">使用命令对象</h4>
<div class="paragraph">
<p>要使用命令对象，控制器动作可以选择指定任意数量的命令对象参数。必须提供参数类型，以便Grails知道要创建和初始化的对象。</p>
</div>
<div class="paragraph">
<p>在执行控制器动作之前，Grails将自动创建命令对象类的实例，并通过绑定请求参数来填充其属性。如果命令对象类标记有 <code>Validateable</code>，则将验证命令对象。例如：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LoginController</span> {

    <span class="keyword">def</span> <span class="function">login</span>(LoginCommand cmd) {
        <span class="keyword">if</span> (cmd.hasErrors()) {
            redirect(<span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">loginForm</span><span class="delimiter">'</span></span>)
            <span class="keyword">return</span>
        }

        <span class="comment">// work with the command object data</span>
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果命令对象的类型是域类的类型，并且有一个 <code>id</code> 请求参数，则将调用域类的静态 <code>get</code> 方法，而不是调用域类的构造函数来创建新实例。 <code>id</code> 参数的值将作为参数传递。</p>
</div>
<div class="paragraph">
<p>调用 <code>get</code> 返回的结果将传递到控制器动作中。这意味着，如果有一个 <code>id</code> 请求参数，而在数据库中找不到相应的记录，那么命令对象的值将为 <code>null</code>。如果在从数据库中检索实例时发生错误，则将 <code>null</code> 作为控制器操作的参数传递给错误，并且将添加错误的controllers <code>errors</code> 属性。</p>
</div>
<div class="paragraph">
<p>如果命令对象的类型是域类，并且没有 <code>id</code> 请求参数，或者没有 <code>id</code> 请求参数，并且其值为空，那么除非HTTP request方法为 <code>null</code> ，否则它将被传递给控制器操作"POST"，在这种情况下，将通过调用域类构造函数来创建域类的新实例。对于域类实例为非空的所有情况，仅当HTTP请求方法为"POST"，"PUT"或"PATCH"时才执行数据绑定。</p>
</div>
</div>
<div class="sect3">
<h4 id="_命令对象和请求参数名称">命令对象和请求参数名称</h4>
<div class="paragraph">
<p>通常，请求参数名称将直接映射到命令对象中的属性名称。嵌套参数名称可用于以直观方式绑定对象图。</p>
</div>
<div class="paragraph">
<p>在下面的示例中，名为 <code>name</code> 的请求参数将绑定到 <code>Person</code> 实例的 <code>name</code> 属性，而名为 <code>address.city</code> 的请求参数将绑定到 <code>address</code> 实例的 <code>city</code> 属性。  <code>Person</code> 中的属性。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StoreController</span> {
    <span class="keyword">def</span> <span class="function">buy</span>(Person buyer) {
        <span class="comment">// ...</span>
    }
}

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Address address
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果控制器动作接受恰好包含相同属性名称的多个命令对象，则可能会出现问题。考虑以下示例。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StoreController</span> {
    <span class="keyword">def</span> <span class="function">buy</span>(Person buyer, Product product) {
        <span class="comment">// ...</span>
    }
}

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Address address
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
}

<span class="type">class</span> <span class="class">Product</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果有一个名为 <code>name</code> 的请求参数，则不清楚该参数是否应代表 <code>Product</code> 的名称或 <code>Person</code> 的名称。如果控制器动作接受2个相同类型的命令对象，则可能会出现该问题的另一个版本，如下所示。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">StoreController</span> {
    <span class="keyword">def</span> <span class="function">buy</span>(Person buyer, Person seller, Product product) {
        <span class="comment">// ...</span>
    }
}

<span class="type">class</span> <span class="class">Person</span> {
    <span class="predefined-type">String</span> name
    Address address
}

<span class="type">class</span> <span class="class">Address</span> {
    <span class="predefined-type">String</span> city
}

<span class="type">class</span> <span class="class">Product</span> {
    <span class="predefined-type">String</span> name
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>为了帮助解决此问题，框架强加了一些特殊的规则，用于将参数名称映射到命令对象类型。命令对象数据绑定将把以控制器操作参数名称开头的所有参数视为属于相应命令对象。</p>
</div>
<div class="paragraph">
<p>例如，<code>product.name</code> 请求参数将绑定到 <code>product</code> 参数中的 <code>name</code> 属性，<code>buyer.name</code> 请求参数将绑定到 <code>buyer</code> 参数中的 <code>name</code> 属性。 <code>seller.address.city</code> 请求参数将绑定到 <code>seller</code> 参数的 <code>address</code> 属性的 <code>city</code> 属性等。</p>
</div>
</div>
<div class="sect3">
<h4 id="_命令对象和依赖注入">命令对象和依赖注入</h4>
<div class="paragraph">
<p>命令对象可以参与依赖项注入。如果您的命令对象具有一些使用Grails链接的自定义验证逻辑，这将非常有用<a href="services.html">service</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">LoginCommand</span> <span class="directive">implements</span> grails.validation.Validateable {

    <span class="keyword">def</span> loginService

    <span class="predefined-type">String</span> username
    <span class="predefined-type">String</span> password

    <span class="directive">static</span> constraints = {
        username <span class="key">validator</span>: { val, obj -&gt;
            obj.loginService.canLogin(obj.username, obj.password)
        }
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在这个例子中，命令对象与 <code>loginService</code> bean交互，该bean是通过名字从Spring <code>ApplicationContext</code> 中注入的。</p>
</div>
</div>
<div class="sect3">
<h4 id="_将请求主体绑定到命令对象">将请求主体绑定到命令对象</h4>
<div class="paragraph">
<p>当发出对接受命令对象的控制器操作的请求，并且该请求包含主体时，Grails将尝试根据请求内容类型解析请求的主体，并使用该主体对命令对象进行数据绑定。请参见以下示例。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/bindingdemo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createWidget</span>(Widget w) {
        render <span class="string"><span class="delimiter">&quot;</span><span class="content">Name: </span><span class="inline"><span class="inline-delimiter">${</span>w?.name<span class="inline-delimiter">}</span></span><span class="content">, Size: </span><span class="inline"><span class="inline-delimiter">${</span>w?.size<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>
    }
}

<span class="type">class</span> <span class="class">Widget</span> {
    <span class="predefined-type">String</span> name
    <span class="predefined-type">Integer</span> size
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl -H &quot;Content-Type: application/json&quot; -d '{&quot;name&quot;:&quot;Some Widget&quot;,&quot;42&quot;}'[size] localhost:8080/demo/createWidget
 Name: Some Widget, Size: 42

$ curl -H &quot;Content-Type: application/xml&quot; -d '&lt;widget&gt;&lt;name&gt;Some Other Widget&lt;/name&gt;&lt;size&gt;2112&lt;/size&gt;&lt;/widget&gt;' localhost:8080/bodybind/demo/createWidget
 Name: Some Other Widget, Size: 2112</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在以下情况下，将不会解析请求正文：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>请求方法为GET</p>
</li>
<li>
<p>请求方法为DELETE</p>
</li>
<li>
<p>内容长度为0</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>请注意，正在解析请求的主体以使其正常工作。此后任何尝试读取请求正文的尝试都将失败，因为相应的输入流将为空。控制器动作可以使用命令对象，也可以自行解析请求的主体（直接解析或通过引用诸如request.JSON之类的东西），但不能同时执行。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/bindingdemo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> bindingdemo

<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createWidget</span>(Widget w) {
        <span class="comment">// this will fail because it requires reading the body,</span>
        <span class="comment">// which has already been read.</span>
        <span class="keyword">def</span> json = request.JSON

        <span class="comment">// ...</span>

    }
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_使用命令对象列表">使用命令对象列表</h4>
<div class="paragraph">
<p>命令对象的常见用例是一个包含另一个对象的集合的命令对象：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">createAuthor</span>(AuthorCommand command) {
        <span class="comment">// ...</span>

    }

    <span class="type">class</span> <span class="class">AuthorCommand</span> {
        <span class="predefined-type">String</span> fullName
        <span class="predefined-type">List</span>&lt;BookCommand&gt; books
    }

    <span class="type">class</span> <span class="class">BookCommand</span> {
        <span class="predefined-type">String</span> title
        <span class="predefined-type">String</span> isbn
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>在此示例中，我们要创建一个包含多本Books的Author。</p>
</div>
<div class="paragraph">
<p>为了从UI层进行这项工作，您可以在GSP中执行以下操作：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:form</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">submit-author-books</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">controller</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">demo</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">action</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">createAuthor</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
    <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">fullName</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
    <span class="tag">&lt;ul&gt;</span>
        <span class="tag">&lt;li&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[0].isbn</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/li&gt;</span>

        <span class="tag">&lt;li&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].title</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
            <span class="tag">&lt;g:fieldValue</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">books[1].isbn</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">value</span>=<span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span>
        <span class="tag">&lt;/li&gt;</span>
    <span class="tag">&lt;/ul&gt;</span>
<span class="tag">&lt;/g:form&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>还支持JSON，因此您可以使用正确的数据绑定提交以下内容</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">fullName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Graeme Rocher</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">books</span><span class="delimiter">&quot;</span></span>: [{
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Definitive Guide to Grails</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1111-343455-1111</span><span class="delimiter">&quot;</span></span>
    }, {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">The Definitive Guide to Grails 2</span><span class="delimiter">&quot;</span></span>,
        <span class="key"><span class="delimiter">&quot;</span><span class="content">isbn</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1111-343455-1112</span><span class="delimiter">&quot;</span></span>
    }],
}</code></pre>
</div>
</div>
</div>

<a name="7.1.11 &#22788;&#29702;&#37325;&#22797;&#34920;&#21333;&#25552;&#20132;"><!-- Legacy link --></a>
<h2 id="formtokens">8.1.11 处理重复表单提交</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/formtokens.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails具有使用“同步器令牌模式”处理重复表单提交的内置支持。 首先，请在链接上定义令牌： <a href="http://gsp.grails.org/latest/ref/Tags/form.html">form</a> 标记:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:form</span> <span class="attribute-name">useToken</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">...</span><span class="tag">&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>然后，在您的控制器代码中，可以使用 <a href="../ref/Controllers/withForm.html">withForm</a> 方法来处理有效和无效的请求:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">withForm {
   <span class="comment">// good request</span>
}.invalidToken {
   <span class="comment">// bad request</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>如果您仅提供 <a href="../ref/Controllers/withForm.html">withForm</a> 方法而不是链式的 <code>invalidToken</code> 方法，则Grails默认会将无效令牌存储在 <code>flash.invalidToken</code> 变量中并重定向请求 回到原始页面。 然后可以在视图中检查:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;g:if</span> <span class="attribute-name">test</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">${flash.invalidToken}</span><span class="delimiter">&quot;</span></span><span class="tag">&gt;</span>
  Don't click the button twice!
<span class="tag">&lt;/g:if&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<a href="../ref/Controllers/withForm.html">withForm</a> 标记使用 <a href="../ref/Controllers/session.html">session</a> 因此如果在集群中使用，则需要会话关联性或集群会话.
</td>
</tr>
</table>
</div>

<a name="7.1.12 &#22522;&#26412;&#31867;&#22411;&#36716;&#25442;"><!-- Legacy link --></a>
<h2 id="typeConverters">8.1.12 基本类型转换器</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/typeConverters.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="sect2">
<h3 id="_类型转换方法">类型转换方法</h3>
<div class="paragraph">
<p>如果想避免 <a href="theWebLayer.html#dataBinding">data binding</a> 的开销，只是想将传入参数（通常是字符串）转换为另一个更合适的类型，请<a href="../ref/Controllers/params.html">params</a> 对象为每种类型提供许多方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> total = params.int(<span class="string"><span class="delimiter">'</span><span class="content">total</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的示例使用 <code>int</code> 方法，还有 <code>boolean</code>, <code>long</code>, <code>char</code>, <code>short</code> 等方法。 这些方法中的每一个都是null安全的，并且不会出现任何解析错误，因此不必对参数进行任何其他检查。
每个转换方法都允许将默认值作为可选的第二个参数传递。 如果在映射中找不到对应的条目，或者在转换过程中发生错误，则将返回默认值。 例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">def</span> total = params.int(<span class="string"><span class="delimiter">'</span><span class="content">total</span><span class="delimiter">'</span></span>, <span class="integer">42</span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>这些相同的类型转换方法也可以在GSP标签的 <code>attrs</code> 参数上使用。</p>
</div>
</div>
<div class="sect2">
<h3 id="_处理多个参数">处理多个参数</h3>
<div class="paragraph">
<p>常见的一个用例是处理多个相同名称的请求参数。 例如，可以获得一个查询字符串，例如 <code>？name = Bob＆name = Judy</code></p>
</div>
<div class="paragraph">
<p>在这种情况下，处理一个参数和处理多个参数具有不同的语义，因为Groovy的 <code>String</code> 迭代机制在每个字符上进行迭代。 为了避免这个问题，可以<a href="../ref/Controllers/params.html">params</a> 对象提供了一个总是返回列表的 <code>list</code> 方法：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">for</span> (name <span class="keyword">in</span> params.list(<span class="string"><span class="delimiter">'</span><span class="content">name</span><span class="delimiter">'</span></span>)) {
    println name
}</code></pre>
</div>
</div>
</div>


<h2 id="controllerExceptionHandling">8.1.13 声明性控制器异常处理</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails/grails-doc/edit/master/src/en/guide/theWebLayer/controllers/controllerExceptionHandling.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Grails控制器支持声明式异常处理的简单机制。如果控制器声明了一个接受单个参数的方法，且参数类型为 <code>java.lang.Exception</code> 或 <code>java.lang.Exception</code> 的子类，则该控制器中的任何操作引发异常时都会调用该方法。这种类型的。请参见以下示例。</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo


<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">someAction</span>() {
        <span class="comment">// do some work</span>
    }

    <span class="keyword">def</span> <span class="function">handleSQLException</span>(<span class="exception">SQLException</span> e) {
        render <span class="string"><span class="delimiter">'</span><span class="content">A SQLException Was Handled</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleBatchUpdateException</span>(<span class="exception">BatchUpdateException</span> e) {
        redirect <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">logging</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">batchProblem</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleNumberFormatException</span>(<span class="exception">NumberFormatException</span> nfe) {
        [<span class="key">problemDescription</span>: <span class="string"><span class="delimiter">'</span><span class="content">A Number Was Invalid</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>该控制器的行为就像写了这样的东西&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="type">class</span> <span class="class">DemoController</span> {

    <span class="keyword">def</span> <span class="function">someAction</span>() {
        <span class="keyword">try</span> {
            <span class="comment">// do some work</span>
        } <span class="keyword">catch</span> (<span class="exception">BatchUpdateException</span> e) {
            <span class="keyword">return</span> handleBatchUpdateException(e)
        } <span class="keyword">catch</span> (<span class="exception">SQLException</span> e) {
            <span class="keyword">return</span> handleSQLException(e)
        } <span class="keyword">catch</span> (<span class="exception">NumberFormatException</span> e) {
            <span class="keyword">return</span> handleNumberFormatException(e)
        }
    }

    <span class="keyword">def</span> <span class="function">handleSQLException</span>(<span class="exception">SQLException</span> e) {
        render <span class="string"><span class="delimiter">'</span><span class="content">A SQLException Was Handled</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleBatchUpdateException</span>(<span class="exception">BatchUpdateException</span> e) {
        redirect <span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">logging</span><span class="delimiter">'</span></span>, <span class="key">action</span>: <span class="string"><span class="delimiter">'</span><span class="content">batchProblem</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="function">handleNumberFormatException</span>(<span class="exception">NumberFormatException</span> nfe) {
        [<span class="key">problemDescription</span>: <span class="string"><span class="delimiter">'</span><span class="content">A Number Was Invalid</span><span class="delimiter">'</span></span>]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>异常处理程序的方法名称可以是任何有效的方法名称。名称不是使方法成为异常处理程序的原因，<code>Exception</code> 参数类型是重要的部分。</p>
</div>
<div class="paragraph">
<p>异常处理程序方法可以执行控制器动作可以执行的任何操作，包括调用 <code>render</code>，<code>redirect</code>，返回模型等。</p>
</div>
<div class="paragraph">
<p>在多个控制器之间共享异常处理程序方法的一种方法是使用继承。异常处理程序方法被继承到子类中，因此应用程序可以在多个控制器从其扩展的抽象类中定义异常处理程序。在多个控制器之间共享异常处理程序方法的另一种方法是使用特征，如下所示&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/com/demo/DatabaseExceptionHandler.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.demo

trait DatabaseExceptionHandler {
    <span class="keyword">def</span> <span class="function">handleSQLException</span>(<span class="exception">SQLException</span> e) {
        <span class="comment">// handle SQLException</span>
    }

    <span class="keyword">def</span> <span class="function">handleBatchUpdateException</span>(<span class="exception">BatchUpdateException</span> e) {
        <span class="comment">// handle BatchUpdateException</span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/com/demo/DemoController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> com.demo

<span class="type">class</span> <span class="class">DemoController</span> <span class="directive">implements</span> DatabaseExceptionHandler {

    <span class="comment">// all of the exception handler methods defined</span>
    <span class="comment">// in DatabaseExceptionHandler will be added to</span>
    <span class="comment">// this class at compile time</span>
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>异常处理程序方法必须在编译时出现。具体来说，不支持将运行时元编程到控制器类上的异常处理程序方法。</p>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../../guide/GORM.html">&lt;&lt; <strong>7</strong><span>&#23545;&#35937;&#20851;&#31995;&#26144;&#23556; &#65288;GORM&#65289;</span></a></div>
                
                    <div class="toc-item next-right"><a href="../../guide/traits.html"><strong>9</strong><span>&#29305;&#24449;&#65288;Trait&#65289;</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Command Line</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Command%20Line/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/bug-report.html">bug-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/clean.html">clean</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/compile.html">compile</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/console.html">console</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-app.html">create-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-command.html">create-command</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-controller.html">create-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-domain-class.html">create-domain-class</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-functional-test.html">create-functional-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-hibernate-cfg-xml.html">create-hibernate-cfg-xml</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-integration-test.html">create-integration-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-interceptor.html">create-interceptor</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-plugin.html">create-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-profile.html">create-profile</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-script.html">create-script</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-service.html">create-service</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-taglib.html">create-taglib</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/create-unit-test.html">create-unit-test</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/dependency-report.html">dependency-report</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/docs.html">docs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-all.html">generate-all</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-controller.html">generate-controller</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/generate-views.html">generate-views</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/help.html">help</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/install-templates.html">install-templates</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/list-plugins.html">list-plugins</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/list-profiles.html">list-profiles</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/package-plugin.html">package-plugin</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/package.html">package</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/plugin-info.html">plugin-info</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/profile-info.html">profile-info</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/run-app.html">run-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/run-command.html">run-command</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/run-script.html">run-script</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/schema-export.html">schema-export</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/shell.html">shell</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/stats.html">stats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/stop-app.html">stop-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/test-app.html">test-app</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Command%20Line/war.html">war</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Constraints</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Constraints/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Constraints/attributes.html">attributes</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/bindable.html">bindable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/blank.html">blank</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/creditCard.html">creditCard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/email.html">email</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/inList.html">inList</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/matches.html">matches</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/max.html">max</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/maxSize.html">maxSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/min.html">min</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/minSize.html">minSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/notEqual.html">notEqual</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/nullable.html">nullable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/range.html">range</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/scale.html">scale</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/size.html">size</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/unique.html">unique</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/url.html">url</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/validator.html">validator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Constraints/widget.html">widget</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Controllers</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Controllers/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Controllers/actionName.html">actionName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/allowedMethods.html">allowedMethods</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/bindData.html">bindData</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/chain.html">chain</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/controllerName.html">controllerName</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/defaultAction.html">defaultAction</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/errors.html">errors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/flash.html">flash</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/forward.html">forward</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/grailsApplication.html">grailsApplication</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/namespace.html">namespace</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/params.html">params</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/redirect.html">redirect</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/render.html">render</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/respond.html">respond</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/responseFormats.html">responseFormats</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/scope.html">scope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/session.html">session</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/withForm.html">withForm</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Controllers/withFormat.html">withFormat</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Database Mapping</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/autoImport.html">autoImport</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/autoTimestamp.html">autoTimestamp</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/batchSize.html">batchSize</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/cache.html">cache</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/cascade.html">cascade</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/column.html">column</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/comment.html">comment</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/discriminator.html">discriminator</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/dynamicInsert.html">dynamicInsert</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/dynamicUpdate.html">dynamicUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/fetch.html">fetch</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/id.html">id</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/ignoreNotFound.html">ignoreNotFound</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/indexColumn.html">indexColumn</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/insertable.html">insertable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/joinTable.html">joinTable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/lazy.html">lazy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/order.html">order</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/sort.html">sort</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/table.html">table</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/type.html">type</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/updateable.html">updateable</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Database%20Mapping/version.html">version</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/addTo.html">addTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/attach.html">attach</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/belongsTo.html">belongsTo</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/clearErrors.html">clearErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/constraints.html">constraints</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/count.html">count</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/countBy.html">countBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/createCriteria.html">createCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/delete.html">delete</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/discard.html">discard</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/embedded.html">embedded</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/errors.html">errors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/executeQuery.html">executeQuery</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/executeUpdate.html">executeUpdate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/exists.html">exists</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/fetchMode.html">fetchMode</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/find.html">find</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAll.html">findAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAllBy.html">findAllBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findAllWhere.html">findAllWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findBy.html">findBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrCreateBy.html">findOrCreateBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrCreateWhere.html">findOrCreateWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrSaveBy.html">findOrSaveBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findOrSaveWhere.html">findOrSaveWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/findWhere.html">findWhere</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/first.html">first</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/get.html">get</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getAll.html">getAll</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getDirtyPropertyNames.html">getDirtyPropertyNames</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/getPersistentValue.html">getPersistentValue</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasErrors.html">hasErrors</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasMany.html">hasMany</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/hasOne.html">hasOne</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/ident.html">ident</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/instanceOf.html">instanceOf</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/isAttached.html">isAttached</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/isDirty.html">isDirty</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/last.html">last</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/list.html">list</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/listOrderBy.html">listOrderBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/load.html">load</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/lock.html">lock</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mapWith.html">mapWith</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mappedBy.html">mappedBy</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/mapping.html">mapping</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/merge.html">merge</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/namedQueries.html">namedQueries</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/properties.html">properties</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/read.html">read</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/refresh.html">refresh</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/removeFrom.html">removeFrom</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/save.html">save</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/transients.html">transients</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/validate.html">validate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/where.html">where</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/whereAny.html">whereAny</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withCriteria.html">withCriteria</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withNewSession.html">withNewSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withSession.html">withSession</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Domain%20Classes/withTransaction.html">withTransaction</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Plug-ins</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Plug-ins/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/URL%20mappings.html">URL mappings</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/codecs.html">codecs</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/controllers.html">controllers</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/core.html">core</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/dataSource.html">dataSource</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/domainClasses.html">domainClasses</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/hibernate.html">hibernate</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/i18n.html">i18n</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/logging.html">logging</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/scaffolding.html">scaffolding</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/services.html">services</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Plug-ins/servlets.html">servlets</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Services</h1><div class="menu-sub">
                        
                            <div class="menu-item"><a href="../../ref/Services/Usage.html">Usage</a></div>
                            
                            
                            <div class="menu-item"><a href="../../ref/Services/scope.html">scope</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Services/transactional.html">transactional</a>
                            </div>
                            
                            </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Servlet API</h1><div class="menu-sub">
                        
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/request.html">request</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/response.html">response</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/servletContext.html">servletContext</a>
                            </div>
                            
                            <div class="menu-item"><a href="../../ref/Servlet%20API/session.html">session</a>
                            </div>
                            
                            </div>
                    </div>
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically.
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
